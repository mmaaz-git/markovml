<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 15.0.1"/>
    <title>markovml.markovml API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .decorator-deprecated{color:#842029;}.pdoc .decorator-deprecated ~ span{filter:grayscale(1) opacity(0.8);}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style><script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>
    mjx-container {
        overflow-x: auto;
        overflow-y: hidden;
    }
</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../markovml.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;markovml</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#AbstractMarkov">AbstractMarkov</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#AbstractMarkov.__init__">AbstractMarkov</a>
                        </li>
                        <li>
                                <a class="variable" href="#AbstractMarkov.n_states">n_states</a>
                        </li>
                        <li>
                                <a class="variable" href="#AbstractMarkov.n_features">n_features</a>
                        </li>
                        <li>
                                <a class="variable" href="#AbstractMarkov.model">model</a>
                        </li>
                        <li>
                                <a class="variable" href="#AbstractMarkov.variables">variables</a>
                        </li>
                        <li>
                                <a class="variable" href="#AbstractMarkov.features">features</a>
                        </li>
                        <li>
                                <a class="variable" href="#AbstractMarkov.feature_aux">feature_aux</a>
                        </li>
                        <li>
                                <a class="variable" href="#AbstractMarkov.feature_constraints">feature_constraints</a>
                        </li>
                        <li>
                                <a class="variable" href="#AbstractMarkov.ml_models">ml_models</a>
                        </li>
                        <li>
                                <a class="variable" href="#AbstractMarkov.ml_outputs">ml_outputs</a>
                        </li>
                        <li>
                                <a class="function" href="#AbstractMarkov.get_values">get_values</a>
                        </li>
                        <li>
                                <a class="function" href="#AbstractMarkov.set_to_ml_output">set_to_ml_output</a>
                        </li>
                        <li>
                                <a class="function" href="#AbstractMarkov.set_to_const">set_to_const</a>
                        </li>
                        <li>
                                <a class="function" href="#AbstractMarkov.add_feature_constraint">add_feature_constraint</a>
                        </li>
                        <li>
                                <a class="function" href="#AbstractMarkov.add_feature_aux_variable">add_feature_aux_variable</a>
                        </li>
                        <li>
                                <a class="function" href="#AbstractMarkov.add_constraint">add_constraint</a>
                        </li>
                        <li>
                                <a class="function" href="#AbstractMarkov.add_ml_model">add_ml_model</a>
                        </li>
                        <li>
                                <a class="function" href="#AbstractMarkov.optimize">optimize</a>
                        </li>
                        <li>
                                <a class="function" href="#AbstractMarkov.find_feasible">find_feasible</a>
                        </li>
                        <li>
                                <a class="function" href="#AbstractMarkov.get_value">get_value</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MarkovReward">MarkovReward</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MarkovReward.__init__">MarkovReward</a>
                        </li>
                        <li>
                                <a class="variable" href="#MarkovReward.discount_factor">discount_factor</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkovReward.get_values">get_values</a>
                        </li>
                        <li>
                                <a class="variable" href="#MarkovReward.pi">pi</a>
                        </li>
                        <li>
                                <a class="variable" href="#MarkovReward.P">P</a>
                        </li>
                        <li>
                                <a class="variable" href="#MarkovReward.r">r</a>
                        </li>
                        <li>
                                <a class="variable" href="#MarkovReward.v">v</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkovReward.set_pi">set_pi</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkovReward.set_r">set_r</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkovReward.set_P">set_P</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkovReward.add_ifr_inequalities">add_ifr_inequalities</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MarkovReach">MarkovReach</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MarkovReach.__init__">MarkovReach</a>
                        </li>
                        <li>
                                <a class="variable" href="#MarkovReach.n_targets">n_targets</a>
                        </li>
                        <li>
                                <a class="variable" href="#MarkovReach.n_transient">n_transient</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkovReach.get_values">get_values</a>
                        </li>
                        <li>
                                <a class="variable" href="#MarkovReach.pi">pi</a>
                        </li>
                        <li>
                                <a class="variable" href="#MarkovReach.Q">Q</a>
                        </li>
                        <li>
                                <a class="variable" href="#MarkovReach.R">R</a>
                        </li>
                        <li>
                                <a class="variable" href="#MarkovReach.v">v</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkovReach.set_pi">set_pi</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkovReach.set_Q">set_Q</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkovReach.set_R">set_R</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#MarkovHitting">MarkovHitting</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MarkovHitting.__init__">MarkovHitting</a>
                        </li>
                        <li>
                                <a class="variable" href="#MarkovHitting.n_transient">n_transient</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkovHitting.get_values">get_values</a>
                        </li>
                        <li>
                                <a class="variable" href="#MarkovHitting.pi">pi</a>
                        </li>
                        <li>
                                <a class="variable" href="#MarkovHitting.Q">Q</a>
                        </li>
                        <li>
                                <a class="variable" href="#MarkovHitting.v">v</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkovHitting.set_pi">set_pi</a>
                        </li>
                        <li>
                                <a class="function" href="#MarkovHitting.set_Q">set_Q</a>
                        </li>
                </ul>

            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../markovml.html">markovml</a><wbr>.markovml    </h1>

                
                        <input id="mod-markovml-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-markovml-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="kn">import</span> <span class="nn">gurobipy</span> <span class="k">as</span> <span class="nn">gp</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a><span class="kn">from</span> <span class="nn">gurobipy</span> <span class="kn">import</span> <span class="n">GRB</span>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="kn">from</span> <span class="nn">gurobi_ml.sklearn</span> <span class="kn">import</span> <span class="p">(</span><span class="n">add_linear_regression_constr</span><span class="p">,</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a>                               <span class="n">add_logistic_regression_constr</span><span class="p">,</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a>                               <span class="n">add_decision_tree_regressor_constr</span><span class="p">,</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a>                               <span class="n">add_random_forest_regressor_constr</span><span class="p">,</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a>                               <span class="n">add_mlp_regressor_constr</span><span class="p">)</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="kn">from</span> <span class="nn">gurobi_ml.torch</span> <span class="kn">import</span> <span class="n">add_sequential_constr</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="kn">from</span> <span class="nn">markovml.utils.gurobi_ml_ext</span> <span class="kn">import</span> <span class="p">(</span><span class="n">add_decision_tree_classifier_constr</span><span class="p">,</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a>                           <span class="n">add_random_forest_classifier_constr</span><span class="p">,</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a>                           <span class="n">add_mlp_classifier_constr</span><span class="p">,</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a>                           <span class="n">add_decision_rules_constr</span><span class="p">,</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a>                           <span class="n">add_sequential_classifier_constr</span><span class="p">,</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a>                           <span class="n">_get_sequential_n_outputs</span><span class="p">)</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">Tuple</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a><span class="kn">import</span> <span class="nn">re</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="p">(</span><span class="n">LinearRegression</span><span class="p">,</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a>                                  <span class="n">LogisticRegression</span><span class="p">,</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a>                                  <span class="n">Ridge</span><span class="p">,</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a>                                  <span class="n">Lasso</span><span class="p">)</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="p">(</span><span class="n">RandomForestRegressor</span><span class="p">,</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a>                              <span class="n">RandomForestClassifier</span><span class="p">)</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a><span class="kn">from</span> <span class="nn">sklearn.neural_network</span> <span class="kn">import</span> <span class="p">(</span><span class="n">MLPRegressor</span><span class="p">,</span> <span class="n">MLPClassifier</span><span class="p">)</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="kn">from</span> <span class="nn">sklearn.tree</span> <span class="kn">import</span> <span class="p">(</span><span class="n">DecisionTreeRegressor</span><span class="p">,</span> <span class="n">DecisionTreeClassifier</span><span class="p">)</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="kn">from</span> <span class="nn">markovml.utils.models_ext</span> <span class="kn">import</span> <span class="n">DecisionRules</span><span class="p">,</span> <span class="n">SequentialClassifier</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="kn">from</span> <span class="nn">torch.nn</span> <span class="kn">import</span> <span class="n">Sequential</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="kn">import</span> <span class="nn">markovml.utils.ima</span> <span class="k">as</span> <span class="nn">ima</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="k">class</span> <span class="nc">AbstractMarkov</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">    This is an abstract class for Markov processes with ML models embedded.</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">    It implements all the basic functionality for setting up a Markov process,</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">    adding ML models, defining the feature space, and optimizing, including</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">    with the decomposition and bound propagation scheme from the paper.</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">    It will be subclassed by `MarkovReward`, `MarkovReach`, and `MarkovHitting`,</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="sd">    which specialize the functionality to the specific problems.</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a>    <span class="c1"># small number for strict inequalities</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a>    <span class="n">_epsilon</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>    <span class="c1"># Supported ml models</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>    <span class="c1"># Currently supported:</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>    <span class="c1">#   linear regression</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>    <span class="c1">#   ridge regression</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>    <span class="c1">#   lasso regression</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>    <span class="c1">#   logistic regression</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>    <span class="c1">#   decision tree regression</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>    <span class="c1">#   decision tree classifier</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>    <span class="c1">#   random forest regression</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>    <span class="c1">#   random forest classifier</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>    <span class="c1">#   mlp regression</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>    <span class="c1">#   mlp classifier</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>    <span class="c1">#   torch sequential</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>    <span class="c1">#   decision rules</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>    <span class="n">_ml_model_registry</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>        <span class="p">(</span><span class="n">LinearRegression</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">):</span> <span class="p">{</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_linear_regression_constr</span><span class="p">,</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">)</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>        <span class="p">},</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>        <span class="n">LogisticRegression</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_logistic_regression_constr</span><span class="p">,</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>        <span class="p">},</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>        <span class="n">DecisionTreeRegressor</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_decision_tree_regressor_constr</span><span class="p">,</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">),</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">n_outputs_</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>        <span class="p">},</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>        <span class="n">DecisionTreeClassifier</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_decision_tree_classifier_constr</span><span class="p">,</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">n_outputs_</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>        <span class="p">},</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>        <span class="n">RandomForestRegressor</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_random_forest_regressor_constr</span><span class="p">,</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">),</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">n_outputs_</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>        <span class="p">},</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>        <span class="n">RandomForestClassifier</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_random_forest_classifier_constr</span><span class="p">,</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">n_outputs_</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>        <span class="p">},</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>        <span class="n">MLPRegressor</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_mlp_regressor_constr</span><span class="p">,</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">),</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">n_outputs_</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>        <span class="p">},</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>        <span class="n">MLPClassifier</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_mlp_classifier_constr</span><span class="p">,</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">n_outputs_</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>        <span class="p">},</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>        <span class="n">DecisionRules</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_decision_rules_constr</span><span class="p">,</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">),</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="mi">1</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>        <span class="p">},</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>        <span class="n">SequentialClassifier</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_sequential_classifier_constr</span><span class="p">,</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="n">_get_sequential_n_outputs</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>        <span class="p">},</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>        <span class="n">Sequential</span><span class="p">:</span> <span class="p">{</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_sequential_constr</span><span class="p">,</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">),</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="n">_get_sequential_n_outputs</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>        <span class="p">}</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>    <span class="p">}</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_states</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a><span class="sd">        Initialize the Markov process with the given number of states and features.</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a><span class="sd">        Parameters</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a><span class="sd">        ----------</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a><span class="sd">        n_states : int</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a><span class="sd">            Number of states in the Markov process (`n` in the paper)</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a><span class="sd">        n_features : int</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a><span class="sd">            Number of features in the Markov process (`m` in the paper)</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a><span class="sd">        Returns</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a><span class="sd">        -------</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a><span class="sd">        None</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a><span class="sd">        Notes</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a><span class="sd">        -----</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a><span class="sd">        This initializes the basic attributes of the Markov process including:</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a><span class="sd">        - Number of states and features</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a><span class="sd">        - Gurobi optimization model</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a><span class="sd">        - Parameter dictionaries for variables, ML output flags, and dimensions</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="sd">        - Feature space variables and constraints</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="sd">        - ML model and output storage</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a><span class="sd">        Subclasses will have additional attributes in their constructors.</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a>        <span class="c1"># basic attributes</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span> <span class="o">=</span> <span class="n">n_states</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_features</span> <span class="o">=</span> <span class="n">n_features</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a>        <span class="c1"># create the main optimization model</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;mainmodel&quot;</span><span class="p">)</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a>        <span class="c1"># store the paramaters</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a>        <span class="c1"># create the feature space</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>            <span class="n">n_features</span><span class="p">,</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a>            <span class="n">lb</span><span class="o">=-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a>            <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a>        <span class="p">)</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_aux</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_constraints</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a>        <span class="c1"># store the ml models</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ml_models</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a>    <span class="c1"># METHODS THAT MUST BE IMPLEMENTED BY SUBCLASSES</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a>    <span class="k">def</span> <span class="nf">_initialize_parameters_and_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="sd">        Here, we add the specific parameters needed for that subclass,</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="sd">        set the appropriate flags for whether they are set, specify their</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="sd">        dimensions, and set them to values if provided. As well, here we</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">        must add necessary constraints for the subclass, for example,</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="sd">        the definition of the value vector v.</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a>        <span class="k">pass</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a>    <span class="k">def</span> <span class="nf">_check_all_vars_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a><span class="sd">        Checks which variables have to be set, either to ML outputs or constants,</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a><span class="sd">        i.e., the variables which must be bound via affine equalities, before</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a><span class="sd">        calling optimize.</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a>        <span class="k">pass</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a>    <span class="k">def</span> <span class="nf">_set_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a><span class="sd">        Set the optimization objective.</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a>        <span class="k">pass</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a>    <span class="k">def</span> <span class="nf">_set_feasible_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">):</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">        Set the constraints on the appropriate quantity for the feasibility version.</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="sd">        The constraints are named &quot;temp_feasible_lb&quot; and &quot;temp_feasible_ub&quot; so that</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a><span class="sd">        they can be removed after the optimization.</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a>        <span class="k">pass</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a>    <span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="sd">        Get values of the key variables of the Markov process after optimization.</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a>        <span class="k">pass</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a>    <span class="k">def</span> <span class="nf">_compute_affine_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ml_bounds</span><span class="p">):</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a><span class="sd">        Propagate the bounds on the ML outputs to the parameters. Must be</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a><span class="sd">        specified by the subclass which parameters are bound by affine equalities</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="sd">        to ML outputs. It should return a dictionary containing bounds for each</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a><span class="sd">        parameter that is an ML output.</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a>        <span class="k">pass</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a>    <span class="k">def</span> <span class="nf">_set_affine_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">affine_bounds</span><span class="p">):</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a><span class="sd">        Set the bounds on the parameters based on the affine bounds.</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a>        <span class="k">pass</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>    <span class="k">def</span> <span class="nf">_compute_initial_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a><span class="sd">        Compute initial bounds on the value vector v. Depends on the subclass.</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a>        <span class="k">pass</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a>    <span class="k">def</span> <span class="nf">_set_initial_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_v_bounds</span><span class="p">):</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="sd">        Set the initial bounds on the value vector v.</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a>        <span class="k">pass</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>    <span class="k">def</span> <span class="nf">_compute_tightened_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a><span class="sd">        Use Gauss-Seidel to compute tighter bounds on value vector.</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a><span class="sd">        Must be implemented by subclasses based on their linear system.</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>        <span class="k">pass</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>    <span class="k">def</span> <span class="nf">_set_tightened_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tightened_v_bounds</span><span class="p">):</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a><span class="sd">        Set the tightened bounds on the value vector v.</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>        <span class="k">pass</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>    <span class="c1"># FUNCTIONS FOR CHECKING VALIDITY OF INPUTTED PARAMETERS</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>    <span class="k">def</span> <span class="nf">_validate_vector_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a><span class="sd">        Validate the length of a vector.</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a><span class="sd">        Parameters</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a><span class="sd">        ----------</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a><span class="sd">        values : Sequence</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a><span class="sd">            The vector whose length needs to be validated</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a><span class="sd">        var_name : str</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a><span class="sd">            Name of the variable for error messages</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a><span class="sd">        Returns</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a><span class="sd">        -------</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a><span class="sd">        None</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a><span class="sd">        Raises</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a><span class="sd">        ------</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a><span class="sd">        ValueError</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a><span class="sd">            If the length of values does not match the expected length stored in</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a><span class="sd">            self._var_dim[var_name][0]</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a><span class="sd">        See Also</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a><span class="sd">        --------</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a><span class="sd">        _validate_matrix_shape</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>        <span class="n">expected_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="n">var_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">!=</span> <span class="n">expected_length</span><span class="p">:</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> must have length </span><span class="si">{</span><span class="n">expected_length</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>    <span class="k">def</span> <span class="nf">_validate_matrix_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">],</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a><span class="sd">        Validate the shape of a matrix.</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a><span class="sd">        Parameters</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a><span class="sd">        ----------</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a><span class="sd">        values : Sequence[Sequence]</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a><span class="sd">            The matrix whose shape needs to be validated</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a><span class="sd">        var_name : str</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a><span class="sd">            Name of the variable for error messages</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a><span class="sd">        Returns</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a><span class="sd">        -------</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a><span class="sd">        None</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a><span class="sd">        Raises</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a><span class="sd">        ------</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a><span class="sd">        ValueError</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a><span class="sd">            If the number of rows in values does not match the expected number of rows stored in</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a><span class="sd">            self._var_dim[var_name][0]</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a><span class="sd">        See Also</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a><span class="sd">        --------</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a><span class="sd">        _validate_vector_length</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>        <span class="n">expected_rows</span><span class="p">,</span> <span class="n">expected_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">!=</span> <span class="n">expected_rows</span><span class="p">:</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> must have </span><span class="si">{</span><span class="n">expected_rows</span><span class="si">}</span><span class="s2"> rows&quot;</span><span class="p">)</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">values</span><span class="p">):</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> must be a 2D sequence (matrix) of size </span><span class="si">{</span><span class="n">expected_rows</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">expected_cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">!=</span> <span class="n">expected_cols</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">values</span><span class="p">):</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Each row of </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> must have length </span><span class="si">{</span><span class="n">expected_cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>    <span class="k">def</span> <span class="nf">_validate_vector_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bounds</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]):</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a><span class="sd">        Validate the bounds of a vector.</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a><span class="sd">        Parameters</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a><span class="sd">        ----------</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a><span class="sd">        values : Sequence</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a><span class="sd">            The vector whose bounds need to be validated</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a><span class="sd">        var_name : str</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a><span class="sd">            Name of the variable for error messages</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a><span class="sd">        bounds : Tuple[float, float]</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a><span class="sd">            The bounds to validate against</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a><span class="sd">        Returns</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a><span class="sd">        -------</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a><span class="sd">        None</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a><span class="sd">        Raises</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a><span class="sd">        ------</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a><span class="sd">        ValueError</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a><span class="sd">            If any value in values does not satisfy the bounds</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a><span class="sd">        See Also</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a><span class="sd">        --------</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a><span class="sd">        _validate_matrix_bounds</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">values</span><span class="p">):</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> must contain values between </span><span class="si">{</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>    <span class="k">def</span> <span class="nf">_validate_matrix_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">],</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bounds</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]):</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a><span class="sd">        Validate the bounds of a matrix.</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a><span class="sd">        Parameters</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a><span class="sd">        ----------</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a><span class="sd">        values : Sequence[Sequence]</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a><span class="sd">            The matrix whose bounds need to be validated</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a><span class="sd">        var_name : str</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a><span class="sd">            Name of the variable for error messages</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a><span class="sd">        bounds : Tuple[float, float]</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a><span class="sd">            The bounds to validate against</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a><span class="sd">        Returns</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a><span class="sd">        -------</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a><span class="sd">        None</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a><span class="sd">        Raises</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a><span class="sd">        ------</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a><span class="sd">        ValueError</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a><span class="sd">            If any value in values does not satisfy the bounds</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a><span class="sd">        See Also</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a><span class="sd">        --------</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a><span class="sd">        _validate_vector_bounds</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">row</span><span class="p">):</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Row </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> must contain values between </span><span class="si">{</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>    <span class="k">def</span> <span class="nf">_validate_stochastic_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">strictsub</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a><span class="sd">        Validate probability vector.</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a><span class="sd">        Parameters</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a><span class="sd">        ----------</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a><span class="sd">        values : Sequence</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a><span class="sd">            The vector of probabilities to validate</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a><span class="sd">        var_name : str</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a><span class="sd">            Name of the variable for error messages</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a><span class="sd">        sub : bool</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a><span class="sd">            If True, allow substochastic (sum &lt;= 1)</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a><span class="sd">        strictsub : bool</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a><span class="sd">            If True, require strict substochastic (sum &lt; 1)</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a><span class="sd">        Returns</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a><span class="sd">        -------</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a><span class="sd">        None</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a><span class="sd">        Raises</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a><span class="sd">        ------</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a><span class="sd">        ValueError</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a><span class="sd">            If the sum of the probabilities does not satisfy the given condition</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a><span class="sd">        See Also</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a><span class="sd">        --------</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a><span class="sd">        _validate_stochastic_matrix</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>        <span class="n">sum_values</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>        <span class="k">if</span> <span class="n">strictsub</span><span class="p">:</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">sum_values</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The sum of probabilities in </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> must be strictly less than 1 (got </span><span class="si">{</span><span class="n">sum_values</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>        <span class="k">elif</span> <span class="n">sub</span><span class="p">:</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">sum_values</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The sum of probabilities in </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> must be at most 1 (got </span><span class="si">{</span><span class="n">sum_values</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sum_values</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-10</span><span class="p">:</span>  <span class="c1"># Use small tolerance for floating point</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The sum of probabilities in </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> must be 1 (got </span><span class="si">{</span><span class="n">sum_values</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>    <span class="k">def</span> <span class="nf">_validate_stochastic_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">],</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">strictsub</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a><span class="sd">        Validate a stochastic matrix.</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a><span class="sd">        Parameters</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a><span class="sd">        ----------</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a><span class="sd">        values : Sequence[Sequence]</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a><span class="sd">            The matrix of probabilities to validate</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a><span class="sd">        var_name : str</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a><span class="sd">            Name of the variable for error messages</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a><span class="sd">        sub : bool</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a><span class="sd">            If True, allow substochastic (sum &lt;= 1)</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a><span class="sd">        strictsub : bool</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a><span class="sd">            If True, require strict substochastic (sum &lt; 1)</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a><span class="sd">        Returns</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a><span class="sd">        -------</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a><span class="sd">        None</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a><span class="sd">        Raises</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a><span class="sd">        ------</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a><span class="sd">        ValueError</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a><span class="sd">            If the sum of the probabilities does not satisfy the given condition</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a><span class="sd">        See Also</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a><span class="sd">        --------</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a><span class="sd">        _validate_stochastic_vector</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="n">sub</span><span class="p">,</span> <span class="n">strictsub</span><span class="o">=</span><span class="n">strictsub</span><span class="p">)</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>    <span class="c1"># FUNCTIONS FOR CHECKING THE SETTING OF PARAMETERS</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>    <span class="k">def</span> <span class="nf">_check_any_var_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a><span class="sd">        Check if any elements of the variable are already set (either to ML output or constant).</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a><span class="sd">        Parameters</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a><span class="sd">        ----------</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a><span class="sd">        var_name : str</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a><span class="sd">            Name of the variable to check</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a><span class="sd">        Returns</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a><span class="sd">        -------</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a><span class="sd">        bool</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a><span class="sd">            True if any elements are set, False if none are set</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a><span class="sd">        Notes</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a><span class="sd">        -----</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a><span class="sd">        Can be used in setting functions to make sure that they have not already been set.</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="n">var_name</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>            <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">var_name</span><span class="p">])</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">var_name</span><span class="p">])</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>            <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">)</span> <span class="ow">or</span> \
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>                <span class="nb">any</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">)</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>    <span class="c1"># FUNCTIONS TO SET PARAMETERS</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>    <span class="c1"># We can set them to a constant value, or to an ML output</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>    <span class="c1"># Can set them individually with set_to_const or set_to_ml_output</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>    <span class="c1"># Checks if already set to an ML output or a constant</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>    <span class="c1"># In subclasses, may have helper functions to e.g., set all of pi at once</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>    <span class="k">def</span> <span class="nf">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">expr</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">):</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a><span class="sd">        Set a variable to an ML output. Checks if already has been set to an ML output or a constant.</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a><span class="sd">        Parameters</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a><span class="sd">        ----------</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a><span class="sd">        var : gp.Var</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a><span class="sd">            The variable to set</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a><span class="sd">        expr : gp.LinExpr | gp.Var</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a><span class="sd">            The expression to set the variable to</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a><span class="sd">        Returns</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a><span class="sd">        -------</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a><span class="sd">        None</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a><span class="sd">        Notes</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a><span class="sd">        -----</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a><span class="sd">        In practice, introduces an equality constraint to the model.</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a><span class="sd">        Raises</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a><span class="sd">        ------</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a><span class="sd">        ValueError</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a><span class="sd">            If unknown variable type</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a><span class="sd">            If the variable is already set to an ML output or a constant</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>        <span class="n">var_name</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">VarName</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>        <span class="n">base_name</span> <span class="o">=</span> <span class="n">var_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Get base name (pi, P, etc.)</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>        <span class="k">if</span> <span class="n">base_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">:</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown variable type: </span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_var_indices</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="n">indices</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> is already set to an ML output or constant&quot;</span><span class="p">)</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">indices</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> is already set to an ML output or constant&quot;</span><span class="p">)</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">var</span> <span class="o">==</span> <span class="n">expr</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;set_to_ml_output_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>    <span class="k">def</span> <span class="nf">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">value</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a><span class="sd">        Set a variable to a constant value. Checks if already has been set to a constant or an ML output.</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a><span class="sd">        Parameters</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a><span class="sd">        ----------</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a><span class="sd">        var : gp.Var</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a><span class="sd">            The variable to set</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a><span class="sd">        value : float | int</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a><span class="sd">            The constant value to set the variable to</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a><span class="sd">        Returns</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a><span class="sd">        -------</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a><span class="sd">        None</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a><span class="sd">        Notes</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a><span class="sd">        -----</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a><span class="sd">        In practice, introduces an equality constraint to the model and fixes</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a><span class="sd">        upper and lower bounds of the variable to the given value.</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a><span class="sd">        Raises</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a><span class="sd">        ------</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a><span class="sd">        ValueError</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a><span class="sd">            If unknown variable type</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a><span class="sd">            If the variable is already set to a constant or an ML output</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>        <span class="n">var_name</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">VarName</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>        <span class="n">base_name</span> <span class="o">=</span> <span class="n">var_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Get base name (pi, P, etc.)</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>        <span class="k">if</span> <span class="n">base_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">:</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown variable type: </span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_var_indices</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="n">indices</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> is already set to a constant or ML output&quot;</span><span class="p">)</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">indices</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> is already set to a constant or ML output&quot;</span><span class="p">)</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">var</span> <span class="o">==</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;set_to_const_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>        <span class="n">var</span><span class="o">.</span><span class="n">LB</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">UB</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>    <span class="c1"># FUNCTIONS TO SPECIFY THE FEATURE SPACE</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>    <span class="c1"># The feature space is a MILP-representable space of features</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>    <span class="c1"># We add linear constraints</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>    <span class="c1"># Or, we can add an auxiliary variable, to help us represent integral constraints</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>    <span class="c1"># This feature space is copied over when optimizing over ML outputs</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>    <span class="c1"># Theoretically, these two building blocks can represent any MILP-representable feature space</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>    <span class="k">def</span> <span class="nf">add_feature_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">):</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a><span class="sd">        Add a feature constraint to the model.</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a><span class="sd">        Parameters</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a><span class="sd">        ----------</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a><span class="sd">        expr : gp.LinExpr</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a><span class="sd">            The linear expression to add as a constraint</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a><span class="sd">        Returns</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a><span class="sd">        -------</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a><span class="sd">        None</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a><span class="sd">        Notes</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a><span class="sd">        -----</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a><span class="sd">        Adds the constraint to the model and also stores it in self.feature_constraints.</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a><span class="sd">        Constraints that are added here are also copied over when optimizing over ML outputs.</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>    <span class="k">def</span> <span class="nf">add_feature_aux_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a><span class="sd">        Add a feature auxiliary variable to the model.</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a><span class="sd">        Parameters</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a><span class="sd">        ----------</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a><span class="sd">        *args : tuple</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a><span class="sd">            Arguments to pass to self.model.addVar</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a><span class="sd">        **kwargs : dict</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a><span class="sd">            Keyword arguments to pass to self.model.addVar</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a><span class="sd">        Returns</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a><span class="sd">        -------</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a><span class="sd">        gp.Var</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a><span class="sd">            The auxiliary variable added to the model</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a><span class="sd">        Notes</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a><span class="sd">        -----</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a><span class="sd">        Adds a variable to the model and stores it in self.feature_aux. Variables</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a><span class="sd">        added here are also copied over when optimizing over ML outputs. Arguments</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a><span class="sd">        are passed to Gurobi&#39;s addVar function, so can specify variable types, bounds,</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a><span class="sd">        etc. Hence, can encode arbitrary MILP constraints by adding integer auxiliary</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a><span class="sd">        variables.</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>        <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>        <span class="k">return</span> <span class="n">var</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>    <span class="c1"># FUNCTIONS TO ADD CONSTRAINTS TO THE MRP</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>    <span class="c1"># For example, inequalities on pi, P, r</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>    <span class="c1"># They are only added to the overall model, not to the submodels</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>    <span class="k">def</span> <span class="nf">add_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constr</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">Constr</span><span class="p">):</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a><span class="sd">        Add an inequality to the overall model.</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a><span class="sd">        Could just call self.model.addConstr(constr), but this is a wrapper for clarity.</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a><span class="sd">        Parameters</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a><span class="sd">        ----------</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a><span class="sd">        constr : gp.Constr</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a><span class="sd">            The constraint to add</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a><span class="sd">        Returns</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a><span class="sd">        -------</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a><span class="sd">        None</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>    <span class="c1"># FUNCTIONS TO ADD THE ML MODELS</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>    <span class="c1"># Can add ML models to the MRP, which creates variables for the ML outputs</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>    <span class="c1"># These can then be used to specify the params</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>    <span class="c1"># To see supported models, see the _ml_model_registry dictionary</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>    <span class="k">def</span> <span class="nf">add_ml_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ml_model</span> <span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a><span class="sd">        Add an ML model to the Markov process. Computes the constraints linking</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a><span class="sd">        the ML outputs to the features, and creates variables for the ML outputs.</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a><span class="sd">        ML outputs can then be accessed using self.ml_outputs.</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a><span class="sd">        Parameters</span>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a><span class="sd">        ----------</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a><span class="sd">        ml_model : Any</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a><span class="sd">            The ML model to add</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a><span class="sd">        Returns</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a><span class="sd">        -------</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a><span class="sd">        None</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a><span class="sd">        Raises</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a><span class="sd">        ------</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a><span class="sd">        ValueError</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a><span class="sd">            If the ML model type is not supported</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>        <span class="c1"># Find matching model type in registry</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>        <span class="k">for</span> <span class="n">model_types</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_model_registry</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ml_model</span><span class="p">,</span> <span class="n">model_types</span><span class="p">):</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ml_models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ml_model</span><span class="p">)</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>                <span class="c1"># Create output variables based on model type</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>                <span class="n">n_outputs</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;get_n_outputs&#39;</span><span class="p">](</span><span class="n">ml_model</span><span class="p">)</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>                <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;bounds&#39;</span><span class="p">]</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>                        <span class="n">n_outputs</span><span class="p">,</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>                        <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ml_outputs_</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>                        <span class="n">lb</span><span class="o">=</span><span class="n">lb</span><span class="p">,</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>                        <span class="n">ub</span><span class="o">=</span><span class="n">ub</span><span class="p">,</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>                        <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>                    <span class="p">)</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>                <span class="p">)</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>                <span class="c1"># Add constraints using registered method</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>                <span class="n">config</span><span class="p">[</span><span class="s1">&#39;constraint_method&#39;</span><span class="p">](</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>                    <span class="n">ml_model</span><span class="p">,</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>                <span class="p">)</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>                <span class="k">return</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported ML model type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">ml_model</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>    <span class="c1"># FUNCTIONS TO OPTIMIZE THE PROBLEM</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>    <span class="k">def</span> <span class="nf">optimize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_decomp</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sense</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">verbose</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gurobi_params</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a><span class="sd">        Public interface for optimizing the problem.</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a><span class="sd">        If use_decomp is True, we use the decomposition and bound propagation approach.</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a><span class="sd">        Can also set the sense, verbosity, and additional Gurobi parameters if needed.</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a><span class="sd">        Parameters</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a><span class="sd">        ----------</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a><span class="sd">        use_decomp : bool (default=True)</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a><span class="sd">            Whether to use the decomposition and bound propagation approach</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a><span class="sd">        sense : str (default=&quot;max&quot;)</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a><span class="sd">            The sense of the optimization problem, either &quot;max&quot; or &quot;min&quot;</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a><span class="sd">        verbose : bool (default=False)</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a><span class="sd">            Whether to print Gurobi output</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a><span class="sd">        gurobi_params : dict (default=None)</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a><span class="sd">            Additional Gurobi parameters to set, e.g., {&#39;TimeLimit&#39;: 60}</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a><span class="sd">        Returns</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a><span class="sd">        -------</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a><span class="sd">        dict</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a><span class="sd">            A dictionary containing the optimization result. Possible formats:</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a><span class="sd">            For optimal/suboptimal solutions:</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a><span class="sd">            {</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a><span class="sd">                &#39;status&#39;: str, either &#39;optimal&#39; or &#39;suboptimal&#39;,</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a><span class="sd">                &#39;objective&#39;: float, the objective value,</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a><span class="sd">                &#39;values&#39;: dict, the values of the variables</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a><span class="sd">            }</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a><span class="sd">            For infeasible/unbounded problems:</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a><span class="sd">            {</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a><span class="sd">                &#39;status&#39;: str, either &#39;infeasible&#39; or &#39;unbounded&#39;,</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a><span class="sd">                &#39;message&#39;: str, description of the problem</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a><span class="sd">            }</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a><span class="sd">            For other errors:</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a><span class="sd">            {</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a><span class="sd">                &#39;status&#39;: &#39;error&#39;,</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a><span class="sd">                &#39;message&#39;: str, error description with status code</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a><span class="sd">            }</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a><span class="sd">        Notes</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a><span class="sd">        -----</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a><span class="sd">        First checks if all required variables are set, then implements the decomposition</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a><span class="sd">        and bound propagation approach, and lastly solves the bilinear program.</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>        <span class="c1"># Check if all required variables are set</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_all_vars_set</span><span class="p">()</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>        <span class="k">if</span> <span class="n">use_decomp</span><span class="p">:</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>            <span class="c1"># Step 1: ML bounds</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>            <span class="n">ml_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_ml_bounds</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_ml_bounds</span><span class="p">(</span><span class="n">ml_bounds</span><span class="p">)</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>            <span class="c1"># Step 2: Parameter bounds from affine relationships</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>            <span class="n">affine_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_affine_bounds</span><span class="p">(</span><span class="n">ml_bounds</span><span class="p">)</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_affine_bounds</span><span class="p">(</span><span class="n">affine_bounds</span><span class="p">)</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>            <span class="c1"># Step 3: Initial value vector bounds</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>            <span class="n">initial_v_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_initial_v_bounds</span><span class="p">()</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_initial_v_bounds</span><span class="p">(</span><span class="n">initial_v_bounds</span><span class="p">)</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>            <span class="c1"># Step 4: Tightened value vector bounds</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>            <span class="n">tightened_v_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_tightened_v_bounds</span><span class="p">()</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_tightened_v_bounds</span><span class="p">(</span><span class="n">tightened_v_bounds</span><span class="p">)</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize</span><span class="p">(</span><span class="n">sense</span><span class="o">=</span><span class="n">sense</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">gurobi_params</span><span class="o">=</span><span class="n">gurobi_params</span><span class="p">)</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>    <span class="k">def</span> <span class="nf">find_feasible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ub</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">use_decomp</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gurobi_params</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a><span class="sd">        Public interface for finding a feasible solution to the problem.</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a><span class="sd">        It finds a feasible feature vector.</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a><span class="sd">        Parameters</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a><span class="sd">        ----------</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a><span class="sd">        lb : float | int | None (default=None)</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a><span class="sd">            The lower bound on the feature vector. None means -inf.</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a><span class="sd">        ub : float | int | None (default=None)</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a><span class="sd">            The upper bound on the feature vector. None means inf.</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a><span class="sd">        use_decomp : bool (default=True)</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a><span class="sd">            Whether to use the decomposition and bound propagation approach</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a><span class="sd">        verbose : bool (default=False)</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a><span class="sd">            Whether to print Gurobi output</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a><span class="sd">        gurobi_params : dict (default=None)</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a><span class="sd">            Additional Gurobi parameters to set, e.g., {&#39;TimeLimit&#39;: 60}</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a><span class="sd">        Returns</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a><span class="sd">        dict</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a><span class="sd">            A dictionary containing the feasibility result. Possible formats:</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a><span class="sd">            For feasible solutions:</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a><span class="sd">            {</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a><span class="sd">                &#39;status&#39;: &#39;feasible&#39;,</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a><span class="sd">                &#39;values&#39;: dict, the values of the variables</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a><span class="sd">            }</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a><span class="sd">            For infeasible/unbounded problems:</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a><span class="sd">            {</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a><span class="sd">                &#39;status&#39;: str, either &#39;infeasible&#39; or &#39;unbounded&#39;,</span>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a><span class="sd">                &#39;message&#39;: str, description of the problem</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a><span class="sd">            }</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a><span class="sd">            For other errors:</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a><span class="sd">            {</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a><span class="sd">                &#39;status&#39;: &#39;error&#39;,</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a><span class="sd">                &#39;message&#39;: str, error description with status code</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a><span class="sd">            }</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_all_vars_set</span><span class="p">()</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>        <span class="k">if</span> <span class="n">lb</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ub</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must specify at least one bound&quot;</span><span class="p">)</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>        <span class="k">if</span> <span class="n">lb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ub</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>            <span class="k">if</span> <span class="n">lb</span> <span class="o">&gt;</span> <span class="n">ub</span><span class="p">:</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Lower bound must be less than upper bound&quot;</span><span class="p">)</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>        <span class="k">if</span> <span class="n">use_decomp</span><span class="p">:</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>            <span class="c1"># Step 1: ML bounds</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>            <span class="n">ml_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_ml_bounds</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_ml_bounds</span><span class="p">(</span><span class="n">ml_bounds</span><span class="p">)</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>            <span class="c1"># Step 2: Parameter bounds from affine relationships</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>            <span class="n">affine_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_affine_bounds</span><span class="p">(</span><span class="n">ml_bounds</span><span class="p">)</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_affine_bounds</span><span class="p">(</span><span class="n">affine_bounds</span><span class="p">)</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>            <span class="c1"># Step 3: Initial value vector bounds</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>            <span class="n">initial_v_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_initial_v_bounds</span><span class="p">()</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_initial_v_bounds</span><span class="p">(</span><span class="n">initial_v_bounds</span><span class="p">)</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>            <span class="c1"># Step 4: Tightened value vector bounds</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>            <span class="n">tightened_v_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_tightened_v_bounds</span><span class="p">()</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_tightened_v_bounds</span><span class="p">(</span><span class="n">tightened_v_bounds</span><span class="p">)</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_feasible</span><span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">gurobi_params</span><span class="o">=</span><span class="n">gurobi_params</span><span class="p">)</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>    <span class="k">def</span> <span class="nf">_optimize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sense</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">verbose</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gurobi_params</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a><span class="sd">        Private interface for optimizing the problem.</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>        <span class="c1"># Set the objective (implemented by subclasses)</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_objective</span><span class="p">()</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>        <span class="c1"># Common Gurobi parameter setting</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s2">&quot;OutputFlag&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>        <span class="k">if</span> <span class="n">gurobi_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>            <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">gurobi_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s2">&quot;Presolve&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ModelSense</span> <span class="o">=</span> <span class="n">GRB</span><span class="o">.</span><span class="n">MAXIMIZE</span> <span class="k">if</span> <span class="n">sense</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span> <span class="k">else</span> <span class="n">GRB</span><span class="o">.</span><span class="n">MINIMIZE</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>        <span class="c1"># Check optimization status</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">:</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;optimal&#39;</span><span class="p">,</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>                <span class="s1">&#39;objective&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">objVal</span><span class="p">,</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>                <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>            <span class="p">}</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">SUBOPTIMAL</span><span class="p">:</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;suboptimal&#39;</span><span class="p">,</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>                <span class="s1">&#39;objective&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">objVal</span><span class="p">,</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>                <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>            <span class="p">}</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFEASIBLE</span><span class="p">:</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;infeasible&#39;</span><span class="p">,</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Problem is infeasible&#39;</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>            <span class="p">}</span>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">UNBOUNDED</span><span class="p">:</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;unbounded&#39;</span><span class="p">,</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Problem is unbounded&#39;</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>            <span class="p">}</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Optimization failed with status code </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>            <span class="p">}</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>    <span class="k">def</span> <span class="nf">_find_feasible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ub</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gurobi_params</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a><span class="sd">        Private interface for finding a feasible solution to the problem.</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>        <span class="k">if</span> <span class="n">lb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>            <span class="n">lb</span> <span class="o">=</span> <span class="o">-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>        <span class="k">if</span> <span class="n">ub</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>            <span class="n">ub</span> <span class="o">=</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>        <span class="c1"># must be implemented by subclasses</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_feasible_constraints</span><span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>        <span class="c1"># Common Gurobi parameter setting</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s2">&quot;OutputFlag&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>        <span class="k">if</span> <span class="n">gurobi_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>            <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">gurobi_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s2">&quot;Presolve&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">status</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">:</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>        <span class="c1"># Remove temporary constraints after storing status and values</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>        <span class="k">for</span> <span class="n">constr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getQConstrs</span><span class="p">():</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>            <span class="k">if</span> <span class="n">constr</span><span class="o">.</span><span class="n">QCName</span> <span class="o">==</span> <span class="s2">&quot;temp_feasible_lb&quot;</span> <span class="ow">or</span> <span class="n">constr</span><span class="o">.</span><span class="n">QCName</span> <span class="o">==</span> <span class="s2">&quot;temp_feasible_ub&quot;</span><span class="p">:</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">:</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;feasible&#39;</span><span class="p">,</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>                <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="n">values</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>            <span class="p">}</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>        <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFEASIBLE</span><span class="p">:</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;infeasible&#39;</span><span class="p">,</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Problem is infeasible&#39;</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>            <span class="p">}</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>        <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">UNBOUNDED</span><span class="p">:</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;unbounded&#39;</span><span class="p">,</span>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Problem is unbounded&#39;</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>            <span class="p">}</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Optimization failed with status code </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>            <span class="p">}</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a><span class="sd">        Get value of variable after optimization.</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a><span class="sd">        Can either pass in a Gurobi variable or a string (name of variable).</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a><span class="sd">        Parameters</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a><span class="sd">        ----------</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a><span class="sd">        var : gp.Var | str</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a><span class="sd">            The variable to get the value of. If a string, it is the name of the variable.</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a><span class="sd">        Returns</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a><span class="sd">        -------</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a><span class="sd">        float</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a><span class="sd">            The value of the variable</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">):</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>            <span class="k">return</span> <span class="n">var</span><span class="o">.</span><span class="n">X</span>  <span class="c1"># Direct access if it&#39;s already a Gurobi variable</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">))</span><span class="o">.</span><span class="n">X</span>  <span class="c1"># Use name lookup for strings</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>    <span class="c1"># DECOMPOSITION AND BOUND PROPAGATION FUNCTIONS</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>    <span class="c1"># Here, ML models can be optimized</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>    <span class="k">def</span> <span class="nf">_optimize_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ml_model_index</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ml_output_index</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sense</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">verbose</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a><span class="sd">        Minimize the specified ML output over the constraints defined for self.features and self.feature_aux.</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a><span class="sd">        Parameters</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a><span class="sd">        ----------</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a><span class="sd">        ml_model_index : int (default=0)</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a><span class="sd">            Index of the ML model to optimize</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a><span class="sd">        ml_output_index : int (default=0)</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a><span class="sd">            Index of the ML output to minimize</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a><span class="sd">        sense : str (default=&quot;max&quot;)</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a><span class="sd">            The sense of the optimization problem, either &quot;max&quot; or &quot;min&quot;</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a><span class="sd">        verbose : bool (default=False)</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a><span class="sd">            Whether to print Gurobi output</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a><span class="sd">        Returns</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a><span class="sd">        -------</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a><span class="sd">        tuple</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a><span class="sd">            A tuple containing the status of the optimization and the value of the ML output</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a><span class="sd">        Notes</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a><span class="sd">        -----</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a><span class="sd">        Builds the subproblem for the given ML model and output, and solves it.</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a><span class="sd">        If the optimizer returns an optimal solution, it returns the objective value.</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a><span class="sd">        If the optimizer returns a suboptimal solution, it uses the best known objective bound.</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a><span class="sd">        If the optimizer returns an infeasible or unbounded solution, it returns None. This is later</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a><span class="sd">        detected in _set_ml_bounds, which forces the bounds to be conflicting, so that the overall model</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a><span class="sd">        is easily detected as infeasible.</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>        <span class="c1"># Create a new subproblem model</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>        <span class="n">subproblem</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;opt_ml_output&quot;</span><span class="p">)</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>        <span class="c1"># Add feature variables to the subproblem with the same bounds as the original model</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>        <span class="n">sub_features</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>            <span class="n">sub_features</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">]</span> <span class="o">=</span> <span class="n">subproblem</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>                <span class="n">name</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">,</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>                <span class="n">lb</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span>  <span class="c1"># Copy the lower bound</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>                <span class="n">ub</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">UB</span><span class="p">,</span>  <span class="c1"># Copy the upper bound</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>                <span class="n">vtype</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">VType</span>  <span class="c1"># Copy the variable type (e.g., CONTINUOUS)</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>            <span class="p">)</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>        <span class="c1"># Add auxiliary feature variables to the subproblem</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>        <span class="n">sub_features_aux</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_aux</span><span class="p">:</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>            <span class="n">sub_features_aux</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">]</span> <span class="o">=</span> <span class="n">subproblem</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>                <span class="n">name</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">,</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>                <span class="n">lb</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span>  <span class="c1"># Copy the lower bound</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>                <span class="n">ub</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">UB</span><span class="p">,</span>  <span class="c1"># Copy the upper bound</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>                <span class="n">vtype</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">VType</span>  <span class="c1"># Copy the variable type (e.g., CONTINUOUS)</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>            <span class="p">)</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>        <span class="n">subproblem</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>        <span class="c1"># Convert self.features to a dict mapping VarName to GRB.Var for easier access</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>        <span class="n">features_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">:</span> <span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">values</span><span class="p">()}</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>        <span class="n">features_aux_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">:</span> <span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_aux</span><span class="p">}</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>        <span class="c1"># Iterate over constraints in the original model</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>        <span class="k">for</span> <span class="n">constr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_constraints</span><span class="p">:</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>            <span class="c1"># Get the linear expression for the constraint</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>            <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getRow</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>            <span class="n">new_expr</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">()</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>                <span class="n">var</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">getVar</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>                <span class="n">coeff</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">getCoeff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>                <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">VarName</span> <span class="ow">in</span> <span class="n">features_map</span><span class="p">:</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>                    <span class="n">new_expr</span> <span class="o">+=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">sub_features</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">]</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>                <span class="k">elif</span> <span class="n">var</span><span class="o">.</span><span class="n">VarName</span> <span class="ow">in</span> <span class="n">features_aux_map</span><span class="p">:</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>                    <span class="n">new_expr</span> <span class="o">+=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">sub_features_aux</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">]</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>            <span class="c1"># Add the modified constraint to the subproblem</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>            <span class="n">subproblem</span><span class="o">.</span><span class="n">addLConstr</span><span class="p">(</span><span class="n">new_expr</span><span class="p">,</span> <span class="n">constr</span><span class="o">.</span><span class="n">Sense</span><span class="p">,</span> <span class="n">constr</span><span class="o">.</span><span class="n">RHS</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">constr</span><span class="o">.</span><span class="n">ConstrName</span><span class="p">)</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>            <span class="n">subproblem</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>        <span class="c1"># Add the ML output variable to the subproblem</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>        <span class="n">ml_output</span> <span class="o">=</span> <span class="n">subproblem</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">ml_model_index</span><span class="p">]),</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ml_output_</span><span class="si">{</span><span class="n">ml_output_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>            <span class="n">lb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">ml_model_index</span><span class="p">][</span><span class="n">ml_output_index</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>            <span class="n">ub</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">ml_model_index</span><span class="p">][</span><span class="n">ml_output_index</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span><span class="p">,</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">ml_model_index</span><span class="p">][</span><span class="n">ml_output_index</span><span class="p">]</span><span class="o">.</span><span class="n">VType</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>        <span class="p">)</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>        <span class="c1"># Recreate the ML model constraint in the subproblem</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>        <span class="c1"># Find matching model type in registry</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>        <span class="n">ml_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_models</span><span class="p">[</span><span class="n">ml_model_index</span><span class="p">]</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>        <span class="k">for</span> <span class="n">model_types</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_model_registry</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ml_model</span><span class="p">,</span> <span class="n">model_types</span><span class="p">):</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>                <span class="n">config</span><span class="p">[</span><span class="s1">&#39;constraint_method&#39;</span><span class="p">](</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>                    <span class="n">subproblem</span><span class="p">,</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>                    <span class="n">ml_model</span><span class="p">,</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>                    <span class="n">sub_features</span><span class="p">,</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>                    <span class="n">ml_output</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>                <span class="p">)</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>                <span class="k">break</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported ML model type for optimization: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">ml_model</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>        <span class="c1"># Set the objective to optimize the ML output</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>        <span class="n">sense</span> <span class="o">=</span> <span class="n">GRB</span><span class="o">.</span><span class="n">MAXIMIZE</span> <span class="k">if</span> <span class="n">sense</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span> <span class="k">else</span> <span class="n">GRB</span><span class="o">.</span><span class="n">MINIMIZE</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>        <span class="n">subproblem</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span><span class="n">ml_output</span><span class="p">[</span><span class="n">ml_output_index</span><span class="p">],</span> <span class="n">sense</span><span class="p">)</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>        <span class="n">subproblem</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s2">&quot;OutputFlag&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>        <span class="n">subproblem</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s2">&quot;Presolve&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>        <span class="c1"># Solve the subproblem</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>        <span class="n">subproblem</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>        <span class="k">if</span> <span class="n">subproblem</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">:</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>            <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;optimal&#39;</span><span class="p">,</span> <span class="n">ml_output</span><span class="p">[</span><span class="n">ml_output_index</span><span class="p">]</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>        <span class="k">elif</span> <span class="n">subproblem</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">GRB</span><span class="o">.</span><span class="n">SUBOPTIMAL</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">TIME_LIMIT</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">NUMERIC</span><span class="p">]:</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>            <span class="c1"># Use ObjBound which is guaranteed to be a valid bound</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>            <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;suboptimal&#39;</span><span class="p">,</span> <span class="n">subproblem</span><span class="o">.</span><span class="n">ObjBound</span><span class="p">)</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>        <span class="k">elif</span> <span class="n">subproblem</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFEASIBLE</span><span class="p">:</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>            <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;infeasible&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>        <span class="k">elif</span> <span class="n">subproblem</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">UNBOUNDED</span><span class="p">:</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>            <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;unbounded&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">sense</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>            <span class="c1"># For any other status, if we have a bound, use it</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">subproblem</span><span class="p">,</span> <span class="s1">&#39;ObjBound&#39;</span><span class="p">):</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>                <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">subproblem</span><span class="o">.</span><span class="n">ObjBound</span><span class="p">)</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>            <span class="c1"># Otherwise use conservative bounds</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>            <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">sense</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>    <span class="k">def</span> <span class="nf">_compute_ml_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a><span class="sd">        Get the bounds on all ML outputs.</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a><span class="sd">        Parameters</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a><span class="sd">        ----------</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a><span class="sd">        verbose : bool (default=False)</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a><span class="sd">            Whether to print Gurobi output</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a><span class="sd">        Returns</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a><span class="sd">        -------</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a><span class="sd">        list[list[tuple[float | None, float | None]]]</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a><span class="sd">            A list of lists of (max, min) tuples for each ML model and output</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a><span class="sd">        Notes</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a><span class="sd">        -----</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a><span class="sd">        If `verbose` is True, it also prints the bounds for each ML model and output, or</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a><span class="sd">        infeasible status. The `verbose` flag is also passed to Gurobi.</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>        <span class="c1"># get bounds on ml outputs</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>        <span class="n">ml_bounds</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_models</span><span class="p">)):</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>            <span class="n">ml_bounds</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>                <span class="n">min_status</span><span class="p">,</span> <span class="n">min_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_ml_output</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">sense</span><span class="o">=</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>                <span class="n">max_status</span><span class="p">,</span> <span class="n">max_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_ml_output</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">sense</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>                <span class="k">if</span> <span class="n">min_status</span> <span class="o">==</span> <span class="s1">&#39;infeasible&#39;</span> <span class="ow">or</span> <span class="n">max_status</span> <span class="o">==</span> <span class="s1">&#39;infeasible&#39;</span><span class="p">:</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>                    <span class="n">ml_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ML model </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> output </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2"> is infeasible&quot;</span><span class="p">)</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>                    <span class="n">ml_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">))</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ML model </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> output </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2"> bounds: </span><span class="si">{</span><span class="n">min_val</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">max_val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>        <span class="k">return</span> <span class="n">ml_bounds</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>    <span class="k">def</span> <span class="nf">_set_ml_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ml_bounds</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]]):</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a><span class="sd">        Set the bounds on the ML outputs.</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a><span class="sd">        Parameters</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a><span class="sd">        ----------</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a><span class="sd">        ml_bounds : list[list[tuple[float | None, float | None]]]</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a><span class="sd">            A list of lists of (max, min) tuples for each ML model and output</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a><span class="sd">        Notes</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a><span class="sd">        -----</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a><span class="sd">        If a tuple is (None, None), this means that the ML model was</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a><span class="sd">        infeasible, so here we set the bounds to conflicting values,</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a><span class="sd">        so that the overall model is easily detected as infeasible.</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_models</span><span class="p">)):</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>                <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">ml_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>                <span class="k">if</span> <span class="n">lb</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ub</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span> <span class="o">=</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span> <span class="o">=</span> <span class="o">-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>    <span class="c1"># SOME HELPER FUNCTIONS</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>    <span class="k">def</span> <span class="nf">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">lb</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a><span class="sd">        Update the lower bound of a variable if the new bound is greater than the current bound.</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a><span class="sd">        Includes a check to ensure that the new bound is not greater than the upper bound.</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a><span class="sd">        Parameters</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a><span class="sd">        ----------</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a><span class="sd">        var : gp.Var</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a><span class="sd">            The variable to update the lower bound of</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a><span class="sd">        lb : float | int</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a><span class="sd">            The new lower bound</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a><span class="sd">        Returns</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a><span class="sd">        -------</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a><span class="sd">        None</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>        <span class="k">if</span> <span class="n">lb</span> <span class="o">&gt;</span> <span class="n">var</span><span class="o">.</span><span class="n">LB</span><span class="p">:</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>            <span class="k">if</span> <span class="n">lb</span> <span class="o">&gt;</span> <span class="n">var</span><span class="o">.</span><span class="n">UB</span><span class="p">:</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>                <span class="n">var</span><span class="o">.</span><span class="n">LB</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">UB</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>                <span class="n">var</span><span class="o">.</span><span class="n">LB</span> <span class="o">=</span> <span class="n">lb</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>    <span class="k">def</span> <span class="nf">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">ub</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a><span class="sd">        Update the upper bound of a variable if the new bound is less than the current bound.</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a><span class="sd">        Includes a check to ensure that the new bound is not less than the lower bound.</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a><span class="sd">        Parameters</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a><span class="sd">        ----------</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a><span class="sd">        var : gp.Var</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a><span class="sd">            The variable to update the upper bound of</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a><span class="sd">        ub : float | int</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a><span class="sd">            The new upper bound</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a><span class="sd">        Returns</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a><span class="sd">        -------</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a><span class="sd">        None</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>        <span class="k">if</span> <span class="n">ub</span> <span class="o">&lt;</span> <span class="n">var</span><span class="o">.</span><span class="n">UB</span><span class="p">:</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>            <span class="k">if</span> <span class="n">ub</span> <span class="o">&lt;</span> <span class="n">var</span><span class="o">.</span><span class="n">LB</span><span class="p">:</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>                <span class="n">var</span><span class="o">.</span><span class="n">UB</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">LB</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>                <span class="n">var</span><span class="o">.</span><span class="n">UB</span> <span class="o">=</span> <span class="n">ub</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>    <span class="k">def</span> <span class="nf">_compute_expr_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">,</span> <span class="n">bounds_dict</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a><span class="sd">        Compute bounds for an affine expression given bounds on its variables.</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a><span class="sd">        Parameters</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a><span class="sd">        ----------</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a><span class="sd">        expr : gp.LinExpr</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a><span class="sd">            The affine expression to compute bounds for</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a><span class="sd">        bounds_dict : dict</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a><span class="sd">            A dictionary mapping variable names to (min, max) bounds</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a><span class="sd">        Returns</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a><span class="sd">        -------</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a><span class="sd">        tuple</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a><span class="sd">            A tuple containing the lower and upper bounds of the expression</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a><span class="sd">        Notes</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a><span class="sd">        -----</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a><span class="sd">        Just simple check of the coefficients and their signs, and sums up appropriate bounds.</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a><span class="sd">        Used to propagate bounds on ML outputs to the the parameters of the Markov process.</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>        <span class="n">lb</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>        <span class="n">ub</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>        <span class="c1"># Handle constant term</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="s1">&#39;getConstant&#39;</span><span class="p">):</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>            <span class="n">const</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">getConstant</span><span class="p">()</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>            <span class="n">lb</span> <span class="o">+=</span> <span class="n">const</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>            <span class="n">ub</span> <span class="o">+=</span> <span class="n">const</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>        <span class="c1"># Handle variables</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>            <span class="n">coeff</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">getCoeff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>            <span class="n">var</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">getVar</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>            <span class="n">var_bounds</span> <span class="o">=</span> <span class="n">bounds_dict</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">]</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>            <span class="c1"># If coefficient is positive, use min for LB and max for UB</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>            <span class="k">if</span> <span class="n">coeff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>                <span class="n">lb</span> <span class="o">+=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">var_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>                <span class="n">ub</span> <span class="o">+=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">var_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>            <span class="c1"># If coefficient is negative, use max for LB and min for UB</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>                <span class="n">lb</span> <span class="o">+=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">var_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>                <span class="n">ub</span> <span class="o">+=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">var_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>        <span class="k">return</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>    <span class="k">def</span> <span class="nf">_get_ml_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">):</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a><span class="sd">        Gets the affine expression for a parameter set to an ML output. Isolates the variable.</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a><span class="sd">        This is used to propagate bounds on ML outputs to the the parameters of the Markov process.</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a><span class="sd">        Parameters</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a><span class="sd">        ----------</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a><span class="sd">        var : gp.Var</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a><span class="sd">            The variable to get the ML expression for</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a><span class="sd">        Returns</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a><span class="sd">        -------</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a><span class="sd">        gp.LinExpr</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a><span class="sd">            The linear expression for the ML output</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>        <span class="n">constr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getConstrByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;set_to_ml_output_</span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>        <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getRow</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>  <span class="c1"># Gets the full expression (pi[0] + x[0] - 1 == 0)</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>        <span class="n">rhs</span> <span class="o">=</span> <span class="n">constr</span><span class="o">.</span><span class="n">RHS</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>        <span class="c1"># Collect terms with and without our variable</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>        <span class="n">var_coeff</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>        <span class="n">other_terms</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">()</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>        <span class="n">const</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">getConstant</span><span class="p">()</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>            <span class="n">coeff</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">getCoeff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>            <span class="n">term_var</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">getVar</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>            <span class="k">if</span> <span class="n">term_var</span><span class="o">.</span><span class="n">VarName</span> <span class="o">==</span> <span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">:</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>                <span class="n">var_coeff</span> <span class="o">=</span> <span class="n">coeff</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>                <span class="n">other_terms</span> <span class="o">+=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">term_var</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>        <span class="c1"># Rearrange to isolate var: var = (rhs - other_terms - const) / var_coeff</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>        <span class="k">if</span> <span class="n">var_coeff</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find variable </span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="si">}</span><span class="s2"> in its ML constraint&quot;</span><span class="p">)</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">rhs</span> <span class="o">-</span> <span class="n">other_terms</span> <span class="o">-</span> <span class="n">const</span><span class="p">)</span> <span class="o">/</span> <span class="n">var_coeff</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>    <span class="k">def</span> <span class="nf">_parse_var_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a><span class="sd">        Parse indices from Gurobi variable names like &#39;pi[0]&#39;, &#39;r[1]&#39;, or &#39;P[0,1]&#39;</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a><span class="sd">        Returns int for single indices and tuple for multiple indices.</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a><span class="sd">        Parameters</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a><span class="sd">        ----------</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a><span class="sd">        var_name : str</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a><span class="sd">            The name of the Gurobi variable (e.g., &#39;pi[0]&#39;, &#39;P[0,1]&#39;)</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a><span class="sd">        Returns</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a><span class="sd">        -------</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a><span class="sd">        int | tuple</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a><span class="sd">            Single index (e.g., 0 for &#39;pi[0]&#39;) or tuple of indices (e.g., (0,1) for &#39;P[0,1]&#39;)</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a><span class="sd">        Raises</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a><span class="sd">        ------</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a><span class="sd">        ValueError</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a><span class="sd">            If the variable name cannot be parsed</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>        <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\[(\d+)(?:,(\d+))?\]&#39;</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">var_name</span><span class="p">)</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not parse indices from variable name: </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>        <span class="c1"># Filter out None values and convert to integers</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>        <span class="n">indices</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span> <span class="k">if</span> <span class="n">idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>        <span class="c1"># Return single integer if only one index, otherwise return tuple</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>        <span class="k">return</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">indices</span>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>    <span class="k">def</span> <span class="nf">_seq_is_all_const</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span> <span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">]]):</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a><span class="sd">        Check if all elements in sequence (1D or 2D) are constants.</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a><span class="sd">        Specifically, checks if they are all floats or ints.</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a><span class="sd">        Parameters</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a><span class="sd">        ----------</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a><span class="sd">        seq : Sequence[Any] | Sequence[Sequence[Any]]</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a><span class="sd">            The sequence to check</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a><span class="sd">        Returns</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a><span class="sd">        -------</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a><span class="sd">        bool</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a><span class="sd">            True if all elements in the sequence are constants, False otherwise</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">seq</span><span class="p">:</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>        <span class="c1"># If first element is a sequence (except string), treat as 2D</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>                    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">seq</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>                    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">row</span><span class="p">)</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>        <span class="c1"># Otherwise treat as 1D</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>                    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">)</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a><span class="k">class</span> <span class="nc">MarkovReward</span><span class="p">(</span><span class="n">AbstractMarkov</span><span class="p">):</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a><span class="sd">    For the total reward problem.</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_states</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>                 <span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>                 <span class="n">discount_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.97</span><span class="p">,</span> <span class="c1"># 3% discount</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>                 <span class="n">pi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>                 <span class="n">P</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>                 <span class="n">r</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a><span class="sd">        Initialize a Markov reward process for the total reward problem.</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a><span class="sd">        Parameters</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a><span class="sd">        ----------</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a><span class="sd">        n_states : int</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a><span class="sd">            The number of states</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a><span class="sd">        n_features : int</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a><span class="sd">            The number of features</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a><span class="sd">        discount_factor : float (default=0.97)</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a><span class="sd">            The discount factor for the Markov process</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a><span class="sd">        pi : Optional[List | np.ndarray] (default=None)</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a><span class="sd">            The initial state probabilities</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a><span class="sd">        P : Optional[List[List] | np.ndarray] (default=None)</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a><span class="sd">            The transition probabilities</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a><span class="sd">        r : Optional[List | np.ndarray] (default=None)</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a><span class="sd">            The reward vector</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a><span class="sd">        Notes</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a><span class="sd">        -----</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a><span class="sd">        Calls the constructor of the parent class AbstractMarkov, and additionally stores</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a><span class="sd">        the discount factor. Then, initializes the defining parameters and constraints.</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">n_states</span><span class="p">,</span> <span class="n">n_features</span><span class="p">)</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">discount_factor</span> <span class="o">=</span> <span class="n">discount_factor</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_parameters_and_constraints</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>    <span class="c1"># FUNCTIONS THAT MUST BE IMPLEMENTED IN SUBCLASSES WHICH UNIQUELY DEFINE THE PROBLEM</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>    <span class="k">def</span> <span class="nf">_initialize_parameters_and_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>                                               <span class="n">pi</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>                                               <span class="n">P</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>                                               <span class="n">r</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a><span class="sd">        Initializes the parameters and constraints for a Markov reward process.</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a><span class="sd">        Parameters</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a><span class="sd">        ----------</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a><span class="sd">        pi : Optional[List | np.ndarray] (default=None)</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a><span class="sd">            The initial state probabilities</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a><span class="sd">        P : Optional[List[List] | np.ndarray] (default=None)</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a><span class="sd">            The transition probabilities</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a><span class="sd">        r : Optional[List | np.ndarray] (default=None)</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a><span class="sd">            The reward vector</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a><span class="sd">        Returns</span>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a><span class="sd">        -------</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a><span class="sd">        None</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a><span class="sd">        Notes</span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a><span class="sd">        -----</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a><span class="sd">        Adds variables for: pi (bounds between 0 and 1), P (bounds between 0 and 1),</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a><span class="sd">        r (bounds between -inf and inf), and v (bounds between -inf and inf).</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a><span class="sd">        Creates boolean lists to store whether each variable has been set to an ML output</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a><span class="sd">        or a constant. Adds stochastic constraints on pi and rows of P. Lastly, adds</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a><span class="sd">        the Bellman equation constraint: v = r + discount_factor * P * v.</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">,</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pi&quot;</span><span class="p">,</span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a>            <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a>            <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a>        <span class="p">)</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">,</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">,</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;P&quot;</span><span class="p">,</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a>            <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a>            <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a>        <span class="p">)</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">,</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a>            <span class="n">lb</span><span class="o">=-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a>            <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a>        <span class="p">)</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">,</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a>            <span class="n">lb</span><span class="o">=-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a>            <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a>        <span class="p">)</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">,)</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">,)</span>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">,)</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a>        <span class="k">if</span> <span class="n">pi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_pi</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a>        <span class="k">if</span> <span class="n">P</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_P</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a>        <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_r</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a>        <span class="c1"># add probability constraints</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">):</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a>                                 <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;prob_constr_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a>        <span class="c1"># add Bellman equation constraints</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">):</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">discount_factor</span> <span class="o">*</span> <span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)),</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a>                                 <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;bellman_constr_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a>    <span class="k">def</span> <span class="nf">_check_all_vars_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a><span class="sd">        Check if pi, P, and r have been set before optimization.</span>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a><span class="sd">        Returns</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a><span class="sd">        -------</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a><span class="sd">        None</span>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a><span class="sd">        Raises</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a><span class="sd">        ------</span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a><span class="sd">        ValueError</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a><span class="sd">            If any required variables have not been set</span>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pi[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] needs to be set to a constant or linked to an ML output&quot;</span><span class="p">)</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;r[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] needs to be set to a constant or linked to an ML output&quot;</span><span class="p">)</span>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]):</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] needs to be set to a constant or linked to an ML output&quot;</span><span class="p">)</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a>    <span class="k">def</span> <span class="nf">_set_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a><span class="sd">        Sets the objective function to pi * v.</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a><span class="sd">        Returns</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a><span class="sd">        -------</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a><span class="sd">        None</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)))</span>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a>    <span class="k">def</span> <span class="nf">_set_feasible_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ub</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a><span class="sd">        Sets the feasible constraints on the objective. When looking for a feasible solution,</span>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a><span class="sd">        this simply adds the constraints: lb &lt;= pi * v &lt;= ub.</span>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a><span class="sd">        Parameters</span>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a><span class="sd">        ----------</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a><span class="sd">        lb : float | int</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a><span class="sd">            The lower bound</span>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a><span class="sd">        ub : float | int</span>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a><span class="sd">            The upper bound</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a><span class="sd">        Returns</span>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a><span class="sd">        -------</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a><span class="sd">        None</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">lb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;temp_feasible_lb&quot;</span><span class="p">)</span>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">ub</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;temp_feasible_ub&quot;</span><span class="p">)</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a>    <span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a><span class="sd">        Returns the values of pi, P, r, v, features, and ml_outputs as a dictionary.</span>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a><span class="sd">        Returns</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a><span class="sd">        -------</span>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a><span class="sd">        dict</span>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a><span class="sd">            A dictionary with keys:</span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a><span class="sd">            - `pi`: the values of pi</span>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a><span class="sd">            - `P`: the values of P</span>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a><span class="sd">            - `r`: the values of r</span>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a><span class="sd">            - `v`: the values of v</span>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a><span class="sd">            - `features`: the values of the features</span>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a><span class="sd">            - `ml_outputs`: the values of the ml_outputs</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a>            <span class="s2">&quot;pi&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)],</span>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a>            <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)],</span>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a>            <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)],</span>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a>            <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)],</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a>            <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">)],</span>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a>            <span class="s2">&quot;ml_outputs&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]))]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">))]</span>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a>        <span class="p">}</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a>    <span class="k">def</span> <span class="nf">_compute_affine_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ml_bounds</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]):</span>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a><span class="sd">        Computes the affine bounds for the parameters that are linked to ML outputs.</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a><span class="sd">        Parameters</span>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a><span class="sd">        ----------</span>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a><span class="sd">        ml_bounds : List[List[Tuple[float, float]]]</span>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a><span class="sd">            The bounds for the ML outputs</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a><span class="sd">        Returns</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a><span class="sd">        -------</span>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a><span class="sd">        dict</span>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a><span class="sd">            A dictionary with keys: &#39;pi&#39;, &#39;P&#39;, &#39;r&#39;</span>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a>        <span class="c1"># Convert ml_bounds to dictionary for easier lookup</span>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a>        <span class="n">bounds_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model_bounds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ml_bounds</span><span class="p">):</span>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a>            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_bounds</span><span class="p">):</span>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a>                <span class="n">bounds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ml_outputs_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a>        <span class="c1"># Initialize bounds dictionary</span>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a>        <span class="n">affine_bounds</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a>            <span class="s1">&#39;pi&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a>            <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a>            <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="p">[]</span>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a>        <span class="p">}</span>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a>        <span class="c1"># Compute bounds for each parameter that is an ML output</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a>                <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ml_expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a>                <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_expr_bounds</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">bounds_dict</span><span class="p">)))</span>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a>                <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ml_expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a>                <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_expr_bounds</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">bounds_dict</span><span class="p">)))</span>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a>                    <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ml_expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a>                    <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_expr_bounds</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">bounds_dict</span><span class="p">)))</span>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a>        <span class="k">return</span> <span class="n">affine_bounds</span>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a>    <span class="k">def</span> <span class="nf">_set_affine_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">affine_bounds</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a><span class="sd">        Sets the bounds for the parameters that are linked to ML outputs.</span>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a><span class="sd">        Parameters</span>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a><span class="sd">        ----------</span>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a><span class="sd">        affine_bounds : dict</span>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a><span class="sd">            The bounds for the ML outputs</span>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a><span class="sd">        Returns</span>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a><span class="sd">        -------</span>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a><span class="sd">        None</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]:</span>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]:</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]:</span>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a>    <span class="k">def</span> <span class="nf">_compute_initial_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a><span class="sd">        Computes the initial bounds for v using the reward bounds and discount factor.</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a><span class="sd">        Uses the lemma from the paper: for each $v_i$, $v_i \\in [v^min_i, v^max_i]$ where</span>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a><span class="sd">        $v^min_i = \\min_j r^min_j / (1 - \\lambda)$, and</span>
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a><span class="sd">        $v^max_i = \\max_j r^max_j / (1 - \\lambda)$.</span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a>
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a><span class="sd">        Returns</span>
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a><span class="sd">        -------</span>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a><span class="sd">        List[Tuple[float, float]]</span>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a><span class="sd">            The initial bounds for v</span>
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a>        <span class="c1"># Get min/max rewards across all states</span>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a>        <span class="n">r_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a>        <span class="n">r_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a>        <span class="c1"># Compute v bounds using reward bounds and discount factor</span>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a>        <span class="n">v_min</span> <span class="o">=</span> <span class="n">r_min</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">discount_factor</span><span class="p">)</span>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a>        <span class="n">v_max</span> <span class="o">=</span> <span class="n">r_max</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">discount_factor</span><span class="p">)</span>
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a>        <span class="c1"># Return bounds for each state</span>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a>        <span class="k">return</span> <span class="p">[(</span><span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a>    <span class="k">def</span> <span class="nf">_set_initial_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_v_bounds</span><span class="p">):</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a><span class="sd">        Sets the initial bounds for v.</span>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a><span class="sd">        Parameters</span>
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a><span class="sd">        ----------</span>
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a><span class="sd">        initial_v_bounds : List[Tuple[float, float]]</span>
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a><span class="sd">            The initial bounds for v</span>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a><span class="sd">        Returns</span>
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a><span class="sd">        -------</span>
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a><span class="sd">        None</span>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a>            <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">initial_v_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a>
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a>    <span class="k">def</span> <span class="nf">_compute_tightened_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a><span class="sd">        Computes the tightened bounds for v using the bounds for P and r and initial bounds for v.</span>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a><span class="sd">        This uses Gauss-Seidel to solve the linear system: $vM = r$, where $M = I - \\lambda * P$.</span>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a>
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a><span class="sd">        Returns</span>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a><span class="sd">        -------</span>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a><span class="sd">        List[Tuple[float, float]]</span>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a><span class="sd">            The tightened bounds for v</span>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a>        <span class="c1"># Create interval matrices for P and r</span>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a>        <span class="n">P_intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a>        <span class="n">r_intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a>        <span class="c1"># Fill intervals from current bounds</span>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a>                <span class="n">P_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span><span class="p">]</span>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a>            <span class="n">r_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span><span class="p">]</span>
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a>
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a>        <span class="c1"># Create linear system: vM = r, where M = I - discount_factor * P</span>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">ima</span><span class="o">.</span><span class="n">_identity_interval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">ima</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">discount_factor</span> <span class="o">*</span> <span class="n">P_intervals</span><span class="p">)</span>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a>        <span class="c1"># Initial guess using current v bounds</span>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a>        <span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])])</span>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a>
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a>        <span class="c1"># Solve using Gauss-Seidel</span>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a>        <span class="n">v_intervals</span> <span class="o">=</span> <span class="n">ima</span><span class="o">.</span><span class="n">interval_gauss_seidel</span><span class="p">(</span>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a>            <span class="n">M</span><span class="p">,</span> <span class="n">r_intervals</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span>
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a>            <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a>            <span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a>        <span class="p">)</span>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a>        <span class="c1"># Convert to list of tuples</span>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a>        <span class="k">return</span> <span class="p">[(</span><span class="n">v_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">v_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a>    <span class="k">def</span> <span class="nf">_set_tightened_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tightened_v_bounds</span><span class="p">):</span>
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a><span class="sd">        Sets the tightened bounds for v.</span>
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a>
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a><span class="sd">        Parameters</span>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a><span class="sd">        ----------</span>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a><span class="sd">        tightened_v_bounds : List[Tuple[float, float]]</span>
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a><span class="sd">            The tightened bounds for v</span>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a>
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a><span class="sd">        Returns</span>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a><span class="sd">        -------</span>
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a><span class="sd">        None</span>
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a>            <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">tightened_v_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a>
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a>    <span class="c1"># CLEAN PARAMETER ACCESSORS</span>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a>    <span class="nd">@property</span>
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a>    <span class="k">def</span> <span class="nf">pi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1741"><a href="#L-1741"><span class="linenos">1741</span></a><span class="sd">        Accessor for the pi parameter.</span>
</span><span id="L-1742"><a href="#L-1742"><span class="linenos">1742</span></a>
</span><span id="L-1743"><a href="#L-1743"><span class="linenos">1743</span></a><span class="sd">        Returns</span>
</span><span id="L-1744"><a href="#L-1744"><span class="linenos">1744</span></a><span class="sd">        -------</span>
</span><span id="L-1745"><a href="#L-1745"><span class="linenos">1745</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="L-1746"><a href="#L-1746"><span class="linenos">1746</span></a><span class="sd">            The pi parameter</span>
</span><span id="L-1747"><a href="#L-1747"><span class="linenos">1747</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1748"><a href="#L-1748"><span class="linenos">1748</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span>
</span><span id="L-1749"><a href="#L-1749"><span class="linenos">1749</span></a>
</span><span id="L-1750"><a href="#L-1750"><span class="linenos">1750</span></a>    <span class="nd">@property</span>
</span><span id="L-1751"><a href="#L-1751"><span class="linenos">1751</span></a>    <span class="k">def</span> <span class="nf">P</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1752"><a href="#L-1752"><span class="linenos">1752</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1753"><a href="#L-1753"><span class="linenos">1753</span></a><span class="sd">        Accessor for the P parameter.</span>
</span><span id="L-1754"><a href="#L-1754"><span class="linenos">1754</span></a>
</span><span id="L-1755"><a href="#L-1755"><span class="linenos">1755</span></a><span class="sd">        Returns</span>
</span><span id="L-1756"><a href="#L-1756"><span class="linenos">1756</span></a><span class="sd">        -------</span>
</span><span id="L-1757"><a href="#L-1757"><span class="linenos">1757</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="L-1758"><a href="#L-1758"><span class="linenos">1758</span></a><span class="sd">            The P parameter</span>
</span><span id="L-1759"><a href="#L-1759"><span class="linenos">1759</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1760"><a href="#L-1760"><span class="linenos">1760</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
</span><span id="L-1761"><a href="#L-1761"><span class="linenos">1761</span></a>
</span><span id="L-1762"><a href="#L-1762"><span class="linenos">1762</span></a>    <span class="nd">@property</span>
</span><span id="L-1763"><a href="#L-1763"><span class="linenos">1763</span></a>    <span class="k">def</span> <span class="nf">r</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1764"><a href="#L-1764"><span class="linenos">1764</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1765"><a href="#L-1765"><span class="linenos">1765</span></a><span class="sd">        Accessor for the r parameter.</span>
</span><span id="L-1766"><a href="#L-1766"><span class="linenos">1766</span></a>
</span><span id="L-1767"><a href="#L-1767"><span class="linenos">1767</span></a><span class="sd">        Returns</span>
</span><span id="L-1768"><a href="#L-1768"><span class="linenos">1768</span></a><span class="sd">        -------</span>
</span><span id="L-1769"><a href="#L-1769"><span class="linenos">1769</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="L-1770"><a href="#L-1770"><span class="linenos">1770</span></a><span class="sd">            The r parameter</span>
</span><span id="L-1771"><a href="#L-1771"><span class="linenos">1771</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1772"><a href="#L-1772"><span class="linenos">1772</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>
</span><span id="L-1773"><a href="#L-1773"><span class="linenos">1773</span></a>
</span><span id="L-1774"><a href="#L-1774"><span class="linenos">1774</span></a>    <span class="nd">@property</span>
</span><span id="L-1775"><a href="#L-1775"><span class="linenos">1775</span></a>    <span class="k">def</span> <span class="nf">v</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1776"><a href="#L-1776"><span class="linenos">1776</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1777"><a href="#L-1777"><span class="linenos">1777</span></a><span class="sd">        Accessor for the v parameter.</span>
</span><span id="L-1778"><a href="#L-1778"><span class="linenos">1778</span></a>
</span><span id="L-1779"><a href="#L-1779"><span class="linenos">1779</span></a><span class="sd">        Returns</span>
</span><span id="L-1780"><a href="#L-1780"><span class="linenos">1780</span></a><span class="sd">        -------</span>
</span><span id="L-1781"><a href="#L-1781"><span class="linenos">1781</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="L-1782"><a href="#L-1782"><span class="linenos">1782</span></a><span class="sd">            The v parameter</span>
</span><span id="L-1783"><a href="#L-1783"><span class="linenos">1783</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1784"><a href="#L-1784"><span class="linenos">1784</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
</span><span id="L-1785"><a href="#L-1785"><span class="linenos">1785</span></a>
</span><span id="L-1786"><a href="#L-1786"><span class="linenos">1786</span></a>    <span class="c1"># HELPER FUNCTIONS TO SET PARAMETERS</span>
</span><span id="L-1787"><a href="#L-1787"><span class="linenos">1787</span></a>    <span class="c1"># Can set them all at once with set_pi, set_P, set_r</span>
</span><span id="L-1788"><a href="#L-1788"><span class="linenos">1788</span></a>    <span class="c1"># These check for validity of, e.g., probabilities</span>
</span><span id="L-1789"><a href="#L-1789"><span class="linenos">1789</span></a>
</span><span id="L-1790"><a href="#L-1790"><span class="linenos">1790</span></a>    <span class="k">def</span> <span class="nf">set_pi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]):</span>
</span><span id="L-1791"><a href="#L-1791"><span class="linenos">1791</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1792"><a href="#L-1792"><span class="linenos">1792</span></a><span class="sd">        Helper function to set the entire pi vector.</span>
</span><span id="L-1793"><a href="#L-1793"><span class="linenos">1793</span></a>
</span><span id="L-1794"><a href="#L-1794"><span class="linenos">1794</span></a><span class="sd">        Parameters</span>
</span><span id="L-1795"><a href="#L-1795"><span class="linenos">1795</span></a><span class="sd">        ----------</span>
</span><span id="L-1796"><a href="#L-1796"><span class="linenos">1796</span></a><span class="sd">        values : List[float | int | gp.Var | gp.LinExpr]</span>
</span><span id="L-1797"><a href="#L-1797"><span class="linenos">1797</span></a><span class="sd">            The values to set the pi parameter to</span>
</span><span id="L-1798"><a href="#L-1798"><span class="linenos">1798</span></a>
</span><span id="L-1799"><a href="#L-1799"><span class="linenos">1799</span></a><span class="sd">        Returns</span>
</span><span id="L-1800"><a href="#L-1800"><span class="linenos">1800</span></a><span class="sd">        -------</span>
</span><span id="L-1801"><a href="#L-1801"><span class="linenos">1801</span></a><span class="sd">        None</span>
</span><span id="L-1802"><a href="#L-1802"><span class="linenos">1802</span></a>
</span><span id="L-1803"><a href="#L-1803"><span class="linenos">1803</span></a><span class="sd">        Raises</span>
</span><span id="L-1804"><a href="#L-1804"><span class="linenos">1804</span></a><span class="sd">        ------</span>
</span><span id="L-1805"><a href="#L-1805"><span class="linenos">1805</span></a><span class="sd">        ValueError</span>
</span><span id="L-1806"><a href="#L-1806"><span class="linenos">1806</span></a><span class="sd">            If the values have incorrect length, are not in [0, 1], don&#39;t sum to 1,or pi is already set</span>
</span><span id="L-1807"><a href="#L-1807"><span class="linenos">1807</span></a>
</span><span id="L-1808"><a href="#L-1808"><span class="linenos">1808</span></a><span class="sd">        Notes</span>
</span><span id="L-1809"><a href="#L-1809"><span class="linenos">1809</span></a><span class="sd">        -----</span>
</span><span id="L-1810"><a href="#L-1810"><span class="linenos">1810</span></a><span class="sd">        This checks for validity of the values, checks if pi is already set, and sets the values.</span>
</span><span id="L-1811"><a href="#L-1811"><span class="linenos">1811</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1812"><a href="#L-1812"><span class="linenos">1812</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_length</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">)</span>
</span><span id="L-1813"><a href="#L-1813"><span class="linenos">1813</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="L-1814"><a href="#L-1814"><span class="linenos">1814</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-1815"><a href="#L-1815"><span class="linenos">1815</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">)</span>
</span><span id="L-1816"><a href="#L-1816"><span class="linenos">1816</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;pi&quot;</span><span class="p">),</span>\
</span><span id="L-1817"><a href="#L-1817"><span class="linenos">1817</span></a>              <span class="s2">&quot;pi is already set&quot;</span>
</span><span id="L-1818"><a href="#L-1818"><span class="linenos">1818</span></a>
</span><span id="L-1819"><a href="#L-1819"><span class="linenos">1819</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;pi&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1820"><a href="#L-1820"><span class="linenos">1820</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="L-1821"><a href="#L-1821"><span class="linenos">1821</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-1822"><a href="#L-1822"><span class="linenos">1822</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="L-1823"><a href="#L-1823"><span class="linenos">1823</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-1824"><a href="#L-1824"><span class="linenos">1824</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1825"><a href="#L-1825"><span class="linenos">1825</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pi[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span><span id="L-1826"><a href="#L-1826"><span class="linenos">1826</span></a>
</span><span id="L-1827"><a href="#L-1827"><span class="linenos">1827</span></a>    <span class="k">def</span> <span class="nf">set_r</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]):</span>
</span><span id="L-1828"><a href="#L-1828"><span class="linenos">1828</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1829"><a href="#L-1829"><span class="linenos">1829</span></a><span class="sd">        Helper function to set the entire r vector.</span>
</span><span id="L-1830"><a href="#L-1830"><span class="linenos">1830</span></a>
</span><span id="L-1831"><a href="#L-1831"><span class="linenos">1831</span></a><span class="sd">        Parameters</span>
</span><span id="L-1832"><a href="#L-1832"><span class="linenos">1832</span></a><span class="sd">        ----------</span>
</span><span id="L-1833"><a href="#L-1833"><span class="linenos">1833</span></a><span class="sd">        values : List[float | int | gp.Var | gp.LinExpr]</span>
</span><span id="L-1834"><a href="#L-1834"><span class="linenos">1834</span></a><span class="sd">            The values to set the r parameter to</span>
</span><span id="L-1835"><a href="#L-1835"><span class="linenos">1835</span></a>
</span><span id="L-1836"><a href="#L-1836"><span class="linenos">1836</span></a><span class="sd">        Returns</span>
</span><span id="L-1837"><a href="#L-1837"><span class="linenos">1837</span></a><span class="sd">        -------</span>
</span><span id="L-1838"><a href="#L-1838"><span class="linenos">1838</span></a><span class="sd">        None</span>
</span><span id="L-1839"><a href="#L-1839"><span class="linenos">1839</span></a>
</span><span id="L-1840"><a href="#L-1840"><span class="linenos">1840</span></a><span class="sd">        Raises</span>
</span><span id="L-1841"><a href="#L-1841"><span class="linenos">1841</span></a><span class="sd">        ------</span>
</span><span id="L-1842"><a href="#L-1842"><span class="linenos">1842</span></a><span class="sd">        ValueError</span>
</span><span id="L-1843"><a href="#L-1843"><span class="linenos">1843</span></a><span class="sd">            If the values have incorrect length, or r is already set</span>
</span><span id="L-1844"><a href="#L-1844"><span class="linenos">1844</span></a>
</span><span id="L-1845"><a href="#L-1845"><span class="linenos">1845</span></a><span class="sd">        Notes</span>
</span><span id="L-1846"><a href="#L-1846"><span class="linenos">1846</span></a><span class="sd">        -----</span>
</span><span id="L-1847"><a href="#L-1847"><span class="linenos">1847</span></a><span class="sd">        This checks for validity of the values, checks if r is already set, and sets the values.</span>
</span><span id="L-1848"><a href="#L-1848"><span class="linenos">1848</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1849"><a href="#L-1849"><span class="linenos">1849</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_length</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
</span><span id="L-1850"><a href="#L-1850"><span class="linenos">1850</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">),</span>\
</span><span id="L-1851"><a href="#L-1851"><span class="linenos">1851</span></a>              <span class="s2">&quot;r is already set&quot;</span>
</span><span id="L-1852"><a href="#L-1852"><span class="linenos">1852</span></a>
</span><span id="L-1853"><a href="#L-1853"><span class="linenos">1853</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1854"><a href="#L-1854"><span class="linenos">1854</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="L-1855"><a href="#L-1855"><span class="linenos">1855</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-1856"><a href="#L-1856"><span class="linenos">1856</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="L-1857"><a href="#L-1857"><span class="linenos">1857</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-1858"><a href="#L-1858"><span class="linenos">1858</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-1859"><a href="#L-1859"><span class="linenos">1859</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;r[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span><span id="L-1860"><a href="#L-1860"><span class="linenos">1860</span></a>
</span><span id="L-1861"><a href="#L-1861"><span class="linenos">1861</span></a>    <span class="k">def</span> <span class="nf">set_P</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]]):</span>
</span><span id="L-1862"><a href="#L-1862"><span class="linenos">1862</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1863"><a href="#L-1863"><span class="linenos">1863</span></a><span class="sd">        Helper function to set the entire P matrix.</span>
</span><span id="L-1864"><a href="#L-1864"><span class="linenos">1864</span></a>
</span><span id="L-1865"><a href="#L-1865"><span class="linenos">1865</span></a><span class="sd">        Parameters</span>
</span><span id="L-1866"><a href="#L-1866"><span class="linenos">1866</span></a><span class="sd">        ----------</span>
</span><span id="L-1867"><a href="#L-1867"><span class="linenos">1867</span></a><span class="sd">        values : List[List[float | int | gp.Var | gp.LinExpr]]</span>
</span><span id="L-1868"><a href="#L-1868"><span class="linenos">1868</span></a><span class="sd">            The values to set the P parameter to</span>
</span><span id="L-1869"><a href="#L-1869"><span class="linenos">1869</span></a>
</span><span id="L-1870"><a href="#L-1870"><span class="linenos">1870</span></a><span class="sd">        Returns</span>
</span><span id="L-1871"><a href="#L-1871"><span class="linenos">1871</span></a><span class="sd">        -------</span>
</span><span id="L-1872"><a href="#L-1872"><span class="linenos">1872</span></a><span class="sd">        None</span>
</span><span id="L-1873"><a href="#L-1873"><span class="linenos">1873</span></a>
</span><span id="L-1874"><a href="#L-1874"><span class="linenos">1874</span></a><span class="sd">        Raises</span>
</span><span id="L-1875"><a href="#L-1875"><span class="linenos">1875</span></a><span class="sd">        ------</span>
</span><span id="L-1876"><a href="#L-1876"><span class="linenos">1876</span></a><span class="sd">        ValueError</span>
</span><span id="L-1877"><a href="#L-1877"><span class="linenos">1877</span></a><span class="sd">            If the values have incorrect shape, are not in [0, 1], rows don&#39;t sum to 1, or P is already set</span>
</span><span id="L-1878"><a href="#L-1878"><span class="linenos">1878</span></a>
</span><span id="L-1879"><a href="#L-1879"><span class="linenos">1879</span></a><span class="sd">        Notes</span>
</span><span id="L-1880"><a href="#L-1880"><span class="linenos">1880</span></a><span class="sd">        -----</span>
</span><span id="L-1881"><a href="#L-1881"><span class="linenos">1881</span></a><span class="sd">        This checks for validity of the values, checks if P is already set, and sets the values.</span>
</span><span id="L-1882"><a href="#L-1882"><span class="linenos">1882</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1883"><a href="#L-1883"><span class="linenos">1883</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_shape</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">)</span>
</span><span id="L-1884"><a href="#L-1884"><span class="linenos">1884</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="L-1885"><a href="#L-1885"><span class="linenos">1885</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-1886"><a href="#L-1886"><span class="linenos">1886</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_matrix</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">)</span>
</span><span id="L-1887"><a href="#L-1887"><span class="linenos">1887</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
</span><span id="L-1888"><a href="#L-1888"><span class="linenos">1888</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="L-1889"><a href="#L-1889"><span class="linenos">1889</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;P[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
</span><span id="L-1890"><a href="#L-1890"><span class="linenos">1890</span></a>
</span><span id="L-1891"><a href="#L-1891"><span class="linenos">1891</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">),</span>\
</span><span id="L-1892"><a href="#L-1892"><span class="linenos">1892</span></a>              <span class="s2">&quot;P is already set&quot;</span>
</span><span id="L-1893"><a href="#L-1893"><span class="linenos">1893</span></a>
</span><span id="L-1894"><a href="#L-1894"><span class="linenos">1894</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-1895"><a href="#L-1895"><span class="linenos">1895</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-1896"><a href="#L-1896"><span class="linenos">1896</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="L-1897"><a href="#L-1897"><span class="linenos">1897</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-1898"><a href="#L-1898"><span class="linenos">1898</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="L-1899"><a href="#L-1899"><span class="linenos">1899</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-1900"><a href="#L-1900"><span class="linenos">1900</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-1901"><a href="#L-1901"><span class="linenos">1901</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span><span id="L-1902"><a href="#L-1902"><span class="linenos">1902</span></a>
</span><span id="L-1903"><a href="#L-1903"><span class="linenos">1903</span></a>    <span class="c1"># FUNCTIONS TO ADD CONSTRAINTS TO THE MRP</span>
</span><span id="L-1904"><a href="#L-1904"><span class="linenos">1904</span></a>    <span class="c1"># In an MRP, IFT is important because we have a full prob matrix</span>
</span><span id="L-1905"><a href="#L-1905"><span class="linenos">1905</span></a>
</span><span id="L-1906"><a href="#L-1906"><span class="linenos">1906</span></a>    <span class="k">def</span> <span class="nf">add_ifr_inequalities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-1907"><a href="#L-1907"><span class="linenos">1907</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1908"><a href="#L-1908"><span class="linenos">1908</span></a><span class="sd">        Helper function to add IFR (increasing failure rate) inequalities on P.</span>
</span><span id="L-1909"><a href="#L-1909"><span class="linenos">1909</span></a>
</span><span id="L-1910"><a href="#L-1910"><span class="linenos">1910</span></a><span class="sd">        Parameters</span>
</span><span id="L-1911"><a href="#L-1911"><span class="linenos">1911</span></a><span class="sd">        ----------</span>
</span><span id="L-1912"><a href="#L-1912"><span class="linenos">1912</span></a><span class="sd">        None</span>
</span><span id="L-1913"><a href="#L-1913"><span class="linenos">1913</span></a>
</span><span id="L-1914"><a href="#L-1914"><span class="linenos">1914</span></a><span class="sd">        Returns</span>
</span><span id="L-1915"><a href="#L-1915"><span class="linenos">1915</span></a><span class="sd">        -------</span>
</span><span id="L-1916"><a href="#L-1916"><span class="linenos">1916</span></a><span class="sd">        None</span>
</span><span id="L-1917"><a href="#L-1917"><span class="linenos">1917</span></a>
</span><span id="L-1918"><a href="#L-1918"><span class="linenos">1918</span></a><span class="sd">        Notes</span>
</span><span id="L-1919"><a href="#L-1919"><span class="linenos">1919</span></a><span class="sd">        -----</span>
</span><span id="L-1920"><a href="#L-1920"><span class="linenos">1920</span></a><span class="sd">        The definition of IFR is the following. Given an $n \\times n$ transition matrix $P$, and a fixed $i \\in [n]$,</span>
</span><span id="L-1921"><a href="#L-1921"><span class="linenos">1921</span></a><span class="sd">        define the function $b_h(i) = \\sum_{j=h}^n P_{ij}$. Then, $P$ is IFR if, for each $h \\in [n]$, we have</span>
</span><span id="L-1922"><a href="#L-1922"><span class="linenos">1922</span></a><span class="sd">        $b_h(i) \\leq b_h(i+1)$ for all $i \\in [n-1]$.</span>
</span><span id="L-1923"><a href="#L-1923"><span class="linenos">1923</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1924"><a href="#L-1924"><span class="linenos">1924</span></a>        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">):</span>
</span><span id="L-1925"><a href="#L-1925"><span class="linenos">1925</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="L-1926"><a href="#L-1926"><span class="linenos">1926</span></a>                <span class="c1"># b_h(i) &lt;= b_h(i+1), i.e., sum_{j=h}^n P_{ij} &lt;= sum_{j=h}^n P_{i+1, j}</span>
</span><span id="L-1927"><a href="#L-1927"><span class="linenos">1927</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">))</span> <span class="o">&lt;=</span>
</span><span id="L-1928"><a href="#L-1928"><span class="linenos">1928</span></a>                                    <span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)),</span>
</span><span id="L-1929"><a href="#L-1929"><span class="linenos">1929</span></a>                                    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ifr_h_</span><span class="si">{</span><span class="n">h</span><span class="si">}</span><span class="s2">_row_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_row_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-1930"><a href="#L-1930"><span class="linenos">1930</span></a>
</span><span id="L-1931"><a href="#L-1931"><span class="linenos">1931</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-1932"><a href="#L-1932"><span class="linenos">1932</span></a>
</span><span id="L-1933"><a href="#L-1933"><span class="linenos">1933</span></a><span class="k">class</span> <span class="nc">MarkovReach</span><span class="p">(</span><span class="n">AbstractMarkov</span><span class="p">):</span>
</span><span id="L-1934"><a href="#L-1934"><span class="linenos">1934</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1935"><a href="#L-1935"><span class="linenos">1935</span></a><span class="sd">    For the reachability problem.</span>
</span><span id="L-1936"><a href="#L-1936"><span class="linenos">1936</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-1937"><a href="#L-1937"><span class="linenos">1937</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_states</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-1938"><a href="#L-1938"><span class="linenos">1938</span></a>                 <span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-1939"><a href="#L-1939"><span class="linenos">1939</span></a>                 <span class="n">n_targets</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-1940"><a href="#L-1940"><span class="linenos">1940</span></a>                 <span class="n">n_transient</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-1941"><a href="#L-1941"><span class="linenos">1941</span></a>                 <span class="n">pi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1942"><a href="#L-1942"><span class="linenos">1942</span></a>                 <span class="n">Q</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1943"><a href="#L-1943"><span class="linenos">1943</span></a>                 <span class="n">R</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-1944"><a href="#L-1944"><span class="linenos">1944</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1945"><a href="#L-1945"><span class="linenos">1945</span></a><span class="sd">        Initialize a Markov chain for the reachability problem.</span>
</span><span id="L-1946"><a href="#L-1946"><span class="linenos">1946</span></a>
</span><span id="L-1947"><a href="#L-1947"><span class="linenos">1947</span></a><span class="sd">        Parameters</span>
</span><span id="L-1948"><a href="#L-1948"><span class="linenos">1948</span></a><span class="sd">        ----------</span>
</span><span id="L-1949"><a href="#L-1949"><span class="linenos">1949</span></a><span class="sd">        n_states : int</span>
</span><span id="L-1950"><a href="#L-1950"><span class="linenos">1950</span></a><span class="sd">            The number of states</span>
</span><span id="L-1951"><a href="#L-1951"><span class="linenos">1951</span></a><span class="sd">        n_features : int</span>
</span><span id="L-1952"><a href="#L-1952"><span class="linenos">1952</span></a><span class="sd">            The number of features</span>
</span><span id="L-1953"><a href="#L-1953"><span class="linenos">1953</span></a><span class="sd">        n_targets : int</span>
</span><span id="L-1954"><a href="#L-1954"><span class="linenos">1954</span></a><span class="sd">            The number of target states ($|S|$ in the paper)</span>
</span><span id="L-1955"><a href="#L-1955"><span class="linenos">1955</span></a><span class="sd">        n_transient : int</span>
</span><span id="L-1956"><a href="#L-1956"><span class="linenos">1956</span></a><span class="sd">            The number of transient states ($|T|$ in the paper)</span>
</span><span id="L-1957"><a href="#L-1957"><span class="linenos">1957</span></a><span class="sd">        pi : Optional[List | np.ndarray]</span>
</span><span id="L-1958"><a href="#L-1958"><span class="linenos">1958</span></a><span class="sd">            The initial state distribution over transient states</span>
</span><span id="L-1959"><a href="#L-1959"><span class="linenos">1959</span></a><span class="sd">        Q : Optional[List[List] | np.ndarray]</span>
</span><span id="L-1960"><a href="#L-1960"><span class="linenos">1960</span></a><span class="sd">            The transition matrix between transient states</span>
</span><span id="L-1961"><a href="#L-1961"><span class="linenos">1961</span></a><span class="sd">        R : Optional[List[List] | np.ndarray]</span>
</span><span id="L-1962"><a href="#L-1962"><span class="linenos">1962</span></a><span class="sd">            The transition matrix from transient states to target states</span>
</span><span id="L-1963"><a href="#L-1963"><span class="linenos">1963</span></a>
</span><span id="L-1964"><a href="#L-1964"><span class="linenos">1964</span></a><span class="sd">        Raises</span>
</span><span id="L-1965"><a href="#L-1965"><span class="linenos">1965</span></a><span class="sd">        -------</span>
</span><span id="L-1966"><a href="#L-1966"><span class="linenos">1966</span></a><span class="sd">        ValueError</span>
</span><span id="L-1967"><a href="#L-1967"><span class="linenos">1967</span></a><span class="sd">            If the number of target states is greater than or equal to the number of states, or the number of transient</span>
</span><span id="L-1968"><a href="#L-1968"><span class="linenos">1968</span></a><span class="sd">            states is greater than or equal to the number of states</span>
</span><span id="L-1969"><a href="#L-1969"><span class="linenos">1969</span></a>
</span><span id="L-1970"><a href="#L-1970"><span class="linenos">1970</span></a><span class="sd">        Notes</span>
</span><span id="L-1971"><a href="#L-1971"><span class="linenos">1971</span></a><span class="sd">        -----</span>
</span><span id="L-1972"><a href="#L-1972"><span class="linenos">1972</span></a><span class="sd">        Calls the constructor of the parent class AbstractMarkov, with additional attributes.</span>
</span><span id="L-1973"><a href="#L-1973"><span class="linenos">1973</span></a><span class="sd">        Then, initializes the defining parameters and constraints for the reachability problem.</span>
</span><span id="L-1974"><a href="#L-1974"><span class="linenos">1974</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-1975"><a href="#L-1975"><span class="linenos">1975</span></a>
</span><span id="L-1976"><a href="#L-1976"><span class="linenos">1976</span></a>        <span class="k">if</span> <span class="n">n_targets</span> <span class="o">&gt;=</span> <span class="n">n_states</span><span class="p">:</span>
</span><span id="L-1977"><a href="#L-1977"><span class="linenos">1977</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of target states must be less than number of states&quot;</span><span class="p">)</span>
</span><span id="L-1978"><a href="#L-1978"><span class="linenos">1978</span></a>        <span class="k">if</span> <span class="n">n_transient</span> <span class="o">&gt;=</span> <span class="n">n_states</span><span class="p">:</span>
</span><span id="L-1979"><a href="#L-1979"><span class="linenos">1979</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of transient states must be less than number of states&quot;</span><span class="p">)</span>
</span><span id="L-1980"><a href="#L-1980"><span class="linenos">1980</span></a>
</span><span id="L-1981"><a href="#L-1981"><span class="linenos">1981</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">n_states</span><span class="p">,</span> <span class="n">n_features</span><span class="p">)</span>
</span><span id="L-1982"><a href="#L-1982"><span class="linenos">1982</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span> <span class="o">=</span> <span class="n">n_targets</span>
</span><span id="L-1983"><a href="#L-1983"><span class="linenos">1983</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span> <span class="o">=</span> <span class="n">n_transient</span>
</span><span id="L-1984"><a href="#L-1984"><span class="linenos">1984</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_parameters_and_constraints</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
</span><span id="L-1985"><a href="#L-1985"><span class="linenos">1985</span></a>
</span><span id="L-1986"><a href="#L-1986"><span class="linenos">1986</span></a>    <span class="c1"># FUNCTIONS THAT MUST BE IMPLEMENTED IN SUBCLASSES WHICH UNIQUELY DEFINE THE PROBLEM</span>
</span><span id="L-1987"><a href="#L-1987"><span class="linenos">1987</span></a>
</span><span id="L-1988"><a href="#L-1988"><span class="linenos">1988</span></a>    <span class="k">def</span> <span class="nf">_initialize_parameters_and_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pi</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1989"><a href="#L-1989"><span class="linenos">1989</span></a>                                               <span class="n">Q</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-1990"><a href="#L-1990"><span class="linenos">1990</span></a>                                               <span class="n">R</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-1991"><a href="#L-1991"><span class="linenos">1991</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-1992"><a href="#L-1992"><span class="linenos">1992</span></a><span class="sd">        Initializes the parameters and constraints for the reachability problem.</span>
</span><span id="L-1993"><a href="#L-1993"><span class="linenos">1993</span></a>
</span><span id="L-1994"><a href="#L-1994"><span class="linenos">1994</span></a><span class="sd">        Parameters</span>
</span><span id="L-1995"><a href="#L-1995"><span class="linenos">1995</span></a><span class="sd">        ----------</span>
</span><span id="L-1996"><a href="#L-1996"><span class="linenos">1996</span></a><span class="sd">        pi : Optional[List | np.ndarray]</span>
</span><span id="L-1997"><a href="#L-1997"><span class="linenos">1997</span></a><span class="sd">            The initial state distribution over transient states</span>
</span><span id="L-1998"><a href="#L-1998"><span class="linenos">1998</span></a><span class="sd">        Q : Optional[List[List] | np.ndarray]</span>
</span><span id="L-1999"><a href="#L-1999"><span class="linenos">1999</span></a><span class="sd">            The transition matrix between transient states</span>
</span><span id="L-2000"><a href="#L-2000"><span class="linenos">2000</span></a><span class="sd">        R : Optional[List[List] | np.ndarray]</span>
</span><span id="L-2001"><a href="#L-2001"><span class="linenos">2001</span></a><span class="sd">            The transition matrix from transient states to target states</span>
</span><span id="L-2002"><a href="#L-2002"><span class="linenos">2002</span></a>
</span><span id="L-2003"><a href="#L-2003"><span class="linenos">2003</span></a><span class="sd">        Returns</span>
</span><span id="L-2004"><a href="#L-2004"><span class="linenos">2004</span></a><span class="sd">        -------</span>
</span><span id="L-2005"><a href="#L-2005"><span class="linenos">2005</span></a><span class="sd">        None</span>
</span><span id="L-2006"><a href="#L-2006"><span class="linenos">2006</span></a>
</span><span id="L-2007"><a href="#L-2007"><span class="linenos">2007</span></a><span class="sd">        Notes</span>
</span><span id="L-2008"><a href="#L-2008"><span class="linenos">2008</span></a><span class="sd">        -----</span>
</span><span id="L-2009"><a href="#L-2009"><span class="linenos">2009</span></a><span class="sd">        Adds variables for: pi (bounds between 0 and 1), Q (bounds between 0 and 1, strictly less</span>
</span><span id="L-2010"><a href="#L-2010"><span class="linenos">2010</span></a><span class="sd">        than 1), R (bounds between 0 and 1, strictly less than 1), and v (bounds between -inf and inf).</span>
</span><span id="L-2011"><a href="#L-2011"><span class="linenos">2011</span></a><span class="sd">        Creates boolean lists to store whether each variable has been set to an ML output</span>
</span><span id="L-2012"><a href="#L-2012"><span class="linenos">2012</span></a><span class="sd">        or a constant. Adds substochastic constraints on pi, strictly substochastic constraints</span>
</span><span id="L-2013"><a href="#L-2013"><span class="linenos">2013</span></a><span class="sd">        on Q, and substochastic constraints on R. In pratice, strict substochastic constraints</span>
</span><span id="L-2014"><a href="#L-2014"><span class="linenos">2014</span></a><span class="sd">        are implemented with a small numerical offset epsilon=1e-6. Lastly, adds the definition of v as</span>
</span><span id="L-2015"><a href="#L-2015"><span class="linenos">2015</span></a><span class="sd">        v = Qv + R1.</span>
</span><span id="L-2016"><a href="#L-2016"><span class="linenos">2016</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2017"><a href="#L-2017"><span class="linenos">2017</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="L-2018"><a href="#L-2018"><span class="linenos">2018</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span>
</span><span id="L-2019"><a href="#L-2019"><span class="linenos">2019</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pi&quot;</span><span class="p">,</span>
</span><span id="L-2020"><a href="#L-2020"><span class="linenos">2020</span></a>            <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-2021"><a href="#L-2021"><span class="linenos">2021</span></a>            <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-2022"><a href="#L-2022"><span class="linenos">2022</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="L-2023"><a href="#L-2023"><span class="linenos">2023</span></a>        <span class="p">)</span>
</span><span id="L-2024"><a href="#L-2024"><span class="linenos">2024</span></a>
</span><span id="L-2025"><a href="#L-2025"><span class="linenos">2025</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="L-2026"><a href="#L-2026"><span class="linenos">2026</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span>
</span><span id="L-2027"><a href="#L-2027"><span class="linenos">2027</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span>
</span><span id="L-2028"><a href="#L-2028"><span class="linenos">2028</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span>
</span><span id="L-2029"><a href="#L-2029"><span class="linenos">2029</span></a>            <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-2030"><a href="#L-2030"><span class="linenos">2030</span></a>            <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span><span class="p">,</span>
</span><span id="L-2031"><a href="#L-2031"><span class="linenos">2031</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="L-2032"><a href="#L-2032"><span class="linenos">2032</span></a>        <span class="p">)</span>
</span><span id="L-2033"><a href="#L-2033"><span class="linenos">2033</span></a>
</span><span id="L-2034"><a href="#L-2034"><span class="linenos">2034</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="L-2035"><a href="#L-2035"><span class="linenos">2035</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span>
</span><span id="L-2036"><a href="#L-2036"><span class="linenos">2036</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span><span class="p">,</span>
</span><span id="L-2037"><a href="#L-2037"><span class="linenos">2037</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;R&quot;</span><span class="p">,</span>
</span><span id="L-2038"><a href="#L-2038"><span class="linenos">2038</span></a>            <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-2039"><a href="#L-2039"><span class="linenos">2039</span></a>            <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-2040"><a href="#L-2040"><span class="linenos">2040</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="L-2041"><a href="#L-2041"><span class="linenos">2041</span></a>        <span class="p">)</span>
</span><span id="L-2042"><a href="#L-2042"><span class="linenos">2042</span></a>
</span><span id="L-2043"><a href="#L-2043"><span class="linenos">2043</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="L-2044"><a href="#L-2044"><span class="linenos">2044</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span>
</span><span id="L-2045"><a href="#L-2045"><span class="linenos">2045</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span>
</span><span id="L-2046"><a href="#L-2046"><span class="linenos">2046</span></a>            <span class="n">lb</span><span class="o">=-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="L-2047"><a href="#L-2047"><span class="linenos">2047</span></a>            <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="L-2048"><a href="#L-2048"><span class="linenos">2048</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="L-2049"><a href="#L-2049"><span class="linenos">2049</span></a>        <span class="p">)</span>
</span><span id="L-2050"><a href="#L-2050"><span class="linenos">2050</span></a>
</span><span id="L-2051"><a href="#L-2051"><span class="linenos">2051</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-2052"><a href="#L-2052"><span class="linenos">2052</span></a>
</span><span id="L-2053"><a href="#L-2053"><span class="linenos">2053</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="L-2054"><a href="#L-2054"><span class="linenos">2054</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="L-2055"><a href="#L-2055"><span class="linenos">2055</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="L-2056"><a href="#L-2056"><span class="linenos">2056</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="L-2057"><a href="#L-2057"><span class="linenos">2057</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="L-2058"><a href="#L-2058"><span class="linenos">2058</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="L-2059"><a href="#L-2059"><span class="linenos">2059</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="L-2060"><a href="#L-2060"><span class="linenos">2060</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="L-2061"><a href="#L-2061"><span class="linenos">2061</span></a>
</span><span id="L-2062"><a href="#L-2062"><span class="linenos">2062</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,)</span>
</span><span id="L-2063"><a href="#L-2063"><span class="linenos">2063</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)</span>
</span><span id="L-2064"><a href="#L-2064"><span class="linenos">2064</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span><span class="p">)</span>
</span><span id="L-2065"><a href="#L-2065"><span class="linenos">2065</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,)</span>
</span><span id="L-2066"><a href="#L-2066"><span class="linenos">2066</span></a>
</span><span id="L-2067"><a href="#L-2067"><span class="linenos">2067</span></a>        <span class="k">if</span> <span class="n">pi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2068"><a href="#L-2068"><span class="linenos">2068</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_pi</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>
</span><span id="L-2069"><a href="#L-2069"><span class="linenos">2069</span></a>        <span class="k">if</span> <span class="n">Q</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2070"><a href="#L-2070"><span class="linenos">2070</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_Q</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
</span><span id="L-2071"><a href="#L-2071"><span class="linenos">2071</span></a>        <span class="k">if</span> <span class="n">R</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2072"><a href="#L-2072"><span class="linenos">2072</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_R</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
</span><span id="L-2073"><a href="#L-2073"><span class="linenos">2073</span></a>
</span><span id="L-2074"><a href="#L-2074"><span class="linenos">2074</span></a>        <span class="c1"># pi is substochastic</span>
</span><span id="L-2075"><a href="#L-2075"><span class="linenos">2075</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span>
</span><span id="L-2076"><a href="#L-2076"><span class="linenos">2076</span></a>                             <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-2077"><a href="#L-2077"><span class="linenos">2077</span></a>                             <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pi_prob_constr&quot;</span><span class="p">)</span>
</span><span id="L-2078"><a href="#L-2078"><span class="linenos">2078</span></a>        <span class="c1"># Q is strictly substochastic</span>
</span><span id="L-2079"><a href="#L-2079"><span class="linenos">2079</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">):</span>
</span><span id="L-2080"><a href="#L-2080"><span class="linenos">2080</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span>
</span><span id="L-2081"><a href="#L-2081"><span class="linenos">2081</span></a>                                 <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span><span class="p">,</span>
</span><span id="L-2082"><a href="#L-2082"><span class="linenos">2082</span></a>                                 <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;q_prob_constr_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2083"><a href="#L-2083"><span class="linenos">2083</span></a>        <span class="c1"># R is substochastic</span>
</span><span id="L-2084"><a href="#L-2084"><span class="linenos">2084</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">):</span>
</span><span id="L-2085"><a href="#L-2085"><span class="linenos">2085</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span><span class="p">))</span>
</span><span id="L-2086"><a href="#L-2086"><span class="linenos">2086</span></a>                                 <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-2087"><a href="#L-2087"><span class="linenos">2087</span></a>                                 <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;r_prob_constr_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2088"><a href="#L-2088"><span class="linenos">2088</span></a>
</span><span id="L-2089"><a href="#L-2089"><span class="linenos">2089</span></a>        <span class="c1"># v = Qv + R1</span>
</span><span id="L-2090"><a href="#L-2090"><span class="linenos">2090</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">):</span>
</span><span id="L-2091"><a href="#L-2091"><span class="linenos">2091</span></a>            <span class="n">R1</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span><span class="p">))</span>
</span><span id="L-2092"><a href="#L-2092"><span class="linenos">2092</span></a>            <span class="n">Qv</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span>
</span><span id="L-2093"><a href="#L-2093"><span class="linenos">2093</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">Qv</span> <span class="o">+</span> <span class="n">R1</span><span class="p">,</span>
</span><span id="L-2094"><a href="#L-2094"><span class="linenos">2094</span></a>                                 <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;v_constr_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2095"><a href="#L-2095"><span class="linenos">2095</span></a>
</span><span id="L-2096"><a href="#L-2096"><span class="linenos">2096</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-2097"><a href="#L-2097"><span class="linenos">2097</span></a>
</span><span id="L-2098"><a href="#L-2098"><span class="linenos">2098</span></a>    <span class="k">def</span> <span class="nf">_check_all_vars_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2099"><a href="#L-2099"><span class="linenos">2099</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2100"><a href="#L-2100"><span class="linenos">2100</span></a><span class="sd">        Check if pi, Q, and R have been set before optimization.</span>
</span><span id="L-2101"><a href="#L-2101"><span class="linenos">2101</span></a>
</span><span id="L-2102"><a href="#L-2102"><span class="linenos">2102</span></a><span class="sd">        Returns</span>
</span><span id="L-2103"><a href="#L-2103"><span class="linenos">2103</span></a><span class="sd">        -------</span>
</span><span id="L-2104"><a href="#L-2104"><span class="linenos">2104</span></a><span class="sd">        None</span>
</span><span id="L-2105"><a href="#L-2105"><span class="linenos">2105</span></a>
</span><span id="L-2106"><a href="#L-2106"><span class="linenos">2106</span></a><span class="sd">        Raises</span>
</span><span id="L-2107"><a href="#L-2107"><span class="linenos">2107</span></a><span class="sd">        ------</span>
</span><span id="L-2108"><a href="#L-2108"><span class="linenos">2108</span></a><span class="sd">        ValueError</span>
</span><span id="L-2109"><a href="#L-2109"><span class="linenos">2109</span></a><span class="sd">            If any required variables have not been set</span>
</span><span id="L-2110"><a href="#L-2110"><span class="linenos">2110</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2111"><a href="#L-2111"><span class="linenos">2111</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2112"><a href="#L-2112"><span class="linenos">2112</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
</span><span id="L-2113"><a href="#L-2113"><span class="linenos">2113</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pi[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] needs to be set to a constant or linked to an ML output&quot;</span><span class="p">)</span>
</span><span id="L-2114"><a href="#L-2114"><span class="linenos">2114</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2115"><a href="#L-2115"><span class="linenos">2115</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-2116"><a href="#L-2116"><span class="linenos">2116</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]):</span>
</span><span id="L-2117"><a href="#L-2117"><span class="linenos">2117</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] needs to be set to a constant or linked to an ML output&quot;</span><span class="p">)</span>
</span><span id="L-2118"><a href="#L-2118"><span class="linenos">2118</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2119"><a href="#L-2119"><span class="linenos">2119</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-2120"><a href="#L-2120"><span class="linenos">2120</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]):</span>
</span><span id="L-2121"><a href="#L-2121"><span class="linenos">2121</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] needs to be set to a constant or linked to an ML output&quot;</span><span class="p">)</span>
</span><span id="L-2122"><a href="#L-2122"><span class="linenos">2122</span></a>
</span><span id="L-2123"><a href="#L-2123"><span class="linenos">2123</span></a>    <span class="k">def</span> <span class="nf">_set_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2124"><a href="#L-2124"><span class="linenos">2124</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2125"><a href="#L-2125"><span class="linenos">2125</span></a><span class="sd">        Sets the objective function to pi * v.</span>
</span><span id="L-2126"><a href="#L-2126"><span class="linenos">2126</span></a>
</span><span id="L-2127"><a href="#L-2127"><span class="linenos">2127</span></a><span class="sd">        Returns</span>
</span><span id="L-2128"><a href="#L-2128"><span class="linenos">2128</span></a><span class="sd">        -------</span>
</span><span id="L-2129"><a href="#L-2129"><span class="linenos">2129</span></a><span class="sd">        None</span>
</span><span id="L-2130"><a href="#L-2130"><span class="linenos">2130</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2131"><a href="#L-2131"><span class="linenos">2131</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)))</span>
</span><span id="L-2132"><a href="#L-2132"><span class="linenos">2132</span></a>
</span><span id="L-2133"><a href="#L-2133"><span class="linenos">2133</span></a>    <span class="k">def</span> <span class="nf">_set_feasible_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-2134"><a href="#L-2134"><span class="linenos">2134</span></a>                                 <span class="n">ub</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-2135"><a href="#L-2135"><span class="linenos">2135</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2136"><a href="#L-2136"><span class="linenos">2136</span></a><span class="sd">        Sets the feasible constraints on the objective. When looking for a feasible solution,</span>
</span><span id="L-2137"><a href="#L-2137"><span class="linenos">2137</span></a><span class="sd">        this simply adds the constraints: lb &lt;= pi * v &lt;= ub.</span>
</span><span id="L-2138"><a href="#L-2138"><span class="linenos">2138</span></a>
</span><span id="L-2139"><a href="#L-2139"><span class="linenos">2139</span></a><span class="sd">        Parameters</span>
</span><span id="L-2140"><a href="#L-2140"><span class="linenos">2140</span></a><span class="sd">        ----------</span>
</span><span id="L-2141"><a href="#L-2141"><span class="linenos">2141</span></a><span class="sd">        lb : float | int</span>
</span><span id="L-2142"><a href="#L-2142"><span class="linenos">2142</span></a><span class="sd">            The lower bound</span>
</span><span id="L-2143"><a href="#L-2143"><span class="linenos">2143</span></a><span class="sd">        ub : float | int</span>
</span><span id="L-2144"><a href="#L-2144"><span class="linenos">2144</span></a><span class="sd">            The upper bound</span>
</span><span id="L-2145"><a href="#L-2145"><span class="linenos">2145</span></a>
</span><span id="L-2146"><a href="#L-2146"><span class="linenos">2146</span></a><span class="sd">        Returns</span>
</span><span id="L-2147"><a href="#L-2147"><span class="linenos">2147</span></a><span class="sd">        -------</span>
</span><span id="L-2148"><a href="#L-2148"><span class="linenos">2148</span></a><span class="sd">        None</span>
</span><span id="L-2149"><a href="#L-2149"><span class="linenos">2149</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2150"><a href="#L-2150"><span class="linenos">2150</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">lb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;temp_feasible_lb&quot;</span><span class="p">)</span>
</span><span id="L-2151"><a href="#L-2151"><span class="linenos">2151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">ub</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;temp_feasible_ub&quot;</span><span class="p">)</span>
</span><span id="L-2152"><a href="#L-2152"><span class="linenos">2152</span></a>
</span><span id="L-2153"><a href="#L-2153"><span class="linenos">2153</span></a>    <span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2154"><a href="#L-2154"><span class="linenos">2154</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2155"><a href="#L-2155"><span class="linenos">2155</span></a><span class="sd">        Returns the values of pi, Q, R, v, features, and ml_outputs as a dictionary.</span>
</span><span id="L-2156"><a href="#L-2156"><span class="linenos">2156</span></a>
</span><span id="L-2157"><a href="#L-2157"><span class="linenos">2157</span></a><span class="sd">        Returns</span>
</span><span id="L-2158"><a href="#L-2158"><span class="linenos">2158</span></a><span class="sd">        -------</span>
</span><span id="L-2159"><a href="#L-2159"><span class="linenos">2159</span></a><span class="sd">        dict</span>
</span><span id="L-2160"><a href="#L-2160"><span class="linenos">2160</span></a><span class="sd">            A dictionary with keys:</span>
</span><span id="L-2161"><a href="#L-2161"><span class="linenos">2161</span></a><span class="sd">            - `pi`: the values of pi</span>
</span><span id="L-2162"><a href="#L-2162"><span class="linenos">2162</span></a><span class="sd">            - `Q`: the values of Q</span>
</span><span id="L-2163"><a href="#L-2163"><span class="linenos">2163</span></a><span class="sd">            - `R`: the values of R</span>
</span><span id="L-2164"><a href="#L-2164"><span class="linenos">2164</span></a><span class="sd">            - `v`: the values of v</span>
</span><span id="L-2165"><a href="#L-2165"><span class="linenos">2165</span></a><span class="sd">            - `features`: the values of the features</span>
</span><span id="L-2166"><a href="#L-2166"><span class="linenos">2166</span></a><span class="sd">            - `ml_outputs`: the values of the ml_outputs</span>
</span><span id="L-2167"><a href="#L-2167"><span class="linenos">2167</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2168"><a href="#L-2168"><span class="linenos">2168</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-2169"><a href="#L-2169"><span class="linenos">2169</span></a>            <span class="s2">&quot;pi&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="L-2170"><a href="#L-2170"><span class="linenos">2170</span></a>            <span class="s2">&quot;Q&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="L-2171"><a href="#L-2171"><span class="linenos">2171</span></a>            <span class="s2">&quot;R&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="L-2172"><a href="#L-2172"><span class="linenos">2172</span></a>            <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="L-2173"><a href="#L-2173"><span class="linenos">2173</span></a>            <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">)],</span>
</span><span id="L-2174"><a href="#L-2174"><span class="linenos">2174</span></a>            <span class="s2">&quot;ml_outputs&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]))]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">))]</span>
</span><span id="L-2175"><a href="#L-2175"><span class="linenos">2175</span></a>        <span class="p">}</span>
</span><span id="L-2176"><a href="#L-2176"><span class="linenos">2176</span></a>
</span><span id="L-2177"><a href="#L-2177"><span class="linenos">2177</span></a>    <span class="k">def</span> <span class="nf">_compute_affine_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ml_bounds</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]):</span>
</span><span id="L-2178"><a href="#L-2178"><span class="linenos">2178</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2179"><a href="#L-2179"><span class="linenos">2179</span></a><span class="sd">        Computes the affine bounds for the parameters that are linked to ML outputs.</span>
</span><span id="L-2180"><a href="#L-2180"><span class="linenos">2180</span></a>
</span><span id="L-2181"><a href="#L-2181"><span class="linenos">2181</span></a><span class="sd">        Parameters</span>
</span><span id="L-2182"><a href="#L-2182"><span class="linenos">2182</span></a><span class="sd">        ----------</span>
</span><span id="L-2183"><a href="#L-2183"><span class="linenos">2183</span></a><span class="sd">        ml_bounds : List[List[Tuple[float, float]]]</span>
</span><span id="L-2184"><a href="#L-2184"><span class="linenos">2184</span></a><span class="sd">            The bounds for the ML outputs</span>
</span><span id="L-2185"><a href="#L-2185"><span class="linenos">2185</span></a>
</span><span id="L-2186"><a href="#L-2186"><span class="linenos">2186</span></a><span class="sd">        Returns</span>
</span><span id="L-2187"><a href="#L-2187"><span class="linenos">2187</span></a><span class="sd">        -------</span>
</span><span id="L-2188"><a href="#L-2188"><span class="linenos">2188</span></a><span class="sd">        dict</span>
</span><span id="L-2189"><a href="#L-2189"><span class="linenos">2189</span></a><span class="sd">            A dictionary with keys: &#39;pi&#39;, &#39;Q&#39;, &#39;R&#39;</span>
</span><span id="L-2190"><a href="#L-2190"><span class="linenos">2190</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2191"><a href="#L-2191"><span class="linenos">2191</span></a>        <span class="c1"># Convert ml_bounds to dictionary for easier lookup</span>
</span><span id="L-2192"><a href="#L-2192"><span class="linenos">2192</span></a>        <span class="n">bounds_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2193"><a href="#L-2193"><span class="linenos">2193</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model_bounds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ml_bounds</span><span class="p">):</span>
</span><span id="L-2194"><a href="#L-2194"><span class="linenos">2194</span></a>            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_bounds</span><span class="p">):</span>
</span><span id="L-2195"><a href="#L-2195"><span class="linenos">2195</span></a>                <span class="n">bounds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ml_outputs_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="L-2196"><a href="#L-2196"><span class="linenos">2196</span></a>
</span><span id="L-2197"><a href="#L-2197"><span class="linenos">2197</span></a>        <span class="c1"># Initialize bounds dictionary</span>
</span><span id="L-2198"><a href="#L-2198"><span class="linenos">2198</span></a>        <span class="n">affine_bounds</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2199"><a href="#L-2199"><span class="linenos">2199</span></a>            <span class="s1">&#39;pi&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-2200"><a href="#L-2200"><span class="linenos">2200</span></a>            <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-2201"><a href="#L-2201"><span class="linenos">2201</span></a>            <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="p">[]</span>
</span><span id="L-2202"><a href="#L-2202"><span class="linenos">2202</span></a>        <span class="p">}</span>
</span><span id="L-2203"><a href="#L-2203"><span class="linenos">2203</span></a>
</span><span id="L-2204"><a href="#L-2204"><span class="linenos">2204</span></a>        <span class="c1"># Compute bounds for each parameter that is an ML output</span>
</span><span id="L-2205"><a href="#L-2205"><span class="linenos">2205</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2206"><a href="#L-2206"><span class="linenos">2206</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
</span><span id="L-2207"><a href="#L-2207"><span class="linenos">2207</span></a>                <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ml_expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-2208"><a href="#L-2208"><span class="linenos">2208</span></a>                <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_expr_bounds</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">bounds_dict</span><span class="p">)))</span>
</span><span id="L-2209"><a href="#L-2209"><span class="linenos">2209</span></a>
</span><span id="L-2210"><a href="#L-2210"><span class="linenos">2210</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2211"><a href="#L-2211"><span class="linenos">2211</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-2212"><a href="#L-2212"><span class="linenos">2212</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
</span><span id="L-2213"><a href="#L-2213"><span class="linenos">2213</span></a>                    <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ml_expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
</span><span id="L-2214"><a href="#L-2214"><span class="linenos">2214</span></a>                    <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_expr_bounds</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">bounds_dict</span><span class="p">)))</span>
</span><span id="L-2215"><a href="#L-2215"><span class="linenos">2215</span></a>
</span><span id="L-2216"><a href="#L-2216"><span class="linenos">2216</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2217"><a href="#L-2217"><span class="linenos">2217</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-2218"><a href="#L-2218"><span class="linenos">2218</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
</span><span id="L-2219"><a href="#L-2219"><span class="linenos">2219</span></a>                    <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ml_expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
</span><span id="L-2220"><a href="#L-2220"><span class="linenos">2220</span></a>                    <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_expr_bounds</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">bounds_dict</span><span class="p">)))</span>
</span><span id="L-2221"><a href="#L-2221"><span class="linenos">2221</span></a>
</span><span id="L-2222"><a href="#L-2222"><span class="linenos">2222</span></a>        <span class="k">return</span> <span class="n">affine_bounds</span>
</span><span id="L-2223"><a href="#L-2223"><span class="linenos">2223</span></a>
</span><span id="L-2224"><a href="#L-2224"><span class="linenos">2224</span></a>    <span class="k">def</span> <span class="nf">_set_affine_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">affine_bounds</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-2225"><a href="#L-2225"><span class="linenos">2225</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2226"><a href="#L-2226"><span class="linenos">2226</span></a><span class="sd">        Sets the bounds for the parameters that are linked to ML outputs.</span>
</span><span id="L-2227"><a href="#L-2227"><span class="linenos">2227</span></a>
</span><span id="L-2228"><a href="#L-2228"><span class="linenos">2228</span></a><span class="sd">        Parameters</span>
</span><span id="L-2229"><a href="#L-2229"><span class="linenos">2229</span></a><span class="sd">        ----------</span>
</span><span id="L-2230"><a href="#L-2230"><span class="linenos">2230</span></a><span class="sd">        affine_bounds : dict</span>
</span><span id="L-2231"><a href="#L-2231"><span class="linenos">2231</span></a><span class="sd">            The bounds for the ML outputs</span>
</span><span id="L-2232"><a href="#L-2232"><span class="linenos">2232</span></a>
</span><span id="L-2233"><a href="#L-2233"><span class="linenos">2233</span></a><span class="sd">        Returns</span>
</span><span id="L-2234"><a href="#L-2234"><span class="linenos">2234</span></a><span class="sd">        -------</span>
</span><span id="L-2235"><a href="#L-2235"><span class="linenos">2235</span></a><span class="sd">        None</span>
</span><span id="L-2236"><a href="#L-2236"><span class="linenos">2236</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2237"><a href="#L-2237"><span class="linenos">2237</span></a>        <span class="c1"># Set bounds only for parameters that are ML outputs</span>
</span><span id="L-2238"><a href="#L-2238"><span class="linenos">2238</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]:</span>
</span><span id="L-2239"><a href="#L-2239"><span class="linenos">2239</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="L-2240"><a href="#L-2240"><span class="linenos">2240</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="L-2241"><a href="#L-2241"><span class="linenos">2241</span></a>
</span><span id="L-2242"><a href="#L-2242"><span class="linenos">2242</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]:</span>
</span><span id="L-2243"><a href="#L-2243"><span class="linenos">2243</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="L-2244"><a href="#L-2244"><span class="linenos">2244</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="L-2245"><a href="#L-2245"><span class="linenos">2245</span></a>
</span><span id="L-2246"><a href="#L-2246"><span class="linenos">2246</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]:</span>
</span><span id="L-2247"><a href="#L-2247"><span class="linenos">2247</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="L-2248"><a href="#L-2248"><span class="linenos">2248</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="L-2249"><a href="#L-2249"><span class="linenos">2249</span></a>
</span><span id="L-2250"><a href="#L-2250"><span class="linenos">2250</span></a>    <span class="k">def</span> <span class="nf">_compute_initial_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2251"><a href="#L-2251"><span class="linenos">2251</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2252"><a href="#L-2252"><span class="linenos">2252</span></a><span class="sd">        Computes the initial bounds for v using the bounds on R.</span>
</span><span id="L-2253"><a href="#L-2253"><span class="linenos">2253</span></a><span class="sd">        Uses the lemma from the paper: for each $v_i$, $v_i \\in [v^min_i, v^max_i]$ where</span>
</span><span id="L-2254"><a href="#L-2254"><span class="linenos">2254</span></a><span class="sd">        $v^min_i = 0$, and</span>
</span><span id="L-2255"><a href="#L-2255"><span class="linenos">2255</span></a><span class="sd">        $v^max_i = 1/\\epsilon * \\max_j \\sum_{k=1}^{|S|} R_{jk}^max$,</span>
</span><span id="L-2256"><a href="#L-2256"><span class="linenos">2256</span></a><span class="sd">        where $\\epsilon$ is the small numerical offset for the strict substochasticity</span>
</span><span id="L-2257"><a href="#L-2257"><span class="linenos">2257</span></a>
</span><span id="L-2258"><a href="#L-2258"><span class="linenos">2258</span></a><span class="sd">        Returns</span>
</span><span id="L-2259"><a href="#L-2259"><span class="linenos">2259</span></a><span class="sd">        -------</span>
</span><span id="L-2260"><a href="#L-2260"><span class="linenos">2260</span></a><span class="sd">        List[Tuple[float, float]]</span>
</span><span id="L-2261"><a href="#L-2261"><span class="linenos">2261</span></a><span class="sd">            The initial bounds for v</span>
</span><span id="L-2262"><a href="#L-2262"><span class="linenos">2262</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2263"><a href="#L-2263"><span class="linenos">2263</span></a>        <span class="c1"># Find maximum row sum of R&#39;s upper bounds</span>
</span><span id="L-2264"><a href="#L-2264"><span class="linenos">2264</span></a>        <span class="n">max_row_sum</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2265"><a href="#L-2265"><span class="linenos">2265</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">):</span>
</span><span id="L-2266"><a href="#L-2266"><span class="linenos">2266</span></a>            <span class="n">row_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span><span class="p">))</span>
</span><span id="L-2267"><a href="#L-2267"><span class="linenos">2267</span></a>            <span class="n">max_row_sum</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_row_sum</span><span class="p">,</span> <span class="n">row_sum</span><span class="p">)</span>
</span><span id="L-2268"><a href="#L-2268"><span class="linenos">2268</span></a>
</span><span id="L-2269"><a href="#L-2269"><span class="linenos">2269</span></a>        <span class="c1"># Compute upper bound using epsilon</span>
</span><span id="L-2270"><a href="#L-2270"><span class="linenos">2270</span></a>        <span class="n">v_max</span> <span class="o">=</span> <span class="n">max_row_sum</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span>
</span><span id="L-2271"><a href="#L-2271"><span class="linenos">2271</span></a>
</span><span id="L-2272"><a href="#L-2272"><span class="linenos">2272</span></a>        <span class="c1"># Return bounds for each transient state: [0, v_max]</span>
</span><span id="L-2273"><a href="#L-2273"><span class="linenos">2273</span></a>        <span class="k">return</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">v_max</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="L-2274"><a href="#L-2274"><span class="linenos">2274</span></a>
</span><span id="L-2275"><a href="#L-2275"><span class="linenos">2275</span></a>    <span class="k">def</span> <span class="nf">_set_initial_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_v_bounds</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]):</span>
</span><span id="L-2276"><a href="#L-2276"><span class="linenos">2276</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2277"><a href="#L-2277"><span class="linenos">2277</span></a><span class="sd">        Sets the initial bounds for v.</span>
</span><span id="L-2278"><a href="#L-2278"><span class="linenos">2278</span></a>
</span><span id="L-2279"><a href="#L-2279"><span class="linenos">2279</span></a><span class="sd">        Parameters</span>
</span><span id="L-2280"><a href="#L-2280"><span class="linenos">2280</span></a><span class="sd">        ----------</span>
</span><span id="L-2281"><a href="#L-2281"><span class="linenos">2281</span></a><span class="sd">        initial_v_bounds : List[Tuple[float, float]]</span>
</span><span id="L-2282"><a href="#L-2282"><span class="linenos">2282</span></a><span class="sd">            The initial bounds for v</span>
</span><span id="L-2283"><a href="#L-2283"><span class="linenos">2283</span></a>
</span><span id="L-2284"><a href="#L-2284"><span class="linenos">2284</span></a><span class="sd">        Returns</span>
</span><span id="L-2285"><a href="#L-2285"><span class="linenos">2285</span></a><span class="sd">        -------</span>
</span><span id="L-2286"><a href="#L-2286"><span class="linenos">2286</span></a><span class="sd">        None</span>
</span><span id="L-2287"><a href="#L-2287"><span class="linenos">2287</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2288"><a href="#L-2288"><span class="linenos">2288</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2289"><a href="#L-2289"><span class="linenos">2289</span></a>            <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">initial_v_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-2290"><a href="#L-2290"><span class="linenos">2290</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="L-2291"><a href="#L-2291"><span class="linenos">2291</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="L-2292"><a href="#L-2292"><span class="linenos">2292</span></a>
</span><span id="L-2293"><a href="#L-2293"><span class="linenos">2293</span></a>    <span class="k">def</span> <span class="nf">_compute_tightened_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2294"><a href="#L-2294"><span class="linenos">2294</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2295"><a href="#L-2295"><span class="linenos">2295</span></a><span class="sd">        Computes the tightened bounds for v using the bounds for Q and R and initial bounds for v.</span>
</span><span id="L-2296"><a href="#L-2296"><span class="linenos">2296</span></a><span class="sd">        This uses Gauss-Seidel to solve the linear system: $vM = R1$, where $M = I - Q$.</span>
</span><span id="L-2297"><a href="#L-2297"><span class="linenos">2297</span></a>
</span><span id="L-2298"><a href="#L-2298"><span class="linenos">2298</span></a><span class="sd">        Returns</span>
</span><span id="L-2299"><a href="#L-2299"><span class="linenos">2299</span></a><span class="sd">        -------</span>
</span><span id="L-2300"><a href="#L-2300"><span class="linenos">2300</span></a><span class="sd">        List[Tuple[float, float]]</span>
</span><span id="L-2301"><a href="#L-2301"><span class="linenos">2301</span></a><span class="sd">            The tightened bounds for v</span>
</span><span id="L-2302"><a href="#L-2302"><span class="linenos">2302</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2303"><a href="#L-2303"><span class="linenos">2303</span></a>        <span class="c1"># Create interval matrices for Q and R</span>
</span><span id="L-2304"><a href="#L-2304"><span class="linenos">2304</span></a>        <span class="n">Q_intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-2305"><a href="#L-2305"><span class="linenos">2305</span></a>        <span class="n">R_intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-2306"><a href="#L-2306"><span class="linenos">2306</span></a>
</span><span id="L-2307"><a href="#L-2307"><span class="linenos">2307</span></a>        <span class="c1"># Fill intervals from current bounds</span>
</span><span id="L-2308"><a href="#L-2308"><span class="linenos">2308</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2309"><a href="#L-2309"><span class="linenos">2309</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-2310"><a href="#L-2310"><span class="linenos">2310</span></a>                <span class="n">Q_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span><span class="p">]</span>
</span><span id="L-2311"><a href="#L-2311"><span class="linenos">2311</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2312"><a href="#L-2312"><span class="linenos">2312</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-2313"><a href="#L-2313"><span class="linenos">2313</span></a>                <span class="n">R_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span><span class="p">]</span>
</span><span id="L-2314"><a href="#L-2314"><span class="linenos">2314</span></a>
</span><span id="L-2315"><a href="#L-2315"><span class="linenos">2315</span></a>        <span class="n">R1_intervals</span> <span class="o">=</span> <span class="n">R_intervals</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># R1 is basically row sums</span>
</span><span id="L-2316"><a href="#L-2316"><span class="linenos">2316</span></a>
</span><span id="L-2317"><a href="#L-2317"><span class="linenos">2317</span></a>        <span class="c1"># Create linear system: Mv = R1, where M = I - Q</span>
</span><span id="L-2318"><a href="#L-2318"><span class="linenos">2318</span></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">ima</span><span class="o">.</span><span class="n">_identity_interval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-2319"><a href="#L-2319"><span class="linenos">2319</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">ima</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">Q_intervals</span><span class="p">)</span>
</span><span id="L-2320"><a href="#L-2320"><span class="linenos">2320</span></a>
</span><span id="L-2321"><a href="#L-2321"><span class="linenos">2321</span></a>        <span class="c1"># Initial guess using current v bounds</span>
</span><span id="L-2322"><a href="#L-2322"><span class="linenos">2322</span></a>        <span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])])</span>
</span><span id="L-2323"><a href="#L-2323"><span class="linenos">2323</span></a>
</span><span id="L-2324"><a href="#L-2324"><span class="linenos">2324</span></a>        <span class="c1"># Solve using Gauss-Seidel</span>
</span><span id="L-2325"><a href="#L-2325"><span class="linenos">2325</span></a>        <span class="n">v_intervals</span> <span class="o">=</span> <span class="n">ima</span><span class="o">.</span><span class="n">interval_gauss_seidel</span><span class="p">(</span>
</span><span id="L-2326"><a href="#L-2326"><span class="linenos">2326</span></a>            <span class="n">M</span><span class="p">,</span> <span class="n">R1_intervals</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span>
</span><span id="L-2327"><a href="#L-2327"><span class="linenos">2327</span></a>            <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span id="L-2328"><a href="#L-2328"><span class="linenos">2328</span></a>            <span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span>
</span><span id="L-2329"><a href="#L-2329"><span class="linenos">2329</span></a>        <span class="p">)</span>
</span><span id="L-2330"><a href="#L-2330"><span class="linenos">2330</span></a>
</span><span id="L-2331"><a href="#L-2331"><span class="linenos">2331</span></a>        <span class="c1"># Convert to list of tuples</span>
</span><span id="L-2332"><a href="#L-2332"><span class="linenos">2332</span></a>        <span class="k">return</span> <span class="p">[(</span><span class="n">v_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">v_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="L-2333"><a href="#L-2333"><span class="linenos">2333</span></a>
</span><span id="L-2334"><a href="#L-2334"><span class="linenos">2334</span></a>    <span class="k">def</span> <span class="nf">_set_tightened_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tightened_v_bounds</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]):</span>
</span><span id="L-2335"><a href="#L-2335"><span class="linenos">2335</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2336"><a href="#L-2336"><span class="linenos">2336</span></a><span class="sd">        Sets the tightened bounds for v.</span>
</span><span id="L-2337"><a href="#L-2337"><span class="linenos">2337</span></a>
</span><span id="L-2338"><a href="#L-2338"><span class="linenos">2338</span></a><span class="sd">        Parameters</span>
</span><span id="L-2339"><a href="#L-2339"><span class="linenos">2339</span></a><span class="sd">        ----------</span>
</span><span id="L-2340"><a href="#L-2340"><span class="linenos">2340</span></a><span class="sd">        tightened_v_bounds : List[Tuple[float, float]]</span>
</span><span id="L-2341"><a href="#L-2341"><span class="linenos">2341</span></a><span class="sd">            The tightened bounds for v</span>
</span><span id="L-2342"><a href="#L-2342"><span class="linenos">2342</span></a>
</span><span id="L-2343"><a href="#L-2343"><span class="linenos">2343</span></a><span class="sd">        Returns</span>
</span><span id="L-2344"><a href="#L-2344"><span class="linenos">2344</span></a><span class="sd">        -------</span>
</span><span id="L-2345"><a href="#L-2345"><span class="linenos">2345</span></a><span class="sd">        None</span>
</span><span id="L-2346"><a href="#L-2346"><span class="linenos">2346</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2347"><a href="#L-2347"><span class="linenos">2347</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2348"><a href="#L-2348"><span class="linenos">2348</span></a>            <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">tightened_v_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-2349"><a href="#L-2349"><span class="linenos">2349</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="L-2350"><a href="#L-2350"><span class="linenos">2350</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="L-2351"><a href="#L-2351"><span class="linenos">2351</span></a>
</span><span id="L-2352"><a href="#L-2352"><span class="linenos">2352</span></a>    <span class="c1"># CLEAN PARAMETER ACCESSORS</span>
</span><span id="L-2353"><a href="#L-2353"><span class="linenos">2353</span></a>
</span><span id="L-2354"><a href="#L-2354"><span class="linenos">2354</span></a>    <span class="nd">@property</span>
</span><span id="L-2355"><a href="#L-2355"><span class="linenos">2355</span></a>    <span class="k">def</span> <span class="nf">pi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2356"><a href="#L-2356"><span class="linenos">2356</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2357"><a href="#L-2357"><span class="linenos">2357</span></a><span class="sd">        Accessor for the pi parameter.</span>
</span><span id="L-2358"><a href="#L-2358"><span class="linenos">2358</span></a>
</span><span id="L-2359"><a href="#L-2359"><span class="linenos">2359</span></a><span class="sd">        Returns</span>
</span><span id="L-2360"><a href="#L-2360"><span class="linenos">2360</span></a><span class="sd">        -------</span>
</span><span id="L-2361"><a href="#L-2361"><span class="linenos">2361</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="L-2362"><a href="#L-2362"><span class="linenos">2362</span></a><span class="sd">            The pi parameter</span>
</span><span id="L-2363"><a href="#L-2363"><span class="linenos">2363</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2364"><a href="#L-2364"><span class="linenos">2364</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span>
</span><span id="L-2365"><a href="#L-2365"><span class="linenos">2365</span></a>
</span><span id="L-2366"><a href="#L-2366"><span class="linenos">2366</span></a>    <span class="nd">@property</span>
</span><span id="L-2367"><a href="#L-2367"><span class="linenos">2367</span></a>    <span class="k">def</span> <span class="nf">Q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2368"><a href="#L-2368"><span class="linenos">2368</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2369"><a href="#L-2369"><span class="linenos">2369</span></a><span class="sd">        Accessor for the Q parameter.</span>
</span><span id="L-2370"><a href="#L-2370"><span class="linenos">2370</span></a>
</span><span id="L-2371"><a href="#L-2371"><span class="linenos">2371</span></a><span class="sd">        Returns</span>
</span><span id="L-2372"><a href="#L-2372"><span class="linenos">2372</span></a><span class="sd">        -------</span>
</span><span id="L-2373"><a href="#L-2373"><span class="linenos">2373</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="L-2374"><a href="#L-2374"><span class="linenos">2374</span></a><span class="sd">            The Q parameter</span>
</span><span id="L-2375"><a href="#L-2375"><span class="linenos">2375</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2376"><a href="#L-2376"><span class="linenos">2376</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span>
</span><span id="L-2377"><a href="#L-2377"><span class="linenos">2377</span></a>
</span><span id="L-2378"><a href="#L-2378"><span class="linenos">2378</span></a>    <span class="nd">@property</span>
</span><span id="L-2379"><a href="#L-2379"><span class="linenos">2379</span></a>    <span class="k">def</span> <span class="nf">R</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2380"><a href="#L-2380"><span class="linenos">2380</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2381"><a href="#L-2381"><span class="linenos">2381</span></a><span class="sd">        Accessor for the R parameter.</span>
</span><span id="L-2382"><a href="#L-2382"><span class="linenos">2382</span></a>
</span><span id="L-2383"><a href="#L-2383"><span class="linenos">2383</span></a><span class="sd">        Returns</span>
</span><span id="L-2384"><a href="#L-2384"><span class="linenos">2384</span></a><span class="sd">        -------</span>
</span><span id="L-2385"><a href="#L-2385"><span class="linenos">2385</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="L-2386"><a href="#L-2386"><span class="linenos">2386</span></a><span class="sd">            The R parameter</span>
</span><span id="L-2387"><a href="#L-2387"><span class="linenos">2387</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2388"><a href="#L-2388"><span class="linenos">2388</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>
</span><span id="L-2389"><a href="#L-2389"><span class="linenos">2389</span></a>
</span><span id="L-2390"><a href="#L-2390"><span class="linenos">2390</span></a>    <span class="nd">@property</span>
</span><span id="L-2391"><a href="#L-2391"><span class="linenos">2391</span></a>    <span class="k">def</span> <span class="nf">v</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2392"><a href="#L-2392"><span class="linenos">2392</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2393"><a href="#L-2393"><span class="linenos">2393</span></a><span class="sd">        Accessor for the v parameter.</span>
</span><span id="L-2394"><a href="#L-2394"><span class="linenos">2394</span></a>
</span><span id="L-2395"><a href="#L-2395"><span class="linenos">2395</span></a><span class="sd">        Returns</span>
</span><span id="L-2396"><a href="#L-2396"><span class="linenos">2396</span></a><span class="sd">        -------</span>
</span><span id="L-2397"><a href="#L-2397"><span class="linenos">2397</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="L-2398"><a href="#L-2398"><span class="linenos">2398</span></a><span class="sd">            The v parameter</span>
</span><span id="L-2399"><a href="#L-2399"><span class="linenos">2399</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2400"><a href="#L-2400"><span class="linenos">2400</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
</span><span id="L-2401"><a href="#L-2401"><span class="linenos">2401</span></a>
</span><span id="L-2402"><a href="#L-2402"><span class="linenos">2402</span></a>    <span class="c1"># HELPER FUNCTIONS TO SET PARAMETERS</span>
</span><span id="L-2403"><a href="#L-2403"><span class="linenos">2403</span></a>
</span><span id="L-2404"><a href="#L-2404"><span class="linenos">2404</span></a>    <span class="k">def</span> <span class="nf">set_pi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]):</span>
</span><span id="L-2405"><a href="#L-2405"><span class="linenos">2405</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2406"><a href="#L-2406"><span class="linenos">2406</span></a><span class="sd">        Helper function to set the entire pi vector.</span>
</span><span id="L-2407"><a href="#L-2407"><span class="linenos">2407</span></a>
</span><span id="L-2408"><a href="#L-2408"><span class="linenos">2408</span></a><span class="sd">        Parameters</span>
</span><span id="L-2409"><a href="#L-2409"><span class="linenos">2409</span></a><span class="sd">        ----------</span>
</span><span id="L-2410"><a href="#L-2410"><span class="linenos">2410</span></a><span class="sd">        values : List[float | int | gp.Var | gp.LinExpr]</span>
</span><span id="L-2411"><a href="#L-2411"><span class="linenos">2411</span></a><span class="sd">            The values to set the pi parameter to</span>
</span><span id="L-2412"><a href="#L-2412"><span class="linenos">2412</span></a>
</span><span id="L-2413"><a href="#L-2413"><span class="linenos">2413</span></a><span class="sd">        Returns</span>
</span><span id="L-2414"><a href="#L-2414"><span class="linenos">2414</span></a><span class="sd">        -------</span>
</span><span id="L-2415"><a href="#L-2415"><span class="linenos">2415</span></a><span class="sd">        None</span>
</span><span id="L-2416"><a href="#L-2416"><span class="linenos">2416</span></a>
</span><span id="L-2417"><a href="#L-2417"><span class="linenos">2417</span></a><span class="sd">        Raises</span>
</span><span id="L-2418"><a href="#L-2418"><span class="linenos">2418</span></a><span class="sd">        ------</span>
</span><span id="L-2419"><a href="#L-2419"><span class="linenos">2419</span></a><span class="sd">        ValueError</span>
</span><span id="L-2420"><a href="#L-2420"><span class="linenos">2420</span></a><span class="sd">            If the values have incorrect length, are not in [0, 1], don&#39;t sum to &lt;=1, or pi is already set</span>
</span><span id="L-2421"><a href="#L-2421"><span class="linenos">2421</span></a>
</span><span id="L-2422"><a href="#L-2422"><span class="linenos">2422</span></a><span class="sd">        Notes</span>
</span><span id="L-2423"><a href="#L-2423"><span class="linenos">2423</span></a><span class="sd">        -----</span>
</span><span id="L-2424"><a href="#L-2424"><span class="linenos">2424</span></a><span class="sd">        This checks for validity of the values, checks if pi is already set, and sets the values.</span>
</span><span id="L-2425"><a href="#L-2425"><span class="linenos">2425</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2426"><a href="#L-2426"><span class="linenos">2426</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_length</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">)</span>
</span><span id="L-2427"><a href="#L-2427"><span class="linenos">2427</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="L-2428"><a href="#L-2428"><span class="linenos">2428</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-2429"><a href="#L-2429"><span class="linenos">2429</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-2430"><a href="#L-2430"><span class="linenos">2430</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;pi&quot;</span><span class="p">),</span>\
</span><span id="L-2431"><a href="#L-2431"><span class="linenos">2431</span></a>              <span class="s2">&quot;pi is already set&quot;</span>
</span><span id="L-2432"><a href="#L-2432"><span class="linenos">2432</span></a>
</span><span id="L-2433"><a href="#L-2433"><span class="linenos">2433</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;pi&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2434"><a href="#L-2434"><span class="linenos">2434</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="L-2435"><a href="#L-2435"><span class="linenos">2435</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-2436"><a href="#L-2436"><span class="linenos">2436</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="L-2437"><a href="#L-2437"><span class="linenos">2437</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-2438"><a href="#L-2438"><span class="linenos">2438</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2439"><a href="#L-2439"><span class="linenos">2439</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pi[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span><span id="L-2440"><a href="#L-2440"><span class="linenos">2440</span></a>
</span><span id="L-2441"><a href="#L-2441"><span class="linenos">2441</span></a>    <span class="k">def</span> <span class="nf">set_Q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]]):</span>
</span><span id="L-2442"><a href="#L-2442"><span class="linenos">2442</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2443"><a href="#L-2443"><span class="linenos">2443</span></a><span class="sd">        Helper function to set the Q matrix.</span>
</span><span id="L-2444"><a href="#L-2444"><span class="linenos">2444</span></a>
</span><span id="L-2445"><a href="#L-2445"><span class="linenos">2445</span></a><span class="sd">        Parameters</span>
</span><span id="L-2446"><a href="#L-2446"><span class="linenos">2446</span></a><span class="sd">        ----------</span>
</span><span id="L-2447"><a href="#L-2447"><span class="linenos">2447</span></a><span class="sd">        values : List[List[float | int | gp.Var | gp.LinExpr]]</span>
</span><span id="L-2448"><a href="#L-2448"><span class="linenos">2448</span></a><span class="sd">            The values to set the Q matrix to</span>
</span><span id="L-2449"><a href="#L-2449"><span class="linenos">2449</span></a>
</span><span id="L-2450"><a href="#L-2450"><span class="linenos">2450</span></a><span class="sd">        Returns</span>
</span><span id="L-2451"><a href="#L-2451"><span class="linenos">2451</span></a><span class="sd">        -------</span>
</span><span id="L-2452"><a href="#L-2452"><span class="linenos">2452</span></a><span class="sd">        None</span>
</span><span id="L-2453"><a href="#L-2453"><span class="linenos">2453</span></a>
</span><span id="L-2454"><a href="#L-2454"><span class="linenos">2454</span></a><span class="sd">        Raises</span>
</span><span id="L-2455"><a href="#L-2455"><span class="linenos">2455</span></a><span class="sd">        ------</span>
</span><span id="L-2456"><a href="#L-2456"><span class="linenos">2456</span></a><span class="sd">        ValueError</span>
</span><span id="L-2457"><a href="#L-2457"><span class="linenos">2457</span></a><span class="sd">            If the values have incorrect length, are not in [0, 1), rows don&#39;t sum to strictly less than 1, or Q is already set</span>
</span><span id="L-2458"><a href="#L-2458"><span class="linenos">2458</span></a>
</span><span id="L-2459"><a href="#L-2459"><span class="linenos">2459</span></a><span class="sd">        Notes</span>
</span><span id="L-2460"><a href="#L-2460"><span class="linenos">2460</span></a><span class="sd">        -----</span>
</span><span id="L-2461"><a href="#L-2461"><span class="linenos">2461</span></a><span class="sd">        This checks for validity of the values, checks if Q is already set, and sets the values.</span>
</span><span id="L-2462"><a href="#L-2462"><span class="linenos">2462</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2463"><a href="#L-2463"><span class="linenos">2463</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_shape</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">)</span>
</span><span id="L-2464"><a href="#L-2464"><span class="linenos">2464</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="L-2465"><a href="#L-2465"><span class="linenos">2465</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-2466"><a href="#L-2466"><span class="linenos">2466</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_matrix</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">strictsub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Q is strictly substochastic</span>
</span><span id="L-2467"><a href="#L-2467"><span class="linenos">2467</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
</span><span id="L-2468"><a href="#L-2468"><span class="linenos">2468</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="L-2469"><a href="#L-2469"><span class="linenos">2469</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;Q[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">strictsub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Q is strictly substochastic</span>
</span><span id="L-2470"><a href="#L-2470"><span class="linenos">2470</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">),</span>\
</span><span id="L-2471"><a href="#L-2471"><span class="linenos">2471</span></a>              <span class="s2">&quot;Q is already set&quot;</span>
</span><span id="L-2472"><a href="#L-2472"><span class="linenos">2472</span></a>
</span><span id="L-2473"><a href="#L-2473"><span class="linenos">2473</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2474"><a href="#L-2474"><span class="linenos">2474</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-2475"><a href="#L-2475"><span class="linenos">2475</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="L-2476"><a href="#L-2476"><span class="linenos">2476</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-2477"><a href="#L-2477"><span class="linenos">2477</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="L-2478"><a href="#L-2478"><span class="linenos">2478</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-2479"><a href="#L-2479"><span class="linenos">2479</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2480"><a href="#L-2480"><span class="linenos">2480</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span><span id="L-2481"><a href="#L-2481"><span class="linenos">2481</span></a>
</span><span id="L-2482"><a href="#L-2482"><span class="linenos">2482</span></a>    <span class="k">def</span> <span class="nf">set_R</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]]):</span>
</span><span id="L-2483"><a href="#L-2483"><span class="linenos">2483</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2484"><a href="#L-2484"><span class="linenos">2484</span></a><span class="sd">        Helper function to set the R matrix.</span>
</span><span id="L-2485"><a href="#L-2485"><span class="linenos">2485</span></a>
</span><span id="L-2486"><a href="#L-2486"><span class="linenos">2486</span></a><span class="sd">        Parameters</span>
</span><span id="L-2487"><a href="#L-2487"><span class="linenos">2487</span></a><span class="sd">        ----------</span>
</span><span id="L-2488"><a href="#L-2488"><span class="linenos">2488</span></a><span class="sd">        values : List[List[float | int | gp.Var | gp.LinExpr]]</span>
</span><span id="L-2489"><a href="#L-2489"><span class="linenos">2489</span></a><span class="sd">            The values to set the R matrix to</span>
</span><span id="L-2490"><a href="#L-2490"><span class="linenos">2490</span></a>
</span><span id="L-2491"><a href="#L-2491"><span class="linenos">2491</span></a><span class="sd">        Returns</span>
</span><span id="L-2492"><a href="#L-2492"><span class="linenos">2492</span></a><span class="sd">        -------</span>
</span><span id="L-2493"><a href="#L-2493"><span class="linenos">2493</span></a><span class="sd">        None</span>
</span><span id="L-2494"><a href="#L-2494"><span class="linenos">2494</span></a>
</span><span id="L-2495"><a href="#L-2495"><span class="linenos">2495</span></a><span class="sd">        Raises</span>
</span><span id="L-2496"><a href="#L-2496"><span class="linenos">2496</span></a><span class="sd">        ------</span>
</span><span id="L-2497"><a href="#L-2497"><span class="linenos">2497</span></a><span class="sd">        ValueError</span>
</span><span id="L-2498"><a href="#L-2498"><span class="linenos">2498</span></a><span class="sd">            If the values have incorrect length, are not in [0, 1], rows don&#39;t sum to &lt;=1, or R is already set</span>
</span><span id="L-2499"><a href="#L-2499"><span class="linenos">2499</span></a>
</span><span id="L-2500"><a href="#L-2500"><span class="linenos">2500</span></a><span class="sd">        Notes</span>
</span><span id="L-2501"><a href="#L-2501"><span class="linenos">2501</span></a><span class="sd">        -----</span>
</span><span id="L-2502"><a href="#L-2502"><span class="linenos">2502</span></a><span class="sd">        This checks for validity of the values, checks if R is already set, and sets the values.</span>
</span><span id="L-2503"><a href="#L-2503"><span class="linenos">2503</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2504"><a href="#L-2504"><span class="linenos">2504</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_shape</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">)</span>
</span><span id="L-2505"><a href="#L-2505"><span class="linenos">2505</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="L-2506"><a href="#L-2506"><span class="linenos">2506</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-2507"><a href="#L-2507"><span class="linenos">2507</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_matrix</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-2508"><a href="#L-2508"><span class="linenos">2508</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
</span><span id="L-2509"><a href="#L-2509"><span class="linenos">2509</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="L-2510"><a href="#L-2510"><span class="linenos">2510</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;R[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-2511"><a href="#L-2511"><span class="linenos">2511</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">),</span>\
</span><span id="L-2512"><a href="#L-2512"><span class="linenos">2512</span></a>              <span class="s2">&quot;R is already set&quot;</span>
</span><span id="L-2513"><a href="#L-2513"><span class="linenos">2513</span></a>
</span><span id="L-2514"><a href="#L-2514"><span class="linenos">2514</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2515"><a href="#L-2515"><span class="linenos">2515</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-2516"><a href="#L-2516"><span class="linenos">2516</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="L-2517"><a href="#L-2517"><span class="linenos">2517</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-2518"><a href="#L-2518"><span class="linenos">2518</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="L-2519"><a href="#L-2519"><span class="linenos">2519</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-2520"><a href="#L-2520"><span class="linenos">2520</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2521"><a href="#L-2521"><span class="linenos">2521</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span><span id="L-2522"><a href="#L-2522"><span class="linenos">2522</span></a>
</span><span id="L-2523"><a href="#L-2523"><span class="linenos">2523</span></a><span class="k">class</span> <span class="nc">MarkovHitting</span><span class="p">(</span><span class="n">AbstractMarkov</span><span class="p">):</span>
</span><span id="L-2524"><a href="#L-2524"><span class="linenos">2524</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2525"><a href="#L-2525"><span class="linenos">2525</span></a><span class="sd">    For the hitting time problem.</span>
</span><span id="L-2526"><a href="#L-2526"><span class="linenos">2526</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-2527"><a href="#L-2527"><span class="linenos">2527</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_states</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-2528"><a href="#L-2528"><span class="linenos">2528</span></a>                 <span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-2529"><a href="#L-2529"><span class="linenos">2529</span></a>                 <span class="n">n_transient</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-2530"><a href="#L-2530"><span class="linenos">2530</span></a>                 <span class="n">pi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2531"><a href="#L-2531"><span class="linenos">2531</span></a>                 <span class="n">Q</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-2532"><a href="#L-2532"><span class="linenos">2532</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2533"><a href="#L-2533"><span class="linenos">2533</span></a><span class="sd">        Initialize a Markov chain for the hitting time problem.</span>
</span><span id="L-2534"><a href="#L-2534"><span class="linenos">2534</span></a>
</span><span id="L-2535"><a href="#L-2535"><span class="linenos">2535</span></a><span class="sd">        Parameters</span>
</span><span id="L-2536"><a href="#L-2536"><span class="linenos">2536</span></a><span class="sd">        ----------</span>
</span><span id="L-2537"><a href="#L-2537"><span class="linenos">2537</span></a><span class="sd">        n_states : int</span>
</span><span id="L-2538"><a href="#L-2538"><span class="linenos">2538</span></a><span class="sd">            The number of states</span>
</span><span id="L-2539"><a href="#L-2539"><span class="linenos">2539</span></a><span class="sd">        n_features : int</span>
</span><span id="L-2540"><a href="#L-2540"><span class="linenos">2540</span></a><span class="sd">            The number of features</span>
</span><span id="L-2541"><a href="#L-2541"><span class="linenos">2541</span></a><span class="sd">        n_transient : int</span>
</span><span id="L-2542"><a href="#L-2542"><span class="linenos">2542</span></a><span class="sd">            The number of transient states ($|T|$ in the paper)</span>
</span><span id="L-2543"><a href="#L-2543"><span class="linenos">2543</span></a><span class="sd">        pi : Optional[List | np.ndarray]</span>
</span><span id="L-2544"><a href="#L-2544"><span class="linenos">2544</span></a><span class="sd">            The initial state distribution over transient states</span>
</span><span id="L-2545"><a href="#L-2545"><span class="linenos">2545</span></a><span class="sd">        Q : Optional[List[List] | np.ndarray]</span>
</span><span id="L-2546"><a href="#L-2546"><span class="linenos">2546</span></a><span class="sd">            The transition matrix between transient states</span>
</span><span id="L-2547"><a href="#L-2547"><span class="linenos">2547</span></a>
</span><span id="L-2548"><a href="#L-2548"><span class="linenos">2548</span></a><span class="sd">        Raises</span>
</span><span id="L-2549"><a href="#L-2549"><span class="linenos">2549</span></a><span class="sd">        -------</span>
</span><span id="L-2550"><a href="#L-2550"><span class="linenos">2550</span></a><span class="sd">        ValueError</span>
</span><span id="L-2551"><a href="#L-2551"><span class="linenos">2551</span></a><span class="sd">            If the number of transient states is greater than or equal to the number of states</span>
</span><span id="L-2552"><a href="#L-2552"><span class="linenos">2552</span></a>
</span><span id="L-2553"><a href="#L-2553"><span class="linenos">2553</span></a><span class="sd">        Notes</span>
</span><span id="L-2554"><a href="#L-2554"><span class="linenos">2554</span></a><span class="sd">        -----</span>
</span><span id="L-2555"><a href="#L-2555"><span class="linenos">2555</span></a><span class="sd">        Calls the constructor of the parent class AbstractMarkov, with additional attributes.</span>
</span><span id="L-2556"><a href="#L-2556"><span class="linenos">2556</span></a><span class="sd">        Then, initializes the defining parameters and constraints for the hitting time problem.</span>
</span><span id="L-2557"><a href="#L-2557"><span class="linenos">2557</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2558"><a href="#L-2558"><span class="linenos">2558</span></a>
</span><span id="L-2559"><a href="#L-2559"><span class="linenos">2559</span></a>        <span class="k">if</span> <span class="n">n_transient</span> <span class="o">&gt;=</span> <span class="n">n_states</span><span class="p">:</span>
</span><span id="L-2560"><a href="#L-2560"><span class="linenos">2560</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of transient states must be less than number of states&quot;</span><span class="p">)</span>
</span><span id="L-2561"><a href="#L-2561"><span class="linenos">2561</span></a>
</span><span id="L-2562"><a href="#L-2562"><span class="linenos">2562</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">n_states</span><span class="p">,</span> <span class="n">n_features</span><span class="p">)</span>
</span><span id="L-2563"><a href="#L-2563"><span class="linenos">2563</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span> <span class="o">=</span> <span class="n">n_transient</span>
</span><span id="L-2564"><a href="#L-2564"><span class="linenos">2564</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_parameters_and_constraints</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span>
</span><span id="L-2565"><a href="#L-2565"><span class="linenos">2565</span></a>
</span><span id="L-2566"><a href="#L-2566"><span class="linenos">2566</span></a>    <span class="c1"># FUNCTIONS THAT MUST BE IMPLEMENTED IN SUBCLASSES WHICH UNIQUELY DEFINE THE PROBLEM</span>
</span><span id="L-2567"><a href="#L-2567"><span class="linenos">2567</span></a>
</span><span id="L-2568"><a href="#L-2568"><span class="linenos">2568</span></a>    <span class="k">def</span> <span class="nf">_initialize_parameters_and_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pi</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-2569"><a href="#L-2569"><span class="linenos">2569</span></a>                                               <span class="n">Q</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="L-2570"><a href="#L-2570"><span class="linenos">2570</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2571"><a href="#L-2571"><span class="linenos">2571</span></a><span class="sd">        Initializes the parameters and constraints for the reachability problem.</span>
</span><span id="L-2572"><a href="#L-2572"><span class="linenos">2572</span></a>
</span><span id="L-2573"><a href="#L-2573"><span class="linenos">2573</span></a><span class="sd">        Parameters</span>
</span><span id="L-2574"><a href="#L-2574"><span class="linenos">2574</span></a><span class="sd">        ----------</span>
</span><span id="L-2575"><a href="#L-2575"><span class="linenos">2575</span></a><span class="sd">        pi : Optional[List | np.ndarray]</span>
</span><span id="L-2576"><a href="#L-2576"><span class="linenos">2576</span></a><span class="sd">            The initial state distribution over transient states</span>
</span><span id="L-2577"><a href="#L-2577"><span class="linenos">2577</span></a><span class="sd">        Q : Optional[List[List] | np.ndarray]</span>
</span><span id="L-2578"><a href="#L-2578"><span class="linenos">2578</span></a><span class="sd">            The transition matrix between transient states</span>
</span><span id="L-2579"><a href="#L-2579"><span class="linenos">2579</span></a>
</span><span id="L-2580"><a href="#L-2580"><span class="linenos">2580</span></a><span class="sd">        Returns</span>
</span><span id="L-2581"><a href="#L-2581"><span class="linenos">2581</span></a><span class="sd">        -------</span>
</span><span id="L-2582"><a href="#L-2582"><span class="linenos">2582</span></a><span class="sd">        None</span>
</span><span id="L-2583"><a href="#L-2583"><span class="linenos">2583</span></a>
</span><span id="L-2584"><a href="#L-2584"><span class="linenos">2584</span></a><span class="sd">        Notes</span>
</span><span id="L-2585"><a href="#L-2585"><span class="linenos">2585</span></a><span class="sd">        -----</span>
</span><span id="L-2586"><a href="#L-2586"><span class="linenos">2586</span></a><span class="sd">        Adds variables for: pi (bounds between 0 and 1), Q (bounds between 0 and 1, strictly less</span>
</span><span id="L-2587"><a href="#L-2587"><span class="linenos">2587</span></a><span class="sd">        than 1), and v (bounds between -inf and inf). Creates boolean lists to store whether each</span>
</span><span id="L-2588"><a href="#L-2588"><span class="linenos">2588</span></a><span class="sd">        variable has been set to an ML output or a constant. Adds substochastic constraints on pi,</span>
</span><span id="L-2589"><a href="#L-2589"><span class="linenos">2589</span></a><span class="sd">        and strictly substochastic constraints on Q. In pratice, strict substochastic constraints</span>
</span><span id="L-2590"><a href="#L-2590"><span class="linenos">2590</span></a><span class="sd">        are implemented with a small numerical offset epsilon=1e-6. Lastly, adds the definition</span>
</span><span id="L-2591"><a href="#L-2591"><span class="linenos">2591</span></a><span class="sd">        of v as v = Qv + 1.</span>
</span><span id="L-2592"><a href="#L-2592"><span class="linenos">2592</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2593"><a href="#L-2593"><span class="linenos">2593</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="L-2594"><a href="#L-2594"><span class="linenos">2594</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span>
</span><span id="L-2595"><a href="#L-2595"><span class="linenos">2595</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pi&quot;</span><span class="p">,</span>
</span><span id="L-2596"><a href="#L-2596"><span class="linenos">2596</span></a>            <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-2597"><a href="#L-2597"><span class="linenos">2597</span></a>            <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="L-2598"><a href="#L-2598"><span class="linenos">2598</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="L-2599"><a href="#L-2599"><span class="linenos">2599</span></a>        <span class="p">)</span>
</span><span id="L-2600"><a href="#L-2600"><span class="linenos">2600</span></a>
</span><span id="L-2601"><a href="#L-2601"><span class="linenos">2601</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="L-2602"><a href="#L-2602"><span class="linenos">2602</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span>
</span><span id="L-2603"><a href="#L-2603"><span class="linenos">2603</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span>
</span><span id="L-2604"><a href="#L-2604"><span class="linenos">2604</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span>
</span><span id="L-2605"><a href="#L-2605"><span class="linenos">2605</span></a>            <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="L-2606"><a href="#L-2606"><span class="linenos">2606</span></a>            <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span><span class="p">,</span>
</span><span id="L-2607"><a href="#L-2607"><span class="linenos">2607</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="L-2608"><a href="#L-2608"><span class="linenos">2608</span></a>        <span class="p">)</span>
</span><span id="L-2609"><a href="#L-2609"><span class="linenos">2609</span></a>
</span><span id="L-2610"><a href="#L-2610"><span class="linenos">2610</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="L-2611"><a href="#L-2611"><span class="linenos">2611</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span>
</span><span id="L-2612"><a href="#L-2612"><span class="linenos">2612</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span>
</span><span id="L-2613"><a href="#L-2613"><span class="linenos">2613</span></a>            <span class="n">lb</span><span class="o">=-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="L-2614"><a href="#L-2614"><span class="linenos">2614</span></a>            <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="L-2615"><a href="#L-2615"><span class="linenos">2615</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="L-2616"><a href="#L-2616"><span class="linenos">2616</span></a>        <span class="p">)</span>
</span><span id="L-2617"><a href="#L-2617"><span class="linenos">2617</span></a>
</span><span id="L-2618"><a href="#L-2618"><span class="linenos">2618</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-2619"><a href="#L-2619"><span class="linenos">2619</span></a>
</span><span id="L-2620"><a href="#L-2620"><span class="linenos">2620</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="L-2621"><a href="#L-2621"><span class="linenos">2621</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="L-2622"><a href="#L-2622"><span class="linenos">2622</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="L-2623"><a href="#L-2623"><span class="linenos">2623</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="L-2624"><a href="#L-2624"><span class="linenos">2624</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="L-2625"><a href="#L-2625"><span class="linenos">2625</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="L-2626"><a href="#L-2626"><span class="linenos">2626</span></a>
</span><span id="L-2627"><a href="#L-2627"><span class="linenos">2627</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,)</span>
</span><span id="L-2628"><a href="#L-2628"><span class="linenos">2628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)</span>
</span><span id="L-2629"><a href="#L-2629"><span class="linenos">2629</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,)</span>
</span><span id="L-2630"><a href="#L-2630"><span class="linenos">2630</span></a>
</span><span id="L-2631"><a href="#L-2631"><span class="linenos">2631</span></a>        <span class="k">if</span> <span class="n">pi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2632"><a href="#L-2632"><span class="linenos">2632</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_pi</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>
</span><span id="L-2633"><a href="#L-2633"><span class="linenos">2633</span></a>        <span class="k">if</span> <span class="n">Q</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-2634"><a href="#L-2634"><span class="linenos">2634</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_Q</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
</span><span id="L-2635"><a href="#L-2635"><span class="linenos">2635</span></a>
</span><span id="L-2636"><a href="#L-2636"><span class="linenos">2636</span></a>        <span class="c1"># pi is substochastic</span>
</span><span id="L-2637"><a href="#L-2637"><span class="linenos">2637</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span>
</span><span id="L-2638"><a href="#L-2638"><span class="linenos">2638</span></a>                             <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-2639"><a href="#L-2639"><span class="linenos">2639</span></a>                             <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pi_prob_constr&quot;</span><span class="p">)</span>
</span><span id="L-2640"><a href="#L-2640"><span class="linenos">2640</span></a>        <span class="c1"># Q is strictly substochastic</span>
</span><span id="L-2641"><a href="#L-2641"><span class="linenos">2641</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">):</span>
</span><span id="L-2642"><a href="#L-2642"><span class="linenos">2642</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span>
</span><span id="L-2643"><a href="#L-2643"><span class="linenos">2643</span></a>                                 <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span><span class="p">,</span>
</span><span id="L-2644"><a href="#L-2644"><span class="linenos">2644</span></a>                                 <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;q_prob_constr_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2645"><a href="#L-2645"><span class="linenos">2645</span></a>
</span><span id="L-2646"><a href="#L-2646"><span class="linenos">2646</span></a>        <span class="c1"># v = Qv + 1</span>
</span><span id="L-2647"><a href="#L-2647"><span class="linenos">2647</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">):</span>
</span><span id="L-2648"><a href="#L-2648"><span class="linenos">2648</span></a>            <span class="n">Qv</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span>
</span><span id="L-2649"><a href="#L-2649"><span class="linenos">2649</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">Qv</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="L-2650"><a href="#L-2650"><span class="linenos">2650</span></a>                                 <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;v_constr_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2651"><a href="#L-2651"><span class="linenos">2651</span></a>
</span><span id="L-2652"><a href="#L-2652"><span class="linenos">2652</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="L-2653"><a href="#L-2653"><span class="linenos">2653</span></a>
</span><span id="L-2654"><a href="#L-2654"><span class="linenos">2654</span></a>    <span class="k">def</span> <span class="nf">_check_all_vars_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2655"><a href="#L-2655"><span class="linenos">2655</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2656"><a href="#L-2656"><span class="linenos">2656</span></a><span class="sd">        Check if pi and Q have been set before optimization.</span>
</span><span id="L-2657"><a href="#L-2657"><span class="linenos">2657</span></a>
</span><span id="L-2658"><a href="#L-2658"><span class="linenos">2658</span></a><span class="sd">        Returns</span>
</span><span id="L-2659"><a href="#L-2659"><span class="linenos">2659</span></a><span class="sd">        -------</span>
</span><span id="L-2660"><a href="#L-2660"><span class="linenos">2660</span></a><span class="sd">        None</span>
</span><span id="L-2661"><a href="#L-2661"><span class="linenos">2661</span></a>
</span><span id="L-2662"><a href="#L-2662"><span class="linenos">2662</span></a><span class="sd">        Raises</span>
</span><span id="L-2663"><a href="#L-2663"><span class="linenos">2663</span></a><span class="sd">        ------</span>
</span><span id="L-2664"><a href="#L-2664"><span class="linenos">2664</span></a><span class="sd">        ValueError</span>
</span><span id="L-2665"><a href="#L-2665"><span class="linenos">2665</span></a><span class="sd">            If any required variables have not been set</span>
</span><span id="L-2666"><a href="#L-2666"><span class="linenos">2666</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2667"><a href="#L-2667"><span class="linenos">2667</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2668"><a href="#L-2668"><span class="linenos">2668</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
</span><span id="L-2669"><a href="#L-2669"><span class="linenos">2669</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pi[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] needs to be set to a constant or linked to an ML output&quot;</span><span class="p">)</span>
</span><span id="L-2670"><a href="#L-2670"><span class="linenos">2670</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2671"><a href="#L-2671"><span class="linenos">2671</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-2672"><a href="#L-2672"><span class="linenos">2672</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]):</span>
</span><span id="L-2673"><a href="#L-2673"><span class="linenos">2673</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] needs to be set to a constant or linked to an ML output&quot;</span><span class="p">)</span>
</span><span id="L-2674"><a href="#L-2674"><span class="linenos">2674</span></a>
</span><span id="L-2675"><a href="#L-2675"><span class="linenos">2675</span></a>    <span class="k">def</span> <span class="nf">_set_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2676"><a href="#L-2676"><span class="linenos">2676</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2677"><a href="#L-2677"><span class="linenos">2677</span></a><span class="sd">        Sets the objective function to pi * v.</span>
</span><span id="L-2678"><a href="#L-2678"><span class="linenos">2678</span></a>
</span><span id="L-2679"><a href="#L-2679"><span class="linenos">2679</span></a><span class="sd">        Returns</span>
</span><span id="L-2680"><a href="#L-2680"><span class="linenos">2680</span></a><span class="sd">        -------</span>
</span><span id="L-2681"><a href="#L-2681"><span class="linenos">2681</span></a><span class="sd">        None</span>
</span><span id="L-2682"><a href="#L-2682"><span class="linenos">2682</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2683"><a href="#L-2683"><span class="linenos">2683</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)))</span>
</span><span id="L-2684"><a href="#L-2684"><span class="linenos">2684</span></a>
</span><span id="L-2685"><a href="#L-2685"><span class="linenos">2685</span></a>    <span class="k">def</span> <span class="nf">_set_feasible_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-2686"><a href="#L-2686"><span class="linenos">2686</span></a>                                 <span class="n">ub</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="L-2687"><a href="#L-2687"><span class="linenos">2687</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2688"><a href="#L-2688"><span class="linenos">2688</span></a><span class="sd">        Sets the feasible constraints on the objective. When looking for a feasible solution,</span>
</span><span id="L-2689"><a href="#L-2689"><span class="linenos">2689</span></a><span class="sd">        this simply adds the constraints: lb &lt;= pi * v &lt;= ub.</span>
</span><span id="L-2690"><a href="#L-2690"><span class="linenos">2690</span></a>
</span><span id="L-2691"><a href="#L-2691"><span class="linenos">2691</span></a><span class="sd">        Parameters</span>
</span><span id="L-2692"><a href="#L-2692"><span class="linenos">2692</span></a><span class="sd">        ----------</span>
</span><span id="L-2693"><a href="#L-2693"><span class="linenos">2693</span></a><span class="sd">        lb : float | int</span>
</span><span id="L-2694"><a href="#L-2694"><span class="linenos">2694</span></a><span class="sd">            The lower bound</span>
</span><span id="L-2695"><a href="#L-2695"><span class="linenos">2695</span></a><span class="sd">        ub : float | int</span>
</span><span id="L-2696"><a href="#L-2696"><span class="linenos">2696</span></a><span class="sd">            The upper bound</span>
</span><span id="L-2697"><a href="#L-2697"><span class="linenos">2697</span></a>
</span><span id="L-2698"><a href="#L-2698"><span class="linenos">2698</span></a><span class="sd">        Returns</span>
</span><span id="L-2699"><a href="#L-2699"><span class="linenos">2699</span></a><span class="sd">        -------</span>
</span><span id="L-2700"><a href="#L-2700"><span class="linenos">2700</span></a><span class="sd">        None</span>
</span><span id="L-2701"><a href="#L-2701"><span class="linenos">2701</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2702"><a href="#L-2702"><span class="linenos">2702</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">lb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;temp_feasible_lb&quot;</span><span class="p">)</span>
</span><span id="L-2703"><a href="#L-2703"><span class="linenos">2703</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">ub</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;temp_feasible_ub&quot;</span><span class="p">)</span>
</span><span id="L-2704"><a href="#L-2704"><span class="linenos">2704</span></a>
</span><span id="L-2705"><a href="#L-2705"><span class="linenos">2705</span></a>    <span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2706"><a href="#L-2706"><span class="linenos">2706</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2707"><a href="#L-2707"><span class="linenos">2707</span></a><span class="sd">        Returns the values of pi, Q, v, features, and ml_outputs as a dictionary.</span>
</span><span id="L-2708"><a href="#L-2708"><span class="linenos">2708</span></a>
</span><span id="L-2709"><a href="#L-2709"><span class="linenos">2709</span></a><span class="sd">        Returns</span>
</span><span id="L-2710"><a href="#L-2710"><span class="linenos">2710</span></a><span class="sd">        -------</span>
</span><span id="L-2711"><a href="#L-2711"><span class="linenos">2711</span></a><span class="sd">        dict</span>
</span><span id="L-2712"><a href="#L-2712"><span class="linenos">2712</span></a><span class="sd">            A dictionary with keys:</span>
</span><span id="L-2713"><a href="#L-2713"><span class="linenos">2713</span></a><span class="sd">            - `pi`: the values of pi</span>
</span><span id="L-2714"><a href="#L-2714"><span class="linenos">2714</span></a><span class="sd">            - `Q`: the values of Q</span>
</span><span id="L-2715"><a href="#L-2715"><span class="linenos">2715</span></a><span class="sd">            - `v`: the values of v</span>
</span><span id="L-2716"><a href="#L-2716"><span class="linenos">2716</span></a><span class="sd">            - `features`: the values of the features</span>
</span><span id="L-2717"><a href="#L-2717"><span class="linenos">2717</span></a><span class="sd">            - `ml_outputs`: the values of the ml_outputs</span>
</span><span id="L-2718"><a href="#L-2718"><span class="linenos">2718</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2719"><a href="#L-2719"><span class="linenos">2719</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="L-2720"><a href="#L-2720"><span class="linenos">2720</span></a>            <span class="s2">&quot;pi&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="L-2721"><a href="#L-2721"><span class="linenos">2721</span></a>            <span class="s2">&quot;Q&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="L-2722"><a href="#L-2722"><span class="linenos">2722</span></a>            <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="L-2723"><a href="#L-2723"><span class="linenos">2723</span></a>            <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">)],</span>
</span><span id="L-2724"><a href="#L-2724"><span class="linenos">2724</span></a>            <span class="s2">&quot;ml_outputs&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]))]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">))]</span>
</span><span id="L-2725"><a href="#L-2725"><span class="linenos">2725</span></a>        <span class="p">}</span>
</span><span id="L-2726"><a href="#L-2726"><span class="linenos">2726</span></a>
</span><span id="L-2727"><a href="#L-2727"><span class="linenos">2727</span></a>    <span class="k">def</span> <span class="nf">_compute_affine_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ml_bounds</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]):</span>
</span><span id="L-2728"><a href="#L-2728"><span class="linenos">2728</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2729"><a href="#L-2729"><span class="linenos">2729</span></a><span class="sd">        Computes the affine bounds for the parameters that are linked to ML outputs.</span>
</span><span id="L-2730"><a href="#L-2730"><span class="linenos">2730</span></a>
</span><span id="L-2731"><a href="#L-2731"><span class="linenos">2731</span></a><span class="sd">        Parameters</span>
</span><span id="L-2732"><a href="#L-2732"><span class="linenos">2732</span></a><span class="sd">        ----------</span>
</span><span id="L-2733"><a href="#L-2733"><span class="linenos">2733</span></a><span class="sd">        ml_bounds : List[List[Tuple[float, float]]]</span>
</span><span id="L-2734"><a href="#L-2734"><span class="linenos">2734</span></a><span class="sd">            The bounds for the ML outputs</span>
</span><span id="L-2735"><a href="#L-2735"><span class="linenos">2735</span></a>
</span><span id="L-2736"><a href="#L-2736"><span class="linenos">2736</span></a><span class="sd">        Returns</span>
</span><span id="L-2737"><a href="#L-2737"><span class="linenos">2737</span></a><span class="sd">        -------</span>
</span><span id="L-2738"><a href="#L-2738"><span class="linenos">2738</span></a><span class="sd">        dict</span>
</span><span id="L-2739"><a href="#L-2739"><span class="linenos">2739</span></a><span class="sd">            A dictionary with keys: &#39;pi&#39;, and &#39;Q&#39;</span>
</span><span id="L-2740"><a href="#L-2740"><span class="linenos">2740</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2741"><a href="#L-2741"><span class="linenos">2741</span></a>        <span class="c1"># Convert ml_bounds to dictionary for easier lookup</span>
</span><span id="L-2742"><a href="#L-2742"><span class="linenos">2742</span></a>        <span class="n">bounds_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2743"><a href="#L-2743"><span class="linenos">2743</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model_bounds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ml_bounds</span><span class="p">):</span>
</span><span id="L-2744"><a href="#L-2744"><span class="linenos">2744</span></a>            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_bounds</span><span class="p">):</span>
</span><span id="L-2745"><a href="#L-2745"><span class="linenos">2745</span></a>                <span class="n">bounds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ml_outputs_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="L-2746"><a href="#L-2746"><span class="linenos">2746</span></a>
</span><span id="L-2747"><a href="#L-2747"><span class="linenos">2747</span></a>        <span class="c1"># Initialize bounds dictionary</span>
</span><span id="L-2748"><a href="#L-2748"><span class="linenos">2748</span></a>        <span class="n">affine_bounds</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="L-2749"><a href="#L-2749"><span class="linenos">2749</span></a>            <span class="s1">&#39;pi&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="L-2750"><a href="#L-2750"><span class="linenos">2750</span></a>            <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="p">[]</span>
</span><span id="L-2751"><a href="#L-2751"><span class="linenos">2751</span></a>        <span class="p">}</span>
</span><span id="L-2752"><a href="#L-2752"><span class="linenos">2752</span></a>
</span><span id="L-2753"><a href="#L-2753"><span class="linenos">2753</span></a>        <span class="c1"># Compute bounds for each parameter that is an ML output</span>
</span><span id="L-2754"><a href="#L-2754"><span class="linenos">2754</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2755"><a href="#L-2755"><span class="linenos">2755</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
</span><span id="L-2756"><a href="#L-2756"><span class="linenos">2756</span></a>                <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ml_expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-2757"><a href="#L-2757"><span class="linenos">2757</span></a>                <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_expr_bounds</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">bounds_dict</span><span class="p">)))</span>
</span><span id="L-2758"><a href="#L-2758"><span class="linenos">2758</span></a>
</span><span id="L-2759"><a href="#L-2759"><span class="linenos">2759</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2760"><a href="#L-2760"><span class="linenos">2760</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-2761"><a href="#L-2761"><span class="linenos">2761</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
</span><span id="L-2762"><a href="#L-2762"><span class="linenos">2762</span></a>                    <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ml_expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
</span><span id="L-2763"><a href="#L-2763"><span class="linenos">2763</span></a>                    <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_expr_bounds</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">bounds_dict</span><span class="p">)))</span>
</span><span id="L-2764"><a href="#L-2764"><span class="linenos">2764</span></a>
</span><span id="L-2765"><a href="#L-2765"><span class="linenos">2765</span></a>        <span class="k">return</span> <span class="n">affine_bounds</span>
</span><span id="L-2766"><a href="#L-2766"><span class="linenos">2766</span></a>
</span><span id="L-2767"><a href="#L-2767"><span class="linenos">2767</span></a>    <span class="k">def</span> <span class="nf">_set_affine_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">affine_bounds</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="L-2768"><a href="#L-2768"><span class="linenos">2768</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2769"><a href="#L-2769"><span class="linenos">2769</span></a><span class="sd">        Sets the bounds for the parameters that are linked to ML outputs.</span>
</span><span id="L-2770"><a href="#L-2770"><span class="linenos">2770</span></a>
</span><span id="L-2771"><a href="#L-2771"><span class="linenos">2771</span></a><span class="sd">        Parameters</span>
</span><span id="L-2772"><a href="#L-2772"><span class="linenos">2772</span></a><span class="sd">        ----------</span>
</span><span id="L-2773"><a href="#L-2773"><span class="linenos">2773</span></a><span class="sd">        affine_bounds : dict</span>
</span><span id="L-2774"><a href="#L-2774"><span class="linenos">2774</span></a><span class="sd">            The bounds for the ML outputs</span>
</span><span id="L-2775"><a href="#L-2775"><span class="linenos">2775</span></a>
</span><span id="L-2776"><a href="#L-2776"><span class="linenos">2776</span></a><span class="sd">        Returns</span>
</span><span id="L-2777"><a href="#L-2777"><span class="linenos">2777</span></a><span class="sd">        -------</span>
</span><span id="L-2778"><a href="#L-2778"><span class="linenos">2778</span></a><span class="sd">        None</span>
</span><span id="L-2779"><a href="#L-2779"><span class="linenos">2779</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2780"><a href="#L-2780"><span class="linenos">2780</span></a>        <span class="c1"># Set bounds only for parameters that are ML outputs</span>
</span><span id="L-2781"><a href="#L-2781"><span class="linenos">2781</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]:</span>
</span><span id="L-2782"><a href="#L-2782"><span class="linenos">2782</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="L-2783"><a href="#L-2783"><span class="linenos">2783</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="L-2784"><a href="#L-2784"><span class="linenos">2784</span></a>
</span><span id="L-2785"><a href="#L-2785"><span class="linenos">2785</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]:</span>
</span><span id="L-2786"><a href="#L-2786"><span class="linenos">2786</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="L-2787"><a href="#L-2787"><span class="linenos">2787</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="L-2788"><a href="#L-2788"><span class="linenos">2788</span></a>
</span><span id="L-2789"><a href="#L-2789"><span class="linenos">2789</span></a>    <span class="k">def</span> <span class="nf">_compute_initial_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2790"><a href="#L-2790"><span class="linenos">2790</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2791"><a href="#L-2791"><span class="linenos">2791</span></a><span class="sd">        Computes the initial bounds for v. Simply, for each $v_i$, $ 0 \leq v_i \leq 1 / \\epsilon$ where</span>
</span><span id="L-2792"><a href="#L-2792"><span class="linenos">2792</span></a><span class="sd">        $\\epsilon$ is the small numerical offset for the strict substochasticity.</span>
</span><span id="L-2793"><a href="#L-2793"><span class="linenos">2793</span></a>
</span><span id="L-2794"><a href="#L-2794"><span class="linenos">2794</span></a><span class="sd">        Returns</span>
</span><span id="L-2795"><a href="#L-2795"><span class="linenos">2795</span></a><span class="sd">        -------</span>
</span><span id="L-2796"><a href="#L-2796"><span class="linenos">2796</span></a><span class="sd">        List[Tuple[float, float]]</span>
</span><span id="L-2797"><a href="#L-2797"><span class="linenos">2797</span></a><span class="sd">            The initial bounds for v</span>
</span><span id="L-2798"><a href="#L-2798"><span class="linenos">2798</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2799"><a href="#L-2799"><span class="linenos">2799</span></a>        <span class="c1"># Compute v bounds using epsilon</span>
</span><span id="L-2800"><a href="#L-2800"><span class="linenos">2800</span></a>        <span class="n">v_min</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2801"><a href="#L-2801"><span class="linenos">2801</span></a>        <span class="n">v_max</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span>
</span><span id="L-2802"><a href="#L-2802"><span class="linenos">2802</span></a>
</span><span id="L-2803"><a href="#L-2803"><span class="linenos">2803</span></a>        <span class="c1"># Return bounds for each state</span>
</span><span id="L-2804"><a href="#L-2804"><span class="linenos">2804</span></a>        <span class="k">return</span> <span class="p">[(</span><span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="L-2805"><a href="#L-2805"><span class="linenos">2805</span></a>
</span><span id="L-2806"><a href="#L-2806"><span class="linenos">2806</span></a>    <span class="k">def</span> <span class="nf">_set_initial_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_v_bounds</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]):</span>
</span><span id="L-2807"><a href="#L-2807"><span class="linenos">2807</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2808"><a href="#L-2808"><span class="linenos">2808</span></a><span class="sd">        Sets the initial bounds for v.</span>
</span><span id="L-2809"><a href="#L-2809"><span class="linenos">2809</span></a>
</span><span id="L-2810"><a href="#L-2810"><span class="linenos">2810</span></a><span class="sd">        Parameters</span>
</span><span id="L-2811"><a href="#L-2811"><span class="linenos">2811</span></a><span class="sd">        ----------</span>
</span><span id="L-2812"><a href="#L-2812"><span class="linenos">2812</span></a><span class="sd">        initial_v_bounds : List[Tuple[float, float]]</span>
</span><span id="L-2813"><a href="#L-2813"><span class="linenos">2813</span></a><span class="sd">            The initial bounds for v</span>
</span><span id="L-2814"><a href="#L-2814"><span class="linenos">2814</span></a>
</span><span id="L-2815"><a href="#L-2815"><span class="linenos">2815</span></a><span class="sd">        Returns</span>
</span><span id="L-2816"><a href="#L-2816"><span class="linenos">2816</span></a><span class="sd">        -------</span>
</span><span id="L-2817"><a href="#L-2817"><span class="linenos">2817</span></a><span class="sd">        None</span>
</span><span id="L-2818"><a href="#L-2818"><span class="linenos">2818</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2819"><a href="#L-2819"><span class="linenos">2819</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2820"><a href="#L-2820"><span class="linenos">2820</span></a>            <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">initial_v_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-2821"><a href="#L-2821"><span class="linenos">2821</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="L-2822"><a href="#L-2822"><span class="linenos">2822</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="L-2823"><a href="#L-2823"><span class="linenos">2823</span></a>
</span><span id="L-2824"><a href="#L-2824"><span class="linenos">2824</span></a>    <span class="k">def</span> <span class="nf">_compute_tightened_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2825"><a href="#L-2825"><span class="linenos">2825</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2826"><a href="#L-2826"><span class="linenos">2826</span></a><span class="sd">        Computes the tightened bounds for v using the bounds for Q and initial bounds for v.</span>
</span><span id="L-2827"><a href="#L-2827"><span class="linenos">2827</span></a><span class="sd">        This uses Gauss-Seidel to solve the linear system: $vM = 1$, where $M = I - Q$.</span>
</span><span id="L-2828"><a href="#L-2828"><span class="linenos">2828</span></a>
</span><span id="L-2829"><a href="#L-2829"><span class="linenos">2829</span></a><span class="sd">        Returns</span>
</span><span id="L-2830"><a href="#L-2830"><span class="linenos">2830</span></a><span class="sd">        -------</span>
</span><span id="L-2831"><a href="#L-2831"><span class="linenos">2831</span></a><span class="sd">        List[Tuple[float, float]]</span>
</span><span id="L-2832"><a href="#L-2832"><span class="linenos">2832</span></a><span class="sd">            The tightened bounds for v</span>
</span><span id="L-2833"><a href="#L-2833"><span class="linenos">2833</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2834"><a href="#L-2834"><span class="linenos">2834</span></a>        <span class="c1"># Create interval matrices for Q</span>
</span><span id="L-2835"><a href="#L-2835"><span class="linenos">2835</span></a>        <span class="n">Q_intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-2836"><a href="#L-2836"><span class="linenos">2836</span></a>
</span><span id="L-2837"><a href="#L-2837"><span class="linenos">2837</span></a>        <span class="c1"># Fill intervals from current bounds</span>
</span><span id="L-2838"><a href="#L-2838"><span class="linenos">2838</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2839"><a href="#L-2839"><span class="linenos">2839</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-2840"><a href="#L-2840"><span class="linenos">2840</span></a>                <span class="n">Q_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span><span class="p">]</span>
</span><span id="L-2841"><a href="#L-2841"><span class="linenos">2841</span></a>
</span><span id="L-2842"><a href="#L-2842"><span class="linenos">2842</span></a>        <span class="c1"># Create linear system: Mv = 1, where M = I - Q</span>
</span><span id="L-2843"><a href="#L-2843"><span class="linenos">2843</span></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">ima</span><span class="o">.</span><span class="n">_identity_interval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-2844"><a href="#L-2844"><span class="linenos">2844</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">ima</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">Q_intervals</span><span class="p">)</span>
</span><span id="L-2845"><a href="#L-2845"><span class="linenos">2845</span></a>        <span class="n">ones_intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="L-2846"><a href="#L-2846"><span class="linenos">2846</span></a>
</span><span id="L-2847"><a href="#L-2847"><span class="linenos">2847</span></a>        <span class="c1"># Initial guess using current v bounds</span>
</span><span id="L-2848"><a href="#L-2848"><span class="linenos">2848</span></a>        <span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])])</span>
</span><span id="L-2849"><a href="#L-2849"><span class="linenos">2849</span></a>
</span><span id="L-2850"><a href="#L-2850"><span class="linenos">2850</span></a>        <span class="c1"># Solve using Gauss-Seidel</span>
</span><span id="L-2851"><a href="#L-2851"><span class="linenos">2851</span></a>        <span class="n">v_intervals</span> <span class="o">=</span> <span class="n">ima</span><span class="o">.</span><span class="n">interval_gauss_seidel</span><span class="p">(</span>
</span><span id="L-2852"><a href="#L-2852"><span class="linenos">2852</span></a>            <span class="n">M</span><span class="p">,</span> <span class="n">ones_intervals</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span>
</span><span id="L-2853"><a href="#L-2853"><span class="linenos">2853</span></a>            <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span id="L-2854"><a href="#L-2854"><span class="linenos">2854</span></a>            <span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span>
</span><span id="L-2855"><a href="#L-2855"><span class="linenos">2855</span></a>        <span class="p">)</span>
</span><span id="L-2856"><a href="#L-2856"><span class="linenos">2856</span></a>
</span><span id="L-2857"><a href="#L-2857"><span class="linenos">2857</span></a>        <span class="c1"># Convert to list of tuples</span>
</span><span id="L-2858"><a href="#L-2858"><span class="linenos">2858</span></a>        <span class="k">return</span> <span class="p">[(</span><span class="n">v_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">v_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="L-2859"><a href="#L-2859"><span class="linenos">2859</span></a>
</span><span id="L-2860"><a href="#L-2860"><span class="linenos">2860</span></a>    <span class="k">def</span> <span class="nf">_set_tightened_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tightened_v_bounds</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]):</span>
</span><span id="L-2861"><a href="#L-2861"><span class="linenos">2861</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2862"><a href="#L-2862"><span class="linenos">2862</span></a><span class="sd">        Sets the tightened bounds for v.</span>
</span><span id="L-2863"><a href="#L-2863"><span class="linenos">2863</span></a>
</span><span id="L-2864"><a href="#L-2864"><span class="linenos">2864</span></a><span class="sd">        Parameters</span>
</span><span id="L-2865"><a href="#L-2865"><span class="linenos">2865</span></a><span class="sd">        ----------</span>
</span><span id="L-2866"><a href="#L-2866"><span class="linenos">2866</span></a><span class="sd">        tightened_v_bounds : List[Tuple[float, float]]</span>
</span><span id="L-2867"><a href="#L-2867"><span class="linenos">2867</span></a><span class="sd">            The tightened bounds for v</span>
</span><span id="L-2868"><a href="#L-2868"><span class="linenos">2868</span></a>
</span><span id="L-2869"><a href="#L-2869"><span class="linenos">2869</span></a><span class="sd">        Returns</span>
</span><span id="L-2870"><a href="#L-2870"><span class="linenos">2870</span></a><span class="sd">        -------</span>
</span><span id="L-2871"><a href="#L-2871"><span class="linenos">2871</span></a><span class="sd">        None</span>
</span><span id="L-2872"><a href="#L-2872"><span class="linenos">2872</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2873"><a href="#L-2873"><span class="linenos">2873</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2874"><a href="#L-2874"><span class="linenos">2874</span></a>            <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">tightened_v_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="L-2875"><a href="#L-2875"><span class="linenos">2875</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="L-2876"><a href="#L-2876"><span class="linenos">2876</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="L-2877"><a href="#L-2877"><span class="linenos">2877</span></a>
</span><span id="L-2878"><a href="#L-2878"><span class="linenos">2878</span></a>    <span class="c1"># CLEAN PARAMETER ACCESSORS</span>
</span><span id="L-2879"><a href="#L-2879"><span class="linenos">2879</span></a>
</span><span id="L-2880"><a href="#L-2880"><span class="linenos">2880</span></a>    <span class="nd">@property</span>
</span><span id="L-2881"><a href="#L-2881"><span class="linenos">2881</span></a>    <span class="k">def</span> <span class="nf">pi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2882"><a href="#L-2882"><span class="linenos">2882</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2883"><a href="#L-2883"><span class="linenos">2883</span></a><span class="sd">        Accessor for the pi parameter.</span>
</span><span id="L-2884"><a href="#L-2884"><span class="linenos">2884</span></a>
</span><span id="L-2885"><a href="#L-2885"><span class="linenos">2885</span></a><span class="sd">        Returns</span>
</span><span id="L-2886"><a href="#L-2886"><span class="linenos">2886</span></a><span class="sd">        -------</span>
</span><span id="L-2887"><a href="#L-2887"><span class="linenos">2887</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="L-2888"><a href="#L-2888"><span class="linenos">2888</span></a><span class="sd">            The pi parameter</span>
</span><span id="L-2889"><a href="#L-2889"><span class="linenos">2889</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2890"><a href="#L-2890"><span class="linenos">2890</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span>
</span><span id="L-2891"><a href="#L-2891"><span class="linenos">2891</span></a>
</span><span id="L-2892"><a href="#L-2892"><span class="linenos">2892</span></a>    <span class="nd">@property</span>
</span><span id="L-2893"><a href="#L-2893"><span class="linenos">2893</span></a>    <span class="k">def</span> <span class="nf">Q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2894"><a href="#L-2894"><span class="linenos">2894</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2895"><a href="#L-2895"><span class="linenos">2895</span></a><span class="sd">        Accessor for the Q parameter.</span>
</span><span id="L-2896"><a href="#L-2896"><span class="linenos">2896</span></a>
</span><span id="L-2897"><a href="#L-2897"><span class="linenos">2897</span></a><span class="sd">        Returns</span>
</span><span id="L-2898"><a href="#L-2898"><span class="linenos">2898</span></a><span class="sd">        -------</span>
</span><span id="L-2899"><a href="#L-2899"><span class="linenos">2899</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="L-2900"><a href="#L-2900"><span class="linenos">2900</span></a><span class="sd">            The Q parameter</span>
</span><span id="L-2901"><a href="#L-2901"><span class="linenos">2901</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2902"><a href="#L-2902"><span class="linenos">2902</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span>
</span><span id="L-2903"><a href="#L-2903"><span class="linenos">2903</span></a>
</span><span id="L-2904"><a href="#L-2904"><span class="linenos">2904</span></a>    <span class="nd">@property</span>
</span><span id="L-2905"><a href="#L-2905"><span class="linenos">2905</span></a>    <span class="k">def</span> <span class="nf">v</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-2906"><a href="#L-2906"><span class="linenos">2906</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2907"><a href="#L-2907"><span class="linenos">2907</span></a><span class="sd">        Accessor for the v parameter.</span>
</span><span id="L-2908"><a href="#L-2908"><span class="linenos">2908</span></a>
</span><span id="L-2909"><a href="#L-2909"><span class="linenos">2909</span></a><span class="sd">        Returns</span>
</span><span id="L-2910"><a href="#L-2910"><span class="linenos">2910</span></a><span class="sd">        -------</span>
</span><span id="L-2911"><a href="#L-2911"><span class="linenos">2911</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="L-2912"><a href="#L-2912"><span class="linenos">2912</span></a><span class="sd">            The v parameter</span>
</span><span id="L-2913"><a href="#L-2913"><span class="linenos">2913</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2914"><a href="#L-2914"><span class="linenos">2914</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
</span><span id="L-2915"><a href="#L-2915"><span class="linenos">2915</span></a>
</span><span id="L-2916"><a href="#L-2916"><span class="linenos">2916</span></a>    <span class="c1"># HELPER FUNCTIONS TO SET PARAMETERS</span>
</span><span id="L-2917"><a href="#L-2917"><span class="linenos">2917</span></a>
</span><span id="L-2918"><a href="#L-2918"><span class="linenos">2918</span></a>    <span class="k">def</span> <span class="nf">set_pi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]):</span>
</span><span id="L-2919"><a href="#L-2919"><span class="linenos">2919</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2920"><a href="#L-2920"><span class="linenos">2920</span></a><span class="sd">        Helper function to set the entire pi vector.</span>
</span><span id="L-2921"><a href="#L-2921"><span class="linenos">2921</span></a>
</span><span id="L-2922"><a href="#L-2922"><span class="linenos">2922</span></a><span class="sd">        Parameters</span>
</span><span id="L-2923"><a href="#L-2923"><span class="linenos">2923</span></a><span class="sd">        ----------</span>
</span><span id="L-2924"><a href="#L-2924"><span class="linenos">2924</span></a><span class="sd">        values : List[float | int | gp.Var | gp.LinExpr]</span>
</span><span id="L-2925"><a href="#L-2925"><span class="linenos">2925</span></a><span class="sd">            The values to set the pi parameter to</span>
</span><span id="L-2926"><a href="#L-2926"><span class="linenos">2926</span></a>
</span><span id="L-2927"><a href="#L-2927"><span class="linenos">2927</span></a><span class="sd">        Returns</span>
</span><span id="L-2928"><a href="#L-2928"><span class="linenos">2928</span></a><span class="sd">        -------</span>
</span><span id="L-2929"><a href="#L-2929"><span class="linenos">2929</span></a><span class="sd">        None</span>
</span><span id="L-2930"><a href="#L-2930"><span class="linenos">2930</span></a>
</span><span id="L-2931"><a href="#L-2931"><span class="linenos">2931</span></a><span class="sd">        Raises</span>
</span><span id="L-2932"><a href="#L-2932"><span class="linenos">2932</span></a><span class="sd">        ------</span>
</span><span id="L-2933"><a href="#L-2933"><span class="linenos">2933</span></a><span class="sd">        ValueError</span>
</span><span id="L-2934"><a href="#L-2934"><span class="linenos">2934</span></a><span class="sd">            If the values have incorrect length, are not in [0, 1], don&#39;t sum to &lt;=1, or pi is already set</span>
</span><span id="L-2935"><a href="#L-2935"><span class="linenos">2935</span></a>
</span><span id="L-2936"><a href="#L-2936"><span class="linenos">2936</span></a><span class="sd">        Notes</span>
</span><span id="L-2937"><a href="#L-2937"><span class="linenos">2937</span></a><span class="sd">        -----</span>
</span><span id="L-2938"><a href="#L-2938"><span class="linenos">2938</span></a><span class="sd">        This checks for validity of the values, checks if pi is already set, and sets the values.</span>
</span><span id="L-2939"><a href="#L-2939"><span class="linenos">2939</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2940"><a href="#L-2940"><span class="linenos">2940</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_length</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">)</span>
</span><span id="L-2941"><a href="#L-2941"><span class="linenos">2941</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="L-2942"><a href="#L-2942"><span class="linenos">2942</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-2943"><a href="#L-2943"><span class="linenos">2943</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="L-2944"><a href="#L-2944"><span class="linenos">2944</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;pi&quot;</span><span class="p">),</span>\
</span><span id="L-2945"><a href="#L-2945"><span class="linenos">2945</span></a>              <span class="s2">&quot;pi is already set&quot;</span>
</span><span id="L-2946"><a href="#L-2946"><span class="linenos">2946</span></a>
</span><span id="L-2947"><a href="#L-2947"><span class="linenos">2947</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;pi&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2948"><a href="#L-2948"><span class="linenos">2948</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="L-2949"><a href="#L-2949"><span class="linenos">2949</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-2950"><a href="#L-2950"><span class="linenos">2950</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="L-2951"><a href="#L-2951"><span class="linenos">2951</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="L-2952"><a href="#L-2952"><span class="linenos">2952</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="L-2953"><a href="#L-2953"><span class="linenos">2953</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pi[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span><span id="L-2954"><a href="#L-2954"><span class="linenos">2954</span></a>
</span><span id="L-2955"><a href="#L-2955"><span class="linenos">2955</span></a>    <span class="k">def</span> <span class="nf">set_Q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]]):</span>
</span><span id="L-2956"><a href="#L-2956"><span class="linenos">2956</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-2957"><a href="#L-2957"><span class="linenos">2957</span></a><span class="sd">        Helper function to set the Q matrix.</span>
</span><span id="L-2958"><a href="#L-2958"><span class="linenos">2958</span></a>
</span><span id="L-2959"><a href="#L-2959"><span class="linenos">2959</span></a><span class="sd">        Parameters</span>
</span><span id="L-2960"><a href="#L-2960"><span class="linenos">2960</span></a><span class="sd">        ----------</span>
</span><span id="L-2961"><a href="#L-2961"><span class="linenos">2961</span></a><span class="sd">        values : List[List[float | int | gp.Var | gp.LinExpr]]</span>
</span><span id="L-2962"><a href="#L-2962"><span class="linenos">2962</span></a><span class="sd">            The values to set the Q matrix to</span>
</span><span id="L-2963"><a href="#L-2963"><span class="linenos">2963</span></a>
</span><span id="L-2964"><a href="#L-2964"><span class="linenos">2964</span></a><span class="sd">        Returns</span>
</span><span id="L-2965"><a href="#L-2965"><span class="linenos">2965</span></a><span class="sd">        -------</span>
</span><span id="L-2966"><a href="#L-2966"><span class="linenos">2966</span></a><span class="sd">        None</span>
</span><span id="L-2967"><a href="#L-2967"><span class="linenos">2967</span></a>
</span><span id="L-2968"><a href="#L-2968"><span class="linenos">2968</span></a><span class="sd">        Raises</span>
</span><span id="L-2969"><a href="#L-2969"><span class="linenos">2969</span></a><span class="sd">        ------</span>
</span><span id="L-2970"><a href="#L-2970"><span class="linenos">2970</span></a><span class="sd">        ValueError</span>
</span><span id="L-2971"><a href="#L-2971"><span class="linenos">2971</span></a><span class="sd">            If the values have incorrect length, are not in [0, 1), rows don&#39;t sum to strictly less than 1, or Q is already set</span>
</span><span id="L-2972"><a href="#L-2972"><span class="linenos">2972</span></a>
</span><span id="L-2973"><a href="#L-2973"><span class="linenos">2973</span></a><span class="sd">        Notes</span>
</span><span id="L-2974"><a href="#L-2974"><span class="linenos">2974</span></a><span class="sd">        -----</span>
</span><span id="L-2975"><a href="#L-2975"><span class="linenos">2975</span></a><span class="sd">        This checks for validity of the values, checks if Q is already set, and sets the values.</span>
</span><span id="L-2976"><a href="#L-2976"><span class="linenos">2976</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="L-2977"><a href="#L-2977"><span class="linenos">2977</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_shape</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">)</span>
</span><span id="L-2978"><a href="#L-2978"><span class="linenos">2978</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="L-2979"><a href="#L-2979"><span class="linenos">2979</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-2980"><a href="#L-2980"><span class="linenos">2980</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_matrix</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">strictsub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Q is strictly substochastic</span>
</span><span id="L-2981"><a href="#L-2981"><span class="linenos">2981</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
</span><span id="L-2982"><a href="#L-2982"><span class="linenos">2982</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="L-2983"><a href="#L-2983"><span class="linenos">2983</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;Q[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">strictsub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Q is strictly substochastic</span>
</span><span id="L-2984"><a href="#L-2984"><span class="linenos">2984</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">),</span>\
</span><span id="L-2985"><a href="#L-2985"><span class="linenos">2985</span></a>              <span class="s2">&quot;Q is already set&quot;</span>
</span><span id="L-2986"><a href="#L-2986"><span class="linenos">2986</span></a>
</span><span id="L-2987"><a href="#L-2987"><span class="linenos">2987</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="L-2988"><a href="#L-2988"><span class="linenos">2988</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="L-2989"><a href="#L-2989"><span class="linenos">2989</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="L-2990"><a href="#L-2990"><span class="linenos">2990</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-2991"><a href="#L-2991"><span class="linenos">2991</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="L-2992"><a href="#L-2992"><span class="linenos">2992</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-2993"><a href="#L-2993"><span class="linenos">2993</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="L-2994"><a href="#L-2994"><span class="linenos">2994</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span></pre></div>


            </section>
                <section id="AbstractMarkov">
                            <input id="AbstractMarkov-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">AbstractMarkov</span><wbr>(<span class="base">abc.ABC</span>):

                <label class="view-source-button" for="AbstractMarkov-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AbstractMarkov"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AbstractMarkov-33"><a href="#AbstractMarkov-33"><span class="linenos">  33</span></a><span class="k">class</span> <span class="nc">AbstractMarkov</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
</span><span id="AbstractMarkov-34"><a href="#AbstractMarkov-34"><span class="linenos">  34</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-35"><a href="#AbstractMarkov-35"><span class="linenos">  35</span></a><span class="sd">    This is an abstract class for Markov processes with ML models embedded.</span>
</span><span id="AbstractMarkov-36"><a href="#AbstractMarkov-36"><span class="linenos">  36</span></a><span class="sd">    It implements all the basic functionality for setting up a Markov process,</span>
</span><span id="AbstractMarkov-37"><a href="#AbstractMarkov-37"><span class="linenos">  37</span></a><span class="sd">    adding ML models, defining the feature space, and optimizing, including</span>
</span><span id="AbstractMarkov-38"><a href="#AbstractMarkov-38"><span class="linenos">  38</span></a><span class="sd">    with the decomposition and bound propagation scheme from the paper.</span>
</span><span id="AbstractMarkov-39"><a href="#AbstractMarkov-39"><span class="linenos">  39</span></a><span class="sd">    It will be subclassed by `MarkovReward`, `MarkovReach`, and `MarkovHitting`,</span>
</span><span id="AbstractMarkov-40"><a href="#AbstractMarkov-40"><span class="linenos">  40</span></a><span class="sd">    which specialize the functionality to the specific problems.</span>
</span><span id="AbstractMarkov-41"><a href="#AbstractMarkov-41"><span class="linenos">  41</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-42"><a href="#AbstractMarkov-42"><span class="linenos">  42</span></a>
</span><span id="AbstractMarkov-43"><a href="#AbstractMarkov-43"><span class="linenos">  43</span></a>    <span class="c1"># small number for strict inequalities</span>
</span><span id="AbstractMarkov-44"><a href="#AbstractMarkov-44"><span class="linenos">  44</span></a>    <span class="n">_epsilon</span> <span class="o">=</span> <span class="mf">1e-6</span>
</span><span id="AbstractMarkov-45"><a href="#AbstractMarkov-45"><span class="linenos">  45</span></a>
</span><span id="AbstractMarkov-46"><a href="#AbstractMarkov-46"><span class="linenos">  46</span></a>    <span class="c1"># Supported ml models</span>
</span><span id="AbstractMarkov-47"><a href="#AbstractMarkov-47"><span class="linenos">  47</span></a>    <span class="c1"># Currently supported:</span>
</span><span id="AbstractMarkov-48"><a href="#AbstractMarkov-48"><span class="linenos">  48</span></a>    <span class="c1">#   linear regression</span>
</span><span id="AbstractMarkov-49"><a href="#AbstractMarkov-49"><span class="linenos">  49</span></a>    <span class="c1">#   ridge regression</span>
</span><span id="AbstractMarkov-50"><a href="#AbstractMarkov-50"><span class="linenos">  50</span></a>    <span class="c1">#   lasso regression</span>
</span><span id="AbstractMarkov-51"><a href="#AbstractMarkov-51"><span class="linenos">  51</span></a>    <span class="c1">#   logistic regression</span>
</span><span id="AbstractMarkov-52"><a href="#AbstractMarkov-52"><span class="linenos">  52</span></a>    <span class="c1">#   decision tree regression</span>
</span><span id="AbstractMarkov-53"><a href="#AbstractMarkov-53"><span class="linenos">  53</span></a>    <span class="c1">#   decision tree classifier</span>
</span><span id="AbstractMarkov-54"><a href="#AbstractMarkov-54"><span class="linenos">  54</span></a>    <span class="c1">#   random forest regression</span>
</span><span id="AbstractMarkov-55"><a href="#AbstractMarkov-55"><span class="linenos">  55</span></a>    <span class="c1">#   random forest classifier</span>
</span><span id="AbstractMarkov-56"><a href="#AbstractMarkov-56"><span class="linenos">  56</span></a>    <span class="c1">#   mlp regression</span>
</span><span id="AbstractMarkov-57"><a href="#AbstractMarkov-57"><span class="linenos">  57</span></a>    <span class="c1">#   mlp classifier</span>
</span><span id="AbstractMarkov-58"><a href="#AbstractMarkov-58"><span class="linenos">  58</span></a>    <span class="c1">#   torch sequential</span>
</span><span id="AbstractMarkov-59"><a href="#AbstractMarkov-59"><span class="linenos">  59</span></a>    <span class="c1">#   decision rules</span>
</span><span id="AbstractMarkov-60"><a href="#AbstractMarkov-60"><span class="linenos">  60</span></a>    <span class="n">_ml_model_registry</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="AbstractMarkov-61"><a href="#AbstractMarkov-61"><span class="linenos">  61</span></a>        <span class="p">(</span><span class="n">LinearRegression</span><span class="p">,</span> <span class="n">Ridge</span><span class="p">,</span> <span class="n">Lasso</span><span class="p">):</span> <span class="p">{</span>
</span><span id="AbstractMarkov-62"><a href="#AbstractMarkov-62"><span class="linenos">  62</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_linear_regression_constr</span><span class="p">,</span>
</span><span id="AbstractMarkov-63"><a href="#AbstractMarkov-63"><span class="linenos">  63</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="AbstractMarkov-64"><a href="#AbstractMarkov-64"><span class="linenos">  64</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">)</span>
</span><span id="AbstractMarkov-65"><a href="#AbstractMarkov-65"><span class="linenos">  65</span></a>        <span class="p">},</span>
</span><span id="AbstractMarkov-66"><a href="#AbstractMarkov-66"><span class="linenos">  66</span></a>        <span class="n">LogisticRegression</span><span class="p">:</span> <span class="p">{</span>
</span><span id="AbstractMarkov-67"><a href="#AbstractMarkov-67"><span class="linenos">  67</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_logistic_regression_constr</span><span class="p">,</span>
</span><span id="AbstractMarkov-68"><a href="#AbstractMarkov-68"><span class="linenos">  68</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="AbstractMarkov-69"><a href="#AbstractMarkov-69"><span class="linenos">  69</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="AbstractMarkov-70"><a href="#AbstractMarkov-70"><span class="linenos">  70</span></a>        <span class="p">},</span>
</span><span id="AbstractMarkov-71"><a href="#AbstractMarkov-71"><span class="linenos">  71</span></a>        <span class="n">DecisionTreeRegressor</span><span class="p">:</span> <span class="p">{</span>
</span><span id="AbstractMarkov-72"><a href="#AbstractMarkov-72"><span class="linenos">  72</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_decision_tree_regressor_constr</span><span class="p">,</span>
</span><span id="AbstractMarkov-73"><a href="#AbstractMarkov-73"><span class="linenos">  73</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">),</span>
</span><span id="AbstractMarkov-74"><a href="#AbstractMarkov-74"><span class="linenos">  74</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">n_outputs_</span>
</span><span id="AbstractMarkov-75"><a href="#AbstractMarkov-75"><span class="linenos">  75</span></a>        <span class="p">},</span>
</span><span id="AbstractMarkov-76"><a href="#AbstractMarkov-76"><span class="linenos">  76</span></a>        <span class="n">DecisionTreeClassifier</span><span class="p">:</span> <span class="p">{</span>
</span><span id="AbstractMarkov-77"><a href="#AbstractMarkov-77"><span class="linenos">  77</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_decision_tree_classifier_constr</span><span class="p">,</span>
</span><span id="AbstractMarkov-78"><a href="#AbstractMarkov-78"><span class="linenos">  78</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="AbstractMarkov-79"><a href="#AbstractMarkov-79"><span class="linenos">  79</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">n_outputs_</span>
</span><span id="AbstractMarkov-80"><a href="#AbstractMarkov-80"><span class="linenos">  80</span></a>        <span class="p">},</span>
</span><span id="AbstractMarkov-81"><a href="#AbstractMarkov-81"><span class="linenos">  81</span></a>        <span class="n">RandomForestRegressor</span><span class="p">:</span> <span class="p">{</span>
</span><span id="AbstractMarkov-82"><a href="#AbstractMarkov-82"><span class="linenos">  82</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_random_forest_regressor_constr</span><span class="p">,</span>
</span><span id="AbstractMarkov-83"><a href="#AbstractMarkov-83"><span class="linenos">  83</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">),</span>
</span><span id="AbstractMarkov-84"><a href="#AbstractMarkov-84"><span class="linenos">  84</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">n_outputs_</span>
</span><span id="AbstractMarkov-85"><a href="#AbstractMarkov-85"><span class="linenos">  85</span></a>        <span class="p">},</span>
</span><span id="AbstractMarkov-86"><a href="#AbstractMarkov-86"><span class="linenos">  86</span></a>        <span class="n">RandomForestClassifier</span><span class="p">:</span> <span class="p">{</span>
</span><span id="AbstractMarkov-87"><a href="#AbstractMarkov-87"><span class="linenos">  87</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_random_forest_classifier_constr</span><span class="p">,</span>
</span><span id="AbstractMarkov-88"><a href="#AbstractMarkov-88"><span class="linenos">  88</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="AbstractMarkov-89"><a href="#AbstractMarkov-89"><span class="linenos">  89</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">n_outputs_</span>
</span><span id="AbstractMarkov-90"><a href="#AbstractMarkov-90"><span class="linenos">  90</span></a>        <span class="p">},</span>
</span><span id="AbstractMarkov-91"><a href="#AbstractMarkov-91"><span class="linenos">  91</span></a>        <span class="n">MLPRegressor</span><span class="p">:</span> <span class="p">{</span>
</span><span id="AbstractMarkov-92"><a href="#AbstractMarkov-92"><span class="linenos">  92</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_mlp_regressor_constr</span><span class="p">,</span>
</span><span id="AbstractMarkov-93"><a href="#AbstractMarkov-93"><span class="linenos">  93</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">),</span>
</span><span id="AbstractMarkov-94"><a href="#AbstractMarkov-94"><span class="linenos">  94</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">n_outputs_</span>
</span><span id="AbstractMarkov-95"><a href="#AbstractMarkov-95"><span class="linenos">  95</span></a>        <span class="p">},</span>
</span><span id="AbstractMarkov-96"><a href="#AbstractMarkov-96"><span class="linenos">  96</span></a>        <span class="n">MLPClassifier</span><span class="p">:</span> <span class="p">{</span>
</span><span id="AbstractMarkov-97"><a href="#AbstractMarkov-97"><span class="linenos">  97</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_mlp_classifier_constr</span><span class="p">,</span>
</span><span id="AbstractMarkov-98"><a href="#AbstractMarkov-98"><span class="linenos">  98</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="AbstractMarkov-99"><a href="#AbstractMarkov-99"><span class="linenos">  99</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">n_outputs_</span>
</span><span id="AbstractMarkov-100"><a href="#AbstractMarkov-100"><span class="linenos"> 100</span></a>        <span class="p">},</span>
</span><span id="AbstractMarkov-101"><a href="#AbstractMarkov-101"><span class="linenos"> 101</span></a>        <span class="n">DecisionRules</span><span class="p">:</span> <span class="p">{</span>
</span><span id="AbstractMarkov-102"><a href="#AbstractMarkov-102"><span class="linenos"> 102</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_decision_rules_constr</span><span class="p">,</span>
</span><span id="AbstractMarkov-103"><a href="#AbstractMarkov-103"><span class="linenos"> 103</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">),</span>
</span><span id="AbstractMarkov-104"><a href="#AbstractMarkov-104"><span class="linenos"> 104</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">model</span><span class="p">:</span> <span class="mi">1</span>
</span><span id="AbstractMarkov-105"><a href="#AbstractMarkov-105"><span class="linenos"> 105</span></a>        <span class="p">},</span>
</span><span id="AbstractMarkov-106"><a href="#AbstractMarkov-106"><span class="linenos"> 106</span></a>        <span class="n">SequentialClassifier</span><span class="p">:</span> <span class="p">{</span>
</span><span id="AbstractMarkov-107"><a href="#AbstractMarkov-107"><span class="linenos"> 107</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_sequential_classifier_constr</span><span class="p">,</span>
</span><span id="AbstractMarkov-108"><a href="#AbstractMarkov-108"><span class="linenos"> 108</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span><span id="AbstractMarkov-109"><a href="#AbstractMarkov-109"><span class="linenos"> 109</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="n">_get_sequential_n_outputs</span>
</span><span id="AbstractMarkov-110"><a href="#AbstractMarkov-110"><span class="linenos"> 110</span></a>        <span class="p">},</span>
</span><span id="AbstractMarkov-111"><a href="#AbstractMarkov-111"><span class="linenos"> 111</span></a>        <span class="n">Sequential</span><span class="p">:</span> <span class="p">{</span>
</span><span id="AbstractMarkov-112"><a href="#AbstractMarkov-112"><span class="linenos"> 112</span></a>            <span class="s1">&#39;constraint_method&#39;</span><span class="p">:</span> <span class="n">add_sequential_constr</span><span class="p">,</span>
</span><span id="AbstractMarkov-113"><a href="#AbstractMarkov-113"><span class="linenos"> 113</span></a>            <span class="s1">&#39;bounds&#39;</span><span class="p">:</span> <span class="p">(</span><span class="o">-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">),</span>
</span><span id="AbstractMarkov-114"><a href="#AbstractMarkov-114"><span class="linenos"> 114</span></a>            <span class="s1">&#39;get_n_outputs&#39;</span><span class="p">:</span> <span class="n">_get_sequential_n_outputs</span>
</span><span id="AbstractMarkov-115"><a href="#AbstractMarkov-115"><span class="linenos"> 115</span></a>        <span class="p">}</span>
</span><span id="AbstractMarkov-116"><a href="#AbstractMarkov-116"><span class="linenos"> 116</span></a>    <span class="p">}</span>
</span><span id="AbstractMarkov-117"><a href="#AbstractMarkov-117"><span class="linenos"> 117</span></a>
</span><span id="AbstractMarkov-118"><a href="#AbstractMarkov-118"><span class="linenos"> 118</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_states</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="AbstractMarkov-119"><a href="#AbstractMarkov-119"><span class="linenos"> 119</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-120"><a href="#AbstractMarkov-120"><span class="linenos"> 120</span></a><span class="sd">        Initialize the Markov process with the given number of states and features.</span>
</span><span id="AbstractMarkov-121"><a href="#AbstractMarkov-121"><span class="linenos"> 121</span></a>
</span><span id="AbstractMarkov-122"><a href="#AbstractMarkov-122"><span class="linenos"> 122</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-123"><a href="#AbstractMarkov-123"><span class="linenos"> 123</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-124"><a href="#AbstractMarkov-124"><span class="linenos"> 124</span></a><span class="sd">        n_states : int</span>
</span><span id="AbstractMarkov-125"><a href="#AbstractMarkov-125"><span class="linenos"> 125</span></a><span class="sd">            Number of states in the Markov process (`n` in the paper)</span>
</span><span id="AbstractMarkov-126"><a href="#AbstractMarkov-126"><span class="linenos"> 126</span></a><span class="sd">        n_features : int</span>
</span><span id="AbstractMarkov-127"><a href="#AbstractMarkov-127"><span class="linenos"> 127</span></a><span class="sd">            Number of features in the Markov process (`m` in the paper)</span>
</span><span id="AbstractMarkov-128"><a href="#AbstractMarkov-128"><span class="linenos"> 128</span></a>
</span><span id="AbstractMarkov-129"><a href="#AbstractMarkov-129"><span class="linenos"> 129</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-130"><a href="#AbstractMarkov-130"><span class="linenos"> 130</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-131"><a href="#AbstractMarkov-131"><span class="linenos"> 131</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov-132"><a href="#AbstractMarkov-132"><span class="linenos"> 132</span></a>
</span><span id="AbstractMarkov-133"><a href="#AbstractMarkov-133"><span class="linenos"> 133</span></a><span class="sd">        Notes</span>
</span><span id="AbstractMarkov-134"><a href="#AbstractMarkov-134"><span class="linenos"> 134</span></a><span class="sd">        -----</span>
</span><span id="AbstractMarkov-135"><a href="#AbstractMarkov-135"><span class="linenos"> 135</span></a><span class="sd">        This initializes the basic attributes of the Markov process including:</span>
</span><span id="AbstractMarkov-136"><a href="#AbstractMarkov-136"><span class="linenos"> 136</span></a><span class="sd">        - Number of states and features</span>
</span><span id="AbstractMarkov-137"><a href="#AbstractMarkov-137"><span class="linenos"> 137</span></a><span class="sd">        - Gurobi optimization model</span>
</span><span id="AbstractMarkov-138"><a href="#AbstractMarkov-138"><span class="linenos"> 138</span></a><span class="sd">        - Parameter dictionaries for variables, ML output flags, and dimensions</span>
</span><span id="AbstractMarkov-139"><a href="#AbstractMarkov-139"><span class="linenos"> 139</span></a><span class="sd">        - Feature space variables and constraints</span>
</span><span id="AbstractMarkov-140"><a href="#AbstractMarkov-140"><span class="linenos"> 140</span></a><span class="sd">        - ML model and output storage</span>
</span><span id="AbstractMarkov-141"><a href="#AbstractMarkov-141"><span class="linenos"> 141</span></a>
</span><span id="AbstractMarkov-142"><a href="#AbstractMarkov-142"><span class="linenos"> 142</span></a><span class="sd">        Subclasses will have additional attributes in their constructors.</span>
</span><span id="AbstractMarkov-143"><a href="#AbstractMarkov-143"><span class="linenos"> 143</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-144"><a href="#AbstractMarkov-144"><span class="linenos"> 144</span></a>        <span class="c1"># basic attributes</span>
</span><span id="AbstractMarkov-145"><a href="#AbstractMarkov-145"><span class="linenos"> 145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span> <span class="o">=</span> <span class="n">n_states</span>
</span><span id="AbstractMarkov-146"><a href="#AbstractMarkov-146"><span class="linenos"> 146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_features</span> <span class="o">=</span> <span class="n">n_features</span>
</span><span id="AbstractMarkov-147"><a href="#AbstractMarkov-147"><span class="linenos"> 147</span></a>
</span><span id="AbstractMarkov-148"><a href="#AbstractMarkov-148"><span class="linenos"> 148</span></a>        <span class="c1"># create the main optimization model</span>
</span><span id="AbstractMarkov-149"><a href="#AbstractMarkov-149"><span class="linenos"> 149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;mainmodel&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-150"><a href="#AbstractMarkov-150"><span class="linenos"> 150</span></a>
</span><span id="AbstractMarkov-151"><a href="#AbstractMarkov-151"><span class="linenos"> 151</span></a>        <span class="c1"># store the paramaters</span>
</span><span id="AbstractMarkov-152"><a href="#AbstractMarkov-152"><span class="linenos"> 152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AbstractMarkov-153"><a href="#AbstractMarkov-153"><span class="linenos"> 153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AbstractMarkov-154"><a href="#AbstractMarkov-154"><span class="linenos"> 154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AbstractMarkov-155"><a href="#AbstractMarkov-155"><span class="linenos"> 155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AbstractMarkov-156"><a href="#AbstractMarkov-156"><span class="linenos"> 156</span></a>
</span><span id="AbstractMarkov-157"><a href="#AbstractMarkov-157"><span class="linenos"> 157</span></a>        <span class="c1"># create the feature space</span>
</span><span id="AbstractMarkov-158"><a href="#AbstractMarkov-158"><span class="linenos"> 158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="AbstractMarkov-159"><a href="#AbstractMarkov-159"><span class="linenos"> 159</span></a>            <span class="n">n_features</span><span class="p">,</span>
</span><span id="AbstractMarkov-160"><a href="#AbstractMarkov-160"><span class="linenos"> 160</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span>
</span><span id="AbstractMarkov-161"><a href="#AbstractMarkov-161"><span class="linenos"> 161</span></a>            <span class="n">lb</span><span class="o">=-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="AbstractMarkov-162"><a href="#AbstractMarkov-162"><span class="linenos"> 162</span></a>            <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="AbstractMarkov-163"><a href="#AbstractMarkov-163"><span class="linenos"> 163</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="AbstractMarkov-164"><a href="#AbstractMarkov-164"><span class="linenos"> 164</span></a>        <span class="p">)</span>
</span><span id="AbstractMarkov-165"><a href="#AbstractMarkov-165"><span class="linenos"> 165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_aux</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AbstractMarkov-166"><a href="#AbstractMarkov-166"><span class="linenos"> 166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_constraints</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AbstractMarkov-167"><a href="#AbstractMarkov-167"><span class="linenos"> 167</span></a>
</span><span id="AbstractMarkov-168"><a href="#AbstractMarkov-168"><span class="linenos"> 168</span></a>        <span class="c1"># store the ml models</span>
</span><span id="AbstractMarkov-169"><a href="#AbstractMarkov-169"><span class="linenos"> 169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ml_models</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AbstractMarkov-170"><a href="#AbstractMarkov-170"><span class="linenos"> 170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AbstractMarkov-171"><a href="#AbstractMarkov-171"><span class="linenos"> 171</span></a>
</span><span id="AbstractMarkov-172"><a href="#AbstractMarkov-172"><span class="linenos"> 172</span></a>    <span class="c1"># METHODS THAT MUST BE IMPLEMENTED BY SUBCLASSES</span>
</span><span id="AbstractMarkov-173"><a href="#AbstractMarkov-173"><span class="linenos"> 173</span></a>
</span><span id="AbstractMarkov-174"><a href="#AbstractMarkov-174"><span class="linenos"> 174</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="AbstractMarkov-175"><a href="#AbstractMarkov-175"><span class="linenos"> 175</span></a>    <span class="k">def</span> <span class="nf">_initialize_parameters_and_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AbstractMarkov-176"><a href="#AbstractMarkov-176"><span class="linenos"> 176</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-177"><a href="#AbstractMarkov-177"><span class="linenos"> 177</span></a><span class="sd">        Here, we add the specific parameters needed for that subclass,</span>
</span><span id="AbstractMarkov-178"><a href="#AbstractMarkov-178"><span class="linenos"> 178</span></a><span class="sd">        set the appropriate flags for whether they are set, specify their</span>
</span><span id="AbstractMarkov-179"><a href="#AbstractMarkov-179"><span class="linenos"> 179</span></a><span class="sd">        dimensions, and set them to values if provided. As well, here we</span>
</span><span id="AbstractMarkov-180"><a href="#AbstractMarkov-180"><span class="linenos"> 180</span></a><span class="sd">        must add necessary constraints for the subclass, for example,</span>
</span><span id="AbstractMarkov-181"><a href="#AbstractMarkov-181"><span class="linenos"> 181</span></a><span class="sd">        the definition of the value vector v.</span>
</span><span id="AbstractMarkov-182"><a href="#AbstractMarkov-182"><span class="linenos"> 182</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-183"><a href="#AbstractMarkov-183"><span class="linenos"> 183</span></a>        <span class="k">pass</span>
</span><span id="AbstractMarkov-184"><a href="#AbstractMarkov-184"><span class="linenos"> 184</span></a>
</span><span id="AbstractMarkov-185"><a href="#AbstractMarkov-185"><span class="linenos"> 185</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="AbstractMarkov-186"><a href="#AbstractMarkov-186"><span class="linenos"> 186</span></a>    <span class="k">def</span> <span class="nf">_check_all_vars_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AbstractMarkov-187"><a href="#AbstractMarkov-187"><span class="linenos"> 187</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-188"><a href="#AbstractMarkov-188"><span class="linenos"> 188</span></a><span class="sd">        Checks which variables have to be set, either to ML outputs or constants,</span>
</span><span id="AbstractMarkov-189"><a href="#AbstractMarkov-189"><span class="linenos"> 189</span></a><span class="sd">        i.e., the variables which must be bound via affine equalities, before</span>
</span><span id="AbstractMarkov-190"><a href="#AbstractMarkov-190"><span class="linenos"> 190</span></a><span class="sd">        calling optimize.</span>
</span><span id="AbstractMarkov-191"><a href="#AbstractMarkov-191"><span class="linenos"> 191</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-192"><a href="#AbstractMarkov-192"><span class="linenos"> 192</span></a>        <span class="k">pass</span>
</span><span id="AbstractMarkov-193"><a href="#AbstractMarkov-193"><span class="linenos"> 193</span></a>
</span><span id="AbstractMarkov-194"><a href="#AbstractMarkov-194"><span class="linenos"> 194</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="AbstractMarkov-195"><a href="#AbstractMarkov-195"><span class="linenos"> 195</span></a>    <span class="k">def</span> <span class="nf">_set_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AbstractMarkov-196"><a href="#AbstractMarkov-196"><span class="linenos"> 196</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-197"><a href="#AbstractMarkov-197"><span class="linenos"> 197</span></a><span class="sd">        Set the optimization objective.</span>
</span><span id="AbstractMarkov-198"><a href="#AbstractMarkov-198"><span class="linenos"> 198</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-199"><a href="#AbstractMarkov-199"><span class="linenos"> 199</span></a>        <span class="k">pass</span>
</span><span id="AbstractMarkov-200"><a href="#AbstractMarkov-200"><span class="linenos"> 200</span></a>
</span><span id="AbstractMarkov-201"><a href="#AbstractMarkov-201"><span class="linenos"> 201</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="AbstractMarkov-202"><a href="#AbstractMarkov-202"><span class="linenos"> 202</span></a>    <span class="k">def</span> <span class="nf">_set_feasible_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">):</span>
</span><span id="AbstractMarkov-203"><a href="#AbstractMarkov-203"><span class="linenos"> 203</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-204"><a href="#AbstractMarkov-204"><span class="linenos"> 204</span></a><span class="sd">        Set the constraints on the appropriate quantity for the feasibility version.</span>
</span><span id="AbstractMarkov-205"><a href="#AbstractMarkov-205"><span class="linenos"> 205</span></a><span class="sd">        The constraints are named &quot;temp_feasible_lb&quot; and &quot;temp_feasible_ub&quot; so that</span>
</span><span id="AbstractMarkov-206"><a href="#AbstractMarkov-206"><span class="linenos"> 206</span></a><span class="sd">        they can be removed after the optimization.</span>
</span><span id="AbstractMarkov-207"><a href="#AbstractMarkov-207"><span class="linenos"> 207</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-208"><a href="#AbstractMarkov-208"><span class="linenos"> 208</span></a>        <span class="k">pass</span>
</span><span id="AbstractMarkov-209"><a href="#AbstractMarkov-209"><span class="linenos"> 209</span></a>
</span><span id="AbstractMarkov-210"><a href="#AbstractMarkov-210"><span class="linenos"> 210</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="AbstractMarkov-211"><a href="#AbstractMarkov-211"><span class="linenos"> 211</span></a>    <span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AbstractMarkov-212"><a href="#AbstractMarkov-212"><span class="linenos"> 212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-213"><a href="#AbstractMarkov-213"><span class="linenos"> 213</span></a><span class="sd">        Get values of the key variables of the Markov process after optimization.</span>
</span><span id="AbstractMarkov-214"><a href="#AbstractMarkov-214"><span class="linenos"> 214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-215"><a href="#AbstractMarkov-215"><span class="linenos"> 215</span></a>        <span class="k">pass</span>
</span><span id="AbstractMarkov-216"><a href="#AbstractMarkov-216"><span class="linenos"> 216</span></a>
</span><span id="AbstractMarkov-217"><a href="#AbstractMarkov-217"><span class="linenos"> 217</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="AbstractMarkov-218"><a href="#AbstractMarkov-218"><span class="linenos"> 218</span></a>    <span class="k">def</span> <span class="nf">_compute_affine_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ml_bounds</span><span class="p">):</span>
</span><span id="AbstractMarkov-219"><a href="#AbstractMarkov-219"><span class="linenos"> 219</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-220"><a href="#AbstractMarkov-220"><span class="linenos"> 220</span></a><span class="sd">        Propagate the bounds on the ML outputs to the parameters. Must be</span>
</span><span id="AbstractMarkov-221"><a href="#AbstractMarkov-221"><span class="linenos"> 221</span></a><span class="sd">        specified by the subclass which parameters are bound by affine equalities</span>
</span><span id="AbstractMarkov-222"><a href="#AbstractMarkov-222"><span class="linenos"> 222</span></a><span class="sd">        to ML outputs. It should return a dictionary containing bounds for each</span>
</span><span id="AbstractMarkov-223"><a href="#AbstractMarkov-223"><span class="linenos"> 223</span></a><span class="sd">        parameter that is an ML output.</span>
</span><span id="AbstractMarkov-224"><a href="#AbstractMarkov-224"><span class="linenos"> 224</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-225"><a href="#AbstractMarkov-225"><span class="linenos"> 225</span></a>        <span class="k">pass</span>
</span><span id="AbstractMarkov-226"><a href="#AbstractMarkov-226"><span class="linenos"> 226</span></a>
</span><span id="AbstractMarkov-227"><a href="#AbstractMarkov-227"><span class="linenos"> 227</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="AbstractMarkov-228"><a href="#AbstractMarkov-228"><span class="linenos"> 228</span></a>    <span class="k">def</span> <span class="nf">_set_affine_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">affine_bounds</span><span class="p">):</span>
</span><span id="AbstractMarkov-229"><a href="#AbstractMarkov-229"><span class="linenos"> 229</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-230"><a href="#AbstractMarkov-230"><span class="linenos"> 230</span></a><span class="sd">        Set the bounds on the parameters based on the affine bounds.</span>
</span><span id="AbstractMarkov-231"><a href="#AbstractMarkov-231"><span class="linenos"> 231</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-232"><a href="#AbstractMarkov-232"><span class="linenos"> 232</span></a>        <span class="k">pass</span>
</span><span id="AbstractMarkov-233"><a href="#AbstractMarkov-233"><span class="linenos"> 233</span></a>
</span><span id="AbstractMarkov-234"><a href="#AbstractMarkov-234"><span class="linenos"> 234</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="AbstractMarkov-235"><a href="#AbstractMarkov-235"><span class="linenos"> 235</span></a>    <span class="k">def</span> <span class="nf">_compute_initial_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AbstractMarkov-236"><a href="#AbstractMarkov-236"><span class="linenos"> 236</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-237"><a href="#AbstractMarkov-237"><span class="linenos"> 237</span></a><span class="sd">        Compute initial bounds on the value vector v. Depends on the subclass.</span>
</span><span id="AbstractMarkov-238"><a href="#AbstractMarkov-238"><span class="linenos"> 238</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-239"><a href="#AbstractMarkov-239"><span class="linenos"> 239</span></a>        <span class="k">pass</span>
</span><span id="AbstractMarkov-240"><a href="#AbstractMarkov-240"><span class="linenos"> 240</span></a>
</span><span id="AbstractMarkov-241"><a href="#AbstractMarkov-241"><span class="linenos"> 241</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="AbstractMarkov-242"><a href="#AbstractMarkov-242"><span class="linenos"> 242</span></a>    <span class="k">def</span> <span class="nf">_set_initial_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_v_bounds</span><span class="p">):</span>
</span><span id="AbstractMarkov-243"><a href="#AbstractMarkov-243"><span class="linenos"> 243</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-244"><a href="#AbstractMarkov-244"><span class="linenos"> 244</span></a><span class="sd">        Set the initial bounds on the value vector v.</span>
</span><span id="AbstractMarkov-245"><a href="#AbstractMarkov-245"><span class="linenos"> 245</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-246"><a href="#AbstractMarkov-246"><span class="linenos"> 246</span></a>        <span class="k">pass</span>
</span><span id="AbstractMarkov-247"><a href="#AbstractMarkov-247"><span class="linenos"> 247</span></a>
</span><span id="AbstractMarkov-248"><a href="#AbstractMarkov-248"><span class="linenos"> 248</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="AbstractMarkov-249"><a href="#AbstractMarkov-249"><span class="linenos"> 249</span></a>    <span class="k">def</span> <span class="nf">_compute_tightened_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AbstractMarkov-250"><a href="#AbstractMarkov-250"><span class="linenos"> 250</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-251"><a href="#AbstractMarkov-251"><span class="linenos"> 251</span></a><span class="sd">        Use Gauss-Seidel to compute tighter bounds on value vector.</span>
</span><span id="AbstractMarkov-252"><a href="#AbstractMarkov-252"><span class="linenos"> 252</span></a><span class="sd">        Must be implemented by subclasses based on their linear system.</span>
</span><span id="AbstractMarkov-253"><a href="#AbstractMarkov-253"><span class="linenos"> 253</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-254"><a href="#AbstractMarkov-254"><span class="linenos"> 254</span></a>        <span class="k">pass</span>
</span><span id="AbstractMarkov-255"><a href="#AbstractMarkov-255"><span class="linenos"> 255</span></a>
</span><span id="AbstractMarkov-256"><a href="#AbstractMarkov-256"><span class="linenos"> 256</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="AbstractMarkov-257"><a href="#AbstractMarkov-257"><span class="linenos"> 257</span></a>    <span class="k">def</span> <span class="nf">_set_tightened_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tightened_v_bounds</span><span class="p">):</span>
</span><span id="AbstractMarkov-258"><a href="#AbstractMarkov-258"><span class="linenos"> 258</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-259"><a href="#AbstractMarkov-259"><span class="linenos"> 259</span></a><span class="sd">        Set the tightened bounds on the value vector v.</span>
</span><span id="AbstractMarkov-260"><a href="#AbstractMarkov-260"><span class="linenos"> 260</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-261"><a href="#AbstractMarkov-261"><span class="linenos"> 261</span></a>        <span class="k">pass</span>
</span><span id="AbstractMarkov-262"><a href="#AbstractMarkov-262"><span class="linenos"> 262</span></a>
</span><span id="AbstractMarkov-263"><a href="#AbstractMarkov-263"><span class="linenos"> 263</span></a>    <span class="c1"># FUNCTIONS FOR CHECKING VALIDITY OF INPUTTED PARAMETERS</span>
</span><span id="AbstractMarkov-264"><a href="#AbstractMarkov-264"><span class="linenos"> 264</span></a>
</span><span id="AbstractMarkov-265"><a href="#AbstractMarkov-265"><span class="linenos"> 265</span></a>    <span class="k">def</span> <span class="nf">_validate_vector_length</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="AbstractMarkov-266"><a href="#AbstractMarkov-266"><span class="linenos"> 266</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-267"><a href="#AbstractMarkov-267"><span class="linenos"> 267</span></a><span class="sd">        Validate the length of a vector.</span>
</span><span id="AbstractMarkov-268"><a href="#AbstractMarkov-268"><span class="linenos"> 268</span></a>
</span><span id="AbstractMarkov-269"><a href="#AbstractMarkov-269"><span class="linenos"> 269</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-270"><a href="#AbstractMarkov-270"><span class="linenos"> 270</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-271"><a href="#AbstractMarkov-271"><span class="linenos"> 271</span></a><span class="sd">        values : Sequence</span>
</span><span id="AbstractMarkov-272"><a href="#AbstractMarkov-272"><span class="linenos"> 272</span></a><span class="sd">            The vector whose length needs to be validated</span>
</span><span id="AbstractMarkov-273"><a href="#AbstractMarkov-273"><span class="linenos"> 273</span></a><span class="sd">        var_name : str</span>
</span><span id="AbstractMarkov-274"><a href="#AbstractMarkov-274"><span class="linenos"> 274</span></a><span class="sd">            Name of the variable for error messages</span>
</span><span id="AbstractMarkov-275"><a href="#AbstractMarkov-275"><span class="linenos"> 275</span></a>
</span><span id="AbstractMarkov-276"><a href="#AbstractMarkov-276"><span class="linenos"> 276</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-277"><a href="#AbstractMarkov-277"><span class="linenos"> 277</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-278"><a href="#AbstractMarkov-278"><span class="linenos"> 278</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov-279"><a href="#AbstractMarkov-279"><span class="linenos"> 279</span></a>
</span><span id="AbstractMarkov-280"><a href="#AbstractMarkov-280"><span class="linenos"> 280</span></a><span class="sd">        Raises</span>
</span><span id="AbstractMarkov-281"><a href="#AbstractMarkov-281"><span class="linenos"> 281</span></a><span class="sd">        ------</span>
</span><span id="AbstractMarkov-282"><a href="#AbstractMarkov-282"><span class="linenos"> 282</span></a><span class="sd">        ValueError</span>
</span><span id="AbstractMarkov-283"><a href="#AbstractMarkov-283"><span class="linenos"> 283</span></a><span class="sd">            If the length of values does not match the expected length stored in</span>
</span><span id="AbstractMarkov-284"><a href="#AbstractMarkov-284"><span class="linenos"> 284</span></a><span class="sd">            self._var_dim[var_name][0]</span>
</span><span id="AbstractMarkov-285"><a href="#AbstractMarkov-285"><span class="linenos"> 285</span></a>
</span><span id="AbstractMarkov-286"><a href="#AbstractMarkov-286"><span class="linenos"> 286</span></a><span class="sd">        See Also</span>
</span><span id="AbstractMarkov-287"><a href="#AbstractMarkov-287"><span class="linenos"> 287</span></a><span class="sd">        --------</span>
</span><span id="AbstractMarkov-288"><a href="#AbstractMarkov-288"><span class="linenos"> 288</span></a><span class="sd">        _validate_matrix_shape</span>
</span><span id="AbstractMarkov-289"><a href="#AbstractMarkov-289"><span class="linenos"> 289</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-290"><a href="#AbstractMarkov-290"><span class="linenos"> 290</span></a>        <span class="n">expected_length</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="n">var_name</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AbstractMarkov-291"><a href="#AbstractMarkov-291"><span class="linenos"> 291</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">!=</span> <span class="n">expected_length</span><span class="p">:</span>
</span><span id="AbstractMarkov-292"><a href="#AbstractMarkov-292"><span class="linenos"> 292</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> must have length </span><span class="si">{</span><span class="n">expected_length</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-293"><a href="#AbstractMarkov-293"><span class="linenos"> 293</span></a>
</span><span id="AbstractMarkov-294"><a href="#AbstractMarkov-294"><span class="linenos"> 294</span></a>    <span class="k">def</span> <span class="nf">_validate_matrix_shape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">],</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="AbstractMarkov-295"><a href="#AbstractMarkov-295"><span class="linenos"> 295</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-296"><a href="#AbstractMarkov-296"><span class="linenos"> 296</span></a><span class="sd">        Validate the shape of a matrix.</span>
</span><span id="AbstractMarkov-297"><a href="#AbstractMarkov-297"><span class="linenos"> 297</span></a>
</span><span id="AbstractMarkov-298"><a href="#AbstractMarkov-298"><span class="linenos"> 298</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-299"><a href="#AbstractMarkov-299"><span class="linenos"> 299</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-300"><a href="#AbstractMarkov-300"><span class="linenos"> 300</span></a><span class="sd">        values : Sequence[Sequence]</span>
</span><span id="AbstractMarkov-301"><a href="#AbstractMarkov-301"><span class="linenos"> 301</span></a><span class="sd">            The matrix whose shape needs to be validated</span>
</span><span id="AbstractMarkov-302"><a href="#AbstractMarkov-302"><span class="linenos"> 302</span></a><span class="sd">        var_name : str</span>
</span><span id="AbstractMarkov-303"><a href="#AbstractMarkov-303"><span class="linenos"> 303</span></a><span class="sd">            Name of the variable for error messages</span>
</span><span id="AbstractMarkov-304"><a href="#AbstractMarkov-304"><span class="linenos"> 304</span></a>
</span><span id="AbstractMarkov-305"><a href="#AbstractMarkov-305"><span class="linenos"> 305</span></a>
</span><span id="AbstractMarkov-306"><a href="#AbstractMarkov-306"><span class="linenos"> 306</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-307"><a href="#AbstractMarkov-307"><span class="linenos"> 307</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-308"><a href="#AbstractMarkov-308"><span class="linenos"> 308</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov-309"><a href="#AbstractMarkov-309"><span class="linenos"> 309</span></a>
</span><span id="AbstractMarkov-310"><a href="#AbstractMarkov-310"><span class="linenos"> 310</span></a><span class="sd">        Raises</span>
</span><span id="AbstractMarkov-311"><a href="#AbstractMarkov-311"><span class="linenos"> 311</span></a><span class="sd">        ------</span>
</span><span id="AbstractMarkov-312"><a href="#AbstractMarkov-312"><span class="linenos"> 312</span></a><span class="sd">        ValueError</span>
</span><span id="AbstractMarkov-313"><a href="#AbstractMarkov-313"><span class="linenos"> 313</span></a><span class="sd">            If the number of rows in values does not match the expected number of rows stored in</span>
</span><span id="AbstractMarkov-314"><a href="#AbstractMarkov-314"><span class="linenos"> 314</span></a><span class="sd">            self._var_dim[var_name][0]</span>
</span><span id="AbstractMarkov-315"><a href="#AbstractMarkov-315"><span class="linenos"> 315</span></a>
</span><span id="AbstractMarkov-316"><a href="#AbstractMarkov-316"><span class="linenos"> 316</span></a><span class="sd">        See Also</span>
</span><span id="AbstractMarkov-317"><a href="#AbstractMarkov-317"><span class="linenos"> 317</span></a><span class="sd">        --------</span>
</span><span id="AbstractMarkov-318"><a href="#AbstractMarkov-318"><span class="linenos"> 318</span></a><span class="sd">        _validate_vector_length</span>
</span><span id="AbstractMarkov-319"><a href="#AbstractMarkov-319"><span class="linenos"> 319</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-320"><a href="#AbstractMarkov-320"><span class="linenos"> 320</span></a>        <span class="n">expected_rows</span><span class="p">,</span> <span class="n">expected_cols</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span>
</span><span id="AbstractMarkov-321"><a href="#AbstractMarkov-321"><span class="linenos"> 321</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">!=</span> <span class="n">expected_rows</span><span class="p">:</span>
</span><span id="AbstractMarkov-322"><a href="#AbstractMarkov-322"><span class="linenos"> 322</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> must have </span><span class="si">{</span><span class="n">expected_rows</span><span class="si">}</span><span class="s2"> rows&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-323"><a href="#AbstractMarkov-323"><span class="linenos"> 323</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">Sequence</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">values</span><span class="p">):</span>
</span><span id="AbstractMarkov-324"><a href="#AbstractMarkov-324"><span class="linenos"> 324</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> must be a 2D sequence (matrix) of size </span><span class="si">{</span><span class="n">expected_rows</span><span class="si">}</span><span class="s2">x</span><span class="si">{</span><span class="n">expected_cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-325"><a href="#AbstractMarkov-325"><span class="linenos"> 325</span></a>        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="o">!=</span> <span class="n">expected_cols</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">values</span><span class="p">):</span>
</span><span id="AbstractMarkov-326"><a href="#AbstractMarkov-326"><span class="linenos"> 326</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Each row of </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> must have length </span><span class="si">{</span><span class="n">expected_cols</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-327"><a href="#AbstractMarkov-327"><span class="linenos"> 327</span></a>
</span><span id="AbstractMarkov-328"><a href="#AbstractMarkov-328"><span class="linenos"> 328</span></a>    <span class="k">def</span> <span class="nf">_validate_vector_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bounds</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]):</span>
</span><span id="AbstractMarkov-329"><a href="#AbstractMarkov-329"><span class="linenos"> 329</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-330"><a href="#AbstractMarkov-330"><span class="linenos"> 330</span></a><span class="sd">        Validate the bounds of a vector.</span>
</span><span id="AbstractMarkov-331"><a href="#AbstractMarkov-331"><span class="linenos"> 331</span></a>
</span><span id="AbstractMarkov-332"><a href="#AbstractMarkov-332"><span class="linenos"> 332</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-333"><a href="#AbstractMarkov-333"><span class="linenos"> 333</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-334"><a href="#AbstractMarkov-334"><span class="linenos"> 334</span></a><span class="sd">        values : Sequence</span>
</span><span id="AbstractMarkov-335"><a href="#AbstractMarkov-335"><span class="linenos"> 335</span></a><span class="sd">            The vector whose bounds need to be validated</span>
</span><span id="AbstractMarkov-336"><a href="#AbstractMarkov-336"><span class="linenos"> 336</span></a><span class="sd">        var_name : str</span>
</span><span id="AbstractMarkov-337"><a href="#AbstractMarkov-337"><span class="linenos"> 337</span></a><span class="sd">            Name of the variable for error messages</span>
</span><span id="AbstractMarkov-338"><a href="#AbstractMarkov-338"><span class="linenos"> 338</span></a><span class="sd">        bounds : Tuple[float, float]</span>
</span><span id="AbstractMarkov-339"><a href="#AbstractMarkov-339"><span class="linenos"> 339</span></a><span class="sd">            The bounds to validate against</span>
</span><span id="AbstractMarkov-340"><a href="#AbstractMarkov-340"><span class="linenos"> 340</span></a>
</span><span id="AbstractMarkov-341"><a href="#AbstractMarkov-341"><span class="linenos"> 341</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-342"><a href="#AbstractMarkov-342"><span class="linenos"> 342</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-343"><a href="#AbstractMarkov-343"><span class="linenos"> 343</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov-344"><a href="#AbstractMarkov-344"><span class="linenos"> 344</span></a>
</span><span id="AbstractMarkov-345"><a href="#AbstractMarkov-345"><span class="linenos"> 345</span></a><span class="sd">        Raises</span>
</span><span id="AbstractMarkov-346"><a href="#AbstractMarkov-346"><span class="linenos"> 346</span></a><span class="sd">        ------</span>
</span><span id="AbstractMarkov-347"><a href="#AbstractMarkov-347"><span class="linenos"> 347</span></a><span class="sd">        ValueError</span>
</span><span id="AbstractMarkov-348"><a href="#AbstractMarkov-348"><span class="linenos"> 348</span></a><span class="sd">            If any value in values does not satisfy the bounds</span>
</span><span id="AbstractMarkov-349"><a href="#AbstractMarkov-349"><span class="linenos"> 349</span></a>
</span><span id="AbstractMarkov-350"><a href="#AbstractMarkov-350"><span class="linenos"> 350</span></a><span class="sd">        See Also</span>
</span><span id="AbstractMarkov-351"><a href="#AbstractMarkov-351"><span class="linenos"> 351</span></a><span class="sd">        --------</span>
</span><span id="AbstractMarkov-352"><a href="#AbstractMarkov-352"><span class="linenos"> 352</span></a><span class="sd">        _validate_matrix_bounds</span>
</span><span id="AbstractMarkov-353"><a href="#AbstractMarkov-353"><span class="linenos"> 353</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-354"><a href="#AbstractMarkov-354"><span class="linenos"> 354</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">values</span><span class="p">):</span>
</span><span id="AbstractMarkov-355"><a href="#AbstractMarkov-355"><span class="linenos"> 355</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> must contain values between </span><span class="si">{</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-356"><a href="#AbstractMarkov-356"><span class="linenos"> 356</span></a>
</span><span id="AbstractMarkov-357"><a href="#AbstractMarkov-357"><span class="linenos"> 357</span></a>    <span class="k">def</span> <span class="nf">_validate_matrix_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">],</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">bounds</span><span class="p">:</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]):</span>
</span><span id="AbstractMarkov-358"><a href="#AbstractMarkov-358"><span class="linenos"> 358</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-359"><a href="#AbstractMarkov-359"><span class="linenos"> 359</span></a><span class="sd">        Validate the bounds of a matrix.</span>
</span><span id="AbstractMarkov-360"><a href="#AbstractMarkov-360"><span class="linenos"> 360</span></a>
</span><span id="AbstractMarkov-361"><a href="#AbstractMarkov-361"><span class="linenos"> 361</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-362"><a href="#AbstractMarkov-362"><span class="linenos"> 362</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-363"><a href="#AbstractMarkov-363"><span class="linenos"> 363</span></a><span class="sd">        values : Sequence[Sequence]</span>
</span><span id="AbstractMarkov-364"><a href="#AbstractMarkov-364"><span class="linenos"> 364</span></a><span class="sd">            The matrix whose bounds need to be validated</span>
</span><span id="AbstractMarkov-365"><a href="#AbstractMarkov-365"><span class="linenos"> 365</span></a><span class="sd">        var_name : str</span>
</span><span id="AbstractMarkov-366"><a href="#AbstractMarkov-366"><span class="linenos"> 366</span></a><span class="sd">            Name of the variable for error messages</span>
</span><span id="AbstractMarkov-367"><a href="#AbstractMarkov-367"><span class="linenos"> 367</span></a><span class="sd">        bounds : Tuple[float, float]</span>
</span><span id="AbstractMarkov-368"><a href="#AbstractMarkov-368"><span class="linenos"> 368</span></a><span class="sd">            The bounds to validate against</span>
</span><span id="AbstractMarkov-369"><a href="#AbstractMarkov-369"><span class="linenos"> 369</span></a>
</span><span id="AbstractMarkov-370"><a href="#AbstractMarkov-370"><span class="linenos"> 370</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-371"><a href="#AbstractMarkov-371"><span class="linenos"> 371</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-372"><a href="#AbstractMarkov-372"><span class="linenos"> 372</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov-373"><a href="#AbstractMarkov-373"><span class="linenos"> 373</span></a>
</span><span id="AbstractMarkov-374"><a href="#AbstractMarkov-374"><span class="linenos"> 374</span></a><span class="sd">        Raises</span>
</span><span id="AbstractMarkov-375"><a href="#AbstractMarkov-375"><span class="linenos"> 375</span></a><span class="sd">        ------</span>
</span><span id="AbstractMarkov-376"><a href="#AbstractMarkov-376"><span class="linenos"> 376</span></a><span class="sd">        ValueError</span>
</span><span id="AbstractMarkov-377"><a href="#AbstractMarkov-377"><span class="linenos"> 377</span></a><span class="sd">            If any value in values does not satisfy the bounds</span>
</span><span id="AbstractMarkov-378"><a href="#AbstractMarkov-378"><span class="linenos"> 378</span></a>
</span><span id="AbstractMarkov-379"><a href="#AbstractMarkov-379"><span class="linenos"> 379</span></a><span class="sd">        See Also</span>
</span><span id="AbstractMarkov-380"><a href="#AbstractMarkov-380"><span class="linenos"> 380</span></a><span class="sd">        --------</span>
</span><span id="AbstractMarkov-381"><a href="#AbstractMarkov-381"><span class="linenos"> 381</span></a><span class="sd">        _validate_vector_bounds</span>
</span><span id="AbstractMarkov-382"><a href="#AbstractMarkov-382"><span class="linenos"> 382</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-383"><a href="#AbstractMarkov-383"><span class="linenos"> 383</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="AbstractMarkov-384"><a href="#AbstractMarkov-384"><span class="linenos"> 384</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">val</span> <span class="o">&lt;=</span> <span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">row</span><span class="p">):</span>
</span><span id="AbstractMarkov-385"><a href="#AbstractMarkov-385"><span class="linenos"> 385</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Row </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> of </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> must contain values between </span><span class="si">{</span><span class="n">bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="n">bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-386"><a href="#AbstractMarkov-386"><span class="linenos"> 386</span></a>
</span><span id="AbstractMarkov-387"><a href="#AbstractMarkov-387"><span class="linenos"> 387</span></a>    <span class="k">def</span> <span class="nf">_validate_stochastic_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">strictsub</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="AbstractMarkov-388"><a href="#AbstractMarkov-388"><span class="linenos"> 388</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-389"><a href="#AbstractMarkov-389"><span class="linenos"> 389</span></a><span class="sd">        Validate probability vector.</span>
</span><span id="AbstractMarkov-390"><a href="#AbstractMarkov-390"><span class="linenos"> 390</span></a>
</span><span id="AbstractMarkov-391"><a href="#AbstractMarkov-391"><span class="linenos"> 391</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-392"><a href="#AbstractMarkov-392"><span class="linenos"> 392</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-393"><a href="#AbstractMarkov-393"><span class="linenos"> 393</span></a><span class="sd">        values : Sequence</span>
</span><span id="AbstractMarkov-394"><a href="#AbstractMarkov-394"><span class="linenos"> 394</span></a><span class="sd">            The vector of probabilities to validate</span>
</span><span id="AbstractMarkov-395"><a href="#AbstractMarkov-395"><span class="linenos"> 395</span></a><span class="sd">        var_name : str</span>
</span><span id="AbstractMarkov-396"><a href="#AbstractMarkov-396"><span class="linenos"> 396</span></a><span class="sd">            Name of the variable for error messages</span>
</span><span id="AbstractMarkov-397"><a href="#AbstractMarkov-397"><span class="linenos"> 397</span></a><span class="sd">        sub : bool</span>
</span><span id="AbstractMarkov-398"><a href="#AbstractMarkov-398"><span class="linenos"> 398</span></a><span class="sd">            If True, allow substochastic (sum &lt;= 1)</span>
</span><span id="AbstractMarkov-399"><a href="#AbstractMarkov-399"><span class="linenos"> 399</span></a><span class="sd">        strictsub : bool</span>
</span><span id="AbstractMarkov-400"><a href="#AbstractMarkov-400"><span class="linenos"> 400</span></a><span class="sd">            If True, require strict substochastic (sum &lt; 1)</span>
</span><span id="AbstractMarkov-401"><a href="#AbstractMarkov-401"><span class="linenos"> 401</span></a>
</span><span id="AbstractMarkov-402"><a href="#AbstractMarkov-402"><span class="linenos"> 402</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-403"><a href="#AbstractMarkov-403"><span class="linenos"> 403</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-404"><a href="#AbstractMarkov-404"><span class="linenos"> 404</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov-405"><a href="#AbstractMarkov-405"><span class="linenos"> 405</span></a>
</span><span id="AbstractMarkov-406"><a href="#AbstractMarkov-406"><span class="linenos"> 406</span></a><span class="sd">        Raises</span>
</span><span id="AbstractMarkov-407"><a href="#AbstractMarkov-407"><span class="linenos"> 407</span></a><span class="sd">        ------</span>
</span><span id="AbstractMarkov-408"><a href="#AbstractMarkov-408"><span class="linenos"> 408</span></a><span class="sd">        ValueError</span>
</span><span id="AbstractMarkov-409"><a href="#AbstractMarkov-409"><span class="linenos"> 409</span></a><span class="sd">            If the sum of the probabilities does not satisfy the given condition</span>
</span><span id="AbstractMarkov-410"><a href="#AbstractMarkov-410"><span class="linenos"> 410</span></a>
</span><span id="AbstractMarkov-411"><a href="#AbstractMarkov-411"><span class="linenos"> 411</span></a><span class="sd">        See Also</span>
</span><span id="AbstractMarkov-412"><a href="#AbstractMarkov-412"><span class="linenos"> 412</span></a><span class="sd">        --------</span>
</span><span id="AbstractMarkov-413"><a href="#AbstractMarkov-413"><span class="linenos"> 413</span></a><span class="sd">        _validate_stochastic_matrix</span>
</span><span id="AbstractMarkov-414"><a href="#AbstractMarkov-414"><span class="linenos"> 414</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-415"><a href="#AbstractMarkov-415"><span class="linenos"> 415</span></a>        <span class="n">sum_values</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
</span><span id="AbstractMarkov-416"><a href="#AbstractMarkov-416"><span class="linenos"> 416</span></a>
</span><span id="AbstractMarkov-417"><a href="#AbstractMarkov-417"><span class="linenos"> 417</span></a>        <span class="k">if</span> <span class="n">strictsub</span><span class="p">:</span>
</span><span id="AbstractMarkov-418"><a href="#AbstractMarkov-418"><span class="linenos"> 418</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">sum_values</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="AbstractMarkov-419"><a href="#AbstractMarkov-419"><span class="linenos"> 419</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The sum of probabilities in </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> must be strictly less than 1 (got </span><span class="si">{</span><span class="n">sum_values</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-420"><a href="#AbstractMarkov-420"><span class="linenos"> 420</span></a>        <span class="k">elif</span> <span class="n">sub</span><span class="p">:</span>
</span><span id="AbstractMarkov-421"><a href="#AbstractMarkov-421"><span class="linenos"> 421</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">sum_values</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="AbstractMarkov-422"><a href="#AbstractMarkov-422"><span class="linenos"> 422</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The sum of probabilities in </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> must be at most 1 (got </span><span class="si">{</span><span class="n">sum_values</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-423"><a href="#AbstractMarkov-423"><span class="linenos"> 423</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AbstractMarkov-424"><a href="#AbstractMarkov-424"><span class="linenos"> 424</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">abs</span><span class="p">(</span><span class="n">sum_values</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">1e-10</span><span class="p">:</span>  <span class="c1"># Use small tolerance for floating point</span>
</span><span id="AbstractMarkov-425"><a href="#AbstractMarkov-425"><span class="linenos"> 425</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The sum of probabilities in </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> must be 1 (got </span><span class="si">{</span><span class="n">sum_values</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-426"><a href="#AbstractMarkov-426"><span class="linenos"> 426</span></a>
</span><span id="AbstractMarkov-427"><a href="#AbstractMarkov-427"><span class="linenos"> 427</span></a>    <span class="k">def</span> <span class="nf">_validate_stochastic_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">],</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">strictsub</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="AbstractMarkov-428"><a href="#AbstractMarkov-428"><span class="linenos"> 428</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-429"><a href="#AbstractMarkov-429"><span class="linenos"> 429</span></a><span class="sd">        Validate a stochastic matrix.</span>
</span><span id="AbstractMarkov-430"><a href="#AbstractMarkov-430"><span class="linenos"> 430</span></a>
</span><span id="AbstractMarkov-431"><a href="#AbstractMarkov-431"><span class="linenos"> 431</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-432"><a href="#AbstractMarkov-432"><span class="linenos"> 432</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-433"><a href="#AbstractMarkov-433"><span class="linenos"> 433</span></a><span class="sd">        values : Sequence[Sequence]</span>
</span><span id="AbstractMarkov-434"><a href="#AbstractMarkov-434"><span class="linenos"> 434</span></a><span class="sd">            The matrix of probabilities to validate</span>
</span><span id="AbstractMarkov-435"><a href="#AbstractMarkov-435"><span class="linenos"> 435</span></a><span class="sd">        var_name : str</span>
</span><span id="AbstractMarkov-436"><a href="#AbstractMarkov-436"><span class="linenos"> 436</span></a><span class="sd">            Name of the variable for error messages</span>
</span><span id="AbstractMarkov-437"><a href="#AbstractMarkov-437"><span class="linenos"> 437</span></a><span class="sd">        sub : bool</span>
</span><span id="AbstractMarkov-438"><a href="#AbstractMarkov-438"><span class="linenos"> 438</span></a><span class="sd">            If True, allow substochastic (sum &lt;= 1)</span>
</span><span id="AbstractMarkov-439"><a href="#AbstractMarkov-439"><span class="linenos"> 439</span></a><span class="sd">        strictsub : bool</span>
</span><span id="AbstractMarkov-440"><a href="#AbstractMarkov-440"><span class="linenos"> 440</span></a><span class="sd">            If True, require strict substochastic (sum &lt; 1)</span>
</span><span id="AbstractMarkov-441"><a href="#AbstractMarkov-441"><span class="linenos"> 441</span></a>
</span><span id="AbstractMarkov-442"><a href="#AbstractMarkov-442"><span class="linenos"> 442</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-443"><a href="#AbstractMarkov-443"><span class="linenos"> 443</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-444"><a href="#AbstractMarkov-444"><span class="linenos"> 444</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov-445"><a href="#AbstractMarkov-445"><span class="linenos"> 445</span></a>
</span><span id="AbstractMarkov-446"><a href="#AbstractMarkov-446"><span class="linenos"> 446</span></a><span class="sd">        Raises</span>
</span><span id="AbstractMarkov-447"><a href="#AbstractMarkov-447"><span class="linenos"> 447</span></a><span class="sd">        ------</span>
</span><span id="AbstractMarkov-448"><a href="#AbstractMarkov-448"><span class="linenos"> 448</span></a><span class="sd">        ValueError</span>
</span><span id="AbstractMarkov-449"><a href="#AbstractMarkov-449"><span class="linenos"> 449</span></a><span class="sd">            If the sum of the probabilities does not satisfy the given condition</span>
</span><span id="AbstractMarkov-450"><a href="#AbstractMarkov-450"><span class="linenos"> 450</span></a>
</span><span id="AbstractMarkov-451"><a href="#AbstractMarkov-451"><span class="linenos"> 451</span></a><span class="sd">        See Also</span>
</span><span id="AbstractMarkov-452"><a href="#AbstractMarkov-452"><span class="linenos"> 452</span></a><span class="sd">        --------</span>
</span><span id="AbstractMarkov-453"><a href="#AbstractMarkov-453"><span class="linenos"> 453</span></a><span class="sd">        _validate_stochastic_vector</span>
</span><span id="AbstractMarkov-454"><a href="#AbstractMarkov-454"><span class="linenos"> 454</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-455"><a href="#AbstractMarkov-455"><span class="linenos"> 455</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="AbstractMarkov-456"><a href="#AbstractMarkov-456"><span class="linenos"> 456</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="n">sub</span><span class="p">,</span> <span class="n">strictsub</span><span class="o">=</span><span class="n">strictsub</span><span class="p">)</span>
</span><span id="AbstractMarkov-457"><a href="#AbstractMarkov-457"><span class="linenos"> 457</span></a>
</span><span id="AbstractMarkov-458"><a href="#AbstractMarkov-458"><span class="linenos"> 458</span></a>    <span class="c1"># FUNCTIONS FOR CHECKING THE SETTING OF PARAMETERS</span>
</span><span id="AbstractMarkov-459"><a href="#AbstractMarkov-459"><span class="linenos"> 459</span></a>
</span><span id="AbstractMarkov-460"><a href="#AbstractMarkov-460"><span class="linenos"> 460</span></a>    <span class="k">def</span> <span class="nf">_check_any_var_set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="AbstractMarkov-461"><a href="#AbstractMarkov-461"><span class="linenos"> 461</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-462"><a href="#AbstractMarkov-462"><span class="linenos"> 462</span></a><span class="sd">        Check if any elements of the variable are already set (either to ML output or constant).</span>
</span><span id="AbstractMarkov-463"><a href="#AbstractMarkov-463"><span class="linenos"> 463</span></a>
</span><span id="AbstractMarkov-464"><a href="#AbstractMarkov-464"><span class="linenos"> 464</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-465"><a href="#AbstractMarkov-465"><span class="linenos"> 465</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-466"><a href="#AbstractMarkov-466"><span class="linenos"> 466</span></a><span class="sd">        var_name : str</span>
</span><span id="AbstractMarkov-467"><a href="#AbstractMarkov-467"><span class="linenos"> 467</span></a><span class="sd">            Name of the variable to check</span>
</span><span id="AbstractMarkov-468"><a href="#AbstractMarkov-468"><span class="linenos"> 468</span></a>
</span><span id="AbstractMarkov-469"><a href="#AbstractMarkov-469"><span class="linenos"> 469</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-470"><a href="#AbstractMarkov-470"><span class="linenos"> 470</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-471"><a href="#AbstractMarkov-471"><span class="linenos"> 471</span></a><span class="sd">        bool</span>
</span><span id="AbstractMarkov-472"><a href="#AbstractMarkov-472"><span class="linenos"> 472</span></a><span class="sd">            True if any elements are set, False if none are set</span>
</span><span id="AbstractMarkov-473"><a href="#AbstractMarkov-473"><span class="linenos"> 473</span></a>
</span><span id="AbstractMarkov-474"><a href="#AbstractMarkov-474"><span class="linenos"> 474</span></a><span class="sd">        Notes</span>
</span><span id="AbstractMarkov-475"><a href="#AbstractMarkov-475"><span class="linenos"> 475</span></a><span class="sd">        -----</span>
</span><span id="AbstractMarkov-476"><a href="#AbstractMarkov-476"><span class="linenos"> 476</span></a><span class="sd">        Can be used in setting functions to make sure that they have not already been set.</span>
</span><span id="AbstractMarkov-477"><a href="#AbstractMarkov-477"><span class="linenos"> 477</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-478"><a href="#AbstractMarkov-478"><span class="linenos"> 478</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="n">var_name</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="AbstractMarkov-479"><a href="#AbstractMarkov-479"><span class="linenos"> 479</span></a>            <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">var_name</span><span class="p">])</span> <span class="ow">or</span> <span class="nb">any</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">var_name</span><span class="p">])</span>
</span><span id="AbstractMarkov-480"><a href="#AbstractMarkov-480"><span class="linenos"> 480</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AbstractMarkov-481"><a href="#AbstractMarkov-481"><span class="linenos"> 481</span></a>            <span class="k">return</span> <span class="nb">any</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">)</span> <span class="ow">or</span> \
</span><span id="AbstractMarkov-482"><a href="#AbstractMarkov-482"><span class="linenos"> 482</span></a>                <span class="nb">any</span><span class="p">(</span><span class="n">item</span> <span class="k">for</span> <span class="n">sublist</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">var_name</span><span class="p">]</span> <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">sublist</span><span class="p">)</span>
</span><span id="AbstractMarkov-483"><a href="#AbstractMarkov-483"><span class="linenos"> 483</span></a>
</span><span id="AbstractMarkov-484"><a href="#AbstractMarkov-484"><span class="linenos"> 484</span></a>    <span class="c1"># FUNCTIONS TO SET PARAMETERS</span>
</span><span id="AbstractMarkov-485"><a href="#AbstractMarkov-485"><span class="linenos"> 485</span></a>    <span class="c1"># We can set them to a constant value, or to an ML output</span>
</span><span id="AbstractMarkov-486"><a href="#AbstractMarkov-486"><span class="linenos"> 486</span></a>    <span class="c1"># Can set them individually with set_to_const or set_to_ml_output</span>
</span><span id="AbstractMarkov-487"><a href="#AbstractMarkov-487"><span class="linenos"> 487</span></a>    <span class="c1"># Checks if already set to an ML output or a constant</span>
</span><span id="AbstractMarkov-488"><a href="#AbstractMarkov-488"><span class="linenos"> 488</span></a>    <span class="c1"># In subclasses, may have helper functions to e.g., set all of pi at once</span>
</span><span id="AbstractMarkov-489"><a href="#AbstractMarkov-489"><span class="linenos"> 489</span></a>
</span><span id="AbstractMarkov-490"><a href="#AbstractMarkov-490"><span class="linenos"> 490</span></a>    <span class="k">def</span> <span class="nf">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">expr</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">):</span>
</span><span id="AbstractMarkov-491"><a href="#AbstractMarkov-491"><span class="linenos"> 491</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-492"><a href="#AbstractMarkov-492"><span class="linenos"> 492</span></a><span class="sd">        Set a variable to an ML output. Checks if already has been set to an ML output or a constant.</span>
</span><span id="AbstractMarkov-493"><a href="#AbstractMarkov-493"><span class="linenos"> 493</span></a>
</span><span id="AbstractMarkov-494"><a href="#AbstractMarkov-494"><span class="linenos"> 494</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-495"><a href="#AbstractMarkov-495"><span class="linenos"> 495</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-496"><a href="#AbstractMarkov-496"><span class="linenos"> 496</span></a><span class="sd">        var : gp.Var</span>
</span><span id="AbstractMarkov-497"><a href="#AbstractMarkov-497"><span class="linenos"> 497</span></a><span class="sd">            The variable to set</span>
</span><span id="AbstractMarkov-498"><a href="#AbstractMarkov-498"><span class="linenos"> 498</span></a><span class="sd">        expr : gp.LinExpr | gp.Var</span>
</span><span id="AbstractMarkov-499"><a href="#AbstractMarkov-499"><span class="linenos"> 499</span></a><span class="sd">            The expression to set the variable to</span>
</span><span id="AbstractMarkov-500"><a href="#AbstractMarkov-500"><span class="linenos"> 500</span></a>
</span><span id="AbstractMarkov-501"><a href="#AbstractMarkov-501"><span class="linenos"> 501</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-502"><a href="#AbstractMarkov-502"><span class="linenos"> 502</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-503"><a href="#AbstractMarkov-503"><span class="linenos"> 503</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov-504"><a href="#AbstractMarkov-504"><span class="linenos"> 504</span></a>
</span><span id="AbstractMarkov-505"><a href="#AbstractMarkov-505"><span class="linenos"> 505</span></a><span class="sd">        Notes</span>
</span><span id="AbstractMarkov-506"><a href="#AbstractMarkov-506"><span class="linenos"> 506</span></a><span class="sd">        -----</span>
</span><span id="AbstractMarkov-507"><a href="#AbstractMarkov-507"><span class="linenos"> 507</span></a><span class="sd">        In practice, introduces an equality constraint to the model.</span>
</span><span id="AbstractMarkov-508"><a href="#AbstractMarkov-508"><span class="linenos"> 508</span></a>
</span><span id="AbstractMarkov-509"><a href="#AbstractMarkov-509"><span class="linenos"> 509</span></a><span class="sd">        Raises</span>
</span><span id="AbstractMarkov-510"><a href="#AbstractMarkov-510"><span class="linenos"> 510</span></a><span class="sd">        ------</span>
</span><span id="AbstractMarkov-511"><a href="#AbstractMarkov-511"><span class="linenos"> 511</span></a><span class="sd">        ValueError</span>
</span><span id="AbstractMarkov-512"><a href="#AbstractMarkov-512"><span class="linenos"> 512</span></a><span class="sd">            If unknown variable type</span>
</span><span id="AbstractMarkov-513"><a href="#AbstractMarkov-513"><span class="linenos"> 513</span></a><span class="sd">            If the variable is already set to an ML output or a constant</span>
</span><span id="AbstractMarkov-514"><a href="#AbstractMarkov-514"><span class="linenos"> 514</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-515"><a href="#AbstractMarkov-515"><span class="linenos"> 515</span></a>        <span class="n">var_name</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">VarName</span>
</span><span id="AbstractMarkov-516"><a href="#AbstractMarkov-516"><span class="linenos"> 516</span></a>        <span class="n">base_name</span> <span class="o">=</span> <span class="n">var_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Get base name (pi, P, etc.)</span>
</span><span id="AbstractMarkov-517"><a href="#AbstractMarkov-517"><span class="linenos"> 517</span></a>
</span><span id="AbstractMarkov-518"><a href="#AbstractMarkov-518"><span class="linenos"> 518</span></a>        <span class="k">if</span> <span class="n">base_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">:</span>
</span><span id="AbstractMarkov-519"><a href="#AbstractMarkov-519"><span class="linenos"> 519</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown variable type: </span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-520"><a href="#AbstractMarkov-520"><span class="linenos"> 520</span></a>
</span><span id="AbstractMarkov-521"><a href="#AbstractMarkov-521"><span class="linenos"> 521</span></a>        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_var_indices</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
</span><span id="AbstractMarkov-522"><a href="#AbstractMarkov-522"><span class="linenos"> 522</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="AbstractMarkov-523"><a href="#AbstractMarkov-523"><span class="linenos"> 523</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="n">indices</span>
</span><span id="AbstractMarkov-524"><a href="#AbstractMarkov-524"><span class="linenos"> 524</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
</span><span id="AbstractMarkov-525"><a href="#AbstractMarkov-525"><span class="linenos"> 525</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> is already set to an ML output or constant&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-526"><a href="#AbstractMarkov-526"><span class="linenos"> 526</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AbstractMarkov-527"><a href="#AbstractMarkov-527"><span class="linenos"> 527</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="AbstractMarkov-528"><a href="#AbstractMarkov-528"><span class="linenos"> 528</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">indices</span>
</span><span id="AbstractMarkov-529"><a href="#AbstractMarkov-529"><span class="linenos"> 529</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
</span><span id="AbstractMarkov-530"><a href="#AbstractMarkov-530"><span class="linenos"> 530</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> is already set to an ML output or constant&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-531"><a href="#AbstractMarkov-531"><span class="linenos"> 531</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AbstractMarkov-532"><a href="#AbstractMarkov-532"><span class="linenos"> 532</span></a>
</span><span id="AbstractMarkov-533"><a href="#AbstractMarkov-533"><span class="linenos"> 533</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">var</span> <span class="o">==</span> <span class="n">expr</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;set_to_ml_output_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-534"><a href="#AbstractMarkov-534"><span class="linenos"> 534</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="AbstractMarkov-535"><a href="#AbstractMarkov-535"><span class="linenos"> 535</span></a>
</span><span id="AbstractMarkov-536"><a href="#AbstractMarkov-536"><span class="linenos"> 536</span></a>    <span class="k">def</span> <span class="nf">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">value</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="AbstractMarkov-537"><a href="#AbstractMarkov-537"><span class="linenos"> 537</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-538"><a href="#AbstractMarkov-538"><span class="linenos"> 538</span></a><span class="sd">        Set a variable to a constant value. Checks if already has been set to a constant or an ML output.</span>
</span><span id="AbstractMarkov-539"><a href="#AbstractMarkov-539"><span class="linenos"> 539</span></a>
</span><span id="AbstractMarkov-540"><a href="#AbstractMarkov-540"><span class="linenos"> 540</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-541"><a href="#AbstractMarkov-541"><span class="linenos"> 541</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-542"><a href="#AbstractMarkov-542"><span class="linenos"> 542</span></a><span class="sd">        var : gp.Var</span>
</span><span id="AbstractMarkov-543"><a href="#AbstractMarkov-543"><span class="linenos"> 543</span></a><span class="sd">            The variable to set</span>
</span><span id="AbstractMarkov-544"><a href="#AbstractMarkov-544"><span class="linenos"> 544</span></a><span class="sd">        value : float | int</span>
</span><span id="AbstractMarkov-545"><a href="#AbstractMarkov-545"><span class="linenos"> 545</span></a><span class="sd">            The constant value to set the variable to</span>
</span><span id="AbstractMarkov-546"><a href="#AbstractMarkov-546"><span class="linenos"> 546</span></a>
</span><span id="AbstractMarkov-547"><a href="#AbstractMarkov-547"><span class="linenos"> 547</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-548"><a href="#AbstractMarkov-548"><span class="linenos"> 548</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-549"><a href="#AbstractMarkov-549"><span class="linenos"> 549</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov-550"><a href="#AbstractMarkov-550"><span class="linenos"> 550</span></a>
</span><span id="AbstractMarkov-551"><a href="#AbstractMarkov-551"><span class="linenos"> 551</span></a><span class="sd">        Notes</span>
</span><span id="AbstractMarkov-552"><a href="#AbstractMarkov-552"><span class="linenos"> 552</span></a><span class="sd">        -----</span>
</span><span id="AbstractMarkov-553"><a href="#AbstractMarkov-553"><span class="linenos"> 553</span></a><span class="sd">        In practice, introduces an equality constraint to the model and fixes</span>
</span><span id="AbstractMarkov-554"><a href="#AbstractMarkov-554"><span class="linenos"> 554</span></a><span class="sd">        upper and lower bounds of the variable to the given value.</span>
</span><span id="AbstractMarkov-555"><a href="#AbstractMarkov-555"><span class="linenos"> 555</span></a>
</span><span id="AbstractMarkov-556"><a href="#AbstractMarkov-556"><span class="linenos"> 556</span></a><span class="sd">        Raises</span>
</span><span id="AbstractMarkov-557"><a href="#AbstractMarkov-557"><span class="linenos"> 557</span></a><span class="sd">        ------</span>
</span><span id="AbstractMarkov-558"><a href="#AbstractMarkov-558"><span class="linenos"> 558</span></a><span class="sd">        ValueError</span>
</span><span id="AbstractMarkov-559"><a href="#AbstractMarkov-559"><span class="linenos"> 559</span></a><span class="sd">            If unknown variable type</span>
</span><span id="AbstractMarkov-560"><a href="#AbstractMarkov-560"><span class="linenos"> 560</span></a><span class="sd">            If the variable is already set to a constant or an ML output</span>
</span><span id="AbstractMarkov-561"><a href="#AbstractMarkov-561"><span class="linenos"> 561</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-562"><a href="#AbstractMarkov-562"><span class="linenos"> 562</span></a>
</span><span id="AbstractMarkov-563"><a href="#AbstractMarkov-563"><span class="linenos"> 563</span></a>        <span class="n">var_name</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">VarName</span>
</span><span id="AbstractMarkov-564"><a href="#AbstractMarkov-564"><span class="linenos"> 564</span></a>        <span class="n">base_name</span> <span class="o">=</span> <span class="n">var_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Get base name (pi, P, etc.)</span>
</span><span id="AbstractMarkov-565"><a href="#AbstractMarkov-565"><span class="linenos"> 565</span></a>
</span><span id="AbstractMarkov-566"><a href="#AbstractMarkov-566"><span class="linenos"> 566</span></a>        <span class="k">if</span> <span class="n">base_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">:</span>
</span><span id="AbstractMarkov-567"><a href="#AbstractMarkov-567"><span class="linenos"> 567</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown variable type: </span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-568"><a href="#AbstractMarkov-568"><span class="linenos"> 568</span></a>
</span><span id="AbstractMarkov-569"><a href="#AbstractMarkov-569"><span class="linenos"> 569</span></a>        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_var_indices</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
</span><span id="AbstractMarkov-570"><a href="#AbstractMarkov-570"><span class="linenos"> 570</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="AbstractMarkov-571"><a href="#AbstractMarkov-571"><span class="linenos"> 571</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="n">indices</span>
</span><span id="AbstractMarkov-572"><a href="#AbstractMarkov-572"><span class="linenos"> 572</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
</span><span id="AbstractMarkov-573"><a href="#AbstractMarkov-573"><span class="linenos"> 573</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> is already set to a constant or ML output&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-574"><a href="#AbstractMarkov-574"><span class="linenos"> 574</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AbstractMarkov-575"><a href="#AbstractMarkov-575"><span class="linenos"> 575</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="AbstractMarkov-576"><a href="#AbstractMarkov-576"><span class="linenos"> 576</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">indices</span>
</span><span id="AbstractMarkov-577"><a href="#AbstractMarkov-577"><span class="linenos"> 577</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
</span><span id="AbstractMarkov-578"><a href="#AbstractMarkov-578"><span class="linenos"> 578</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> is already set to a constant or ML output&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-579"><a href="#AbstractMarkov-579"><span class="linenos"> 579</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AbstractMarkov-580"><a href="#AbstractMarkov-580"><span class="linenos"> 580</span></a>
</span><span id="AbstractMarkov-581"><a href="#AbstractMarkov-581"><span class="linenos"> 581</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">var</span> <span class="o">==</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;set_to_const_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-582"><a href="#AbstractMarkov-582"><span class="linenos"> 582</span></a>        <span class="n">var</span><span class="o">.</span><span class="n">LB</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">UB</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="AbstractMarkov-583"><a href="#AbstractMarkov-583"><span class="linenos"> 583</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="AbstractMarkov-584"><a href="#AbstractMarkov-584"><span class="linenos"> 584</span></a>
</span><span id="AbstractMarkov-585"><a href="#AbstractMarkov-585"><span class="linenos"> 585</span></a>    <span class="c1"># FUNCTIONS TO SPECIFY THE FEATURE SPACE</span>
</span><span id="AbstractMarkov-586"><a href="#AbstractMarkov-586"><span class="linenos"> 586</span></a>    <span class="c1"># The feature space is a MILP-representable space of features</span>
</span><span id="AbstractMarkov-587"><a href="#AbstractMarkov-587"><span class="linenos"> 587</span></a>    <span class="c1"># We add linear constraints</span>
</span><span id="AbstractMarkov-588"><a href="#AbstractMarkov-588"><span class="linenos"> 588</span></a>    <span class="c1"># Or, we can add an auxiliary variable, to help us represent integral constraints</span>
</span><span id="AbstractMarkov-589"><a href="#AbstractMarkov-589"><span class="linenos"> 589</span></a>    <span class="c1"># This feature space is copied over when optimizing over ML outputs</span>
</span><span id="AbstractMarkov-590"><a href="#AbstractMarkov-590"><span class="linenos"> 590</span></a>    <span class="c1"># Theoretically, these two building blocks can represent any MILP-representable feature space</span>
</span><span id="AbstractMarkov-591"><a href="#AbstractMarkov-591"><span class="linenos"> 591</span></a>
</span><span id="AbstractMarkov-592"><a href="#AbstractMarkov-592"><span class="linenos"> 592</span></a>    <span class="k">def</span> <span class="nf">add_feature_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">):</span>
</span><span id="AbstractMarkov-593"><a href="#AbstractMarkov-593"><span class="linenos"> 593</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-594"><a href="#AbstractMarkov-594"><span class="linenos"> 594</span></a><span class="sd">        Add a feature constraint to the model.</span>
</span><span id="AbstractMarkov-595"><a href="#AbstractMarkov-595"><span class="linenos"> 595</span></a>
</span><span id="AbstractMarkov-596"><a href="#AbstractMarkov-596"><span class="linenos"> 596</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-597"><a href="#AbstractMarkov-597"><span class="linenos"> 597</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-598"><a href="#AbstractMarkov-598"><span class="linenos"> 598</span></a><span class="sd">        expr : gp.LinExpr</span>
</span><span id="AbstractMarkov-599"><a href="#AbstractMarkov-599"><span class="linenos"> 599</span></a><span class="sd">            The linear expression to add as a constraint</span>
</span><span id="AbstractMarkov-600"><a href="#AbstractMarkov-600"><span class="linenos"> 600</span></a>
</span><span id="AbstractMarkov-601"><a href="#AbstractMarkov-601"><span class="linenos"> 601</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-602"><a href="#AbstractMarkov-602"><span class="linenos"> 602</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-603"><a href="#AbstractMarkov-603"><span class="linenos"> 603</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov-604"><a href="#AbstractMarkov-604"><span class="linenos"> 604</span></a>
</span><span id="AbstractMarkov-605"><a href="#AbstractMarkov-605"><span class="linenos"> 605</span></a><span class="sd">        Notes</span>
</span><span id="AbstractMarkov-606"><a href="#AbstractMarkov-606"><span class="linenos"> 606</span></a><span class="sd">        -----</span>
</span><span id="AbstractMarkov-607"><a href="#AbstractMarkov-607"><span class="linenos"> 607</span></a><span class="sd">        Adds the constraint to the model and also stores it in self.feature_constraints.</span>
</span><span id="AbstractMarkov-608"><a href="#AbstractMarkov-608"><span class="linenos"> 608</span></a><span class="sd">        Constraints that are added here are also copied over when optimizing over ML outputs.</span>
</span><span id="AbstractMarkov-609"><a href="#AbstractMarkov-609"><span class="linenos"> 609</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-610"><a href="#AbstractMarkov-610"><span class="linenos"> 610</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>
</span><span id="AbstractMarkov-611"><a href="#AbstractMarkov-611"><span class="linenos"> 611</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="AbstractMarkov-612"><a href="#AbstractMarkov-612"><span class="linenos"> 612</span></a>
</span><span id="AbstractMarkov-613"><a href="#AbstractMarkov-613"><span class="linenos"> 613</span></a>    <span class="k">def</span> <span class="nf">add_feature_aux_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="AbstractMarkov-614"><a href="#AbstractMarkov-614"><span class="linenos"> 614</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-615"><a href="#AbstractMarkov-615"><span class="linenos"> 615</span></a><span class="sd">        Add a feature auxiliary variable to the model.</span>
</span><span id="AbstractMarkov-616"><a href="#AbstractMarkov-616"><span class="linenos"> 616</span></a>
</span><span id="AbstractMarkov-617"><a href="#AbstractMarkov-617"><span class="linenos"> 617</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-618"><a href="#AbstractMarkov-618"><span class="linenos"> 618</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-619"><a href="#AbstractMarkov-619"><span class="linenos"> 619</span></a><span class="sd">        *args : tuple</span>
</span><span id="AbstractMarkov-620"><a href="#AbstractMarkov-620"><span class="linenos"> 620</span></a><span class="sd">            Arguments to pass to self.model.addVar</span>
</span><span id="AbstractMarkov-621"><a href="#AbstractMarkov-621"><span class="linenos"> 621</span></a><span class="sd">        **kwargs : dict</span>
</span><span id="AbstractMarkov-622"><a href="#AbstractMarkov-622"><span class="linenos"> 622</span></a><span class="sd">            Keyword arguments to pass to self.model.addVar</span>
</span><span id="AbstractMarkov-623"><a href="#AbstractMarkov-623"><span class="linenos"> 623</span></a>
</span><span id="AbstractMarkov-624"><a href="#AbstractMarkov-624"><span class="linenos"> 624</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-625"><a href="#AbstractMarkov-625"><span class="linenos"> 625</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-626"><a href="#AbstractMarkov-626"><span class="linenos"> 626</span></a><span class="sd">        gp.Var</span>
</span><span id="AbstractMarkov-627"><a href="#AbstractMarkov-627"><span class="linenos"> 627</span></a><span class="sd">            The auxiliary variable added to the model</span>
</span><span id="AbstractMarkov-628"><a href="#AbstractMarkov-628"><span class="linenos"> 628</span></a>
</span><span id="AbstractMarkov-629"><a href="#AbstractMarkov-629"><span class="linenos"> 629</span></a><span class="sd">        Notes</span>
</span><span id="AbstractMarkov-630"><a href="#AbstractMarkov-630"><span class="linenos"> 630</span></a><span class="sd">        -----</span>
</span><span id="AbstractMarkov-631"><a href="#AbstractMarkov-631"><span class="linenos"> 631</span></a><span class="sd">        Adds a variable to the model and stores it in self.feature_aux. Variables</span>
</span><span id="AbstractMarkov-632"><a href="#AbstractMarkov-632"><span class="linenos"> 632</span></a><span class="sd">        added here are also copied over when optimizing over ML outputs. Arguments</span>
</span><span id="AbstractMarkov-633"><a href="#AbstractMarkov-633"><span class="linenos"> 633</span></a><span class="sd">        are passed to Gurobi&#39;s addVar function, so can specify variable types, bounds,</span>
</span><span id="AbstractMarkov-634"><a href="#AbstractMarkov-634"><span class="linenos"> 634</span></a><span class="sd">        etc. Hence, can encode arbitrary MILP constraints by adding integer auxiliary</span>
</span><span id="AbstractMarkov-635"><a href="#AbstractMarkov-635"><span class="linenos"> 635</span></a><span class="sd">        variables.</span>
</span><span id="AbstractMarkov-636"><a href="#AbstractMarkov-636"><span class="linenos"> 636</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-637"><a href="#AbstractMarkov-637"><span class="linenos"> 637</span></a>        <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="AbstractMarkov-638"><a href="#AbstractMarkov-638"><span class="linenos"> 638</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
</span><span id="AbstractMarkov-639"><a href="#AbstractMarkov-639"><span class="linenos"> 639</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="AbstractMarkov-640"><a href="#AbstractMarkov-640"><span class="linenos"> 640</span></a>        <span class="k">return</span> <span class="n">var</span>
</span><span id="AbstractMarkov-641"><a href="#AbstractMarkov-641"><span class="linenos"> 641</span></a>
</span><span id="AbstractMarkov-642"><a href="#AbstractMarkov-642"><span class="linenos"> 642</span></a>    <span class="c1"># FUNCTIONS TO ADD CONSTRAINTS TO THE MRP</span>
</span><span id="AbstractMarkov-643"><a href="#AbstractMarkov-643"><span class="linenos"> 643</span></a>    <span class="c1"># For example, inequalities on pi, P, r</span>
</span><span id="AbstractMarkov-644"><a href="#AbstractMarkov-644"><span class="linenos"> 644</span></a>    <span class="c1"># They are only added to the overall model, not to the submodels</span>
</span><span id="AbstractMarkov-645"><a href="#AbstractMarkov-645"><span class="linenos"> 645</span></a>
</span><span id="AbstractMarkov-646"><a href="#AbstractMarkov-646"><span class="linenos"> 646</span></a>    <span class="k">def</span> <span class="nf">add_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constr</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">Constr</span><span class="p">):</span>
</span><span id="AbstractMarkov-647"><a href="#AbstractMarkov-647"><span class="linenos"> 647</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-648"><a href="#AbstractMarkov-648"><span class="linenos"> 648</span></a><span class="sd">        Add an inequality to the overall model.</span>
</span><span id="AbstractMarkov-649"><a href="#AbstractMarkov-649"><span class="linenos"> 649</span></a><span class="sd">        Could just call self.model.addConstr(constr), but this is a wrapper for clarity.</span>
</span><span id="AbstractMarkov-650"><a href="#AbstractMarkov-650"><span class="linenos"> 650</span></a>
</span><span id="AbstractMarkov-651"><a href="#AbstractMarkov-651"><span class="linenos"> 651</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-652"><a href="#AbstractMarkov-652"><span class="linenos"> 652</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-653"><a href="#AbstractMarkov-653"><span class="linenos"> 653</span></a><span class="sd">        constr : gp.Constr</span>
</span><span id="AbstractMarkov-654"><a href="#AbstractMarkov-654"><span class="linenos"> 654</span></a><span class="sd">            The constraint to add</span>
</span><span id="AbstractMarkov-655"><a href="#AbstractMarkov-655"><span class="linenos"> 655</span></a>
</span><span id="AbstractMarkov-656"><a href="#AbstractMarkov-656"><span class="linenos"> 656</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-657"><a href="#AbstractMarkov-657"><span class="linenos"> 657</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-658"><a href="#AbstractMarkov-658"><span class="linenos"> 658</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov-659"><a href="#AbstractMarkov-659"><span class="linenos"> 659</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-660"><a href="#AbstractMarkov-660"><span class="linenos"> 660</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
</span><span id="AbstractMarkov-661"><a href="#AbstractMarkov-661"><span class="linenos"> 661</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="AbstractMarkov-662"><a href="#AbstractMarkov-662"><span class="linenos"> 662</span></a>
</span><span id="AbstractMarkov-663"><a href="#AbstractMarkov-663"><span class="linenos"> 663</span></a>    <span class="c1"># FUNCTIONS TO ADD THE ML MODELS</span>
</span><span id="AbstractMarkov-664"><a href="#AbstractMarkov-664"><span class="linenos"> 664</span></a>    <span class="c1"># Can add ML models to the MRP, which creates variables for the ML outputs</span>
</span><span id="AbstractMarkov-665"><a href="#AbstractMarkov-665"><span class="linenos"> 665</span></a>    <span class="c1"># These can then be used to specify the params</span>
</span><span id="AbstractMarkov-666"><a href="#AbstractMarkov-666"><span class="linenos"> 666</span></a>    <span class="c1"># To see supported models, see the _ml_model_registry dictionary</span>
</span><span id="AbstractMarkov-667"><a href="#AbstractMarkov-667"><span class="linenos"> 667</span></a>
</span><span id="AbstractMarkov-668"><a href="#AbstractMarkov-668"><span class="linenos"> 668</span></a>    <span class="k">def</span> <span class="nf">add_ml_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ml_model</span> <span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="AbstractMarkov-669"><a href="#AbstractMarkov-669"><span class="linenos"> 669</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-670"><a href="#AbstractMarkov-670"><span class="linenos"> 670</span></a><span class="sd">        Add an ML model to the Markov process. Computes the constraints linking</span>
</span><span id="AbstractMarkov-671"><a href="#AbstractMarkov-671"><span class="linenos"> 671</span></a><span class="sd">        the ML outputs to the features, and creates variables for the ML outputs.</span>
</span><span id="AbstractMarkov-672"><a href="#AbstractMarkov-672"><span class="linenos"> 672</span></a><span class="sd">        ML outputs can then be accessed using self.ml_outputs.</span>
</span><span id="AbstractMarkov-673"><a href="#AbstractMarkov-673"><span class="linenos"> 673</span></a>
</span><span id="AbstractMarkov-674"><a href="#AbstractMarkov-674"><span class="linenos"> 674</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-675"><a href="#AbstractMarkov-675"><span class="linenos"> 675</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-676"><a href="#AbstractMarkov-676"><span class="linenos"> 676</span></a><span class="sd">        ml_model : Any</span>
</span><span id="AbstractMarkov-677"><a href="#AbstractMarkov-677"><span class="linenos"> 677</span></a><span class="sd">            The ML model to add</span>
</span><span id="AbstractMarkov-678"><a href="#AbstractMarkov-678"><span class="linenos"> 678</span></a>
</span><span id="AbstractMarkov-679"><a href="#AbstractMarkov-679"><span class="linenos"> 679</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-680"><a href="#AbstractMarkov-680"><span class="linenos"> 680</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-681"><a href="#AbstractMarkov-681"><span class="linenos"> 681</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov-682"><a href="#AbstractMarkov-682"><span class="linenos"> 682</span></a>
</span><span id="AbstractMarkov-683"><a href="#AbstractMarkov-683"><span class="linenos"> 683</span></a><span class="sd">        Raises</span>
</span><span id="AbstractMarkov-684"><a href="#AbstractMarkov-684"><span class="linenos"> 684</span></a><span class="sd">        ------</span>
</span><span id="AbstractMarkov-685"><a href="#AbstractMarkov-685"><span class="linenos"> 685</span></a><span class="sd">        ValueError</span>
</span><span id="AbstractMarkov-686"><a href="#AbstractMarkov-686"><span class="linenos"> 686</span></a><span class="sd">            If the ML model type is not supported</span>
</span><span id="AbstractMarkov-687"><a href="#AbstractMarkov-687"><span class="linenos"> 687</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-688"><a href="#AbstractMarkov-688"><span class="linenos"> 688</span></a>        <span class="c1"># Find matching model type in registry</span>
</span><span id="AbstractMarkov-689"><a href="#AbstractMarkov-689"><span class="linenos"> 689</span></a>        <span class="k">for</span> <span class="n">model_types</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_model_registry</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AbstractMarkov-690"><a href="#AbstractMarkov-690"><span class="linenos"> 690</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ml_model</span><span class="p">,</span> <span class="n">model_types</span><span class="p">):</span>
</span><span id="AbstractMarkov-691"><a href="#AbstractMarkov-691"><span class="linenos"> 691</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ml_models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ml_model</span><span class="p">)</span>
</span><span id="AbstractMarkov-692"><a href="#AbstractMarkov-692"><span class="linenos"> 692</span></a>
</span><span id="AbstractMarkov-693"><a href="#AbstractMarkov-693"><span class="linenos"> 693</span></a>                <span class="c1"># Create output variables based on model type</span>
</span><span id="AbstractMarkov-694"><a href="#AbstractMarkov-694"><span class="linenos"> 694</span></a>                <span class="n">n_outputs</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;get_n_outputs&#39;</span><span class="p">](</span><span class="n">ml_model</span><span class="p">)</span>
</span><span id="AbstractMarkov-695"><a href="#AbstractMarkov-695"><span class="linenos"> 695</span></a>                <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;bounds&#39;</span><span class="p">]</span>
</span><span id="AbstractMarkov-696"><a href="#AbstractMarkov-696"><span class="linenos"> 696</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="AbstractMarkov-697"><a href="#AbstractMarkov-697"><span class="linenos"> 697</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="AbstractMarkov-698"><a href="#AbstractMarkov-698"><span class="linenos"> 698</span></a>                        <span class="n">n_outputs</span><span class="p">,</span>
</span><span id="AbstractMarkov-699"><a href="#AbstractMarkov-699"><span class="linenos"> 699</span></a>                        <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ml_outputs_</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AbstractMarkov-700"><a href="#AbstractMarkov-700"><span class="linenos"> 700</span></a>                        <span class="n">lb</span><span class="o">=</span><span class="n">lb</span><span class="p">,</span>
</span><span id="AbstractMarkov-701"><a href="#AbstractMarkov-701"><span class="linenos"> 701</span></a>                        <span class="n">ub</span><span class="o">=</span><span class="n">ub</span><span class="p">,</span>
</span><span id="AbstractMarkov-702"><a href="#AbstractMarkov-702"><span class="linenos"> 702</span></a>                        <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="AbstractMarkov-703"><a href="#AbstractMarkov-703"><span class="linenos"> 703</span></a>                    <span class="p">)</span>
</span><span id="AbstractMarkov-704"><a href="#AbstractMarkov-704"><span class="linenos"> 704</span></a>                <span class="p">)</span>
</span><span id="AbstractMarkov-705"><a href="#AbstractMarkov-705"><span class="linenos"> 705</span></a>
</span><span id="AbstractMarkov-706"><a href="#AbstractMarkov-706"><span class="linenos"> 706</span></a>                <span class="c1"># Add constraints using registered method</span>
</span><span id="AbstractMarkov-707"><a href="#AbstractMarkov-707"><span class="linenos"> 707</span></a>                <span class="n">config</span><span class="p">[</span><span class="s1">&#39;constraint_method&#39;</span><span class="p">](</span>
</span><span id="AbstractMarkov-708"><a href="#AbstractMarkov-708"><span class="linenos"> 708</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="AbstractMarkov-709"><a href="#AbstractMarkov-709"><span class="linenos"> 709</span></a>                    <span class="n">ml_model</span><span class="p">,</span>
</span><span id="AbstractMarkov-710"><a href="#AbstractMarkov-710"><span class="linenos"> 710</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span>
</span><span id="AbstractMarkov-711"><a href="#AbstractMarkov-711"><span class="linenos"> 711</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="AbstractMarkov-712"><a href="#AbstractMarkov-712"><span class="linenos"> 712</span></a>                <span class="p">)</span>
</span><span id="AbstractMarkov-713"><a href="#AbstractMarkov-713"><span class="linenos"> 713</span></a>
</span><span id="AbstractMarkov-714"><a href="#AbstractMarkov-714"><span class="linenos"> 714</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="AbstractMarkov-715"><a href="#AbstractMarkov-715"><span class="linenos"> 715</span></a>                <span class="k">return</span>
</span><span id="AbstractMarkov-716"><a href="#AbstractMarkov-716"><span class="linenos"> 716</span></a>
</span><span id="AbstractMarkov-717"><a href="#AbstractMarkov-717"><span class="linenos"> 717</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported ML model type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">ml_model</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-718"><a href="#AbstractMarkov-718"><span class="linenos"> 718</span></a>
</span><span id="AbstractMarkov-719"><a href="#AbstractMarkov-719"><span class="linenos"> 719</span></a>    <span class="c1"># FUNCTIONS TO OPTIMIZE THE PROBLEM</span>
</span><span id="AbstractMarkov-720"><a href="#AbstractMarkov-720"><span class="linenos"> 720</span></a>
</span><span id="AbstractMarkov-721"><a href="#AbstractMarkov-721"><span class="linenos"> 721</span></a>    <span class="k">def</span> <span class="nf">optimize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_decomp</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sense</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">verbose</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gurobi_params</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AbstractMarkov-722"><a href="#AbstractMarkov-722"><span class="linenos"> 722</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-723"><a href="#AbstractMarkov-723"><span class="linenos"> 723</span></a><span class="sd">        Public interface for optimizing the problem.</span>
</span><span id="AbstractMarkov-724"><a href="#AbstractMarkov-724"><span class="linenos"> 724</span></a><span class="sd">        If use_decomp is True, we use the decomposition and bound propagation approach.</span>
</span><span id="AbstractMarkov-725"><a href="#AbstractMarkov-725"><span class="linenos"> 725</span></a><span class="sd">        Can also set the sense, verbosity, and additional Gurobi parameters if needed.</span>
</span><span id="AbstractMarkov-726"><a href="#AbstractMarkov-726"><span class="linenos"> 726</span></a>
</span><span id="AbstractMarkov-727"><a href="#AbstractMarkov-727"><span class="linenos"> 727</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-728"><a href="#AbstractMarkov-728"><span class="linenos"> 728</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-729"><a href="#AbstractMarkov-729"><span class="linenos"> 729</span></a><span class="sd">        use_decomp : bool (default=True)</span>
</span><span id="AbstractMarkov-730"><a href="#AbstractMarkov-730"><span class="linenos"> 730</span></a><span class="sd">            Whether to use the decomposition and bound propagation approach</span>
</span><span id="AbstractMarkov-731"><a href="#AbstractMarkov-731"><span class="linenos"> 731</span></a><span class="sd">        sense : str (default=&quot;max&quot;)</span>
</span><span id="AbstractMarkov-732"><a href="#AbstractMarkov-732"><span class="linenos"> 732</span></a><span class="sd">            The sense of the optimization problem, either &quot;max&quot; or &quot;min&quot;</span>
</span><span id="AbstractMarkov-733"><a href="#AbstractMarkov-733"><span class="linenos"> 733</span></a><span class="sd">        verbose : bool (default=False)</span>
</span><span id="AbstractMarkov-734"><a href="#AbstractMarkov-734"><span class="linenos"> 734</span></a><span class="sd">            Whether to print Gurobi output</span>
</span><span id="AbstractMarkov-735"><a href="#AbstractMarkov-735"><span class="linenos"> 735</span></a><span class="sd">        gurobi_params : dict (default=None)</span>
</span><span id="AbstractMarkov-736"><a href="#AbstractMarkov-736"><span class="linenos"> 736</span></a><span class="sd">            Additional Gurobi parameters to set, e.g., {&#39;TimeLimit&#39;: 60}</span>
</span><span id="AbstractMarkov-737"><a href="#AbstractMarkov-737"><span class="linenos"> 737</span></a>
</span><span id="AbstractMarkov-738"><a href="#AbstractMarkov-738"><span class="linenos"> 738</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-739"><a href="#AbstractMarkov-739"><span class="linenos"> 739</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-740"><a href="#AbstractMarkov-740"><span class="linenos"> 740</span></a><span class="sd">        dict</span>
</span><span id="AbstractMarkov-741"><a href="#AbstractMarkov-741"><span class="linenos"> 741</span></a><span class="sd">            A dictionary containing the optimization result. Possible formats:</span>
</span><span id="AbstractMarkov-742"><a href="#AbstractMarkov-742"><span class="linenos"> 742</span></a>
</span><span id="AbstractMarkov-743"><a href="#AbstractMarkov-743"><span class="linenos"> 743</span></a><span class="sd">            For optimal/suboptimal solutions:</span>
</span><span id="AbstractMarkov-744"><a href="#AbstractMarkov-744"><span class="linenos"> 744</span></a><span class="sd">            {</span>
</span><span id="AbstractMarkov-745"><a href="#AbstractMarkov-745"><span class="linenos"> 745</span></a><span class="sd">                &#39;status&#39;: str, either &#39;optimal&#39; or &#39;suboptimal&#39;,</span>
</span><span id="AbstractMarkov-746"><a href="#AbstractMarkov-746"><span class="linenos"> 746</span></a><span class="sd">                &#39;objective&#39;: float, the objective value,</span>
</span><span id="AbstractMarkov-747"><a href="#AbstractMarkov-747"><span class="linenos"> 747</span></a><span class="sd">                &#39;values&#39;: dict, the values of the variables</span>
</span><span id="AbstractMarkov-748"><a href="#AbstractMarkov-748"><span class="linenos"> 748</span></a><span class="sd">            }</span>
</span><span id="AbstractMarkov-749"><a href="#AbstractMarkov-749"><span class="linenos"> 749</span></a>
</span><span id="AbstractMarkov-750"><a href="#AbstractMarkov-750"><span class="linenos"> 750</span></a><span class="sd">            For infeasible/unbounded problems:</span>
</span><span id="AbstractMarkov-751"><a href="#AbstractMarkov-751"><span class="linenos"> 751</span></a><span class="sd">            {</span>
</span><span id="AbstractMarkov-752"><a href="#AbstractMarkov-752"><span class="linenos"> 752</span></a><span class="sd">                &#39;status&#39;: str, either &#39;infeasible&#39; or &#39;unbounded&#39;,</span>
</span><span id="AbstractMarkov-753"><a href="#AbstractMarkov-753"><span class="linenos"> 753</span></a><span class="sd">                &#39;message&#39;: str, description of the problem</span>
</span><span id="AbstractMarkov-754"><a href="#AbstractMarkov-754"><span class="linenos"> 754</span></a><span class="sd">            }</span>
</span><span id="AbstractMarkov-755"><a href="#AbstractMarkov-755"><span class="linenos"> 755</span></a>
</span><span id="AbstractMarkov-756"><a href="#AbstractMarkov-756"><span class="linenos"> 756</span></a><span class="sd">            For other errors:</span>
</span><span id="AbstractMarkov-757"><a href="#AbstractMarkov-757"><span class="linenos"> 757</span></a><span class="sd">            {</span>
</span><span id="AbstractMarkov-758"><a href="#AbstractMarkov-758"><span class="linenos"> 758</span></a><span class="sd">                &#39;status&#39;: &#39;error&#39;,</span>
</span><span id="AbstractMarkov-759"><a href="#AbstractMarkov-759"><span class="linenos"> 759</span></a><span class="sd">                &#39;message&#39;: str, error description with status code</span>
</span><span id="AbstractMarkov-760"><a href="#AbstractMarkov-760"><span class="linenos"> 760</span></a><span class="sd">            }</span>
</span><span id="AbstractMarkov-761"><a href="#AbstractMarkov-761"><span class="linenos"> 761</span></a>
</span><span id="AbstractMarkov-762"><a href="#AbstractMarkov-762"><span class="linenos"> 762</span></a><span class="sd">        Notes</span>
</span><span id="AbstractMarkov-763"><a href="#AbstractMarkov-763"><span class="linenos"> 763</span></a><span class="sd">        -----</span>
</span><span id="AbstractMarkov-764"><a href="#AbstractMarkov-764"><span class="linenos"> 764</span></a><span class="sd">        First checks if all required variables are set, then implements the decomposition</span>
</span><span id="AbstractMarkov-765"><a href="#AbstractMarkov-765"><span class="linenos"> 765</span></a><span class="sd">        and bound propagation approach, and lastly solves the bilinear program.</span>
</span><span id="AbstractMarkov-766"><a href="#AbstractMarkov-766"><span class="linenos"> 766</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-767"><a href="#AbstractMarkov-767"><span class="linenos"> 767</span></a>        <span class="c1"># Check if all required variables are set</span>
</span><span id="AbstractMarkov-768"><a href="#AbstractMarkov-768"><span class="linenos"> 768</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_all_vars_set</span><span class="p">()</span>
</span><span id="AbstractMarkov-769"><a href="#AbstractMarkov-769"><span class="linenos"> 769</span></a>
</span><span id="AbstractMarkov-770"><a href="#AbstractMarkov-770"><span class="linenos"> 770</span></a>        <span class="k">if</span> <span class="n">use_decomp</span><span class="p">:</span>
</span><span id="AbstractMarkov-771"><a href="#AbstractMarkov-771"><span class="linenos"> 771</span></a>            <span class="c1"># Step 1: ML bounds</span>
</span><span id="AbstractMarkov-772"><a href="#AbstractMarkov-772"><span class="linenos"> 772</span></a>            <span class="n">ml_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_ml_bounds</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="AbstractMarkov-773"><a href="#AbstractMarkov-773"><span class="linenos"> 773</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_ml_bounds</span><span class="p">(</span><span class="n">ml_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov-774"><a href="#AbstractMarkov-774"><span class="linenos"> 774</span></a>
</span><span id="AbstractMarkov-775"><a href="#AbstractMarkov-775"><span class="linenos"> 775</span></a>            <span class="c1"># Step 2: Parameter bounds from affine relationships</span>
</span><span id="AbstractMarkov-776"><a href="#AbstractMarkov-776"><span class="linenos"> 776</span></a>            <span class="n">affine_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_affine_bounds</span><span class="p">(</span><span class="n">ml_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov-777"><a href="#AbstractMarkov-777"><span class="linenos"> 777</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_affine_bounds</span><span class="p">(</span><span class="n">affine_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov-778"><a href="#AbstractMarkov-778"><span class="linenos"> 778</span></a>
</span><span id="AbstractMarkov-779"><a href="#AbstractMarkov-779"><span class="linenos"> 779</span></a>            <span class="c1"># Step 3: Initial value vector bounds</span>
</span><span id="AbstractMarkov-780"><a href="#AbstractMarkov-780"><span class="linenos"> 780</span></a>            <span class="n">initial_v_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_initial_v_bounds</span><span class="p">()</span>
</span><span id="AbstractMarkov-781"><a href="#AbstractMarkov-781"><span class="linenos"> 781</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_initial_v_bounds</span><span class="p">(</span><span class="n">initial_v_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov-782"><a href="#AbstractMarkov-782"><span class="linenos"> 782</span></a>
</span><span id="AbstractMarkov-783"><a href="#AbstractMarkov-783"><span class="linenos"> 783</span></a>            <span class="c1"># Step 4: Tightened value vector bounds</span>
</span><span id="AbstractMarkov-784"><a href="#AbstractMarkov-784"><span class="linenos"> 784</span></a>            <span class="n">tightened_v_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_tightened_v_bounds</span><span class="p">()</span>
</span><span id="AbstractMarkov-785"><a href="#AbstractMarkov-785"><span class="linenos"> 785</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_tightened_v_bounds</span><span class="p">(</span><span class="n">tightened_v_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov-786"><a href="#AbstractMarkov-786"><span class="linenos"> 786</span></a>
</span><span id="AbstractMarkov-787"><a href="#AbstractMarkov-787"><span class="linenos"> 787</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize</span><span class="p">(</span><span class="n">sense</span><span class="o">=</span><span class="n">sense</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">gurobi_params</span><span class="o">=</span><span class="n">gurobi_params</span><span class="p">)</span>
</span><span id="AbstractMarkov-788"><a href="#AbstractMarkov-788"><span class="linenos"> 788</span></a>
</span><span id="AbstractMarkov-789"><a href="#AbstractMarkov-789"><span class="linenos"> 789</span></a>    <span class="k">def</span> <span class="nf">find_feasible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ub</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">use_decomp</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gurobi_params</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AbstractMarkov-790"><a href="#AbstractMarkov-790"><span class="linenos"> 790</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-791"><a href="#AbstractMarkov-791"><span class="linenos"> 791</span></a><span class="sd">        Public interface for finding a feasible solution to the problem.</span>
</span><span id="AbstractMarkov-792"><a href="#AbstractMarkov-792"><span class="linenos"> 792</span></a><span class="sd">        It finds a feasible feature vector.</span>
</span><span id="AbstractMarkov-793"><a href="#AbstractMarkov-793"><span class="linenos"> 793</span></a>
</span><span id="AbstractMarkov-794"><a href="#AbstractMarkov-794"><span class="linenos"> 794</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-795"><a href="#AbstractMarkov-795"><span class="linenos"> 795</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-796"><a href="#AbstractMarkov-796"><span class="linenos"> 796</span></a><span class="sd">        lb : float | int | None (default=None)</span>
</span><span id="AbstractMarkov-797"><a href="#AbstractMarkov-797"><span class="linenos"> 797</span></a><span class="sd">            The lower bound on the feature vector. None means -inf.</span>
</span><span id="AbstractMarkov-798"><a href="#AbstractMarkov-798"><span class="linenos"> 798</span></a><span class="sd">        ub : float | int | None (default=None)</span>
</span><span id="AbstractMarkov-799"><a href="#AbstractMarkov-799"><span class="linenos"> 799</span></a><span class="sd">            The upper bound on the feature vector. None means inf.</span>
</span><span id="AbstractMarkov-800"><a href="#AbstractMarkov-800"><span class="linenos"> 800</span></a><span class="sd">        use_decomp : bool (default=True)</span>
</span><span id="AbstractMarkov-801"><a href="#AbstractMarkov-801"><span class="linenos"> 801</span></a><span class="sd">            Whether to use the decomposition and bound propagation approach</span>
</span><span id="AbstractMarkov-802"><a href="#AbstractMarkov-802"><span class="linenos"> 802</span></a><span class="sd">        verbose : bool (default=False)</span>
</span><span id="AbstractMarkov-803"><a href="#AbstractMarkov-803"><span class="linenos"> 803</span></a><span class="sd">            Whether to print Gurobi output</span>
</span><span id="AbstractMarkov-804"><a href="#AbstractMarkov-804"><span class="linenos"> 804</span></a><span class="sd">        gurobi_params : dict (default=None)</span>
</span><span id="AbstractMarkov-805"><a href="#AbstractMarkov-805"><span class="linenos"> 805</span></a><span class="sd">            Additional Gurobi parameters to set, e.g., {&#39;TimeLimit&#39;: 60}</span>
</span><span id="AbstractMarkov-806"><a href="#AbstractMarkov-806"><span class="linenos"> 806</span></a>
</span><span id="AbstractMarkov-807"><a href="#AbstractMarkov-807"><span class="linenos"> 807</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-808"><a href="#AbstractMarkov-808"><span class="linenos"> 808</span></a>
</span><span id="AbstractMarkov-809"><a href="#AbstractMarkov-809"><span class="linenos"> 809</span></a><span class="sd">        dict</span>
</span><span id="AbstractMarkov-810"><a href="#AbstractMarkov-810"><span class="linenos"> 810</span></a><span class="sd">            A dictionary containing the feasibility result. Possible formats:</span>
</span><span id="AbstractMarkov-811"><a href="#AbstractMarkov-811"><span class="linenos"> 811</span></a>
</span><span id="AbstractMarkov-812"><a href="#AbstractMarkov-812"><span class="linenos"> 812</span></a><span class="sd">            For feasible solutions:</span>
</span><span id="AbstractMarkov-813"><a href="#AbstractMarkov-813"><span class="linenos"> 813</span></a><span class="sd">            {</span>
</span><span id="AbstractMarkov-814"><a href="#AbstractMarkov-814"><span class="linenos"> 814</span></a><span class="sd">                &#39;status&#39;: &#39;feasible&#39;,</span>
</span><span id="AbstractMarkov-815"><a href="#AbstractMarkov-815"><span class="linenos"> 815</span></a><span class="sd">                &#39;values&#39;: dict, the values of the variables</span>
</span><span id="AbstractMarkov-816"><a href="#AbstractMarkov-816"><span class="linenos"> 816</span></a><span class="sd">            }</span>
</span><span id="AbstractMarkov-817"><a href="#AbstractMarkov-817"><span class="linenos"> 817</span></a>
</span><span id="AbstractMarkov-818"><a href="#AbstractMarkov-818"><span class="linenos"> 818</span></a><span class="sd">            For infeasible/unbounded problems:</span>
</span><span id="AbstractMarkov-819"><a href="#AbstractMarkov-819"><span class="linenos"> 819</span></a><span class="sd">            {</span>
</span><span id="AbstractMarkov-820"><a href="#AbstractMarkov-820"><span class="linenos"> 820</span></a><span class="sd">                &#39;status&#39;: str, either &#39;infeasible&#39; or &#39;unbounded&#39;,</span>
</span><span id="AbstractMarkov-821"><a href="#AbstractMarkov-821"><span class="linenos"> 821</span></a><span class="sd">                &#39;message&#39;: str, description of the problem</span>
</span><span id="AbstractMarkov-822"><a href="#AbstractMarkov-822"><span class="linenos"> 822</span></a><span class="sd">            }</span>
</span><span id="AbstractMarkov-823"><a href="#AbstractMarkov-823"><span class="linenos"> 823</span></a>
</span><span id="AbstractMarkov-824"><a href="#AbstractMarkov-824"><span class="linenos"> 824</span></a><span class="sd">            For other errors:</span>
</span><span id="AbstractMarkov-825"><a href="#AbstractMarkov-825"><span class="linenos"> 825</span></a><span class="sd">            {</span>
</span><span id="AbstractMarkov-826"><a href="#AbstractMarkov-826"><span class="linenos"> 826</span></a><span class="sd">                &#39;status&#39;: &#39;error&#39;,</span>
</span><span id="AbstractMarkov-827"><a href="#AbstractMarkov-827"><span class="linenos"> 827</span></a><span class="sd">                &#39;message&#39;: str, error description with status code</span>
</span><span id="AbstractMarkov-828"><a href="#AbstractMarkov-828"><span class="linenos"> 828</span></a><span class="sd">            }</span>
</span><span id="AbstractMarkov-829"><a href="#AbstractMarkov-829"><span class="linenos"> 829</span></a>
</span><span id="AbstractMarkov-830"><a href="#AbstractMarkov-830"><span class="linenos"> 830</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-831"><a href="#AbstractMarkov-831"><span class="linenos"> 831</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_all_vars_set</span><span class="p">()</span>
</span><span id="AbstractMarkov-832"><a href="#AbstractMarkov-832"><span class="linenos"> 832</span></a>
</span><span id="AbstractMarkov-833"><a href="#AbstractMarkov-833"><span class="linenos"> 833</span></a>        <span class="k">if</span> <span class="n">lb</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ub</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AbstractMarkov-834"><a href="#AbstractMarkov-834"><span class="linenos"> 834</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must specify at least one bound&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-835"><a href="#AbstractMarkov-835"><span class="linenos"> 835</span></a>        <span class="k">if</span> <span class="n">lb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ub</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AbstractMarkov-836"><a href="#AbstractMarkov-836"><span class="linenos"> 836</span></a>            <span class="k">if</span> <span class="n">lb</span> <span class="o">&gt;</span> <span class="n">ub</span><span class="p">:</span>
</span><span id="AbstractMarkov-837"><a href="#AbstractMarkov-837"><span class="linenos"> 837</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Lower bound must be less than upper bound&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-838"><a href="#AbstractMarkov-838"><span class="linenos"> 838</span></a>
</span><span id="AbstractMarkov-839"><a href="#AbstractMarkov-839"><span class="linenos"> 839</span></a>        <span class="k">if</span> <span class="n">use_decomp</span><span class="p">:</span>
</span><span id="AbstractMarkov-840"><a href="#AbstractMarkov-840"><span class="linenos"> 840</span></a>            <span class="c1"># Step 1: ML bounds</span>
</span><span id="AbstractMarkov-841"><a href="#AbstractMarkov-841"><span class="linenos"> 841</span></a>            <span class="n">ml_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_ml_bounds</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="AbstractMarkov-842"><a href="#AbstractMarkov-842"><span class="linenos"> 842</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_ml_bounds</span><span class="p">(</span><span class="n">ml_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov-843"><a href="#AbstractMarkov-843"><span class="linenos"> 843</span></a>
</span><span id="AbstractMarkov-844"><a href="#AbstractMarkov-844"><span class="linenos"> 844</span></a>            <span class="c1"># Step 2: Parameter bounds from affine relationships</span>
</span><span id="AbstractMarkov-845"><a href="#AbstractMarkov-845"><span class="linenos"> 845</span></a>            <span class="n">affine_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_affine_bounds</span><span class="p">(</span><span class="n">ml_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov-846"><a href="#AbstractMarkov-846"><span class="linenos"> 846</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_affine_bounds</span><span class="p">(</span><span class="n">affine_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov-847"><a href="#AbstractMarkov-847"><span class="linenos"> 847</span></a>
</span><span id="AbstractMarkov-848"><a href="#AbstractMarkov-848"><span class="linenos"> 848</span></a>            <span class="c1"># Step 3: Initial value vector bounds</span>
</span><span id="AbstractMarkov-849"><a href="#AbstractMarkov-849"><span class="linenos"> 849</span></a>            <span class="n">initial_v_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_initial_v_bounds</span><span class="p">()</span>
</span><span id="AbstractMarkov-850"><a href="#AbstractMarkov-850"><span class="linenos"> 850</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_initial_v_bounds</span><span class="p">(</span><span class="n">initial_v_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov-851"><a href="#AbstractMarkov-851"><span class="linenos"> 851</span></a>
</span><span id="AbstractMarkov-852"><a href="#AbstractMarkov-852"><span class="linenos"> 852</span></a>            <span class="c1"># Step 4: Tightened value vector bounds</span>
</span><span id="AbstractMarkov-853"><a href="#AbstractMarkov-853"><span class="linenos"> 853</span></a>            <span class="n">tightened_v_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_tightened_v_bounds</span><span class="p">()</span>
</span><span id="AbstractMarkov-854"><a href="#AbstractMarkov-854"><span class="linenos"> 854</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_tightened_v_bounds</span><span class="p">(</span><span class="n">tightened_v_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov-855"><a href="#AbstractMarkov-855"><span class="linenos"> 855</span></a>
</span><span id="AbstractMarkov-856"><a href="#AbstractMarkov-856"><span class="linenos"> 856</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_feasible</span><span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">gurobi_params</span><span class="o">=</span><span class="n">gurobi_params</span><span class="p">)</span>
</span><span id="AbstractMarkov-857"><a href="#AbstractMarkov-857"><span class="linenos"> 857</span></a>
</span><span id="AbstractMarkov-858"><a href="#AbstractMarkov-858"><span class="linenos"> 858</span></a>    <span class="k">def</span> <span class="nf">_optimize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sense</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">verbose</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gurobi_params</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AbstractMarkov-859"><a href="#AbstractMarkov-859"><span class="linenos"> 859</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-860"><a href="#AbstractMarkov-860"><span class="linenos"> 860</span></a><span class="sd">        Private interface for optimizing the problem.</span>
</span><span id="AbstractMarkov-861"><a href="#AbstractMarkov-861"><span class="linenos"> 861</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-862"><a href="#AbstractMarkov-862"><span class="linenos"> 862</span></a>        <span class="c1"># Set the objective (implemented by subclasses)</span>
</span><span id="AbstractMarkov-863"><a href="#AbstractMarkov-863"><span class="linenos"> 863</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_objective</span><span class="p">()</span>
</span><span id="AbstractMarkov-864"><a href="#AbstractMarkov-864"><span class="linenos"> 864</span></a>
</span><span id="AbstractMarkov-865"><a href="#AbstractMarkov-865"><span class="linenos"> 865</span></a>        <span class="c1"># Common Gurobi parameter setting</span>
</span><span id="AbstractMarkov-866"><a href="#AbstractMarkov-866"><span class="linenos"> 866</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s2">&quot;OutputFlag&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
</span><span id="AbstractMarkov-867"><a href="#AbstractMarkov-867"><span class="linenos"> 867</span></a>        <span class="k">if</span> <span class="n">gurobi_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AbstractMarkov-868"><a href="#AbstractMarkov-868"><span class="linenos"> 868</span></a>            <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">gurobi_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AbstractMarkov-869"><a href="#AbstractMarkov-869"><span class="linenos"> 869</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="AbstractMarkov-870"><a href="#AbstractMarkov-870"><span class="linenos"> 870</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s2">&quot;Presolve&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="AbstractMarkov-871"><a href="#AbstractMarkov-871"><span class="linenos"> 871</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ModelSense</span> <span class="o">=</span> <span class="n">GRB</span><span class="o">.</span><span class="n">MAXIMIZE</span> <span class="k">if</span> <span class="n">sense</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span> <span class="k">else</span> <span class="n">GRB</span><span class="o">.</span><span class="n">MINIMIZE</span>
</span><span id="AbstractMarkov-872"><a href="#AbstractMarkov-872"><span class="linenos"> 872</span></a>
</span><span id="AbstractMarkov-873"><a href="#AbstractMarkov-873"><span class="linenos"> 873</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</span><span id="AbstractMarkov-874"><a href="#AbstractMarkov-874"><span class="linenos"> 874</span></a>
</span><span id="AbstractMarkov-875"><a href="#AbstractMarkov-875"><span class="linenos"> 875</span></a>        <span class="c1"># Check optimization status</span>
</span><span id="AbstractMarkov-876"><a href="#AbstractMarkov-876"><span class="linenos"> 876</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">:</span>
</span><span id="AbstractMarkov-877"><a href="#AbstractMarkov-877"><span class="linenos"> 877</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="AbstractMarkov-878"><a href="#AbstractMarkov-878"><span class="linenos"> 878</span></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;optimal&#39;</span><span class="p">,</span>
</span><span id="AbstractMarkov-879"><a href="#AbstractMarkov-879"><span class="linenos"> 879</span></a>                <span class="s1">&#39;objective&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">objVal</span><span class="p">,</span>
</span><span id="AbstractMarkov-880"><a href="#AbstractMarkov-880"><span class="linenos"> 880</span></a>                <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>
</span><span id="AbstractMarkov-881"><a href="#AbstractMarkov-881"><span class="linenos"> 881</span></a>            <span class="p">}</span>
</span><span id="AbstractMarkov-882"><a href="#AbstractMarkov-882"><span class="linenos"> 882</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">SUBOPTIMAL</span><span class="p">:</span>
</span><span id="AbstractMarkov-883"><a href="#AbstractMarkov-883"><span class="linenos"> 883</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="AbstractMarkov-884"><a href="#AbstractMarkov-884"><span class="linenos"> 884</span></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;suboptimal&#39;</span><span class="p">,</span>
</span><span id="AbstractMarkov-885"><a href="#AbstractMarkov-885"><span class="linenos"> 885</span></a>                <span class="s1">&#39;objective&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">objVal</span><span class="p">,</span>
</span><span id="AbstractMarkov-886"><a href="#AbstractMarkov-886"><span class="linenos"> 886</span></a>                <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>
</span><span id="AbstractMarkov-887"><a href="#AbstractMarkov-887"><span class="linenos"> 887</span></a>            <span class="p">}</span>
</span><span id="AbstractMarkov-888"><a href="#AbstractMarkov-888"><span class="linenos"> 888</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFEASIBLE</span><span class="p">:</span>
</span><span id="AbstractMarkov-889"><a href="#AbstractMarkov-889"><span class="linenos"> 889</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="AbstractMarkov-890"><a href="#AbstractMarkov-890"><span class="linenos"> 890</span></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;infeasible&#39;</span><span class="p">,</span>
</span><span id="AbstractMarkov-891"><a href="#AbstractMarkov-891"><span class="linenos"> 891</span></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Problem is infeasible&#39;</span>
</span><span id="AbstractMarkov-892"><a href="#AbstractMarkov-892"><span class="linenos"> 892</span></a>            <span class="p">}</span>
</span><span id="AbstractMarkov-893"><a href="#AbstractMarkov-893"><span class="linenos"> 893</span></a>        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">UNBOUNDED</span><span class="p">:</span>
</span><span id="AbstractMarkov-894"><a href="#AbstractMarkov-894"><span class="linenos"> 894</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="AbstractMarkov-895"><a href="#AbstractMarkov-895"><span class="linenos"> 895</span></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;unbounded&#39;</span><span class="p">,</span>
</span><span id="AbstractMarkov-896"><a href="#AbstractMarkov-896"><span class="linenos"> 896</span></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Problem is unbounded&#39;</span>
</span><span id="AbstractMarkov-897"><a href="#AbstractMarkov-897"><span class="linenos"> 897</span></a>            <span class="p">}</span>
</span><span id="AbstractMarkov-898"><a href="#AbstractMarkov-898"><span class="linenos"> 898</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AbstractMarkov-899"><a href="#AbstractMarkov-899"><span class="linenos"> 899</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="AbstractMarkov-900"><a href="#AbstractMarkov-900"><span class="linenos"> 900</span></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span><span id="AbstractMarkov-901"><a href="#AbstractMarkov-901"><span class="linenos"> 901</span></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Optimization failed with status code </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">status</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="AbstractMarkov-902"><a href="#AbstractMarkov-902"><span class="linenos"> 902</span></a>            <span class="p">}</span>
</span><span id="AbstractMarkov-903"><a href="#AbstractMarkov-903"><span class="linenos"> 903</span></a>
</span><span id="AbstractMarkov-904"><a href="#AbstractMarkov-904"><span class="linenos"> 904</span></a>    <span class="k">def</span> <span class="nf">_find_feasible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ub</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gurobi_params</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AbstractMarkov-905"><a href="#AbstractMarkov-905"><span class="linenos"> 905</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-906"><a href="#AbstractMarkov-906"><span class="linenos"> 906</span></a><span class="sd">        Private interface for finding a feasible solution to the problem.</span>
</span><span id="AbstractMarkov-907"><a href="#AbstractMarkov-907"><span class="linenos"> 907</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-908"><a href="#AbstractMarkov-908"><span class="linenos"> 908</span></a>        <span class="k">if</span> <span class="n">lb</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AbstractMarkov-909"><a href="#AbstractMarkov-909"><span class="linenos"> 909</span></a>            <span class="n">lb</span> <span class="o">=</span> <span class="o">-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span>
</span><span id="AbstractMarkov-910"><a href="#AbstractMarkov-910"><span class="linenos"> 910</span></a>        <span class="k">if</span> <span class="n">ub</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AbstractMarkov-911"><a href="#AbstractMarkov-911"><span class="linenos"> 911</span></a>            <span class="n">ub</span> <span class="o">=</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span>
</span><span id="AbstractMarkov-912"><a href="#AbstractMarkov-912"><span class="linenos"> 912</span></a>        <span class="c1"># must be implemented by subclasses</span>
</span><span id="AbstractMarkov-913"><a href="#AbstractMarkov-913"><span class="linenos"> 913</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_set_feasible_constraints</span><span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="AbstractMarkov-914"><a href="#AbstractMarkov-914"><span class="linenos"> 914</span></a>
</span><span id="AbstractMarkov-915"><a href="#AbstractMarkov-915"><span class="linenos"> 915</span></a>        <span class="c1"># Common Gurobi parameter setting</span>
</span><span id="AbstractMarkov-916"><a href="#AbstractMarkov-916"><span class="linenos"> 916</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s2">&quot;OutputFlag&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
</span><span id="AbstractMarkov-917"><a href="#AbstractMarkov-917"><span class="linenos"> 917</span></a>        <span class="k">if</span> <span class="n">gurobi_params</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AbstractMarkov-918"><a href="#AbstractMarkov-918"><span class="linenos"> 918</span></a>            <span class="k">for</span> <span class="n">param</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">gurobi_params</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AbstractMarkov-919"><a href="#AbstractMarkov-919"><span class="linenos"> 919</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</span><span id="AbstractMarkov-920"><a href="#AbstractMarkov-920"><span class="linenos"> 920</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="AbstractMarkov-921"><a href="#AbstractMarkov-921"><span class="linenos"> 921</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s2">&quot;Presolve&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="AbstractMarkov-922"><a href="#AbstractMarkov-922"><span class="linenos"> 922</span></a>
</span><span id="AbstractMarkov-923"><a href="#AbstractMarkov-923"><span class="linenos"> 923</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</span><span id="AbstractMarkov-924"><a href="#AbstractMarkov-924"><span class="linenos"> 924</span></a>
</span><span id="AbstractMarkov-925"><a href="#AbstractMarkov-925"><span class="linenos"> 925</span></a>        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">status</span>
</span><span id="AbstractMarkov-926"><a href="#AbstractMarkov-926"><span class="linenos"> 926</span></a>        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">:</span>
</span><span id="AbstractMarkov-927"><a href="#AbstractMarkov-927"><span class="linenos"> 927</span></a>            <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_values</span><span class="p">()</span>
</span><span id="AbstractMarkov-928"><a href="#AbstractMarkov-928"><span class="linenos"> 928</span></a>
</span><span id="AbstractMarkov-929"><a href="#AbstractMarkov-929"><span class="linenos"> 929</span></a>        <span class="c1"># Remove temporary constraints after storing status and values</span>
</span><span id="AbstractMarkov-930"><a href="#AbstractMarkov-930"><span class="linenos"> 930</span></a>        <span class="k">for</span> <span class="n">constr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getQConstrs</span><span class="p">():</span>
</span><span id="AbstractMarkov-931"><a href="#AbstractMarkov-931"><span class="linenos"> 931</span></a>            <span class="k">if</span> <span class="n">constr</span><span class="o">.</span><span class="n">QCName</span> <span class="o">==</span> <span class="s2">&quot;temp_feasible_lb&quot;</span> <span class="ow">or</span> <span class="n">constr</span><span class="o">.</span><span class="n">QCName</span> <span class="o">==</span> <span class="s2">&quot;temp_feasible_ub&quot;</span><span class="p">:</span>
</span><span id="AbstractMarkov-932"><a href="#AbstractMarkov-932"><span class="linenos"> 932</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
</span><span id="AbstractMarkov-933"><a href="#AbstractMarkov-933"><span class="linenos"> 933</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="AbstractMarkov-934"><a href="#AbstractMarkov-934"><span class="linenos"> 934</span></a>
</span><span id="AbstractMarkov-935"><a href="#AbstractMarkov-935"><span class="linenos"> 935</span></a>        <span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">:</span>
</span><span id="AbstractMarkov-936"><a href="#AbstractMarkov-936"><span class="linenos"> 936</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="AbstractMarkov-937"><a href="#AbstractMarkov-937"><span class="linenos"> 937</span></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;feasible&#39;</span><span class="p">,</span>
</span><span id="AbstractMarkov-938"><a href="#AbstractMarkov-938"><span class="linenos"> 938</span></a>                <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="n">values</span>
</span><span id="AbstractMarkov-939"><a href="#AbstractMarkov-939"><span class="linenos"> 939</span></a>            <span class="p">}</span>
</span><span id="AbstractMarkov-940"><a href="#AbstractMarkov-940"><span class="linenos"> 940</span></a>        <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFEASIBLE</span><span class="p">:</span>
</span><span id="AbstractMarkov-941"><a href="#AbstractMarkov-941"><span class="linenos"> 941</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="AbstractMarkov-942"><a href="#AbstractMarkov-942"><span class="linenos"> 942</span></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;infeasible&#39;</span><span class="p">,</span>
</span><span id="AbstractMarkov-943"><a href="#AbstractMarkov-943"><span class="linenos"> 943</span></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Problem is infeasible&#39;</span>
</span><span id="AbstractMarkov-944"><a href="#AbstractMarkov-944"><span class="linenos"> 944</span></a>            <span class="p">}</span>
</span><span id="AbstractMarkov-945"><a href="#AbstractMarkov-945"><span class="linenos"> 945</span></a>        <span class="k">elif</span> <span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">UNBOUNDED</span><span class="p">:</span>
</span><span id="AbstractMarkov-946"><a href="#AbstractMarkov-946"><span class="linenos"> 946</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="AbstractMarkov-947"><a href="#AbstractMarkov-947"><span class="linenos"> 947</span></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;unbounded&#39;</span><span class="p">,</span>
</span><span id="AbstractMarkov-948"><a href="#AbstractMarkov-948"><span class="linenos"> 948</span></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="s1">&#39;Problem is unbounded&#39;</span>
</span><span id="AbstractMarkov-949"><a href="#AbstractMarkov-949"><span class="linenos"> 949</span></a>            <span class="p">}</span>
</span><span id="AbstractMarkov-950"><a href="#AbstractMarkov-950"><span class="linenos"> 950</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AbstractMarkov-951"><a href="#AbstractMarkov-951"><span class="linenos"> 951</span></a>            <span class="k">return</span> <span class="p">{</span>
</span><span id="AbstractMarkov-952"><a href="#AbstractMarkov-952"><span class="linenos"> 952</span></a>                <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="s1">&#39;error&#39;</span><span class="p">,</span>
</span><span id="AbstractMarkov-953"><a href="#AbstractMarkov-953"><span class="linenos"> 953</span></a>                <span class="s1">&#39;message&#39;</span><span class="p">:</span> <span class="sa">f</span><span class="s1">&#39;Optimization failed with status code </span><span class="si">{</span><span class="n">status</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="AbstractMarkov-954"><a href="#AbstractMarkov-954"><span class="linenos"> 954</span></a>            <span class="p">}</span>
</span><span id="AbstractMarkov-955"><a href="#AbstractMarkov-955"><span class="linenos"> 955</span></a>
</span><span id="AbstractMarkov-956"><a href="#AbstractMarkov-956"><span class="linenos"> 956</span></a>    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="AbstractMarkov-957"><a href="#AbstractMarkov-957"><span class="linenos"> 957</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-958"><a href="#AbstractMarkov-958"><span class="linenos"> 958</span></a><span class="sd">        Get value of variable after optimization.</span>
</span><span id="AbstractMarkov-959"><a href="#AbstractMarkov-959"><span class="linenos"> 959</span></a><span class="sd">        Can either pass in a Gurobi variable or a string (name of variable).</span>
</span><span id="AbstractMarkov-960"><a href="#AbstractMarkov-960"><span class="linenos"> 960</span></a>
</span><span id="AbstractMarkov-961"><a href="#AbstractMarkov-961"><span class="linenos"> 961</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-962"><a href="#AbstractMarkov-962"><span class="linenos"> 962</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-963"><a href="#AbstractMarkov-963"><span class="linenos"> 963</span></a><span class="sd">        var : gp.Var | str</span>
</span><span id="AbstractMarkov-964"><a href="#AbstractMarkov-964"><span class="linenos"> 964</span></a><span class="sd">            The variable to get the value of. If a string, it is the name of the variable.</span>
</span><span id="AbstractMarkov-965"><a href="#AbstractMarkov-965"><span class="linenos"> 965</span></a>
</span><span id="AbstractMarkov-966"><a href="#AbstractMarkov-966"><span class="linenos"> 966</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-967"><a href="#AbstractMarkov-967"><span class="linenos"> 967</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-968"><a href="#AbstractMarkov-968"><span class="linenos"> 968</span></a><span class="sd">        float</span>
</span><span id="AbstractMarkov-969"><a href="#AbstractMarkov-969"><span class="linenos"> 969</span></a><span class="sd">            The value of the variable</span>
</span><span id="AbstractMarkov-970"><a href="#AbstractMarkov-970"><span class="linenos"> 970</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-971"><a href="#AbstractMarkov-971"><span class="linenos"> 971</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">):</span>
</span><span id="AbstractMarkov-972"><a href="#AbstractMarkov-972"><span class="linenos"> 972</span></a>            <span class="k">return</span> <span class="n">var</span><span class="o">.</span><span class="n">X</span>  <span class="c1"># Direct access if it&#39;s already a Gurobi variable</span>
</span><span id="AbstractMarkov-973"><a href="#AbstractMarkov-973"><span class="linenos"> 973</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AbstractMarkov-974"><a href="#AbstractMarkov-974"><span class="linenos"> 974</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">))</span><span class="o">.</span><span class="n">X</span>  <span class="c1"># Use name lookup for strings</span>
</span><span id="AbstractMarkov-975"><a href="#AbstractMarkov-975"><span class="linenos"> 975</span></a>
</span><span id="AbstractMarkov-976"><a href="#AbstractMarkov-976"><span class="linenos"> 976</span></a>    <span class="c1"># DECOMPOSITION AND BOUND PROPAGATION FUNCTIONS</span>
</span><span id="AbstractMarkov-977"><a href="#AbstractMarkov-977"><span class="linenos"> 977</span></a>    <span class="c1"># Here, ML models can be optimized</span>
</span><span id="AbstractMarkov-978"><a href="#AbstractMarkov-978"><span class="linenos"> 978</span></a>
</span><span id="AbstractMarkov-979"><a href="#AbstractMarkov-979"><span class="linenos"> 979</span></a>    <span class="k">def</span> <span class="nf">_optimize_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ml_model_index</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ml_output_index</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">sense</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">verbose</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="AbstractMarkov-980"><a href="#AbstractMarkov-980"><span class="linenos"> 980</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-981"><a href="#AbstractMarkov-981"><span class="linenos"> 981</span></a><span class="sd">        Minimize the specified ML output over the constraints defined for self.features and self.feature_aux.</span>
</span><span id="AbstractMarkov-982"><a href="#AbstractMarkov-982"><span class="linenos"> 982</span></a>
</span><span id="AbstractMarkov-983"><a href="#AbstractMarkov-983"><span class="linenos"> 983</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-984"><a href="#AbstractMarkov-984"><span class="linenos"> 984</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-985"><a href="#AbstractMarkov-985"><span class="linenos"> 985</span></a><span class="sd">        ml_model_index : int (default=0)</span>
</span><span id="AbstractMarkov-986"><a href="#AbstractMarkov-986"><span class="linenos"> 986</span></a><span class="sd">            Index of the ML model to optimize</span>
</span><span id="AbstractMarkov-987"><a href="#AbstractMarkov-987"><span class="linenos"> 987</span></a><span class="sd">        ml_output_index : int (default=0)</span>
</span><span id="AbstractMarkov-988"><a href="#AbstractMarkov-988"><span class="linenos"> 988</span></a><span class="sd">            Index of the ML output to minimize</span>
</span><span id="AbstractMarkov-989"><a href="#AbstractMarkov-989"><span class="linenos"> 989</span></a><span class="sd">        sense : str (default=&quot;max&quot;)</span>
</span><span id="AbstractMarkov-990"><a href="#AbstractMarkov-990"><span class="linenos"> 990</span></a><span class="sd">            The sense of the optimization problem, either &quot;max&quot; or &quot;min&quot;</span>
</span><span id="AbstractMarkov-991"><a href="#AbstractMarkov-991"><span class="linenos"> 991</span></a><span class="sd">        verbose : bool (default=False)</span>
</span><span id="AbstractMarkov-992"><a href="#AbstractMarkov-992"><span class="linenos"> 992</span></a><span class="sd">            Whether to print Gurobi output</span>
</span><span id="AbstractMarkov-993"><a href="#AbstractMarkov-993"><span class="linenos"> 993</span></a>
</span><span id="AbstractMarkov-994"><a href="#AbstractMarkov-994"><span class="linenos"> 994</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-995"><a href="#AbstractMarkov-995"><span class="linenos"> 995</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-996"><a href="#AbstractMarkov-996"><span class="linenos"> 996</span></a><span class="sd">        tuple</span>
</span><span id="AbstractMarkov-997"><a href="#AbstractMarkov-997"><span class="linenos"> 997</span></a><span class="sd">            A tuple containing the status of the optimization and the value of the ML output</span>
</span><span id="AbstractMarkov-998"><a href="#AbstractMarkov-998"><span class="linenos"> 998</span></a>
</span><span id="AbstractMarkov-999"><a href="#AbstractMarkov-999"><span class="linenos"> 999</span></a><span class="sd">        Notes</span>
</span><span id="AbstractMarkov-1000"><a href="#AbstractMarkov-1000"><span class="linenos">1000</span></a><span class="sd">        -----</span>
</span><span id="AbstractMarkov-1001"><a href="#AbstractMarkov-1001"><span class="linenos">1001</span></a><span class="sd">        Builds the subproblem for the given ML model and output, and solves it.</span>
</span><span id="AbstractMarkov-1002"><a href="#AbstractMarkov-1002"><span class="linenos">1002</span></a><span class="sd">        If the optimizer returns an optimal solution, it returns the objective value.</span>
</span><span id="AbstractMarkov-1003"><a href="#AbstractMarkov-1003"><span class="linenos">1003</span></a><span class="sd">        If the optimizer returns a suboptimal solution, it uses the best known objective bound.</span>
</span><span id="AbstractMarkov-1004"><a href="#AbstractMarkov-1004"><span class="linenos">1004</span></a><span class="sd">        If the optimizer returns an infeasible or unbounded solution, it returns None. This is later</span>
</span><span id="AbstractMarkov-1005"><a href="#AbstractMarkov-1005"><span class="linenos">1005</span></a><span class="sd">        detected in _set_ml_bounds, which forces the bounds to be conflicting, so that the overall model</span>
</span><span id="AbstractMarkov-1006"><a href="#AbstractMarkov-1006"><span class="linenos">1006</span></a><span class="sd">        is easily detected as infeasible.</span>
</span><span id="AbstractMarkov-1007"><a href="#AbstractMarkov-1007"><span class="linenos">1007</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-1008"><a href="#AbstractMarkov-1008"><span class="linenos">1008</span></a>        <span class="c1"># Create a new subproblem model</span>
</span><span id="AbstractMarkov-1009"><a href="#AbstractMarkov-1009"><span class="linenos">1009</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="AbstractMarkov-1010"><a href="#AbstractMarkov-1010"><span class="linenos">1010</span></a>        <span class="n">subproblem</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;opt_ml_output&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-1011"><a href="#AbstractMarkov-1011"><span class="linenos">1011</span></a>
</span><span id="AbstractMarkov-1012"><a href="#AbstractMarkov-1012"><span class="linenos">1012</span></a>        <span class="c1"># Add feature variables to the subproblem with the same bounds as the original model</span>
</span><span id="AbstractMarkov-1013"><a href="#AbstractMarkov-1013"><span class="linenos">1013</span></a>        <span class="n">sub_features</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AbstractMarkov-1014"><a href="#AbstractMarkov-1014"><span class="linenos">1014</span></a>        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
</span><span id="AbstractMarkov-1015"><a href="#AbstractMarkov-1015"><span class="linenos">1015</span></a>            <span class="n">sub_features</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">]</span> <span class="o">=</span> <span class="n">subproblem</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
</span><span id="AbstractMarkov-1016"><a href="#AbstractMarkov-1016"><span class="linenos">1016</span></a>                <span class="n">name</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">,</span>
</span><span id="AbstractMarkov-1017"><a href="#AbstractMarkov-1017"><span class="linenos">1017</span></a>                <span class="n">lb</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span>  <span class="c1"># Copy the lower bound</span>
</span><span id="AbstractMarkov-1018"><a href="#AbstractMarkov-1018"><span class="linenos">1018</span></a>                <span class="n">ub</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">UB</span><span class="p">,</span>  <span class="c1"># Copy the upper bound</span>
</span><span id="AbstractMarkov-1019"><a href="#AbstractMarkov-1019"><span class="linenos">1019</span></a>                <span class="n">vtype</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">VType</span>  <span class="c1"># Copy the variable type (e.g., CONTINUOUS)</span>
</span><span id="AbstractMarkov-1020"><a href="#AbstractMarkov-1020"><span class="linenos">1020</span></a>            <span class="p">)</span>
</span><span id="AbstractMarkov-1021"><a href="#AbstractMarkov-1021"><span class="linenos">1021</span></a>        <span class="c1"># Add auxiliary feature variables to the subproblem</span>
</span><span id="AbstractMarkov-1022"><a href="#AbstractMarkov-1022"><span class="linenos">1022</span></a>        <span class="n">sub_features_aux</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AbstractMarkov-1023"><a href="#AbstractMarkov-1023"><span class="linenos">1023</span></a>        <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_aux</span><span class="p">:</span>
</span><span id="AbstractMarkov-1024"><a href="#AbstractMarkov-1024"><span class="linenos">1024</span></a>            <span class="n">sub_features_aux</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">]</span> <span class="o">=</span> <span class="n">subproblem</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span>
</span><span id="AbstractMarkov-1025"><a href="#AbstractMarkov-1025"><span class="linenos">1025</span></a>                <span class="n">name</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">,</span>
</span><span id="AbstractMarkov-1026"><a href="#AbstractMarkov-1026"><span class="linenos">1026</span></a>                <span class="n">lb</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span>  <span class="c1"># Copy the lower bound</span>
</span><span id="AbstractMarkov-1027"><a href="#AbstractMarkov-1027"><span class="linenos">1027</span></a>                <span class="n">ub</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">UB</span><span class="p">,</span>  <span class="c1"># Copy the upper bound</span>
</span><span id="AbstractMarkov-1028"><a href="#AbstractMarkov-1028"><span class="linenos">1028</span></a>                <span class="n">vtype</span><span class="o">=</span><span class="n">var</span><span class="o">.</span><span class="n">VType</span>  <span class="c1"># Copy the variable type (e.g., CONTINUOUS)</span>
</span><span id="AbstractMarkov-1029"><a href="#AbstractMarkov-1029"><span class="linenos">1029</span></a>            <span class="p">)</span>
</span><span id="AbstractMarkov-1030"><a href="#AbstractMarkov-1030"><span class="linenos">1030</span></a>        <span class="n">subproblem</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="AbstractMarkov-1031"><a href="#AbstractMarkov-1031"><span class="linenos">1031</span></a>
</span><span id="AbstractMarkov-1032"><a href="#AbstractMarkov-1032"><span class="linenos">1032</span></a>        <span class="c1"># Convert self.features to a dict mapping VarName to GRB.Var for easier access</span>
</span><span id="AbstractMarkov-1033"><a href="#AbstractMarkov-1033"><span class="linenos">1033</span></a>        <span class="n">features_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">:</span> <span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="o">.</span><span class="n">values</span><span class="p">()}</span>
</span><span id="AbstractMarkov-1034"><a href="#AbstractMarkov-1034"><span class="linenos">1034</span></a>        <span class="n">features_aux_map</span> <span class="o">=</span> <span class="p">{</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">:</span> <span class="n">var</span> <span class="k">for</span> <span class="n">var</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_aux</span><span class="p">}</span>
</span><span id="AbstractMarkov-1035"><a href="#AbstractMarkov-1035"><span class="linenos">1035</span></a>
</span><span id="AbstractMarkov-1036"><a href="#AbstractMarkov-1036"><span class="linenos">1036</span></a>        <span class="c1"># Iterate over constraints in the original model</span>
</span><span id="AbstractMarkov-1037"><a href="#AbstractMarkov-1037"><span class="linenos">1037</span></a>        <span class="k">for</span> <span class="n">constr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">feature_constraints</span><span class="p">:</span>
</span><span id="AbstractMarkov-1038"><a href="#AbstractMarkov-1038"><span class="linenos">1038</span></a>            <span class="c1"># Get the linear expression for the constraint</span>
</span><span id="AbstractMarkov-1039"><a href="#AbstractMarkov-1039"><span class="linenos">1039</span></a>            <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getRow</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
</span><span id="AbstractMarkov-1040"><a href="#AbstractMarkov-1040"><span class="linenos">1040</span></a>
</span><span id="AbstractMarkov-1041"><a href="#AbstractMarkov-1041"><span class="linenos">1041</span></a>            <span class="n">new_expr</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">()</span>
</span><span id="AbstractMarkov-1042"><a href="#AbstractMarkov-1042"><span class="linenos">1042</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
</span><span id="AbstractMarkov-1043"><a href="#AbstractMarkov-1043"><span class="linenos">1043</span></a>                <span class="n">var</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">getVar</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="AbstractMarkov-1044"><a href="#AbstractMarkov-1044"><span class="linenos">1044</span></a>                <span class="n">coeff</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">getCoeff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="AbstractMarkov-1045"><a href="#AbstractMarkov-1045"><span class="linenos">1045</span></a>                <span class="k">if</span> <span class="n">var</span><span class="o">.</span><span class="n">VarName</span> <span class="ow">in</span> <span class="n">features_map</span><span class="p">:</span>
</span><span id="AbstractMarkov-1046"><a href="#AbstractMarkov-1046"><span class="linenos">1046</span></a>                    <span class="n">new_expr</span> <span class="o">+=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">sub_features</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">]</span>
</span><span id="AbstractMarkov-1047"><a href="#AbstractMarkov-1047"><span class="linenos">1047</span></a>                <span class="k">elif</span> <span class="n">var</span><span class="o">.</span><span class="n">VarName</span> <span class="ow">in</span> <span class="n">features_aux_map</span><span class="p">:</span>
</span><span id="AbstractMarkov-1048"><a href="#AbstractMarkov-1048"><span class="linenos">1048</span></a>                    <span class="n">new_expr</span> <span class="o">+=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">sub_features_aux</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">]</span>
</span><span id="AbstractMarkov-1049"><a href="#AbstractMarkov-1049"><span class="linenos">1049</span></a>
</span><span id="AbstractMarkov-1050"><a href="#AbstractMarkov-1050"><span class="linenos">1050</span></a>            <span class="c1"># Add the modified constraint to the subproblem</span>
</span><span id="AbstractMarkov-1051"><a href="#AbstractMarkov-1051"><span class="linenos">1051</span></a>            <span class="n">subproblem</span><span class="o">.</span><span class="n">addLConstr</span><span class="p">(</span><span class="n">new_expr</span><span class="p">,</span> <span class="n">constr</span><span class="o">.</span><span class="n">Sense</span><span class="p">,</span> <span class="n">constr</span><span class="o">.</span><span class="n">RHS</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">constr</span><span class="o">.</span><span class="n">ConstrName</span><span class="p">)</span>
</span><span id="AbstractMarkov-1052"><a href="#AbstractMarkov-1052"><span class="linenos">1052</span></a>            <span class="n">subproblem</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="AbstractMarkov-1053"><a href="#AbstractMarkov-1053"><span class="linenos">1053</span></a>
</span><span id="AbstractMarkov-1054"><a href="#AbstractMarkov-1054"><span class="linenos">1054</span></a>        <span class="c1"># Add the ML output variable to the subproblem</span>
</span><span id="AbstractMarkov-1055"><a href="#AbstractMarkov-1055"><span class="linenos">1055</span></a>        <span class="n">ml_output</span> <span class="o">=</span> <span class="n">subproblem</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="AbstractMarkov-1056"><a href="#AbstractMarkov-1056"><span class="linenos">1056</span></a>            <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">ml_model_index</span><span class="p">]),</span>
</span><span id="AbstractMarkov-1057"><a href="#AbstractMarkov-1057"><span class="linenos">1057</span></a>            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ml_output_</span><span class="si">{</span><span class="n">ml_output_index</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AbstractMarkov-1058"><a href="#AbstractMarkov-1058"><span class="linenos">1058</span></a>            <span class="n">lb</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">ml_model_index</span><span class="p">][</span><span class="n">ml_output_index</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span>
</span><span id="AbstractMarkov-1059"><a href="#AbstractMarkov-1059"><span class="linenos">1059</span></a>            <span class="n">ub</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">ml_model_index</span><span class="p">][</span><span class="n">ml_output_index</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span><span class="p">,</span>
</span><span id="AbstractMarkov-1060"><a href="#AbstractMarkov-1060"><span class="linenos">1060</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">ml_model_index</span><span class="p">][</span><span class="n">ml_output_index</span><span class="p">]</span><span class="o">.</span><span class="n">VType</span>
</span><span id="AbstractMarkov-1061"><a href="#AbstractMarkov-1061"><span class="linenos">1061</span></a>        <span class="p">)</span>
</span><span id="AbstractMarkov-1062"><a href="#AbstractMarkov-1062"><span class="linenos">1062</span></a>
</span><span id="AbstractMarkov-1063"><a href="#AbstractMarkov-1063"><span class="linenos">1063</span></a>        <span class="c1"># Recreate the ML model constraint in the subproblem</span>
</span><span id="AbstractMarkov-1064"><a href="#AbstractMarkov-1064"><span class="linenos">1064</span></a>        <span class="c1"># Find matching model type in registry</span>
</span><span id="AbstractMarkov-1065"><a href="#AbstractMarkov-1065"><span class="linenos">1065</span></a>        <span class="n">ml_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ml_models</span><span class="p">[</span><span class="n">ml_model_index</span><span class="p">]</span>
</span><span id="AbstractMarkov-1066"><a href="#AbstractMarkov-1066"><span class="linenos">1066</span></a>        <span class="k">for</span> <span class="n">model_types</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_model_registry</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AbstractMarkov-1067"><a href="#AbstractMarkov-1067"><span class="linenos">1067</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ml_model</span><span class="p">,</span> <span class="n">model_types</span><span class="p">):</span>
</span><span id="AbstractMarkov-1068"><a href="#AbstractMarkov-1068"><span class="linenos">1068</span></a>                <span class="n">config</span><span class="p">[</span><span class="s1">&#39;constraint_method&#39;</span><span class="p">](</span>
</span><span id="AbstractMarkov-1069"><a href="#AbstractMarkov-1069"><span class="linenos">1069</span></a>                    <span class="n">subproblem</span><span class="p">,</span>
</span><span id="AbstractMarkov-1070"><a href="#AbstractMarkov-1070"><span class="linenos">1070</span></a>                    <span class="n">ml_model</span><span class="p">,</span>
</span><span id="AbstractMarkov-1071"><a href="#AbstractMarkov-1071"><span class="linenos">1071</span></a>                    <span class="n">sub_features</span><span class="p">,</span>
</span><span id="AbstractMarkov-1072"><a href="#AbstractMarkov-1072"><span class="linenos">1072</span></a>                    <span class="n">ml_output</span>
</span><span id="AbstractMarkov-1073"><a href="#AbstractMarkov-1073"><span class="linenos">1073</span></a>                <span class="p">)</span>
</span><span id="AbstractMarkov-1074"><a href="#AbstractMarkov-1074"><span class="linenos">1074</span></a>                <span class="k">break</span>
</span><span id="AbstractMarkov-1075"><a href="#AbstractMarkov-1075"><span class="linenos">1075</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AbstractMarkov-1076"><a href="#AbstractMarkov-1076"><span class="linenos">1076</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported ML model type for optimization: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">ml_model</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-1077"><a href="#AbstractMarkov-1077"><span class="linenos">1077</span></a>
</span><span id="AbstractMarkov-1078"><a href="#AbstractMarkov-1078"><span class="linenos">1078</span></a>        <span class="c1"># Set the objective to optimize the ML output</span>
</span><span id="AbstractMarkov-1079"><a href="#AbstractMarkov-1079"><span class="linenos">1079</span></a>        <span class="n">sense</span> <span class="o">=</span> <span class="n">GRB</span><span class="o">.</span><span class="n">MAXIMIZE</span> <span class="k">if</span> <span class="n">sense</span> <span class="o">==</span> <span class="s2">&quot;max&quot;</span> <span class="k">else</span> <span class="n">GRB</span><span class="o">.</span><span class="n">MINIMIZE</span>
</span><span id="AbstractMarkov-1080"><a href="#AbstractMarkov-1080"><span class="linenos">1080</span></a>        <span class="n">subproblem</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span><span class="n">ml_output</span><span class="p">[</span><span class="n">ml_output_index</span><span class="p">],</span> <span class="n">sense</span><span class="p">)</span>
</span><span id="AbstractMarkov-1081"><a href="#AbstractMarkov-1081"><span class="linenos">1081</span></a>        <span class="n">subproblem</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s2">&quot;OutputFlag&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="p">)</span>
</span><span id="AbstractMarkov-1082"><a href="#AbstractMarkov-1082"><span class="linenos">1082</span></a>        <span class="n">subproblem</span><span class="o">.</span><span class="n">setParam</span><span class="p">(</span><span class="s2">&quot;Presolve&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="AbstractMarkov-1083"><a href="#AbstractMarkov-1083"><span class="linenos">1083</span></a>
</span><span id="AbstractMarkov-1084"><a href="#AbstractMarkov-1084"><span class="linenos">1084</span></a>        <span class="c1"># Solve the subproblem</span>
</span><span id="AbstractMarkov-1085"><a href="#AbstractMarkov-1085"><span class="linenos">1085</span></a>        <span class="n">subproblem</span><span class="o">.</span><span class="n">optimize</span><span class="p">()</span>
</span><span id="AbstractMarkov-1086"><a href="#AbstractMarkov-1086"><span class="linenos">1086</span></a>
</span><span id="AbstractMarkov-1087"><a href="#AbstractMarkov-1087"><span class="linenos">1087</span></a>        <span class="k">if</span> <span class="n">subproblem</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">OPTIMAL</span><span class="p">:</span>
</span><span id="AbstractMarkov-1088"><a href="#AbstractMarkov-1088"><span class="linenos">1088</span></a>            <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;optimal&#39;</span><span class="p">,</span> <span class="n">ml_output</span><span class="p">[</span><span class="n">ml_output_index</span><span class="p">]</span><span class="o">.</span><span class="n">X</span><span class="p">)</span>
</span><span id="AbstractMarkov-1089"><a href="#AbstractMarkov-1089"><span class="linenos">1089</span></a>        <span class="k">elif</span> <span class="n">subproblem</span><span class="o">.</span><span class="n">status</span> <span class="ow">in</span> <span class="p">[</span><span class="n">GRB</span><span class="o">.</span><span class="n">SUBOPTIMAL</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">TIME_LIMIT</span><span class="p">,</span> <span class="n">GRB</span><span class="o">.</span><span class="n">NUMERIC</span><span class="p">]:</span>
</span><span id="AbstractMarkov-1090"><a href="#AbstractMarkov-1090"><span class="linenos">1090</span></a>            <span class="c1"># Use ObjBound which is guaranteed to be a valid bound</span>
</span><span id="AbstractMarkov-1091"><a href="#AbstractMarkov-1091"><span class="linenos">1091</span></a>            <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;suboptimal&#39;</span><span class="p">,</span> <span class="n">subproblem</span><span class="o">.</span><span class="n">ObjBound</span><span class="p">)</span>
</span><span id="AbstractMarkov-1092"><a href="#AbstractMarkov-1092"><span class="linenos">1092</span></a>        <span class="k">elif</span> <span class="n">subproblem</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFEASIBLE</span><span class="p">:</span>
</span><span id="AbstractMarkov-1093"><a href="#AbstractMarkov-1093"><span class="linenos">1093</span></a>            <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;infeasible&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="AbstractMarkov-1094"><a href="#AbstractMarkov-1094"><span class="linenos">1094</span></a>        <span class="k">elif</span> <span class="n">subproblem</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="n">GRB</span><span class="o">.</span><span class="n">UNBOUNDED</span><span class="p">:</span>
</span><span id="AbstractMarkov-1095"><a href="#AbstractMarkov-1095"><span class="linenos">1095</span></a>            <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;unbounded&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">sense</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span>
</span><span id="AbstractMarkov-1096"><a href="#AbstractMarkov-1096"><span class="linenos">1096</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AbstractMarkov-1097"><a href="#AbstractMarkov-1097"><span class="linenos">1097</span></a>            <span class="c1"># For any other status, if we have a bound, use it</span>
</span><span id="AbstractMarkov-1098"><a href="#AbstractMarkov-1098"><span class="linenos">1098</span></a>            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">subproblem</span><span class="p">,</span> <span class="s1">&#39;ObjBound&#39;</span><span class="p">):</span>
</span><span id="AbstractMarkov-1099"><a href="#AbstractMarkov-1099"><span class="linenos">1099</span></a>                <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="n">subproblem</span><span class="o">.</span><span class="n">ObjBound</span><span class="p">)</span>
</span><span id="AbstractMarkov-1100"><a href="#AbstractMarkov-1100"><span class="linenos">1100</span></a>            <span class="c1"># Otherwise use conservative bounds</span>
</span><span id="AbstractMarkov-1101"><a href="#AbstractMarkov-1101"><span class="linenos">1101</span></a>            <span class="k">return</span> <span class="p">(</span><span class="s1">&#39;error&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;-inf&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">sense</span> <span class="o">==</span> <span class="s2">&quot;min&quot;</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;inf&#39;</span><span class="p">))</span>
</span><span id="AbstractMarkov-1102"><a href="#AbstractMarkov-1102"><span class="linenos">1102</span></a>
</span><span id="AbstractMarkov-1103"><a href="#AbstractMarkov-1103"><span class="linenos">1103</span></a>    <span class="k">def</span> <span class="nf">_compute_ml_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">verbose</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
</span><span id="AbstractMarkov-1104"><a href="#AbstractMarkov-1104"><span class="linenos">1104</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-1105"><a href="#AbstractMarkov-1105"><span class="linenos">1105</span></a><span class="sd">        Get the bounds on all ML outputs.</span>
</span><span id="AbstractMarkov-1106"><a href="#AbstractMarkov-1106"><span class="linenos">1106</span></a>
</span><span id="AbstractMarkov-1107"><a href="#AbstractMarkov-1107"><span class="linenos">1107</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-1108"><a href="#AbstractMarkov-1108"><span class="linenos">1108</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-1109"><a href="#AbstractMarkov-1109"><span class="linenos">1109</span></a><span class="sd">        verbose : bool (default=False)</span>
</span><span id="AbstractMarkov-1110"><a href="#AbstractMarkov-1110"><span class="linenos">1110</span></a><span class="sd">            Whether to print Gurobi output</span>
</span><span id="AbstractMarkov-1111"><a href="#AbstractMarkov-1111"><span class="linenos">1111</span></a>
</span><span id="AbstractMarkov-1112"><a href="#AbstractMarkov-1112"><span class="linenos">1112</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-1113"><a href="#AbstractMarkov-1113"><span class="linenos">1113</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-1114"><a href="#AbstractMarkov-1114"><span class="linenos">1114</span></a><span class="sd">        list[list[tuple[float | None, float | None]]]</span>
</span><span id="AbstractMarkov-1115"><a href="#AbstractMarkov-1115"><span class="linenos">1115</span></a><span class="sd">            A list of lists of (max, min) tuples for each ML model and output</span>
</span><span id="AbstractMarkov-1116"><a href="#AbstractMarkov-1116"><span class="linenos">1116</span></a>
</span><span id="AbstractMarkov-1117"><a href="#AbstractMarkov-1117"><span class="linenos">1117</span></a><span class="sd">        Notes</span>
</span><span id="AbstractMarkov-1118"><a href="#AbstractMarkov-1118"><span class="linenos">1118</span></a><span class="sd">        -----</span>
</span><span id="AbstractMarkov-1119"><a href="#AbstractMarkov-1119"><span class="linenos">1119</span></a><span class="sd">        If `verbose` is True, it also prints the bounds for each ML model and output, or</span>
</span><span id="AbstractMarkov-1120"><a href="#AbstractMarkov-1120"><span class="linenos">1120</span></a><span class="sd">        infeasible status. The `verbose` flag is also passed to Gurobi.</span>
</span><span id="AbstractMarkov-1121"><a href="#AbstractMarkov-1121"><span class="linenos">1121</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-1122"><a href="#AbstractMarkov-1122"><span class="linenos">1122</span></a>        <span class="c1"># get bounds on ml outputs</span>
</span><span id="AbstractMarkov-1123"><a href="#AbstractMarkov-1123"><span class="linenos">1123</span></a>        <span class="n">ml_bounds</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AbstractMarkov-1124"><a href="#AbstractMarkov-1124"><span class="linenos">1124</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_models</span><span class="p">)):</span>
</span><span id="AbstractMarkov-1125"><a href="#AbstractMarkov-1125"><span class="linenos">1125</span></a>            <span class="n">ml_bounds</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
</span><span id="AbstractMarkov-1126"><a href="#AbstractMarkov-1126"><span class="linenos">1126</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
</span><span id="AbstractMarkov-1127"><a href="#AbstractMarkov-1127"><span class="linenos">1127</span></a>                <span class="n">min_status</span><span class="p">,</span> <span class="n">min_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_ml_output</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">sense</span><span class="o">=</span><span class="s2">&quot;min&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="AbstractMarkov-1128"><a href="#AbstractMarkov-1128"><span class="linenos">1128</span></a>                <span class="n">max_status</span><span class="p">,</span> <span class="n">max_val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize_ml_output</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">sense</span><span class="o">=</span><span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="AbstractMarkov-1129"><a href="#AbstractMarkov-1129"><span class="linenos">1129</span></a>
</span><span id="AbstractMarkov-1130"><a href="#AbstractMarkov-1130"><span class="linenos">1130</span></a>                <span class="k">if</span> <span class="n">min_status</span> <span class="o">==</span> <span class="s1">&#39;infeasible&#39;</span> <span class="ow">or</span> <span class="n">max_status</span> <span class="o">==</span> <span class="s1">&#39;infeasible&#39;</span><span class="p">:</span>
</span><span id="AbstractMarkov-1131"><a href="#AbstractMarkov-1131"><span class="linenos">1131</span></a>                    <span class="n">ml_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">))</span>
</span><span id="AbstractMarkov-1132"><a href="#AbstractMarkov-1132"><span class="linenos">1132</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="AbstractMarkov-1133"><a href="#AbstractMarkov-1133"><span class="linenos">1133</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ML model </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> output </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2"> is infeasible&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-1134"><a href="#AbstractMarkov-1134"><span class="linenos">1134</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AbstractMarkov-1135"><a href="#AbstractMarkov-1135"><span class="linenos">1135</span></a>                    <span class="n">ml_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span><span class="p">))</span>
</span><span id="AbstractMarkov-1136"><a href="#AbstractMarkov-1136"><span class="linenos">1136</span></a>                    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
</span><span id="AbstractMarkov-1137"><a href="#AbstractMarkov-1137"><span class="linenos">1137</span></a>                        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;ML model </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> output </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2"> bounds: </span><span class="si">{</span><span class="n">min_val</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">max_val</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-1138"><a href="#AbstractMarkov-1138"><span class="linenos">1138</span></a>        <span class="k">return</span> <span class="n">ml_bounds</span>
</span><span id="AbstractMarkov-1139"><a href="#AbstractMarkov-1139"><span class="linenos">1139</span></a>
</span><span id="AbstractMarkov-1140"><a href="#AbstractMarkov-1140"><span class="linenos">1140</span></a>    <span class="k">def</span> <span class="nf">_set_ml_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ml_bounds</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span><span class="p">]]]):</span>
</span><span id="AbstractMarkov-1141"><a href="#AbstractMarkov-1141"><span class="linenos">1141</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-1142"><a href="#AbstractMarkov-1142"><span class="linenos">1142</span></a><span class="sd">        Set the bounds on the ML outputs.</span>
</span><span id="AbstractMarkov-1143"><a href="#AbstractMarkov-1143"><span class="linenos">1143</span></a>
</span><span id="AbstractMarkov-1144"><a href="#AbstractMarkov-1144"><span class="linenos">1144</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-1145"><a href="#AbstractMarkov-1145"><span class="linenos">1145</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-1146"><a href="#AbstractMarkov-1146"><span class="linenos">1146</span></a><span class="sd">        ml_bounds : list[list[tuple[float | None, float | None]]]</span>
</span><span id="AbstractMarkov-1147"><a href="#AbstractMarkov-1147"><span class="linenos">1147</span></a><span class="sd">            A list of lists of (max, min) tuples for each ML model and output</span>
</span><span id="AbstractMarkov-1148"><a href="#AbstractMarkov-1148"><span class="linenos">1148</span></a>
</span><span id="AbstractMarkov-1149"><a href="#AbstractMarkov-1149"><span class="linenos">1149</span></a><span class="sd">        Notes</span>
</span><span id="AbstractMarkov-1150"><a href="#AbstractMarkov-1150"><span class="linenos">1150</span></a><span class="sd">        -----</span>
</span><span id="AbstractMarkov-1151"><a href="#AbstractMarkov-1151"><span class="linenos">1151</span></a><span class="sd">        If a tuple is (None, None), this means that the ML model was</span>
</span><span id="AbstractMarkov-1152"><a href="#AbstractMarkov-1152"><span class="linenos">1152</span></a><span class="sd">        infeasible, so here we set the bounds to conflicting values,</span>
</span><span id="AbstractMarkov-1153"><a href="#AbstractMarkov-1153"><span class="linenos">1153</span></a><span class="sd">        so that the overall model is easily detected as infeasible.</span>
</span><span id="AbstractMarkov-1154"><a href="#AbstractMarkov-1154"><span class="linenos">1154</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-1155"><a href="#AbstractMarkov-1155"><span class="linenos">1155</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_models</span><span class="p">)):</span>
</span><span id="AbstractMarkov-1156"><a href="#AbstractMarkov-1156"><span class="linenos">1156</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">])):</span>
</span><span id="AbstractMarkov-1157"><a href="#AbstractMarkov-1157"><span class="linenos">1157</span></a>                <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">ml_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
</span><span id="AbstractMarkov-1158"><a href="#AbstractMarkov-1158"><span class="linenos">1158</span></a>                <span class="k">if</span> <span class="n">lb</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">ub</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AbstractMarkov-1159"><a href="#AbstractMarkov-1159"><span class="linenos">1159</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span> <span class="o">=</span> <span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span>
</span><span id="AbstractMarkov-1160"><a href="#AbstractMarkov-1160"><span class="linenos">1160</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span> <span class="o">=</span> <span class="o">-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span>
</span><span id="AbstractMarkov-1161"><a href="#AbstractMarkov-1161"><span class="linenos">1161</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="AbstractMarkov-1162"><a href="#AbstractMarkov-1162"><span class="linenos">1162</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="AbstractMarkov-1163"><a href="#AbstractMarkov-1163"><span class="linenos">1163</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="AbstractMarkov-1164"><a href="#AbstractMarkov-1164"><span class="linenos">1164</span></a>
</span><span id="AbstractMarkov-1165"><a href="#AbstractMarkov-1165"><span class="linenos">1165</span></a>    <span class="c1"># SOME HELPER FUNCTIONS</span>
</span><span id="AbstractMarkov-1166"><a href="#AbstractMarkov-1166"><span class="linenos">1166</span></a>
</span><span id="AbstractMarkov-1167"><a href="#AbstractMarkov-1167"><span class="linenos">1167</span></a>    <span class="k">def</span> <span class="nf">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">lb</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="AbstractMarkov-1168"><a href="#AbstractMarkov-1168"><span class="linenos">1168</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-1169"><a href="#AbstractMarkov-1169"><span class="linenos">1169</span></a><span class="sd">        Update the lower bound of a variable if the new bound is greater than the current bound.</span>
</span><span id="AbstractMarkov-1170"><a href="#AbstractMarkov-1170"><span class="linenos">1170</span></a><span class="sd">        Includes a check to ensure that the new bound is not greater than the upper bound.</span>
</span><span id="AbstractMarkov-1171"><a href="#AbstractMarkov-1171"><span class="linenos">1171</span></a>
</span><span id="AbstractMarkov-1172"><a href="#AbstractMarkov-1172"><span class="linenos">1172</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-1173"><a href="#AbstractMarkov-1173"><span class="linenos">1173</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-1174"><a href="#AbstractMarkov-1174"><span class="linenos">1174</span></a><span class="sd">        var : gp.Var</span>
</span><span id="AbstractMarkov-1175"><a href="#AbstractMarkov-1175"><span class="linenos">1175</span></a><span class="sd">            The variable to update the lower bound of</span>
</span><span id="AbstractMarkov-1176"><a href="#AbstractMarkov-1176"><span class="linenos">1176</span></a><span class="sd">        lb : float | int</span>
</span><span id="AbstractMarkov-1177"><a href="#AbstractMarkov-1177"><span class="linenos">1177</span></a><span class="sd">            The new lower bound</span>
</span><span id="AbstractMarkov-1178"><a href="#AbstractMarkov-1178"><span class="linenos">1178</span></a>
</span><span id="AbstractMarkov-1179"><a href="#AbstractMarkov-1179"><span class="linenos">1179</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-1180"><a href="#AbstractMarkov-1180"><span class="linenos">1180</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-1181"><a href="#AbstractMarkov-1181"><span class="linenos">1181</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov-1182"><a href="#AbstractMarkov-1182"><span class="linenos">1182</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-1183"><a href="#AbstractMarkov-1183"><span class="linenos">1183</span></a>        <span class="k">if</span> <span class="n">lb</span> <span class="o">&gt;</span> <span class="n">var</span><span class="o">.</span><span class="n">LB</span><span class="p">:</span>
</span><span id="AbstractMarkov-1184"><a href="#AbstractMarkov-1184"><span class="linenos">1184</span></a>            <span class="k">if</span> <span class="n">lb</span> <span class="o">&gt;</span> <span class="n">var</span><span class="o">.</span><span class="n">UB</span><span class="p">:</span>
</span><span id="AbstractMarkov-1185"><a href="#AbstractMarkov-1185"><span class="linenos">1185</span></a>                <span class="n">var</span><span class="o">.</span><span class="n">LB</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">UB</span>
</span><span id="AbstractMarkov-1186"><a href="#AbstractMarkov-1186"><span class="linenos">1186</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AbstractMarkov-1187"><a href="#AbstractMarkov-1187"><span class="linenos">1187</span></a>                <span class="n">var</span><span class="o">.</span><span class="n">LB</span> <span class="o">=</span> <span class="n">lb</span>
</span><span id="AbstractMarkov-1188"><a href="#AbstractMarkov-1188"><span class="linenos">1188</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="AbstractMarkov-1189"><a href="#AbstractMarkov-1189"><span class="linenos">1189</span></a>
</span><span id="AbstractMarkov-1190"><a href="#AbstractMarkov-1190"><span class="linenos">1190</span></a>    <span class="k">def</span> <span class="nf">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">ub</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="AbstractMarkov-1191"><a href="#AbstractMarkov-1191"><span class="linenos">1191</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-1192"><a href="#AbstractMarkov-1192"><span class="linenos">1192</span></a><span class="sd">        Update the upper bound of a variable if the new bound is less than the current bound.</span>
</span><span id="AbstractMarkov-1193"><a href="#AbstractMarkov-1193"><span class="linenos">1193</span></a><span class="sd">        Includes a check to ensure that the new bound is not less than the lower bound.</span>
</span><span id="AbstractMarkov-1194"><a href="#AbstractMarkov-1194"><span class="linenos">1194</span></a>
</span><span id="AbstractMarkov-1195"><a href="#AbstractMarkov-1195"><span class="linenos">1195</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-1196"><a href="#AbstractMarkov-1196"><span class="linenos">1196</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-1197"><a href="#AbstractMarkov-1197"><span class="linenos">1197</span></a><span class="sd">        var : gp.Var</span>
</span><span id="AbstractMarkov-1198"><a href="#AbstractMarkov-1198"><span class="linenos">1198</span></a><span class="sd">            The variable to update the upper bound of</span>
</span><span id="AbstractMarkov-1199"><a href="#AbstractMarkov-1199"><span class="linenos">1199</span></a><span class="sd">        ub : float | int</span>
</span><span id="AbstractMarkov-1200"><a href="#AbstractMarkov-1200"><span class="linenos">1200</span></a><span class="sd">            The new upper bound</span>
</span><span id="AbstractMarkov-1201"><a href="#AbstractMarkov-1201"><span class="linenos">1201</span></a>
</span><span id="AbstractMarkov-1202"><a href="#AbstractMarkov-1202"><span class="linenos">1202</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-1203"><a href="#AbstractMarkov-1203"><span class="linenos">1203</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-1204"><a href="#AbstractMarkov-1204"><span class="linenos">1204</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov-1205"><a href="#AbstractMarkov-1205"><span class="linenos">1205</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-1206"><a href="#AbstractMarkov-1206"><span class="linenos">1206</span></a>        <span class="k">if</span> <span class="n">ub</span> <span class="o">&lt;</span> <span class="n">var</span><span class="o">.</span><span class="n">UB</span><span class="p">:</span>
</span><span id="AbstractMarkov-1207"><a href="#AbstractMarkov-1207"><span class="linenos">1207</span></a>            <span class="k">if</span> <span class="n">ub</span> <span class="o">&lt;</span> <span class="n">var</span><span class="o">.</span><span class="n">LB</span><span class="p">:</span>
</span><span id="AbstractMarkov-1208"><a href="#AbstractMarkov-1208"><span class="linenos">1208</span></a>                <span class="n">var</span><span class="o">.</span><span class="n">UB</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">LB</span>
</span><span id="AbstractMarkov-1209"><a href="#AbstractMarkov-1209"><span class="linenos">1209</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AbstractMarkov-1210"><a href="#AbstractMarkov-1210"><span class="linenos">1210</span></a>                <span class="n">var</span><span class="o">.</span><span class="n">UB</span> <span class="o">=</span> <span class="n">ub</span>
</span><span id="AbstractMarkov-1211"><a href="#AbstractMarkov-1211"><span class="linenos">1211</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="AbstractMarkov-1212"><a href="#AbstractMarkov-1212"><span class="linenos">1212</span></a>
</span><span id="AbstractMarkov-1213"><a href="#AbstractMarkov-1213"><span class="linenos">1213</span></a>    <span class="k">def</span> <span class="nf">_compute_expr_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">,</span> <span class="n">bounds_dict</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="AbstractMarkov-1214"><a href="#AbstractMarkov-1214"><span class="linenos">1214</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-1215"><a href="#AbstractMarkov-1215"><span class="linenos">1215</span></a><span class="sd">        Compute bounds for an affine expression given bounds on its variables.</span>
</span><span id="AbstractMarkov-1216"><a href="#AbstractMarkov-1216"><span class="linenos">1216</span></a>
</span><span id="AbstractMarkov-1217"><a href="#AbstractMarkov-1217"><span class="linenos">1217</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-1218"><a href="#AbstractMarkov-1218"><span class="linenos">1218</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-1219"><a href="#AbstractMarkov-1219"><span class="linenos">1219</span></a><span class="sd">        expr : gp.LinExpr</span>
</span><span id="AbstractMarkov-1220"><a href="#AbstractMarkov-1220"><span class="linenos">1220</span></a><span class="sd">            The affine expression to compute bounds for</span>
</span><span id="AbstractMarkov-1221"><a href="#AbstractMarkov-1221"><span class="linenos">1221</span></a><span class="sd">        bounds_dict : dict</span>
</span><span id="AbstractMarkov-1222"><a href="#AbstractMarkov-1222"><span class="linenos">1222</span></a><span class="sd">            A dictionary mapping variable names to (min, max) bounds</span>
</span><span id="AbstractMarkov-1223"><a href="#AbstractMarkov-1223"><span class="linenos">1223</span></a>
</span><span id="AbstractMarkov-1224"><a href="#AbstractMarkov-1224"><span class="linenos">1224</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-1225"><a href="#AbstractMarkov-1225"><span class="linenos">1225</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-1226"><a href="#AbstractMarkov-1226"><span class="linenos">1226</span></a><span class="sd">        tuple</span>
</span><span id="AbstractMarkov-1227"><a href="#AbstractMarkov-1227"><span class="linenos">1227</span></a><span class="sd">            A tuple containing the lower and upper bounds of the expression</span>
</span><span id="AbstractMarkov-1228"><a href="#AbstractMarkov-1228"><span class="linenos">1228</span></a>
</span><span id="AbstractMarkov-1229"><a href="#AbstractMarkov-1229"><span class="linenos">1229</span></a><span class="sd">        Notes</span>
</span><span id="AbstractMarkov-1230"><a href="#AbstractMarkov-1230"><span class="linenos">1230</span></a><span class="sd">        -----</span>
</span><span id="AbstractMarkov-1231"><a href="#AbstractMarkov-1231"><span class="linenos">1231</span></a><span class="sd">        Just simple check of the coefficients and their signs, and sums up appropriate bounds.</span>
</span><span id="AbstractMarkov-1232"><a href="#AbstractMarkov-1232"><span class="linenos">1232</span></a><span class="sd">        Used to propagate bounds on ML outputs to the the parameters of the Markov process.</span>
</span><span id="AbstractMarkov-1233"><a href="#AbstractMarkov-1233"><span class="linenos">1233</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-1234"><a href="#AbstractMarkov-1234"><span class="linenos">1234</span></a>        <span class="n">lb</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="AbstractMarkov-1235"><a href="#AbstractMarkov-1235"><span class="linenos">1235</span></a>        <span class="n">ub</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="AbstractMarkov-1236"><a href="#AbstractMarkov-1236"><span class="linenos">1236</span></a>
</span><span id="AbstractMarkov-1237"><a href="#AbstractMarkov-1237"><span class="linenos">1237</span></a>        <span class="c1"># Handle constant term</span>
</span><span id="AbstractMarkov-1238"><a href="#AbstractMarkov-1238"><span class="linenos">1238</span></a>        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="s1">&#39;getConstant&#39;</span><span class="p">):</span>
</span><span id="AbstractMarkov-1239"><a href="#AbstractMarkov-1239"><span class="linenos">1239</span></a>            <span class="n">const</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">getConstant</span><span class="p">()</span>
</span><span id="AbstractMarkov-1240"><a href="#AbstractMarkov-1240"><span class="linenos">1240</span></a>            <span class="n">lb</span> <span class="o">+=</span> <span class="n">const</span>
</span><span id="AbstractMarkov-1241"><a href="#AbstractMarkov-1241"><span class="linenos">1241</span></a>            <span class="n">ub</span> <span class="o">+=</span> <span class="n">const</span>
</span><span id="AbstractMarkov-1242"><a href="#AbstractMarkov-1242"><span class="linenos">1242</span></a>
</span><span id="AbstractMarkov-1243"><a href="#AbstractMarkov-1243"><span class="linenos">1243</span></a>        <span class="c1"># Handle variables</span>
</span><span id="AbstractMarkov-1244"><a href="#AbstractMarkov-1244"><span class="linenos">1244</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
</span><span id="AbstractMarkov-1245"><a href="#AbstractMarkov-1245"><span class="linenos">1245</span></a>            <span class="n">coeff</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">getCoeff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="AbstractMarkov-1246"><a href="#AbstractMarkov-1246"><span class="linenos">1246</span></a>            <span class="n">var</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">getVar</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="AbstractMarkov-1247"><a href="#AbstractMarkov-1247"><span class="linenos">1247</span></a>            <span class="n">var_bounds</span> <span class="o">=</span> <span class="n">bounds_dict</span><span class="p">[</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">]</span>
</span><span id="AbstractMarkov-1248"><a href="#AbstractMarkov-1248"><span class="linenos">1248</span></a>
</span><span id="AbstractMarkov-1249"><a href="#AbstractMarkov-1249"><span class="linenos">1249</span></a>            <span class="c1"># If coefficient is positive, use min for LB and max for UB</span>
</span><span id="AbstractMarkov-1250"><a href="#AbstractMarkov-1250"><span class="linenos">1250</span></a>            <span class="k">if</span> <span class="n">coeff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="AbstractMarkov-1251"><a href="#AbstractMarkov-1251"><span class="linenos">1251</span></a>                <span class="n">lb</span> <span class="o">+=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">var_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AbstractMarkov-1252"><a href="#AbstractMarkov-1252"><span class="linenos">1252</span></a>                <span class="n">ub</span> <span class="o">+=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">var_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="AbstractMarkov-1253"><a href="#AbstractMarkov-1253"><span class="linenos">1253</span></a>            <span class="c1"># If coefficient is negative, use max for LB and min for UB</span>
</span><span id="AbstractMarkov-1254"><a href="#AbstractMarkov-1254"><span class="linenos">1254</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AbstractMarkov-1255"><a href="#AbstractMarkov-1255"><span class="linenos">1255</span></a>                <span class="n">lb</span> <span class="o">+=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">var_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="AbstractMarkov-1256"><a href="#AbstractMarkov-1256"><span class="linenos">1256</span></a>                <span class="n">ub</span> <span class="o">+=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">var_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="AbstractMarkov-1257"><a href="#AbstractMarkov-1257"><span class="linenos">1257</span></a>
</span><span id="AbstractMarkov-1258"><a href="#AbstractMarkov-1258"><span class="linenos">1258</span></a>        <span class="k">return</span> <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span>
</span><span id="AbstractMarkov-1259"><a href="#AbstractMarkov-1259"><span class="linenos">1259</span></a>
</span><span id="AbstractMarkov-1260"><a href="#AbstractMarkov-1260"><span class="linenos">1260</span></a>    <span class="k">def</span> <span class="nf">_get_ml_expr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">):</span>
</span><span id="AbstractMarkov-1261"><a href="#AbstractMarkov-1261"><span class="linenos">1261</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-1262"><a href="#AbstractMarkov-1262"><span class="linenos">1262</span></a><span class="sd">        Gets the affine expression for a parameter set to an ML output. Isolates the variable.</span>
</span><span id="AbstractMarkov-1263"><a href="#AbstractMarkov-1263"><span class="linenos">1263</span></a><span class="sd">        This is used to propagate bounds on ML outputs to the the parameters of the Markov process.</span>
</span><span id="AbstractMarkov-1264"><a href="#AbstractMarkov-1264"><span class="linenos">1264</span></a>
</span><span id="AbstractMarkov-1265"><a href="#AbstractMarkov-1265"><span class="linenos">1265</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-1266"><a href="#AbstractMarkov-1266"><span class="linenos">1266</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-1267"><a href="#AbstractMarkov-1267"><span class="linenos">1267</span></a><span class="sd">        var : gp.Var</span>
</span><span id="AbstractMarkov-1268"><a href="#AbstractMarkov-1268"><span class="linenos">1268</span></a><span class="sd">            The variable to get the ML expression for</span>
</span><span id="AbstractMarkov-1269"><a href="#AbstractMarkov-1269"><span class="linenos">1269</span></a>
</span><span id="AbstractMarkov-1270"><a href="#AbstractMarkov-1270"><span class="linenos">1270</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-1271"><a href="#AbstractMarkov-1271"><span class="linenos">1271</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-1272"><a href="#AbstractMarkov-1272"><span class="linenos">1272</span></a><span class="sd">        gp.LinExpr</span>
</span><span id="AbstractMarkov-1273"><a href="#AbstractMarkov-1273"><span class="linenos">1273</span></a><span class="sd">            The linear expression for the ML output</span>
</span><span id="AbstractMarkov-1274"><a href="#AbstractMarkov-1274"><span class="linenos">1274</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-1275"><a href="#AbstractMarkov-1275"><span class="linenos">1275</span></a>        <span class="n">constr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getConstrByName</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;set_to_ml_output_</span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-1276"><a href="#AbstractMarkov-1276"><span class="linenos">1276</span></a>        <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getRow</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>  <span class="c1"># Gets the full expression (pi[0] + x[0] - 1 == 0)</span>
</span><span id="AbstractMarkov-1277"><a href="#AbstractMarkov-1277"><span class="linenos">1277</span></a>        <span class="n">rhs</span> <span class="o">=</span> <span class="n">constr</span><span class="o">.</span><span class="n">RHS</span>
</span><span id="AbstractMarkov-1278"><a href="#AbstractMarkov-1278"><span class="linenos">1278</span></a>        <span class="c1"># Collect terms with and without our variable</span>
</span><span id="AbstractMarkov-1279"><a href="#AbstractMarkov-1279"><span class="linenos">1279</span></a>        <span class="n">var_coeff</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="AbstractMarkov-1280"><a href="#AbstractMarkov-1280"><span class="linenos">1280</span></a>        <span class="n">other_terms</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">()</span>
</span><span id="AbstractMarkov-1281"><a href="#AbstractMarkov-1281"><span class="linenos">1281</span></a>        <span class="n">const</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">getConstant</span><span class="p">()</span>
</span><span id="AbstractMarkov-1282"><a href="#AbstractMarkov-1282"><span class="linenos">1282</span></a>
</span><span id="AbstractMarkov-1283"><a href="#AbstractMarkov-1283"><span class="linenos">1283</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">expr</span><span class="o">.</span><span class="n">size</span><span class="p">()):</span>
</span><span id="AbstractMarkov-1284"><a href="#AbstractMarkov-1284"><span class="linenos">1284</span></a>            <span class="n">coeff</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">getCoeff</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="AbstractMarkov-1285"><a href="#AbstractMarkov-1285"><span class="linenos">1285</span></a>            <span class="n">term_var</span> <span class="o">=</span> <span class="n">expr</span><span class="o">.</span><span class="n">getVar</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="AbstractMarkov-1286"><a href="#AbstractMarkov-1286"><span class="linenos">1286</span></a>            <span class="k">if</span> <span class="n">term_var</span><span class="o">.</span><span class="n">VarName</span> <span class="o">==</span> <span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="p">:</span>
</span><span id="AbstractMarkov-1287"><a href="#AbstractMarkov-1287"><span class="linenos">1287</span></a>                <span class="n">var_coeff</span> <span class="o">=</span> <span class="n">coeff</span>
</span><span id="AbstractMarkov-1288"><a href="#AbstractMarkov-1288"><span class="linenos">1288</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="AbstractMarkov-1289"><a href="#AbstractMarkov-1289"><span class="linenos">1289</span></a>                <span class="n">other_terms</span> <span class="o">+=</span> <span class="n">coeff</span> <span class="o">*</span> <span class="n">term_var</span>
</span><span id="AbstractMarkov-1290"><a href="#AbstractMarkov-1290"><span class="linenos">1290</span></a>
</span><span id="AbstractMarkov-1291"><a href="#AbstractMarkov-1291"><span class="linenos">1291</span></a>        <span class="c1"># Rearrange to isolate var: var = (rhs - other_terms - const) / var_coeff</span>
</span><span id="AbstractMarkov-1292"><a href="#AbstractMarkov-1292"><span class="linenos">1292</span></a>        <span class="k">if</span> <span class="n">var_coeff</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="AbstractMarkov-1293"><a href="#AbstractMarkov-1293"><span class="linenos">1293</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not find variable </span><span class="si">{</span><span class="n">var</span><span class="o">.</span><span class="n">VarName</span><span class="si">}</span><span class="s2"> in its ML constraint&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-1294"><a href="#AbstractMarkov-1294"><span class="linenos">1294</span></a>        <span class="k">return</span> <span class="p">(</span><span class="n">rhs</span> <span class="o">-</span> <span class="n">other_terms</span> <span class="o">-</span> <span class="n">const</span><span class="p">)</span> <span class="o">/</span> <span class="n">var_coeff</span>
</span><span id="AbstractMarkov-1295"><a href="#AbstractMarkov-1295"><span class="linenos">1295</span></a>
</span><span id="AbstractMarkov-1296"><a href="#AbstractMarkov-1296"><span class="linenos">1296</span></a>    <span class="k">def</span> <span class="nf">_parse_var_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="AbstractMarkov-1297"><a href="#AbstractMarkov-1297"><span class="linenos">1297</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-1298"><a href="#AbstractMarkov-1298"><span class="linenos">1298</span></a><span class="sd">        Parse indices from Gurobi variable names like &#39;pi[0]&#39;, &#39;r[1]&#39;, or &#39;P[0,1]&#39;</span>
</span><span id="AbstractMarkov-1299"><a href="#AbstractMarkov-1299"><span class="linenos">1299</span></a><span class="sd">        Returns int for single indices and tuple for multiple indices.</span>
</span><span id="AbstractMarkov-1300"><a href="#AbstractMarkov-1300"><span class="linenos">1300</span></a>
</span><span id="AbstractMarkov-1301"><a href="#AbstractMarkov-1301"><span class="linenos">1301</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-1302"><a href="#AbstractMarkov-1302"><span class="linenos">1302</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-1303"><a href="#AbstractMarkov-1303"><span class="linenos">1303</span></a><span class="sd">        var_name : str</span>
</span><span id="AbstractMarkov-1304"><a href="#AbstractMarkov-1304"><span class="linenos">1304</span></a><span class="sd">            The name of the Gurobi variable (e.g., &#39;pi[0]&#39;, &#39;P[0,1]&#39;)</span>
</span><span id="AbstractMarkov-1305"><a href="#AbstractMarkov-1305"><span class="linenos">1305</span></a>
</span><span id="AbstractMarkov-1306"><a href="#AbstractMarkov-1306"><span class="linenos">1306</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-1307"><a href="#AbstractMarkov-1307"><span class="linenos">1307</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-1308"><a href="#AbstractMarkov-1308"><span class="linenos">1308</span></a><span class="sd">        int | tuple</span>
</span><span id="AbstractMarkov-1309"><a href="#AbstractMarkov-1309"><span class="linenos">1309</span></a><span class="sd">            Single index (e.g., 0 for &#39;pi[0]&#39;) or tuple of indices (e.g., (0,1) for &#39;P[0,1]&#39;)</span>
</span><span id="AbstractMarkov-1310"><a href="#AbstractMarkov-1310"><span class="linenos">1310</span></a>
</span><span id="AbstractMarkov-1311"><a href="#AbstractMarkov-1311"><span class="linenos">1311</span></a><span class="sd">        Raises</span>
</span><span id="AbstractMarkov-1312"><a href="#AbstractMarkov-1312"><span class="linenos">1312</span></a><span class="sd">        ------</span>
</span><span id="AbstractMarkov-1313"><a href="#AbstractMarkov-1313"><span class="linenos">1313</span></a><span class="sd">        ValueError</span>
</span><span id="AbstractMarkov-1314"><a href="#AbstractMarkov-1314"><span class="linenos">1314</span></a><span class="sd">            If the variable name cannot be parsed</span>
</span><span id="AbstractMarkov-1315"><a href="#AbstractMarkov-1315"><span class="linenos">1315</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-1316"><a href="#AbstractMarkov-1316"><span class="linenos">1316</span></a>        <span class="n">pattern</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\[(\d+)(?:,(\d+))?\]&#39;</span>
</span><span id="AbstractMarkov-1317"><a href="#AbstractMarkov-1317"><span class="linenos">1317</span></a>        <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">pattern</span><span class="p">,</span> <span class="n">var_name</span><span class="p">)</span>
</span><span id="AbstractMarkov-1318"><a href="#AbstractMarkov-1318"><span class="linenos">1318</span></a>
</span><span id="AbstractMarkov-1319"><a href="#AbstractMarkov-1319"><span class="linenos">1319</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">match</span><span class="p">:</span>
</span><span id="AbstractMarkov-1320"><a href="#AbstractMarkov-1320"><span class="linenos">1320</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Could not parse indices from variable name: </span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov-1321"><a href="#AbstractMarkov-1321"><span class="linenos">1321</span></a>
</span><span id="AbstractMarkov-1322"><a href="#AbstractMarkov-1322"><span class="linenos">1322</span></a>        <span class="c1"># Filter out None values and convert to integers</span>
</span><span id="AbstractMarkov-1323"><a href="#AbstractMarkov-1323"><span class="linenos">1323</span></a>        <span class="n">indices</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">match</span><span class="o">.</span><span class="n">groups</span><span class="p">()</span> <span class="k">if</span> <span class="n">idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="AbstractMarkov-1324"><a href="#AbstractMarkov-1324"><span class="linenos">1324</span></a>
</span><span id="AbstractMarkov-1325"><a href="#AbstractMarkov-1325"><span class="linenos">1325</span></a>        <span class="c1"># Return single integer if only one index, otherwise return tuple</span>
</span><span id="AbstractMarkov-1326"><a href="#AbstractMarkov-1326"><span class="linenos">1326</span></a>        <span class="k">return</span> <span class="n">indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">indices</span>
</span><span id="AbstractMarkov-1327"><a href="#AbstractMarkov-1327"><span class="linenos">1327</span></a>
</span><span id="AbstractMarkov-1328"><a href="#AbstractMarkov-1328"><span class="linenos">1328</span></a>    <span class="k">def</span> <span class="nf">_seq_is_all_const</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span> <span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="n">Any</span><span class="p">]]):</span>
</span><span id="AbstractMarkov-1329"><a href="#AbstractMarkov-1329"><span class="linenos">1329</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-1330"><a href="#AbstractMarkov-1330"><span class="linenos">1330</span></a><span class="sd">        Check if all elements in sequence (1D or 2D) are constants.</span>
</span><span id="AbstractMarkov-1331"><a href="#AbstractMarkov-1331"><span class="linenos">1331</span></a><span class="sd">        Specifically, checks if they are all floats or ints.</span>
</span><span id="AbstractMarkov-1332"><a href="#AbstractMarkov-1332"><span class="linenos">1332</span></a>
</span><span id="AbstractMarkov-1333"><a href="#AbstractMarkov-1333"><span class="linenos">1333</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov-1334"><a href="#AbstractMarkov-1334"><span class="linenos">1334</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov-1335"><a href="#AbstractMarkov-1335"><span class="linenos">1335</span></a><span class="sd">        seq : Sequence[Any] | Sequence[Sequence[Any]]</span>
</span><span id="AbstractMarkov-1336"><a href="#AbstractMarkov-1336"><span class="linenos">1336</span></a><span class="sd">            The sequence to check</span>
</span><span id="AbstractMarkov-1337"><a href="#AbstractMarkov-1337"><span class="linenos">1337</span></a>
</span><span id="AbstractMarkov-1338"><a href="#AbstractMarkov-1338"><span class="linenos">1338</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov-1339"><a href="#AbstractMarkov-1339"><span class="linenos">1339</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov-1340"><a href="#AbstractMarkov-1340"><span class="linenos">1340</span></a><span class="sd">        bool</span>
</span><span id="AbstractMarkov-1341"><a href="#AbstractMarkov-1341"><span class="linenos">1341</span></a><span class="sd">            True if all elements in the sequence are constants, False otherwise</span>
</span><span id="AbstractMarkov-1342"><a href="#AbstractMarkov-1342"><span class="linenos">1342</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov-1343"><a href="#AbstractMarkov-1343"><span class="linenos">1343</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">seq</span><span class="p">:</span>
</span><span id="AbstractMarkov-1344"><a href="#AbstractMarkov-1344"><span class="linenos">1344</span></a>            <span class="k">return</span> <span class="kc">True</span>
</span><span id="AbstractMarkov-1345"><a href="#AbstractMarkov-1345"><span class="linenos">1345</span></a>
</span><span id="AbstractMarkov-1346"><a href="#AbstractMarkov-1346"><span class="linenos">1346</span></a>        <span class="c1"># If first element is a sequence (except string), treat as 2D</span>
</span><span id="AbstractMarkov-1347"><a href="#AbstractMarkov-1347"><span class="linenos">1347</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">))</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="AbstractMarkov-1348"><a href="#AbstractMarkov-1348"><span class="linenos">1348</span></a>            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span>
</span><span id="AbstractMarkov-1349"><a href="#AbstractMarkov-1349"><span class="linenos">1349</span></a>                    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">seq</span>
</span><span id="AbstractMarkov-1350"><a href="#AbstractMarkov-1350"><span class="linenos">1350</span></a>                    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">row</span><span class="p">)</span>
</span><span id="AbstractMarkov-1351"><a href="#AbstractMarkov-1351"><span class="linenos">1351</span></a>        <span class="c1"># Otherwise treat as 1D</span>
</span><span id="AbstractMarkov-1352"><a href="#AbstractMarkov-1352"><span class="linenos">1352</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AbstractMarkov-1353"><a href="#AbstractMarkov-1353"><span class="linenos">1353</span></a>            <span class="k">return</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">))</span>
</span><span id="AbstractMarkov-1354"><a href="#AbstractMarkov-1354"><span class="linenos">1354</span></a>                    <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>This is an abstract class for Markov processes with ML models embedded.
It implements all the basic functionality for setting up a Markov process,
adding ML models, defining the feature space, and optimizing, including
with the decomposition and bound propagation scheme from the paper.
It will be subclassed by <code><a href="#MarkovReward">MarkovReward</a></code>, <code><a href="#MarkovReach">MarkovReach</a></code>, and <code><a href="#MarkovHitting">MarkovHitting</a></code>,
which specialize the functionality to the specific problems.</p>
</div>


                            <div id="AbstractMarkov.__init__" class="classattr">
                                        <input id="AbstractMarkov.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">AbstractMarkov</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">n_states</span><span class="p">:</span> <span class="nb">int</span>, </span><span class="param"><span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span></span>)</span>

                <label class="view-source-button" for="AbstractMarkov.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AbstractMarkov.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AbstractMarkov.__init__-118"><a href="#AbstractMarkov.__init__-118"><span class="linenos">118</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_states</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="AbstractMarkov.__init__-119"><a href="#AbstractMarkov.__init__-119"><span class="linenos">119</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.__init__-120"><a href="#AbstractMarkov.__init__-120"><span class="linenos">120</span></a><span class="sd">        Initialize the Markov process with the given number of states and features.</span>
</span><span id="AbstractMarkov.__init__-121"><a href="#AbstractMarkov.__init__-121"><span class="linenos">121</span></a>
</span><span id="AbstractMarkov.__init__-122"><a href="#AbstractMarkov.__init__-122"><span class="linenos">122</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov.__init__-123"><a href="#AbstractMarkov.__init__-123"><span class="linenos">123</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov.__init__-124"><a href="#AbstractMarkov.__init__-124"><span class="linenos">124</span></a><span class="sd">        n_states : int</span>
</span><span id="AbstractMarkov.__init__-125"><a href="#AbstractMarkov.__init__-125"><span class="linenos">125</span></a><span class="sd">            Number of states in the Markov process (`n` in the paper)</span>
</span><span id="AbstractMarkov.__init__-126"><a href="#AbstractMarkov.__init__-126"><span class="linenos">126</span></a><span class="sd">        n_features : int</span>
</span><span id="AbstractMarkov.__init__-127"><a href="#AbstractMarkov.__init__-127"><span class="linenos">127</span></a><span class="sd">            Number of features in the Markov process (`m` in the paper)</span>
</span><span id="AbstractMarkov.__init__-128"><a href="#AbstractMarkov.__init__-128"><span class="linenos">128</span></a>
</span><span id="AbstractMarkov.__init__-129"><a href="#AbstractMarkov.__init__-129"><span class="linenos">129</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov.__init__-130"><a href="#AbstractMarkov.__init__-130"><span class="linenos">130</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov.__init__-131"><a href="#AbstractMarkov.__init__-131"><span class="linenos">131</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov.__init__-132"><a href="#AbstractMarkov.__init__-132"><span class="linenos">132</span></a>
</span><span id="AbstractMarkov.__init__-133"><a href="#AbstractMarkov.__init__-133"><span class="linenos">133</span></a><span class="sd">        Notes</span>
</span><span id="AbstractMarkov.__init__-134"><a href="#AbstractMarkov.__init__-134"><span class="linenos">134</span></a><span class="sd">        -----</span>
</span><span id="AbstractMarkov.__init__-135"><a href="#AbstractMarkov.__init__-135"><span class="linenos">135</span></a><span class="sd">        This initializes the basic attributes of the Markov process including:</span>
</span><span id="AbstractMarkov.__init__-136"><a href="#AbstractMarkov.__init__-136"><span class="linenos">136</span></a><span class="sd">        - Number of states and features</span>
</span><span id="AbstractMarkov.__init__-137"><a href="#AbstractMarkov.__init__-137"><span class="linenos">137</span></a><span class="sd">        - Gurobi optimization model</span>
</span><span id="AbstractMarkov.__init__-138"><a href="#AbstractMarkov.__init__-138"><span class="linenos">138</span></a><span class="sd">        - Parameter dictionaries for variables, ML output flags, and dimensions</span>
</span><span id="AbstractMarkov.__init__-139"><a href="#AbstractMarkov.__init__-139"><span class="linenos">139</span></a><span class="sd">        - Feature space variables and constraints</span>
</span><span id="AbstractMarkov.__init__-140"><a href="#AbstractMarkov.__init__-140"><span class="linenos">140</span></a><span class="sd">        - ML model and output storage</span>
</span><span id="AbstractMarkov.__init__-141"><a href="#AbstractMarkov.__init__-141"><span class="linenos">141</span></a>
</span><span id="AbstractMarkov.__init__-142"><a href="#AbstractMarkov.__init__-142"><span class="linenos">142</span></a><span class="sd">        Subclasses will have additional attributes in their constructors.</span>
</span><span id="AbstractMarkov.__init__-143"><a href="#AbstractMarkov.__init__-143"><span class="linenos">143</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.__init__-144"><a href="#AbstractMarkov.__init__-144"><span class="linenos">144</span></a>        <span class="c1"># basic attributes</span>
</span><span id="AbstractMarkov.__init__-145"><a href="#AbstractMarkov.__init__-145"><span class="linenos">145</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span> <span class="o">=</span> <span class="n">n_states</span>
</span><span id="AbstractMarkov.__init__-146"><a href="#AbstractMarkov.__init__-146"><span class="linenos">146</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_features</span> <span class="o">=</span> <span class="n">n_features</span>
</span><span id="AbstractMarkov.__init__-147"><a href="#AbstractMarkov.__init__-147"><span class="linenos">147</span></a>
</span><span id="AbstractMarkov.__init__-148"><a href="#AbstractMarkov.__init__-148"><span class="linenos">148</span></a>        <span class="c1"># create the main optimization model</span>
</span><span id="AbstractMarkov.__init__-149"><a href="#AbstractMarkov.__init__-149"><span class="linenos">149</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">Model</span><span class="p">(</span><span class="s2">&quot;mainmodel&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov.__init__-150"><a href="#AbstractMarkov.__init__-150"><span class="linenos">150</span></a>
</span><span id="AbstractMarkov.__init__-151"><a href="#AbstractMarkov.__init__-151"><span class="linenos">151</span></a>        <span class="c1"># store the paramaters</span>
</span><span id="AbstractMarkov.__init__-152"><a href="#AbstractMarkov.__init__-152"><span class="linenos">152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AbstractMarkov.__init__-153"><a href="#AbstractMarkov.__init__-153"><span class="linenos">153</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AbstractMarkov.__init__-154"><a href="#AbstractMarkov.__init__-154"><span class="linenos">154</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AbstractMarkov.__init__-155"><a href="#AbstractMarkov.__init__-155"><span class="linenos">155</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="AbstractMarkov.__init__-156"><a href="#AbstractMarkov.__init__-156"><span class="linenos">156</span></a>
</span><span id="AbstractMarkov.__init__-157"><a href="#AbstractMarkov.__init__-157"><span class="linenos">157</span></a>        <span class="c1"># create the feature space</span>
</span><span id="AbstractMarkov.__init__-158"><a href="#AbstractMarkov.__init__-158"><span class="linenos">158</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="AbstractMarkov.__init__-159"><a href="#AbstractMarkov.__init__-159"><span class="linenos">159</span></a>            <span class="n">n_features</span><span class="p">,</span>
</span><span id="AbstractMarkov.__init__-160"><a href="#AbstractMarkov.__init__-160"><span class="linenos">160</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;features&quot;</span><span class="p">,</span>
</span><span id="AbstractMarkov.__init__-161"><a href="#AbstractMarkov.__init__-161"><span class="linenos">161</span></a>            <span class="n">lb</span><span class="o">=-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="AbstractMarkov.__init__-162"><a href="#AbstractMarkov.__init__-162"><span class="linenos">162</span></a>            <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="AbstractMarkov.__init__-163"><a href="#AbstractMarkov.__init__-163"><span class="linenos">163</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="AbstractMarkov.__init__-164"><a href="#AbstractMarkov.__init__-164"><span class="linenos">164</span></a>        <span class="p">)</span>
</span><span id="AbstractMarkov.__init__-165"><a href="#AbstractMarkov.__init__-165"><span class="linenos">165</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_aux</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AbstractMarkov.__init__-166"><a href="#AbstractMarkov.__init__-166"><span class="linenos">166</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_constraints</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AbstractMarkov.__init__-167"><a href="#AbstractMarkov.__init__-167"><span class="linenos">167</span></a>
</span><span id="AbstractMarkov.__init__-168"><a href="#AbstractMarkov.__init__-168"><span class="linenos">168</span></a>        <span class="c1"># store the ml models</span>
</span><span id="AbstractMarkov.__init__-169"><a href="#AbstractMarkov.__init__-169"><span class="linenos">169</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ml_models</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="AbstractMarkov.__init__-170"><a href="#AbstractMarkov.__init__-170"><span class="linenos">170</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span> <span class="o">=</span> <span class="p">[]</span>
</span></pre></div>


            <div class="docstring"><p>Initialize the Markov process with the given number of states and features.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>n_states</strong> (int):
Number of states in the Markov process (<code>n</code> in the paper)</li>
<li><strong>n_features</strong> (int):
Number of features in the Markov process (<code>m</code> in the paper)</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="notes">Notes</h6>

<p>This initializes the basic attributes of the Markov process including:</p>

<ul>
<li>Number of states and features</li>
<li>Gurobi optimization model</li>
<li>Parameter dictionaries for variables, ML output flags, and dimensions</li>
<li>Feature space variables and constraints</li>
<li>ML model and output storage</li>
</ul>

<p>Subclasses will have additional attributes in their constructors.</p>
</div>


                            </div>
                            <div id="AbstractMarkov.n_states" class="classattr">
                                <div class="attr variable">
            <span class="name">n_states</span>

        
    </div>
    <a class="headerlink" href="#AbstractMarkov.n_states"></a>
    
    

                            </div>
                            <div id="AbstractMarkov.n_features" class="classattr">
                                <div class="attr variable">
            <span class="name">n_features</span>

        
    </div>
    <a class="headerlink" href="#AbstractMarkov.n_features"></a>
    
    

                            </div>
                            <div id="AbstractMarkov.model" class="classattr">
                                <div class="attr variable">
            <span class="name">model</span>

        
    </div>
    <a class="headerlink" href="#AbstractMarkov.model"></a>
    
    

                            </div>
                            <div id="AbstractMarkov.variables" class="classattr">
                                <div class="attr variable">
            <span class="name">variables</span><span class="annotation">: Dict[str, gurobipy._core.Var]</span>

        
    </div>
    <a class="headerlink" href="#AbstractMarkov.variables"></a>
    
    

                            </div>
                            <div id="AbstractMarkov.features" class="classattr">
                                <div class="attr variable">
            <span class="name">features</span>

        
    </div>
    <a class="headerlink" href="#AbstractMarkov.features"></a>
    
    

                            </div>
                            <div id="AbstractMarkov.feature_aux" class="classattr">
                                <div class="attr variable">
            <span class="name">feature_aux</span>

        
    </div>
    <a class="headerlink" href="#AbstractMarkov.feature_aux"></a>
    
    

                            </div>
                            <div id="AbstractMarkov.feature_constraints" class="classattr">
                                <div class="attr variable">
            <span class="name">feature_constraints</span>

        
    </div>
    <a class="headerlink" href="#AbstractMarkov.feature_constraints"></a>
    
    

                            </div>
                            <div id="AbstractMarkov.ml_models" class="classattr">
                                <div class="attr variable">
            <span class="name">ml_models</span>

        
    </div>
    <a class="headerlink" href="#AbstractMarkov.ml_models"></a>
    
    

                            </div>
                            <div id="AbstractMarkov.ml_outputs" class="classattr">
                                <div class="attr variable">
            <span class="name">ml_outputs</span>

        
    </div>
    <a class="headerlink" href="#AbstractMarkov.ml_outputs"></a>
    
    

                            </div>
                            <div id="AbstractMarkov.get_values" class="classattr">
                                        <input id="AbstractMarkov.get_values-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator decorator-abstractmethod">@abstractmethod</div>

        <span class="def">def</span>
        <span class="name">get_values</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AbstractMarkov.get_values-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AbstractMarkov.get_values"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AbstractMarkov.get_values-210"><a href="#AbstractMarkov.get_values-210"><span class="linenos">210</span></a>    <span class="nd">@abstractmethod</span>
</span><span id="AbstractMarkov.get_values-211"><a href="#AbstractMarkov.get_values-211"><span class="linenos">211</span></a>    <span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="AbstractMarkov.get_values-212"><a href="#AbstractMarkov.get_values-212"><span class="linenos">212</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.get_values-213"><a href="#AbstractMarkov.get_values-213"><span class="linenos">213</span></a><span class="sd">        Get values of the key variables of the Markov process after optimization.</span>
</span><span id="AbstractMarkov.get_values-214"><a href="#AbstractMarkov.get_values-214"><span class="linenos">214</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.get_values-215"><a href="#AbstractMarkov.get_values-215"><span class="linenos">215</span></a>        <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Get values of the key variables of the Markov process after optimization.</p>
</div>


                            </div>
                            <div id="AbstractMarkov.set_to_ml_output" class="classattr">
                                        <input id="AbstractMarkov.set_to_ml_output-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_to_ml_output</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">var</span><span class="p">:</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">Var</span>,</span><span class="param">	<span class="n">expr</span><span class="p">:</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">LinExpr</span> <span class="o">|</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">Var</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AbstractMarkov.set_to_ml_output-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AbstractMarkov.set_to_ml_output"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AbstractMarkov.set_to_ml_output-490"><a href="#AbstractMarkov.set_to_ml_output-490"><span class="linenos">490</span></a>    <span class="k">def</span> <span class="nf">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">expr</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">):</span>
</span><span id="AbstractMarkov.set_to_ml_output-491"><a href="#AbstractMarkov.set_to_ml_output-491"><span class="linenos">491</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.set_to_ml_output-492"><a href="#AbstractMarkov.set_to_ml_output-492"><span class="linenos">492</span></a><span class="sd">        Set a variable to an ML output. Checks if already has been set to an ML output or a constant.</span>
</span><span id="AbstractMarkov.set_to_ml_output-493"><a href="#AbstractMarkov.set_to_ml_output-493"><span class="linenos">493</span></a>
</span><span id="AbstractMarkov.set_to_ml_output-494"><a href="#AbstractMarkov.set_to_ml_output-494"><span class="linenos">494</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov.set_to_ml_output-495"><a href="#AbstractMarkov.set_to_ml_output-495"><span class="linenos">495</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov.set_to_ml_output-496"><a href="#AbstractMarkov.set_to_ml_output-496"><span class="linenos">496</span></a><span class="sd">        var : gp.Var</span>
</span><span id="AbstractMarkov.set_to_ml_output-497"><a href="#AbstractMarkov.set_to_ml_output-497"><span class="linenos">497</span></a><span class="sd">            The variable to set</span>
</span><span id="AbstractMarkov.set_to_ml_output-498"><a href="#AbstractMarkov.set_to_ml_output-498"><span class="linenos">498</span></a><span class="sd">        expr : gp.LinExpr | gp.Var</span>
</span><span id="AbstractMarkov.set_to_ml_output-499"><a href="#AbstractMarkov.set_to_ml_output-499"><span class="linenos">499</span></a><span class="sd">            The expression to set the variable to</span>
</span><span id="AbstractMarkov.set_to_ml_output-500"><a href="#AbstractMarkov.set_to_ml_output-500"><span class="linenos">500</span></a>
</span><span id="AbstractMarkov.set_to_ml_output-501"><a href="#AbstractMarkov.set_to_ml_output-501"><span class="linenos">501</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov.set_to_ml_output-502"><a href="#AbstractMarkov.set_to_ml_output-502"><span class="linenos">502</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov.set_to_ml_output-503"><a href="#AbstractMarkov.set_to_ml_output-503"><span class="linenos">503</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov.set_to_ml_output-504"><a href="#AbstractMarkov.set_to_ml_output-504"><span class="linenos">504</span></a>
</span><span id="AbstractMarkov.set_to_ml_output-505"><a href="#AbstractMarkov.set_to_ml_output-505"><span class="linenos">505</span></a><span class="sd">        Notes</span>
</span><span id="AbstractMarkov.set_to_ml_output-506"><a href="#AbstractMarkov.set_to_ml_output-506"><span class="linenos">506</span></a><span class="sd">        -----</span>
</span><span id="AbstractMarkov.set_to_ml_output-507"><a href="#AbstractMarkov.set_to_ml_output-507"><span class="linenos">507</span></a><span class="sd">        In practice, introduces an equality constraint to the model.</span>
</span><span id="AbstractMarkov.set_to_ml_output-508"><a href="#AbstractMarkov.set_to_ml_output-508"><span class="linenos">508</span></a>
</span><span id="AbstractMarkov.set_to_ml_output-509"><a href="#AbstractMarkov.set_to_ml_output-509"><span class="linenos">509</span></a><span class="sd">        Raises</span>
</span><span id="AbstractMarkov.set_to_ml_output-510"><a href="#AbstractMarkov.set_to_ml_output-510"><span class="linenos">510</span></a><span class="sd">        ------</span>
</span><span id="AbstractMarkov.set_to_ml_output-511"><a href="#AbstractMarkov.set_to_ml_output-511"><span class="linenos">511</span></a><span class="sd">        ValueError</span>
</span><span id="AbstractMarkov.set_to_ml_output-512"><a href="#AbstractMarkov.set_to_ml_output-512"><span class="linenos">512</span></a><span class="sd">            If unknown variable type</span>
</span><span id="AbstractMarkov.set_to_ml_output-513"><a href="#AbstractMarkov.set_to_ml_output-513"><span class="linenos">513</span></a><span class="sd">            If the variable is already set to an ML output or a constant</span>
</span><span id="AbstractMarkov.set_to_ml_output-514"><a href="#AbstractMarkov.set_to_ml_output-514"><span class="linenos">514</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.set_to_ml_output-515"><a href="#AbstractMarkov.set_to_ml_output-515"><span class="linenos">515</span></a>        <span class="n">var_name</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">VarName</span>
</span><span id="AbstractMarkov.set_to_ml_output-516"><a href="#AbstractMarkov.set_to_ml_output-516"><span class="linenos">516</span></a>        <span class="n">base_name</span> <span class="o">=</span> <span class="n">var_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Get base name (pi, P, etc.)</span>
</span><span id="AbstractMarkov.set_to_ml_output-517"><a href="#AbstractMarkov.set_to_ml_output-517"><span class="linenos">517</span></a>
</span><span id="AbstractMarkov.set_to_ml_output-518"><a href="#AbstractMarkov.set_to_ml_output-518"><span class="linenos">518</span></a>        <span class="k">if</span> <span class="n">base_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">:</span>
</span><span id="AbstractMarkov.set_to_ml_output-519"><a href="#AbstractMarkov.set_to_ml_output-519"><span class="linenos">519</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown variable type: </span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov.set_to_ml_output-520"><a href="#AbstractMarkov.set_to_ml_output-520"><span class="linenos">520</span></a>
</span><span id="AbstractMarkov.set_to_ml_output-521"><a href="#AbstractMarkov.set_to_ml_output-521"><span class="linenos">521</span></a>        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_var_indices</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
</span><span id="AbstractMarkov.set_to_ml_output-522"><a href="#AbstractMarkov.set_to_ml_output-522"><span class="linenos">522</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="AbstractMarkov.set_to_ml_output-523"><a href="#AbstractMarkov.set_to_ml_output-523"><span class="linenos">523</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="n">indices</span>
</span><span id="AbstractMarkov.set_to_ml_output-524"><a href="#AbstractMarkov.set_to_ml_output-524"><span class="linenos">524</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
</span><span id="AbstractMarkov.set_to_ml_output-525"><a href="#AbstractMarkov.set_to_ml_output-525"><span class="linenos">525</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> is already set to an ML output or constant&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov.set_to_ml_output-526"><a href="#AbstractMarkov.set_to_ml_output-526"><span class="linenos">526</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AbstractMarkov.set_to_ml_output-527"><a href="#AbstractMarkov.set_to_ml_output-527"><span class="linenos">527</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="AbstractMarkov.set_to_ml_output-528"><a href="#AbstractMarkov.set_to_ml_output-528"><span class="linenos">528</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">indices</span>
</span><span id="AbstractMarkov.set_to_ml_output-529"><a href="#AbstractMarkov.set_to_ml_output-529"><span class="linenos">529</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
</span><span id="AbstractMarkov.set_to_ml_output-530"><a href="#AbstractMarkov.set_to_ml_output-530"><span class="linenos">530</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> is already set to an ML output or constant&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov.set_to_ml_output-531"><a href="#AbstractMarkov.set_to_ml_output-531"><span class="linenos">531</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AbstractMarkov.set_to_ml_output-532"><a href="#AbstractMarkov.set_to_ml_output-532"><span class="linenos">532</span></a>
</span><span id="AbstractMarkov.set_to_ml_output-533"><a href="#AbstractMarkov.set_to_ml_output-533"><span class="linenos">533</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">var</span> <span class="o">==</span> <span class="n">expr</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;set_to_ml_output_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov.set_to_ml_output-534"><a href="#AbstractMarkov.set_to_ml_output-534"><span class="linenos">534</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Set a variable to an ML output. Checks if already has been set to an ML output or a constant.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>var</strong> (gp.Var):
The variable to set</li>
<li><strong>expr</strong> (gp.LinExpr | gp.Var):
The expression to set the variable to</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="notes">Notes</h6>

<p>In practice, introduces an equality constraint to the model.</p>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If unknown variable type
If the variable is already set to an ML output or a constant</li>
</ul>
</div>


                            </div>
                            <div id="AbstractMarkov.set_to_const" class="classattr">
                                        <input id="AbstractMarkov.set_to_const-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_to_const</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">var</span><span class="p">:</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">Var</span>, </span><span class="param"><span class="n">value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AbstractMarkov.set_to_const-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AbstractMarkov.set_to_const"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AbstractMarkov.set_to_const-536"><a href="#AbstractMarkov.set_to_const-536"><span class="linenos">536</span></a>    <span class="k">def</span> <span class="nf">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">value</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="AbstractMarkov.set_to_const-537"><a href="#AbstractMarkov.set_to_const-537"><span class="linenos">537</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.set_to_const-538"><a href="#AbstractMarkov.set_to_const-538"><span class="linenos">538</span></a><span class="sd">        Set a variable to a constant value. Checks if already has been set to a constant or an ML output.</span>
</span><span id="AbstractMarkov.set_to_const-539"><a href="#AbstractMarkov.set_to_const-539"><span class="linenos">539</span></a>
</span><span id="AbstractMarkov.set_to_const-540"><a href="#AbstractMarkov.set_to_const-540"><span class="linenos">540</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov.set_to_const-541"><a href="#AbstractMarkov.set_to_const-541"><span class="linenos">541</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov.set_to_const-542"><a href="#AbstractMarkov.set_to_const-542"><span class="linenos">542</span></a><span class="sd">        var : gp.Var</span>
</span><span id="AbstractMarkov.set_to_const-543"><a href="#AbstractMarkov.set_to_const-543"><span class="linenos">543</span></a><span class="sd">            The variable to set</span>
</span><span id="AbstractMarkov.set_to_const-544"><a href="#AbstractMarkov.set_to_const-544"><span class="linenos">544</span></a><span class="sd">        value : float | int</span>
</span><span id="AbstractMarkov.set_to_const-545"><a href="#AbstractMarkov.set_to_const-545"><span class="linenos">545</span></a><span class="sd">            The constant value to set the variable to</span>
</span><span id="AbstractMarkov.set_to_const-546"><a href="#AbstractMarkov.set_to_const-546"><span class="linenos">546</span></a>
</span><span id="AbstractMarkov.set_to_const-547"><a href="#AbstractMarkov.set_to_const-547"><span class="linenos">547</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov.set_to_const-548"><a href="#AbstractMarkov.set_to_const-548"><span class="linenos">548</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov.set_to_const-549"><a href="#AbstractMarkov.set_to_const-549"><span class="linenos">549</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov.set_to_const-550"><a href="#AbstractMarkov.set_to_const-550"><span class="linenos">550</span></a>
</span><span id="AbstractMarkov.set_to_const-551"><a href="#AbstractMarkov.set_to_const-551"><span class="linenos">551</span></a><span class="sd">        Notes</span>
</span><span id="AbstractMarkov.set_to_const-552"><a href="#AbstractMarkov.set_to_const-552"><span class="linenos">552</span></a><span class="sd">        -----</span>
</span><span id="AbstractMarkov.set_to_const-553"><a href="#AbstractMarkov.set_to_const-553"><span class="linenos">553</span></a><span class="sd">        In practice, introduces an equality constraint to the model and fixes</span>
</span><span id="AbstractMarkov.set_to_const-554"><a href="#AbstractMarkov.set_to_const-554"><span class="linenos">554</span></a><span class="sd">        upper and lower bounds of the variable to the given value.</span>
</span><span id="AbstractMarkov.set_to_const-555"><a href="#AbstractMarkov.set_to_const-555"><span class="linenos">555</span></a>
</span><span id="AbstractMarkov.set_to_const-556"><a href="#AbstractMarkov.set_to_const-556"><span class="linenos">556</span></a><span class="sd">        Raises</span>
</span><span id="AbstractMarkov.set_to_const-557"><a href="#AbstractMarkov.set_to_const-557"><span class="linenos">557</span></a><span class="sd">        ------</span>
</span><span id="AbstractMarkov.set_to_const-558"><a href="#AbstractMarkov.set_to_const-558"><span class="linenos">558</span></a><span class="sd">        ValueError</span>
</span><span id="AbstractMarkov.set_to_const-559"><a href="#AbstractMarkov.set_to_const-559"><span class="linenos">559</span></a><span class="sd">            If unknown variable type</span>
</span><span id="AbstractMarkov.set_to_const-560"><a href="#AbstractMarkov.set_to_const-560"><span class="linenos">560</span></a><span class="sd">            If the variable is already set to a constant or an ML output</span>
</span><span id="AbstractMarkov.set_to_const-561"><a href="#AbstractMarkov.set_to_const-561"><span class="linenos">561</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.set_to_const-562"><a href="#AbstractMarkov.set_to_const-562"><span class="linenos">562</span></a>
</span><span id="AbstractMarkov.set_to_const-563"><a href="#AbstractMarkov.set_to_const-563"><span class="linenos">563</span></a>        <span class="n">var_name</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">VarName</span>
</span><span id="AbstractMarkov.set_to_const-564"><a href="#AbstractMarkov.set_to_const-564"><span class="linenos">564</span></a>        <span class="n">base_name</span> <span class="o">=</span> <span class="n">var_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Get base name (pi, P, etc.)</span>
</span><span id="AbstractMarkov.set_to_const-565"><a href="#AbstractMarkov.set_to_const-565"><span class="linenos">565</span></a>
</span><span id="AbstractMarkov.set_to_const-566"><a href="#AbstractMarkov.set_to_const-566"><span class="linenos">566</span></a>        <span class="k">if</span> <span class="n">base_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">:</span>
</span><span id="AbstractMarkov.set_to_const-567"><a href="#AbstractMarkov.set_to_const-567"><span class="linenos">567</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unknown variable type: </span><span class="si">{</span><span class="n">base_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov.set_to_const-568"><a href="#AbstractMarkov.set_to_const-568"><span class="linenos">568</span></a>
</span><span id="AbstractMarkov.set_to_const-569"><a href="#AbstractMarkov.set_to_const-569"><span class="linenos">569</span></a>        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse_var_indices</span><span class="p">(</span><span class="n">var_name</span><span class="p">)</span>
</span><span id="AbstractMarkov.set_to_const-570"><a href="#AbstractMarkov.set_to_const-570"><span class="linenos">570</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="AbstractMarkov.set_to_const-571"><a href="#AbstractMarkov.set_to_const-571"><span class="linenos">571</span></a>            <span class="n">i</span> <span class="o">=</span> <span class="n">indices</span>
</span><span id="AbstractMarkov.set_to_const-572"><a href="#AbstractMarkov.set_to_const-572"><span class="linenos">572</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
</span><span id="AbstractMarkov.set_to_const-573"><a href="#AbstractMarkov.set_to_const-573"><span class="linenos">573</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> is already set to a constant or ML output&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov.set_to_const-574"><a href="#AbstractMarkov.set_to_const-574"><span class="linenos">574</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AbstractMarkov.set_to_const-575"><a href="#AbstractMarkov.set_to_const-575"><span class="linenos">575</span></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="AbstractMarkov.set_to_const-576"><a href="#AbstractMarkov.set_to_const-576"><span class="linenos">576</span></a>            <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">indices</span>
</span><span id="AbstractMarkov.set_to_const-577"><a href="#AbstractMarkov.set_to_const-577"><span class="linenos">577</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
</span><span id="AbstractMarkov.set_to_const-578"><a href="#AbstractMarkov.set_to_const-578"><span class="linenos">578</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2"> is already set to a constant or ML output&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov.set_to_const-579"><a href="#AbstractMarkov.set_to_const-579"><span class="linenos">579</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="n">base_name</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="AbstractMarkov.set_to_const-580"><a href="#AbstractMarkov.set_to_const-580"><span class="linenos">580</span></a>
</span><span id="AbstractMarkov.set_to_const-581"><a href="#AbstractMarkov.set_to_const-581"><span class="linenos">581</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">var</span> <span class="o">==</span> <span class="n">value</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;set_to_const_</span><span class="si">{</span><span class="n">var_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov.set_to_const-582"><a href="#AbstractMarkov.set_to_const-582"><span class="linenos">582</span></a>        <span class="n">var</span><span class="o">.</span><span class="n">LB</span> <span class="o">=</span> <span class="n">var</span><span class="o">.</span><span class="n">UB</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="AbstractMarkov.set_to_const-583"><a href="#AbstractMarkov.set_to_const-583"><span class="linenos">583</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Set a variable to a constant value. Checks if already has been set to a constant or an ML output.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>var</strong> (gp.Var):
The variable to set</li>
<li><strong>value</strong> (float | int):
The constant value to set the variable to</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="notes">Notes</h6>

<p>In practice, introduces an equality constraint to the model and fixes
upper and lower bounds of the variable to the given value.</p>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If unknown variable type
If the variable is already set to a constant or an ML output</li>
</ul>
</div>


                            </div>
                            <div id="AbstractMarkov.add_feature_constraint" class="classattr">
                                        <input id="AbstractMarkov.add_feature_constraint-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_feature_constraint</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">expr</span><span class="p">:</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">LinExpr</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AbstractMarkov.add_feature_constraint-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AbstractMarkov.add_feature_constraint"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AbstractMarkov.add_feature_constraint-592"><a href="#AbstractMarkov.add_feature_constraint-592"><span class="linenos">592</span></a>    <span class="k">def</span> <span class="nf">add_feature_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">expr</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">):</span>
</span><span id="AbstractMarkov.add_feature_constraint-593"><a href="#AbstractMarkov.add_feature_constraint-593"><span class="linenos">593</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.add_feature_constraint-594"><a href="#AbstractMarkov.add_feature_constraint-594"><span class="linenos">594</span></a><span class="sd">        Add a feature constraint to the model.</span>
</span><span id="AbstractMarkov.add_feature_constraint-595"><a href="#AbstractMarkov.add_feature_constraint-595"><span class="linenos">595</span></a>
</span><span id="AbstractMarkov.add_feature_constraint-596"><a href="#AbstractMarkov.add_feature_constraint-596"><span class="linenos">596</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov.add_feature_constraint-597"><a href="#AbstractMarkov.add_feature_constraint-597"><span class="linenos">597</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov.add_feature_constraint-598"><a href="#AbstractMarkov.add_feature_constraint-598"><span class="linenos">598</span></a><span class="sd">        expr : gp.LinExpr</span>
</span><span id="AbstractMarkov.add_feature_constraint-599"><a href="#AbstractMarkov.add_feature_constraint-599"><span class="linenos">599</span></a><span class="sd">            The linear expression to add as a constraint</span>
</span><span id="AbstractMarkov.add_feature_constraint-600"><a href="#AbstractMarkov.add_feature_constraint-600"><span class="linenos">600</span></a>
</span><span id="AbstractMarkov.add_feature_constraint-601"><a href="#AbstractMarkov.add_feature_constraint-601"><span class="linenos">601</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov.add_feature_constraint-602"><a href="#AbstractMarkov.add_feature_constraint-602"><span class="linenos">602</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov.add_feature_constraint-603"><a href="#AbstractMarkov.add_feature_constraint-603"><span class="linenos">603</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov.add_feature_constraint-604"><a href="#AbstractMarkov.add_feature_constraint-604"><span class="linenos">604</span></a>
</span><span id="AbstractMarkov.add_feature_constraint-605"><a href="#AbstractMarkov.add_feature_constraint-605"><span class="linenos">605</span></a><span class="sd">        Notes</span>
</span><span id="AbstractMarkov.add_feature_constraint-606"><a href="#AbstractMarkov.add_feature_constraint-606"><span class="linenos">606</span></a><span class="sd">        -----</span>
</span><span id="AbstractMarkov.add_feature_constraint-607"><a href="#AbstractMarkov.add_feature_constraint-607"><span class="linenos">607</span></a><span class="sd">        Adds the constraint to the model and also stores it in self.feature_constraints.</span>
</span><span id="AbstractMarkov.add_feature_constraint-608"><a href="#AbstractMarkov.add_feature_constraint-608"><span class="linenos">608</span></a><span class="sd">        Constraints that are added here are also copied over when optimizing over ML outputs.</span>
</span><span id="AbstractMarkov.add_feature_constraint-609"><a href="#AbstractMarkov.add_feature_constraint-609"><span class="linenos">609</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.add_feature_constraint-610"><a href="#AbstractMarkov.add_feature_constraint-610"><span class="linenos">610</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_constraints</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">expr</span><span class="p">))</span>
</span><span id="AbstractMarkov.add_feature_constraint-611"><a href="#AbstractMarkov.add_feature_constraint-611"><span class="linenos">611</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Add a feature constraint to the model.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>expr</strong> (gp.LinExpr):
The linear expression to add as a constraint</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="notes">Notes</h6>

<p>Adds the constraint to the model and also stores it in self.feature_constraints.
Constraints that are added here are also copied over when optimizing over ML outputs.</p>
</div>


                            </div>
                            <div id="AbstractMarkov.add_feature_aux_variable" class="classattr">
                                        <input id="AbstractMarkov.add_feature_aux_variable-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_feature_aux_variable</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AbstractMarkov.add_feature_aux_variable-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AbstractMarkov.add_feature_aux_variable"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AbstractMarkov.add_feature_aux_variable-613"><a href="#AbstractMarkov.add_feature_aux_variable-613"><span class="linenos">613</span></a>    <span class="k">def</span> <span class="nf">add_feature_aux_variable</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-614"><a href="#AbstractMarkov.add_feature_aux_variable-614"><span class="linenos">614</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-615"><a href="#AbstractMarkov.add_feature_aux_variable-615"><span class="linenos">615</span></a><span class="sd">        Add a feature auxiliary variable to the model.</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-616"><a href="#AbstractMarkov.add_feature_aux_variable-616"><span class="linenos">616</span></a>
</span><span id="AbstractMarkov.add_feature_aux_variable-617"><a href="#AbstractMarkov.add_feature_aux_variable-617"><span class="linenos">617</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-618"><a href="#AbstractMarkov.add_feature_aux_variable-618"><span class="linenos">618</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-619"><a href="#AbstractMarkov.add_feature_aux_variable-619"><span class="linenos">619</span></a><span class="sd">        *args : tuple</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-620"><a href="#AbstractMarkov.add_feature_aux_variable-620"><span class="linenos">620</span></a><span class="sd">            Arguments to pass to self.model.addVar</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-621"><a href="#AbstractMarkov.add_feature_aux_variable-621"><span class="linenos">621</span></a><span class="sd">        **kwargs : dict</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-622"><a href="#AbstractMarkov.add_feature_aux_variable-622"><span class="linenos">622</span></a><span class="sd">            Keyword arguments to pass to self.model.addVar</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-623"><a href="#AbstractMarkov.add_feature_aux_variable-623"><span class="linenos">623</span></a>
</span><span id="AbstractMarkov.add_feature_aux_variable-624"><a href="#AbstractMarkov.add_feature_aux_variable-624"><span class="linenos">624</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-625"><a href="#AbstractMarkov.add_feature_aux_variable-625"><span class="linenos">625</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-626"><a href="#AbstractMarkov.add_feature_aux_variable-626"><span class="linenos">626</span></a><span class="sd">        gp.Var</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-627"><a href="#AbstractMarkov.add_feature_aux_variable-627"><span class="linenos">627</span></a><span class="sd">            The auxiliary variable added to the model</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-628"><a href="#AbstractMarkov.add_feature_aux_variable-628"><span class="linenos">628</span></a>
</span><span id="AbstractMarkov.add_feature_aux_variable-629"><a href="#AbstractMarkov.add_feature_aux_variable-629"><span class="linenos">629</span></a><span class="sd">        Notes</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-630"><a href="#AbstractMarkov.add_feature_aux_variable-630"><span class="linenos">630</span></a><span class="sd">        -----</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-631"><a href="#AbstractMarkov.add_feature_aux_variable-631"><span class="linenos">631</span></a><span class="sd">        Adds a variable to the model and stores it in self.feature_aux. Variables</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-632"><a href="#AbstractMarkov.add_feature_aux_variable-632"><span class="linenos">632</span></a><span class="sd">        added here are also copied over when optimizing over ML outputs. Arguments</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-633"><a href="#AbstractMarkov.add_feature_aux_variable-633"><span class="linenos">633</span></a><span class="sd">        are passed to Gurobi&#39;s addVar function, so can specify variable types, bounds,</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-634"><a href="#AbstractMarkov.add_feature_aux_variable-634"><span class="linenos">634</span></a><span class="sd">        etc. Hence, can encode arbitrary MILP constraints by adding integer auxiliary</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-635"><a href="#AbstractMarkov.add_feature_aux_variable-635"><span class="linenos">635</span></a><span class="sd">        variables.</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-636"><a href="#AbstractMarkov.add_feature_aux_variable-636"><span class="linenos">636</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-637"><a href="#AbstractMarkov.add_feature_aux_variable-637"><span class="linenos">637</span></a>        <span class="n">var</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVar</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-638"><a href="#AbstractMarkov.add_feature_aux_variable-638"><span class="linenos">638</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">feature_aux</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">var</span><span class="p">)</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-639"><a href="#AbstractMarkov.add_feature_aux_variable-639"><span class="linenos">639</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="AbstractMarkov.add_feature_aux_variable-640"><a href="#AbstractMarkov.add_feature_aux_variable-640"><span class="linenos">640</span></a>        <span class="k">return</span> <span class="n">var</span>
</span></pre></div>


            <div class="docstring"><p>Add a feature auxiliary variable to the model.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>*args</strong> (tuple):
Arguments to pass to self.model.addVar</li>
<li><strong>**kwargs</strong> (dict):
Keyword arguments to pass to self.model.addVar</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>gp.Var</strong>: The auxiliary variable added to the model</li>
</ul>

<h6 id="notes">Notes</h6>

<p>Adds a variable to the model and stores it in self.feature_aux. Variables
added here are also copied over when optimizing over ML outputs. Arguments
are passed to Gurobi's addVar function, so can specify variable types, bounds,
etc. Hence, can encode arbitrary MILP constraints by adding integer auxiliary
variables.</p>
</div>


                            </div>
                            <div id="AbstractMarkov.add_constraint" class="classattr">
                                        <input id="AbstractMarkov.add_constraint-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_constraint</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">constr</span><span class="p">:</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">Constr</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AbstractMarkov.add_constraint-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AbstractMarkov.add_constraint"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AbstractMarkov.add_constraint-646"><a href="#AbstractMarkov.add_constraint-646"><span class="linenos">646</span></a>    <span class="k">def</span> <span class="nf">add_constraint</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">constr</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">Constr</span><span class="p">):</span>
</span><span id="AbstractMarkov.add_constraint-647"><a href="#AbstractMarkov.add_constraint-647"><span class="linenos">647</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.add_constraint-648"><a href="#AbstractMarkov.add_constraint-648"><span class="linenos">648</span></a><span class="sd">        Add an inequality to the overall model.</span>
</span><span id="AbstractMarkov.add_constraint-649"><a href="#AbstractMarkov.add_constraint-649"><span class="linenos">649</span></a><span class="sd">        Could just call self.model.addConstr(constr), but this is a wrapper for clarity.</span>
</span><span id="AbstractMarkov.add_constraint-650"><a href="#AbstractMarkov.add_constraint-650"><span class="linenos">650</span></a>
</span><span id="AbstractMarkov.add_constraint-651"><a href="#AbstractMarkov.add_constraint-651"><span class="linenos">651</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov.add_constraint-652"><a href="#AbstractMarkov.add_constraint-652"><span class="linenos">652</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov.add_constraint-653"><a href="#AbstractMarkov.add_constraint-653"><span class="linenos">653</span></a><span class="sd">        constr : gp.Constr</span>
</span><span id="AbstractMarkov.add_constraint-654"><a href="#AbstractMarkov.add_constraint-654"><span class="linenos">654</span></a><span class="sd">            The constraint to add</span>
</span><span id="AbstractMarkov.add_constraint-655"><a href="#AbstractMarkov.add_constraint-655"><span class="linenos">655</span></a>
</span><span id="AbstractMarkov.add_constraint-656"><a href="#AbstractMarkov.add_constraint-656"><span class="linenos">656</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov.add_constraint-657"><a href="#AbstractMarkov.add_constraint-657"><span class="linenos">657</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov.add_constraint-658"><a href="#AbstractMarkov.add_constraint-658"><span class="linenos">658</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov.add_constraint-659"><a href="#AbstractMarkov.add_constraint-659"><span class="linenos">659</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.add_constraint-660"><a href="#AbstractMarkov.add_constraint-660"><span class="linenos">660</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">constr</span><span class="p">)</span>
</span><span id="AbstractMarkov.add_constraint-661"><a href="#AbstractMarkov.add_constraint-661"><span class="linenos">661</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Add an inequality to the overall model.
Could just call self.model.addConstr(constr), but this is a wrapper for clarity.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>constr</strong> (gp.Constr):
The constraint to add</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>
</div>


                            </div>
                            <div id="AbstractMarkov.add_ml_model" class="classattr">
                                        <input id="AbstractMarkov.add_ml_model-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_ml_model</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">ml_model</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AbstractMarkov.add_ml_model-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AbstractMarkov.add_ml_model"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AbstractMarkov.add_ml_model-668"><a href="#AbstractMarkov.add_ml_model-668"><span class="linenos">668</span></a>    <span class="k">def</span> <span class="nf">add_ml_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ml_model</span> <span class="p">:</span> <span class="n">Any</span><span class="p">):</span>
</span><span id="AbstractMarkov.add_ml_model-669"><a href="#AbstractMarkov.add_ml_model-669"><span class="linenos">669</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.add_ml_model-670"><a href="#AbstractMarkov.add_ml_model-670"><span class="linenos">670</span></a><span class="sd">        Add an ML model to the Markov process. Computes the constraints linking</span>
</span><span id="AbstractMarkov.add_ml_model-671"><a href="#AbstractMarkov.add_ml_model-671"><span class="linenos">671</span></a><span class="sd">        the ML outputs to the features, and creates variables for the ML outputs.</span>
</span><span id="AbstractMarkov.add_ml_model-672"><a href="#AbstractMarkov.add_ml_model-672"><span class="linenos">672</span></a><span class="sd">        ML outputs can then be accessed using self.ml_outputs.</span>
</span><span id="AbstractMarkov.add_ml_model-673"><a href="#AbstractMarkov.add_ml_model-673"><span class="linenos">673</span></a>
</span><span id="AbstractMarkov.add_ml_model-674"><a href="#AbstractMarkov.add_ml_model-674"><span class="linenos">674</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov.add_ml_model-675"><a href="#AbstractMarkov.add_ml_model-675"><span class="linenos">675</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov.add_ml_model-676"><a href="#AbstractMarkov.add_ml_model-676"><span class="linenos">676</span></a><span class="sd">        ml_model : Any</span>
</span><span id="AbstractMarkov.add_ml_model-677"><a href="#AbstractMarkov.add_ml_model-677"><span class="linenos">677</span></a><span class="sd">            The ML model to add</span>
</span><span id="AbstractMarkov.add_ml_model-678"><a href="#AbstractMarkov.add_ml_model-678"><span class="linenos">678</span></a>
</span><span id="AbstractMarkov.add_ml_model-679"><a href="#AbstractMarkov.add_ml_model-679"><span class="linenos">679</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov.add_ml_model-680"><a href="#AbstractMarkov.add_ml_model-680"><span class="linenos">680</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov.add_ml_model-681"><a href="#AbstractMarkov.add_ml_model-681"><span class="linenos">681</span></a><span class="sd">        None</span>
</span><span id="AbstractMarkov.add_ml_model-682"><a href="#AbstractMarkov.add_ml_model-682"><span class="linenos">682</span></a>
</span><span id="AbstractMarkov.add_ml_model-683"><a href="#AbstractMarkov.add_ml_model-683"><span class="linenos">683</span></a><span class="sd">        Raises</span>
</span><span id="AbstractMarkov.add_ml_model-684"><a href="#AbstractMarkov.add_ml_model-684"><span class="linenos">684</span></a><span class="sd">        ------</span>
</span><span id="AbstractMarkov.add_ml_model-685"><a href="#AbstractMarkov.add_ml_model-685"><span class="linenos">685</span></a><span class="sd">        ValueError</span>
</span><span id="AbstractMarkov.add_ml_model-686"><a href="#AbstractMarkov.add_ml_model-686"><span class="linenos">686</span></a><span class="sd">            If the ML model type is not supported</span>
</span><span id="AbstractMarkov.add_ml_model-687"><a href="#AbstractMarkov.add_ml_model-687"><span class="linenos">687</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.add_ml_model-688"><a href="#AbstractMarkov.add_ml_model-688"><span class="linenos">688</span></a>        <span class="c1"># Find matching model type in registry</span>
</span><span id="AbstractMarkov.add_ml_model-689"><a href="#AbstractMarkov.add_ml_model-689"><span class="linenos">689</span></a>        <span class="k">for</span> <span class="n">model_types</span><span class="p">,</span> <span class="n">config</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ml_model_registry</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="AbstractMarkov.add_ml_model-690"><a href="#AbstractMarkov.add_ml_model-690"><span class="linenos">690</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">ml_model</span><span class="p">,</span> <span class="n">model_types</span><span class="p">):</span>
</span><span id="AbstractMarkov.add_ml_model-691"><a href="#AbstractMarkov.add_ml_model-691"><span class="linenos">691</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ml_models</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ml_model</span><span class="p">)</span>
</span><span id="AbstractMarkov.add_ml_model-692"><a href="#AbstractMarkov.add_ml_model-692"><span class="linenos">692</span></a>
</span><span id="AbstractMarkov.add_ml_model-693"><a href="#AbstractMarkov.add_ml_model-693"><span class="linenos">693</span></a>                <span class="c1"># Create output variables based on model type</span>
</span><span id="AbstractMarkov.add_ml_model-694"><a href="#AbstractMarkov.add_ml_model-694"><span class="linenos">694</span></a>                <span class="n">n_outputs</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;get_n_outputs&#39;</span><span class="p">](</span><span class="n">ml_model</span><span class="p">)</span>
</span><span id="AbstractMarkov.add_ml_model-695"><a href="#AbstractMarkov.add_ml_model-695"><span class="linenos">695</span></a>                <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;bounds&#39;</span><span class="p">]</span>
</span><span id="AbstractMarkov.add_ml_model-696"><a href="#AbstractMarkov.add_ml_model-696"><span class="linenos">696</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
</span><span id="AbstractMarkov.add_ml_model-697"><a href="#AbstractMarkov.add_ml_model-697"><span class="linenos">697</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="AbstractMarkov.add_ml_model-698"><a href="#AbstractMarkov.add_ml_model-698"><span class="linenos">698</span></a>                        <span class="n">n_outputs</span><span class="p">,</span>
</span><span id="AbstractMarkov.add_ml_model-699"><a href="#AbstractMarkov.add_ml_model-699"><span class="linenos">699</span></a>                        <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ml_outputs_</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="AbstractMarkov.add_ml_model-700"><a href="#AbstractMarkov.add_ml_model-700"><span class="linenos">700</span></a>                        <span class="n">lb</span><span class="o">=</span><span class="n">lb</span><span class="p">,</span>
</span><span id="AbstractMarkov.add_ml_model-701"><a href="#AbstractMarkov.add_ml_model-701"><span class="linenos">701</span></a>                        <span class="n">ub</span><span class="o">=</span><span class="n">ub</span><span class="p">,</span>
</span><span id="AbstractMarkov.add_ml_model-702"><a href="#AbstractMarkov.add_ml_model-702"><span class="linenos">702</span></a>                        <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="AbstractMarkov.add_ml_model-703"><a href="#AbstractMarkov.add_ml_model-703"><span class="linenos">703</span></a>                    <span class="p">)</span>
</span><span id="AbstractMarkov.add_ml_model-704"><a href="#AbstractMarkov.add_ml_model-704"><span class="linenos">704</span></a>                <span class="p">)</span>
</span><span id="AbstractMarkov.add_ml_model-705"><a href="#AbstractMarkov.add_ml_model-705"><span class="linenos">705</span></a>
</span><span id="AbstractMarkov.add_ml_model-706"><a href="#AbstractMarkov.add_ml_model-706"><span class="linenos">706</span></a>                <span class="c1"># Add constraints using registered method</span>
</span><span id="AbstractMarkov.add_ml_model-707"><a href="#AbstractMarkov.add_ml_model-707"><span class="linenos">707</span></a>                <span class="n">config</span><span class="p">[</span><span class="s1">&#39;constraint_method&#39;</span><span class="p">](</span>
</span><span id="AbstractMarkov.add_ml_model-708"><a href="#AbstractMarkov.add_ml_model-708"><span class="linenos">708</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span>
</span><span id="AbstractMarkov.add_ml_model-709"><a href="#AbstractMarkov.add_ml_model-709"><span class="linenos">709</span></a>                    <span class="n">ml_model</span><span class="p">,</span>
</span><span id="AbstractMarkov.add_ml_model-710"><a href="#AbstractMarkov.add_ml_model-710"><span class="linenos">710</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">,</span>
</span><span id="AbstractMarkov.add_ml_model-711"><a href="#AbstractMarkov.add_ml_model-711"><span class="linenos">711</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="AbstractMarkov.add_ml_model-712"><a href="#AbstractMarkov.add_ml_model-712"><span class="linenos">712</span></a>                <span class="p">)</span>
</span><span id="AbstractMarkov.add_ml_model-713"><a href="#AbstractMarkov.add_ml_model-713"><span class="linenos">713</span></a>
</span><span id="AbstractMarkov.add_ml_model-714"><a href="#AbstractMarkov.add_ml_model-714"><span class="linenos">714</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="AbstractMarkov.add_ml_model-715"><a href="#AbstractMarkov.add_ml_model-715"><span class="linenos">715</span></a>                <span class="k">return</span>
</span><span id="AbstractMarkov.add_ml_model-716"><a href="#AbstractMarkov.add_ml_model-716"><span class="linenos">716</span></a>
</span><span id="AbstractMarkov.add_ml_model-717"><a href="#AbstractMarkov.add_ml_model-717"><span class="linenos">717</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unsupported ML model type: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">ml_model</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Add an ML model to the Markov process. Computes the constraints linking
the ML outputs to the features, and creates variables for the ML outputs.
ML outputs can then be accessed using self.ml_outputs.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>ml_model</strong> (Any):
The ML model to add</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If the ML model type is not supported</li>
</ul>
</div>


                            </div>
                            <div id="AbstractMarkov.optimize" class="classattr">
                                        <input id="AbstractMarkov.optimize-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">optimize</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">use_decomp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">sense</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;max&#39;</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">gurobi_params</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AbstractMarkov.optimize-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AbstractMarkov.optimize"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AbstractMarkov.optimize-721"><a href="#AbstractMarkov.optimize-721"><span class="linenos">721</span></a>    <span class="k">def</span> <span class="nf">optimize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">use_decomp</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sense</span> <span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;max&quot;</span><span class="p">,</span> <span class="n">verbose</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gurobi_params</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AbstractMarkov.optimize-722"><a href="#AbstractMarkov.optimize-722"><span class="linenos">722</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.optimize-723"><a href="#AbstractMarkov.optimize-723"><span class="linenos">723</span></a><span class="sd">        Public interface for optimizing the problem.</span>
</span><span id="AbstractMarkov.optimize-724"><a href="#AbstractMarkov.optimize-724"><span class="linenos">724</span></a><span class="sd">        If use_decomp is True, we use the decomposition and bound propagation approach.</span>
</span><span id="AbstractMarkov.optimize-725"><a href="#AbstractMarkov.optimize-725"><span class="linenos">725</span></a><span class="sd">        Can also set the sense, verbosity, and additional Gurobi parameters if needed.</span>
</span><span id="AbstractMarkov.optimize-726"><a href="#AbstractMarkov.optimize-726"><span class="linenos">726</span></a>
</span><span id="AbstractMarkov.optimize-727"><a href="#AbstractMarkov.optimize-727"><span class="linenos">727</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov.optimize-728"><a href="#AbstractMarkov.optimize-728"><span class="linenos">728</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov.optimize-729"><a href="#AbstractMarkov.optimize-729"><span class="linenos">729</span></a><span class="sd">        use_decomp : bool (default=True)</span>
</span><span id="AbstractMarkov.optimize-730"><a href="#AbstractMarkov.optimize-730"><span class="linenos">730</span></a><span class="sd">            Whether to use the decomposition and bound propagation approach</span>
</span><span id="AbstractMarkov.optimize-731"><a href="#AbstractMarkov.optimize-731"><span class="linenos">731</span></a><span class="sd">        sense : str (default=&quot;max&quot;)</span>
</span><span id="AbstractMarkov.optimize-732"><a href="#AbstractMarkov.optimize-732"><span class="linenos">732</span></a><span class="sd">            The sense of the optimization problem, either &quot;max&quot; or &quot;min&quot;</span>
</span><span id="AbstractMarkov.optimize-733"><a href="#AbstractMarkov.optimize-733"><span class="linenos">733</span></a><span class="sd">        verbose : bool (default=False)</span>
</span><span id="AbstractMarkov.optimize-734"><a href="#AbstractMarkov.optimize-734"><span class="linenos">734</span></a><span class="sd">            Whether to print Gurobi output</span>
</span><span id="AbstractMarkov.optimize-735"><a href="#AbstractMarkov.optimize-735"><span class="linenos">735</span></a><span class="sd">        gurobi_params : dict (default=None)</span>
</span><span id="AbstractMarkov.optimize-736"><a href="#AbstractMarkov.optimize-736"><span class="linenos">736</span></a><span class="sd">            Additional Gurobi parameters to set, e.g., {&#39;TimeLimit&#39;: 60}</span>
</span><span id="AbstractMarkov.optimize-737"><a href="#AbstractMarkov.optimize-737"><span class="linenos">737</span></a>
</span><span id="AbstractMarkov.optimize-738"><a href="#AbstractMarkov.optimize-738"><span class="linenos">738</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov.optimize-739"><a href="#AbstractMarkov.optimize-739"><span class="linenos">739</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov.optimize-740"><a href="#AbstractMarkov.optimize-740"><span class="linenos">740</span></a><span class="sd">        dict</span>
</span><span id="AbstractMarkov.optimize-741"><a href="#AbstractMarkov.optimize-741"><span class="linenos">741</span></a><span class="sd">            A dictionary containing the optimization result. Possible formats:</span>
</span><span id="AbstractMarkov.optimize-742"><a href="#AbstractMarkov.optimize-742"><span class="linenos">742</span></a>
</span><span id="AbstractMarkov.optimize-743"><a href="#AbstractMarkov.optimize-743"><span class="linenos">743</span></a><span class="sd">            For optimal/suboptimal solutions:</span>
</span><span id="AbstractMarkov.optimize-744"><a href="#AbstractMarkov.optimize-744"><span class="linenos">744</span></a><span class="sd">            {</span>
</span><span id="AbstractMarkov.optimize-745"><a href="#AbstractMarkov.optimize-745"><span class="linenos">745</span></a><span class="sd">                &#39;status&#39;: str, either &#39;optimal&#39; or &#39;suboptimal&#39;,</span>
</span><span id="AbstractMarkov.optimize-746"><a href="#AbstractMarkov.optimize-746"><span class="linenos">746</span></a><span class="sd">                &#39;objective&#39;: float, the objective value,</span>
</span><span id="AbstractMarkov.optimize-747"><a href="#AbstractMarkov.optimize-747"><span class="linenos">747</span></a><span class="sd">                &#39;values&#39;: dict, the values of the variables</span>
</span><span id="AbstractMarkov.optimize-748"><a href="#AbstractMarkov.optimize-748"><span class="linenos">748</span></a><span class="sd">            }</span>
</span><span id="AbstractMarkov.optimize-749"><a href="#AbstractMarkov.optimize-749"><span class="linenos">749</span></a>
</span><span id="AbstractMarkov.optimize-750"><a href="#AbstractMarkov.optimize-750"><span class="linenos">750</span></a><span class="sd">            For infeasible/unbounded problems:</span>
</span><span id="AbstractMarkov.optimize-751"><a href="#AbstractMarkov.optimize-751"><span class="linenos">751</span></a><span class="sd">            {</span>
</span><span id="AbstractMarkov.optimize-752"><a href="#AbstractMarkov.optimize-752"><span class="linenos">752</span></a><span class="sd">                &#39;status&#39;: str, either &#39;infeasible&#39; or &#39;unbounded&#39;,</span>
</span><span id="AbstractMarkov.optimize-753"><a href="#AbstractMarkov.optimize-753"><span class="linenos">753</span></a><span class="sd">                &#39;message&#39;: str, description of the problem</span>
</span><span id="AbstractMarkov.optimize-754"><a href="#AbstractMarkov.optimize-754"><span class="linenos">754</span></a><span class="sd">            }</span>
</span><span id="AbstractMarkov.optimize-755"><a href="#AbstractMarkov.optimize-755"><span class="linenos">755</span></a>
</span><span id="AbstractMarkov.optimize-756"><a href="#AbstractMarkov.optimize-756"><span class="linenos">756</span></a><span class="sd">            For other errors:</span>
</span><span id="AbstractMarkov.optimize-757"><a href="#AbstractMarkov.optimize-757"><span class="linenos">757</span></a><span class="sd">            {</span>
</span><span id="AbstractMarkov.optimize-758"><a href="#AbstractMarkov.optimize-758"><span class="linenos">758</span></a><span class="sd">                &#39;status&#39;: &#39;error&#39;,</span>
</span><span id="AbstractMarkov.optimize-759"><a href="#AbstractMarkov.optimize-759"><span class="linenos">759</span></a><span class="sd">                &#39;message&#39;: str, error description with status code</span>
</span><span id="AbstractMarkov.optimize-760"><a href="#AbstractMarkov.optimize-760"><span class="linenos">760</span></a><span class="sd">            }</span>
</span><span id="AbstractMarkov.optimize-761"><a href="#AbstractMarkov.optimize-761"><span class="linenos">761</span></a>
</span><span id="AbstractMarkov.optimize-762"><a href="#AbstractMarkov.optimize-762"><span class="linenos">762</span></a><span class="sd">        Notes</span>
</span><span id="AbstractMarkov.optimize-763"><a href="#AbstractMarkov.optimize-763"><span class="linenos">763</span></a><span class="sd">        -----</span>
</span><span id="AbstractMarkov.optimize-764"><a href="#AbstractMarkov.optimize-764"><span class="linenos">764</span></a><span class="sd">        First checks if all required variables are set, then implements the decomposition</span>
</span><span id="AbstractMarkov.optimize-765"><a href="#AbstractMarkov.optimize-765"><span class="linenos">765</span></a><span class="sd">        and bound propagation approach, and lastly solves the bilinear program.</span>
</span><span id="AbstractMarkov.optimize-766"><a href="#AbstractMarkov.optimize-766"><span class="linenos">766</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.optimize-767"><a href="#AbstractMarkov.optimize-767"><span class="linenos">767</span></a>        <span class="c1"># Check if all required variables are set</span>
</span><span id="AbstractMarkov.optimize-768"><a href="#AbstractMarkov.optimize-768"><span class="linenos">768</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_all_vars_set</span><span class="p">()</span>
</span><span id="AbstractMarkov.optimize-769"><a href="#AbstractMarkov.optimize-769"><span class="linenos">769</span></a>
</span><span id="AbstractMarkov.optimize-770"><a href="#AbstractMarkov.optimize-770"><span class="linenos">770</span></a>        <span class="k">if</span> <span class="n">use_decomp</span><span class="p">:</span>
</span><span id="AbstractMarkov.optimize-771"><a href="#AbstractMarkov.optimize-771"><span class="linenos">771</span></a>            <span class="c1"># Step 1: ML bounds</span>
</span><span id="AbstractMarkov.optimize-772"><a href="#AbstractMarkov.optimize-772"><span class="linenos">772</span></a>            <span class="n">ml_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_ml_bounds</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="AbstractMarkov.optimize-773"><a href="#AbstractMarkov.optimize-773"><span class="linenos">773</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_ml_bounds</span><span class="p">(</span><span class="n">ml_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov.optimize-774"><a href="#AbstractMarkov.optimize-774"><span class="linenos">774</span></a>
</span><span id="AbstractMarkov.optimize-775"><a href="#AbstractMarkov.optimize-775"><span class="linenos">775</span></a>            <span class="c1"># Step 2: Parameter bounds from affine relationships</span>
</span><span id="AbstractMarkov.optimize-776"><a href="#AbstractMarkov.optimize-776"><span class="linenos">776</span></a>            <span class="n">affine_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_affine_bounds</span><span class="p">(</span><span class="n">ml_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov.optimize-777"><a href="#AbstractMarkov.optimize-777"><span class="linenos">777</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_affine_bounds</span><span class="p">(</span><span class="n">affine_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov.optimize-778"><a href="#AbstractMarkov.optimize-778"><span class="linenos">778</span></a>
</span><span id="AbstractMarkov.optimize-779"><a href="#AbstractMarkov.optimize-779"><span class="linenos">779</span></a>            <span class="c1"># Step 3: Initial value vector bounds</span>
</span><span id="AbstractMarkov.optimize-780"><a href="#AbstractMarkov.optimize-780"><span class="linenos">780</span></a>            <span class="n">initial_v_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_initial_v_bounds</span><span class="p">()</span>
</span><span id="AbstractMarkov.optimize-781"><a href="#AbstractMarkov.optimize-781"><span class="linenos">781</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_initial_v_bounds</span><span class="p">(</span><span class="n">initial_v_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov.optimize-782"><a href="#AbstractMarkov.optimize-782"><span class="linenos">782</span></a>
</span><span id="AbstractMarkov.optimize-783"><a href="#AbstractMarkov.optimize-783"><span class="linenos">783</span></a>            <span class="c1"># Step 4: Tightened value vector bounds</span>
</span><span id="AbstractMarkov.optimize-784"><a href="#AbstractMarkov.optimize-784"><span class="linenos">784</span></a>            <span class="n">tightened_v_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_tightened_v_bounds</span><span class="p">()</span>
</span><span id="AbstractMarkov.optimize-785"><a href="#AbstractMarkov.optimize-785"><span class="linenos">785</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_tightened_v_bounds</span><span class="p">(</span><span class="n">tightened_v_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov.optimize-786"><a href="#AbstractMarkov.optimize-786"><span class="linenos">786</span></a>
</span><span id="AbstractMarkov.optimize-787"><a href="#AbstractMarkov.optimize-787"><span class="linenos">787</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_optimize</span><span class="p">(</span><span class="n">sense</span><span class="o">=</span><span class="n">sense</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">gurobi_params</span><span class="o">=</span><span class="n">gurobi_params</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Public interface for optimizing the problem.
If use_decomp is True, we use the decomposition and bound propagation approach.
Can also set the sense, verbosity, and additional Gurobi parameters if needed.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>use_decomp</strong> (bool (default=True)):
Whether to use the decomposition and bound propagation approach</li>
<li><strong>sense</strong> (str (default="max")):
The sense of the optimization problem, either "max" or "min"</li>
<li><strong>verbose</strong> (bool (default=False)):
Whether to print Gurobi output</li>
<li><strong>gurobi_params</strong> (dict (default=None)):
Additional Gurobi parameters to set, e.g., {'TimeLimit': 60}</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>dict</strong>: A dictionary containing the optimization result. Possible formats:</li>
</ul>

<p>For optimal/suboptimal solutions:
{
    'status': str, either 'optimal' or 'suboptimal',
    'objective': float, the objective value,
    'values': dict, the values of the variables
}</p>

<p>For infeasible/unbounded problems:
{
    'status': str, either 'infeasible' or 'unbounded',
    'message': str, description of the problem
}</p>

<p>For other errors:
{
    'status': 'error',
    'message': str, error description with status code
}</p>

<h6 id="notes">Notes</h6>

<p>First checks if all required variables are set, then implements the decomposition
and bound propagation approach, and lastly solves the bilinear program.</p>
</div>


                            </div>
                            <div id="AbstractMarkov.find_feasible" class="classattr">
                                        <input id="AbstractMarkov.find_feasible-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">find_feasible</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">lb</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ub</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">use_decomp</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">verbose</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">gurobi_params</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AbstractMarkov.find_feasible-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AbstractMarkov.find_feasible"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AbstractMarkov.find_feasible-789"><a href="#AbstractMarkov.find_feasible-789"><span class="linenos">789</span></a>    <span class="k">def</span> <span class="nf">find_feasible</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ub</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">use_decomp</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span> <span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">gurobi_params</span> <span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="AbstractMarkov.find_feasible-790"><a href="#AbstractMarkov.find_feasible-790"><span class="linenos">790</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.find_feasible-791"><a href="#AbstractMarkov.find_feasible-791"><span class="linenos">791</span></a><span class="sd">        Public interface for finding a feasible solution to the problem.</span>
</span><span id="AbstractMarkov.find_feasible-792"><a href="#AbstractMarkov.find_feasible-792"><span class="linenos">792</span></a><span class="sd">        It finds a feasible feature vector.</span>
</span><span id="AbstractMarkov.find_feasible-793"><a href="#AbstractMarkov.find_feasible-793"><span class="linenos">793</span></a>
</span><span id="AbstractMarkov.find_feasible-794"><a href="#AbstractMarkov.find_feasible-794"><span class="linenos">794</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov.find_feasible-795"><a href="#AbstractMarkov.find_feasible-795"><span class="linenos">795</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov.find_feasible-796"><a href="#AbstractMarkov.find_feasible-796"><span class="linenos">796</span></a><span class="sd">        lb : float | int | None (default=None)</span>
</span><span id="AbstractMarkov.find_feasible-797"><a href="#AbstractMarkov.find_feasible-797"><span class="linenos">797</span></a><span class="sd">            The lower bound on the feature vector. None means -inf.</span>
</span><span id="AbstractMarkov.find_feasible-798"><a href="#AbstractMarkov.find_feasible-798"><span class="linenos">798</span></a><span class="sd">        ub : float | int | None (default=None)</span>
</span><span id="AbstractMarkov.find_feasible-799"><a href="#AbstractMarkov.find_feasible-799"><span class="linenos">799</span></a><span class="sd">            The upper bound on the feature vector. None means inf.</span>
</span><span id="AbstractMarkov.find_feasible-800"><a href="#AbstractMarkov.find_feasible-800"><span class="linenos">800</span></a><span class="sd">        use_decomp : bool (default=True)</span>
</span><span id="AbstractMarkov.find_feasible-801"><a href="#AbstractMarkov.find_feasible-801"><span class="linenos">801</span></a><span class="sd">            Whether to use the decomposition and bound propagation approach</span>
</span><span id="AbstractMarkov.find_feasible-802"><a href="#AbstractMarkov.find_feasible-802"><span class="linenos">802</span></a><span class="sd">        verbose : bool (default=False)</span>
</span><span id="AbstractMarkov.find_feasible-803"><a href="#AbstractMarkov.find_feasible-803"><span class="linenos">803</span></a><span class="sd">            Whether to print Gurobi output</span>
</span><span id="AbstractMarkov.find_feasible-804"><a href="#AbstractMarkov.find_feasible-804"><span class="linenos">804</span></a><span class="sd">        gurobi_params : dict (default=None)</span>
</span><span id="AbstractMarkov.find_feasible-805"><a href="#AbstractMarkov.find_feasible-805"><span class="linenos">805</span></a><span class="sd">            Additional Gurobi parameters to set, e.g., {&#39;TimeLimit&#39;: 60}</span>
</span><span id="AbstractMarkov.find_feasible-806"><a href="#AbstractMarkov.find_feasible-806"><span class="linenos">806</span></a>
</span><span id="AbstractMarkov.find_feasible-807"><a href="#AbstractMarkov.find_feasible-807"><span class="linenos">807</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov.find_feasible-808"><a href="#AbstractMarkov.find_feasible-808"><span class="linenos">808</span></a>
</span><span id="AbstractMarkov.find_feasible-809"><a href="#AbstractMarkov.find_feasible-809"><span class="linenos">809</span></a><span class="sd">        dict</span>
</span><span id="AbstractMarkov.find_feasible-810"><a href="#AbstractMarkov.find_feasible-810"><span class="linenos">810</span></a><span class="sd">            A dictionary containing the feasibility result. Possible formats:</span>
</span><span id="AbstractMarkov.find_feasible-811"><a href="#AbstractMarkov.find_feasible-811"><span class="linenos">811</span></a>
</span><span id="AbstractMarkov.find_feasible-812"><a href="#AbstractMarkov.find_feasible-812"><span class="linenos">812</span></a><span class="sd">            For feasible solutions:</span>
</span><span id="AbstractMarkov.find_feasible-813"><a href="#AbstractMarkov.find_feasible-813"><span class="linenos">813</span></a><span class="sd">            {</span>
</span><span id="AbstractMarkov.find_feasible-814"><a href="#AbstractMarkov.find_feasible-814"><span class="linenos">814</span></a><span class="sd">                &#39;status&#39;: &#39;feasible&#39;,</span>
</span><span id="AbstractMarkov.find_feasible-815"><a href="#AbstractMarkov.find_feasible-815"><span class="linenos">815</span></a><span class="sd">                &#39;values&#39;: dict, the values of the variables</span>
</span><span id="AbstractMarkov.find_feasible-816"><a href="#AbstractMarkov.find_feasible-816"><span class="linenos">816</span></a><span class="sd">            }</span>
</span><span id="AbstractMarkov.find_feasible-817"><a href="#AbstractMarkov.find_feasible-817"><span class="linenos">817</span></a>
</span><span id="AbstractMarkov.find_feasible-818"><a href="#AbstractMarkov.find_feasible-818"><span class="linenos">818</span></a><span class="sd">            For infeasible/unbounded problems:</span>
</span><span id="AbstractMarkov.find_feasible-819"><a href="#AbstractMarkov.find_feasible-819"><span class="linenos">819</span></a><span class="sd">            {</span>
</span><span id="AbstractMarkov.find_feasible-820"><a href="#AbstractMarkov.find_feasible-820"><span class="linenos">820</span></a><span class="sd">                &#39;status&#39;: str, either &#39;infeasible&#39; or &#39;unbounded&#39;,</span>
</span><span id="AbstractMarkov.find_feasible-821"><a href="#AbstractMarkov.find_feasible-821"><span class="linenos">821</span></a><span class="sd">                &#39;message&#39;: str, description of the problem</span>
</span><span id="AbstractMarkov.find_feasible-822"><a href="#AbstractMarkov.find_feasible-822"><span class="linenos">822</span></a><span class="sd">            }</span>
</span><span id="AbstractMarkov.find_feasible-823"><a href="#AbstractMarkov.find_feasible-823"><span class="linenos">823</span></a>
</span><span id="AbstractMarkov.find_feasible-824"><a href="#AbstractMarkov.find_feasible-824"><span class="linenos">824</span></a><span class="sd">            For other errors:</span>
</span><span id="AbstractMarkov.find_feasible-825"><a href="#AbstractMarkov.find_feasible-825"><span class="linenos">825</span></a><span class="sd">            {</span>
</span><span id="AbstractMarkov.find_feasible-826"><a href="#AbstractMarkov.find_feasible-826"><span class="linenos">826</span></a><span class="sd">                &#39;status&#39;: &#39;error&#39;,</span>
</span><span id="AbstractMarkov.find_feasible-827"><a href="#AbstractMarkov.find_feasible-827"><span class="linenos">827</span></a><span class="sd">                &#39;message&#39;: str, error description with status code</span>
</span><span id="AbstractMarkov.find_feasible-828"><a href="#AbstractMarkov.find_feasible-828"><span class="linenos">828</span></a><span class="sd">            }</span>
</span><span id="AbstractMarkov.find_feasible-829"><a href="#AbstractMarkov.find_feasible-829"><span class="linenos">829</span></a>
</span><span id="AbstractMarkov.find_feasible-830"><a href="#AbstractMarkov.find_feasible-830"><span class="linenos">830</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.find_feasible-831"><a href="#AbstractMarkov.find_feasible-831"><span class="linenos">831</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_check_all_vars_set</span><span class="p">()</span>
</span><span id="AbstractMarkov.find_feasible-832"><a href="#AbstractMarkov.find_feasible-832"><span class="linenos">832</span></a>
</span><span id="AbstractMarkov.find_feasible-833"><a href="#AbstractMarkov.find_feasible-833"><span class="linenos">833</span></a>        <span class="k">if</span> <span class="n">lb</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ub</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AbstractMarkov.find_feasible-834"><a href="#AbstractMarkov.find_feasible-834"><span class="linenos">834</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must specify at least one bound&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov.find_feasible-835"><a href="#AbstractMarkov.find_feasible-835"><span class="linenos">835</span></a>        <span class="k">if</span> <span class="n">lb</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">ub</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="AbstractMarkov.find_feasible-836"><a href="#AbstractMarkov.find_feasible-836"><span class="linenos">836</span></a>            <span class="k">if</span> <span class="n">lb</span> <span class="o">&gt;</span> <span class="n">ub</span><span class="p">:</span>
</span><span id="AbstractMarkov.find_feasible-837"><a href="#AbstractMarkov.find_feasible-837"><span class="linenos">837</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Lower bound must be less than upper bound&quot;</span><span class="p">)</span>
</span><span id="AbstractMarkov.find_feasible-838"><a href="#AbstractMarkov.find_feasible-838"><span class="linenos">838</span></a>
</span><span id="AbstractMarkov.find_feasible-839"><a href="#AbstractMarkov.find_feasible-839"><span class="linenos">839</span></a>        <span class="k">if</span> <span class="n">use_decomp</span><span class="p">:</span>
</span><span id="AbstractMarkov.find_feasible-840"><a href="#AbstractMarkov.find_feasible-840"><span class="linenos">840</span></a>            <span class="c1"># Step 1: ML bounds</span>
</span><span id="AbstractMarkov.find_feasible-841"><a href="#AbstractMarkov.find_feasible-841"><span class="linenos">841</span></a>            <span class="n">ml_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_ml_bounds</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</span><span id="AbstractMarkov.find_feasible-842"><a href="#AbstractMarkov.find_feasible-842"><span class="linenos">842</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_ml_bounds</span><span class="p">(</span><span class="n">ml_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov.find_feasible-843"><a href="#AbstractMarkov.find_feasible-843"><span class="linenos">843</span></a>
</span><span id="AbstractMarkov.find_feasible-844"><a href="#AbstractMarkov.find_feasible-844"><span class="linenos">844</span></a>            <span class="c1"># Step 2: Parameter bounds from affine relationships</span>
</span><span id="AbstractMarkov.find_feasible-845"><a href="#AbstractMarkov.find_feasible-845"><span class="linenos">845</span></a>            <span class="n">affine_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_affine_bounds</span><span class="p">(</span><span class="n">ml_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov.find_feasible-846"><a href="#AbstractMarkov.find_feasible-846"><span class="linenos">846</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_affine_bounds</span><span class="p">(</span><span class="n">affine_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov.find_feasible-847"><a href="#AbstractMarkov.find_feasible-847"><span class="linenos">847</span></a>
</span><span id="AbstractMarkov.find_feasible-848"><a href="#AbstractMarkov.find_feasible-848"><span class="linenos">848</span></a>            <span class="c1"># Step 3: Initial value vector bounds</span>
</span><span id="AbstractMarkov.find_feasible-849"><a href="#AbstractMarkov.find_feasible-849"><span class="linenos">849</span></a>            <span class="n">initial_v_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_initial_v_bounds</span><span class="p">()</span>
</span><span id="AbstractMarkov.find_feasible-850"><a href="#AbstractMarkov.find_feasible-850"><span class="linenos">850</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_initial_v_bounds</span><span class="p">(</span><span class="n">initial_v_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov.find_feasible-851"><a href="#AbstractMarkov.find_feasible-851"><span class="linenos">851</span></a>
</span><span id="AbstractMarkov.find_feasible-852"><a href="#AbstractMarkov.find_feasible-852"><span class="linenos">852</span></a>            <span class="c1"># Step 4: Tightened value vector bounds</span>
</span><span id="AbstractMarkov.find_feasible-853"><a href="#AbstractMarkov.find_feasible-853"><span class="linenos">853</span></a>            <span class="n">tightened_v_bounds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_tightened_v_bounds</span><span class="p">()</span>
</span><span id="AbstractMarkov.find_feasible-854"><a href="#AbstractMarkov.find_feasible-854"><span class="linenos">854</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_set_tightened_v_bounds</span><span class="p">(</span><span class="n">tightened_v_bounds</span><span class="p">)</span>
</span><span id="AbstractMarkov.find_feasible-855"><a href="#AbstractMarkov.find_feasible-855"><span class="linenos">855</span></a>
</span><span id="AbstractMarkov.find_feasible-856"><a href="#AbstractMarkov.find_feasible-856"><span class="linenos">856</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_find_feasible</span><span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span> <span class="n">gurobi_params</span><span class="o">=</span><span class="n">gurobi_params</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Public interface for finding a feasible solution to the problem.
It finds a feasible feature vector.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>lb</strong> (float | int | None (default=None)):
The lower bound on the feature vector. None means -inf.</li>
<li><strong>ub</strong> (float | int | None (default=None)):
The upper bound on the feature vector. None means inf.</li>
<li><strong>use_decomp</strong> (bool (default=True)):
Whether to use the decomposition and bound propagation approach</li>
<li><strong>verbose</strong> (bool (default=False)):
Whether to print Gurobi output</li>
<li><strong>gurobi_params</strong> (dict (default=None)):
Additional Gurobi parameters to set, e.g., {'TimeLimit': 60}</li>
<li><strong>Returns</strong></li>
<li><strong>dict</strong>: A dictionary containing the feasibility result. Possible formats:</li>
</ul>

<p>For feasible solutions:
{
    'status': 'feasible',
    'values': dict, the values of the variables
}</p>

<p>For infeasible/unbounded problems:
{
    'status': str, either 'infeasible' or 'unbounded',
    'message': str, description of the problem
}</p>

<p>For other errors:
{
    'status': 'error',
    'message': str, error description with status code
}</p>
</div>


                            </div>
                            <div id="AbstractMarkov.get_value" class="classattr">
                                        <input id="AbstractMarkov.get_value-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_value</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">var</span><span class="p">:</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="nb">str</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="AbstractMarkov.get_value-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#AbstractMarkov.get_value"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="AbstractMarkov.get_value-956"><a href="#AbstractMarkov.get_value-956"><span class="linenos">956</span></a>    <span class="k">def</span> <span class="nf">get_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">var</span> <span class="p">:</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="AbstractMarkov.get_value-957"><a href="#AbstractMarkov.get_value-957"><span class="linenos">957</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.get_value-958"><a href="#AbstractMarkov.get_value-958"><span class="linenos">958</span></a><span class="sd">        Get value of variable after optimization.</span>
</span><span id="AbstractMarkov.get_value-959"><a href="#AbstractMarkov.get_value-959"><span class="linenos">959</span></a><span class="sd">        Can either pass in a Gurobi variable or a string (name of variable).</span>
</span><span id="AbstractMarkov.get_value-960"><a href="#AbstractMarkov.get_value-960"><span class="linenos">960</span></a>
</span><span id="AbstractMarkov.get_value-961"><a href="#AbstractMarkov.get_value-961"><span class="linenos">961</span></a><span class="sd">        Parameters</span>
</span><span id="AbstractMarkov.get_value-962"><a href="#AbstractMarkov.get_value-962"><span class="linenos">962</span></a><span class="sd">        ----------</span>
</span><span id="AbstractMarkov.get_value-963"><a href="#AbstractMarkov.get_value-963"><span class="linenos">963</span></a><span class="sd">        var : gp.Var | str</span>
</span><span id="AbstractMarkov.get_value-964"><a href="#AbstractMarkov.get_value-964"><span class="linenos">964</span></a><span class="sd">            The variable to get the value of. If a string, it is the name of the variable.</span>
</span><span id="AbstractMarkov.get_value-965"><a href="#AbstractMarkov.get_value-965"><span class="linenos">965</span></a>
</span><span id="AbstractMarkov.get_value-966"><a href="#AbstractMarkov.get_value-966"><span class="linenos">966</span></a><span class="sd">        Returns</span>
</span><span id="AbstractMarkov.get_value-967"><a href="#AbstractMarkov.get_value-967"><span class="linenos">967</span></a><span class="sd">        -------</span>
</span><span id="AbstractMarkov.get_value-968"><a href="#AbstractMarkov.get_value-968"><span class="linenos">968</span></a><span class="sd">        float</span>
</span><span id="AbstractMarkov.get_value-969"><a href="#AbstractMarkov.get_value-969"><span class="linenos">969</span></a><span class="sd">            The value of the variable</span>
</span><span id="AbstractMarkov.get_value-970"><a href="#AbstractMarkov.get_value-970"><span class="linenos">970</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="AbstractMarkov.get_value-971"><a href="#AbstractMarkov.get_value-971"><span class="linenos">971</span></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">):</span>
</span><span id="AbstractMarkov.get_value-972"><a href="#AbstractMarkov.get_value-972"><span class="linenos">972</span></a>            <span class="k">return</span> <span class="n">var</span><span class="o">.</span><span class="n">X</span>  <span class="c1"># Direct access if it&#39;s already a Gurobi variable</span>
</span><span id="AbstractMarkov.get_value-973"><a href="#AbstractMarkov.get_value-973"><span class="linenos">973</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="AbstractMarkov.get_value-974"><a href="#AbstractMarkov.get_value-974"><span class="linenos">974</span></a>            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getVarByName</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">var</span><span class="p">))</span><span class="o">.</span><span class="n">X</span>  <span class="c1"># Use name lookup for strings</span>
</span></pre></div>


            <div class="docstring"><p>Get value of variable after optimization.
Can either pass in a Gurobi variable or a string (name of variable).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>var</strong> (gp.Var | str):
The variable to get the value of. If a string, it is the name of the variable.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>float</strong>: The value of the variable</li>
</ul>
</div>


                            </div>
                </section>
                <section id="MarkovReward">
                            <input id="MarkovReward-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MarkovReward</span><wbr>(<span class="base"><a href="#AbstractMarkov">AbstractMarkov</a></span>):

                <label class="view-source-button" for="MarkovReward-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReward"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReward-1356"><a href="#MarkovReward-1356"><span class="linenos">1356</span></a><span class="k">class</span> <span class="nc">MarkovReward</span><span class="p">(</span><span class="n">AbstractMarkov</span><span class="p">):</span>
</span><span id="MarkovReward-1357"><a href="#MarkovReward-1357"><span class="linenos">1357</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1358"><a href="#MarkovReward-1358"><span class="linenos">1358</span></a><span class="sd">    For the total reward problem.</span>
</span><span id="MarkovReward-1359"><a href="#MarkovReward-1359"><span class="linenos">1359</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1360"><a href="#MarkovReward-1360"><span class="linenos">1360</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_states</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovReward-1361"><a href="#MarkovReward-1361"><span class="linenos">1361</span></a>                 <span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovReward-1362"><a href="#MarkovReward-1362"><span class="linenos">1362</span></a>                 <span class="n">discount_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.97</span><span class="p">,</span> <span class="c1"># 3% discount</span>
</span><span id="MarkovReward-1363"><a href="#MarkovReward-1363"><span class="linenos">1363</span></a>                 <span class="n">pi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MarkovReward-1364"><a href="#MarkovReward-1364"><span class="linenos">1364</span></a>                 <span class="n">P</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MarkovReward-1365"><a href="#MarkovReward-1365"><span class="linenos">1365</span></a>                 <span class="n">r</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="MarkovReward-1366"><a href="#MarkovReward-1366"><span class="linenos">1366</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1367"><a href="#MarkovReward-1367"><span class="linenos">1367</span></a><span class="sd">        Initialize a Markov reward process for the total reward problem.</span>
</span><span id="MarkovReward-1368"><a href="#MarkovReward-1368"><span class="linenos">1368</span></a>
</span><span id="MarkovReward-1369"><a href="#MarkovReward-1369"><span class="linenos">1369</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReward-1370"><a href="#MarkovReward-1370"><span class="linenos">1370</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReward-1371"><a href="#MarkovReward-1371"><span class="linenos">1371</span></a><span class="sd">        n_states : int</span>
</span><span id="MarkovReward-1372"><a href="#MarkovReward-1372"><span class="linenos">1372</span></a><span class="sd">            The number of states</span>
</span><span id="MarkovReward-1373"><a href="#MarkovReward-1373"><span class="linenos">1373</span></a><span class="sd">        n_features : int</span>
</span><span id="MarkovReward-1374"><a href="#MarkovReward-1374"><span class="linenos">1374</span></a><span class="sd">            The number of features</span>
</span><span id="MarkovReward-1375"><a href="#MarkovReward-1375"><span class="linenos">1375</span></a><span class="sd">        discount_factor : float (default=0.97)</span>
</span><span id="MarkovReward-1376"><a href="#MarkovReward-1376"><span class="linenos">1376</span></a><span class="sd">            The discount factor for the Markov process</span>
</span><span id="MarkovReward-1377"><a href="#MarkovReward-1377"><span class="linenos">1377</span></a><span class="sd">        pi : Optional[List | np.ndarray] (default=None)</span>
</span><span id="MarkovReward-1378"><a href="#MarkovReward-1378"><span class="linenos">1378</span></a><span class="sd">            The initial state probabilities</span>
</span><span id="MarkovReward-1379"><a href="#MarkovReward-1379"><span class="linenos">1379</span></a><span class="sd">        P : Optional[List[List] | np.ndarray] (default=None)</span>
</span><span id="MarkovReward-1380"><a href="#MarkovReward-1380"><span class="linenos">1380</span></a><span class="sd">            The transition probabilities</span>
</span><span id="MarkovReward-1381"><a href="#MarkovReward-1381"><span class="linenos">1381</span></a><span class="sd">        r : Optional[List | np.ndarray] (default=None)</span>
</span><span id="MarkovReward-1382"><a href="#MarkovReward-1382"><span class="linenos">1382</span></a><span class="sd">            The reward vector</span>
</span><span id="MarkovReward-1383"><a href="#MarkovReward-1383"><span class="linenos">1383</span></a>
</span><span id="MarkovReward-1384"><a href="#MarkovReward-1384"><span class="linenos">1384</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReward-1385"><a href="#MarkovReward-1385"><span class="linenos">1385</span></a><span class="sd">        -----</span>
</span><span id="MarkovReward-1386"><a href="#MarkovReward-1386"><span class="linenos">1386</span></a><span class="sd">        Calls the constructor of the parent class AbstractMarkov, and additionally stores</span>
</span><span id="MarkovReward-1387"><a href="#MarkovReward-1387"><span class="linenos">1387</span></a><span class="sd">        the discount factor. Then, initializes the defining parameters and constraints.</span>
</span><span id="MarkovReward-1388"><a href="#MarkovReward-1388"><span class="linenos">1388</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1389"><a href="#MarkovReward-1389"><span class="linenos">1389</span></a>
</span><span id="MarkovReward-1390"><a href="#MarkovReward-1390"><span class="linenos">1390</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">n_states</span><span class="p">,</span> <span class="n">n_features</span><span class="p">)</span>
</span><span id="MarkovReward-1391"><a href="#MarkovReward-1391"><span class="linenos">1391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">discount_factor</span> <span class="o">=</span> <span class="n">discount_factor</span>
</span><span id="MarkovReward-1392"><a href="#MarkovReward-1392"><span class="linenos">1392</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_parameters_and_constraints</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
</span><span id="MarkovReward-1393"><a href="#MarkovReward-1393"><span class="linenos">1393</span></a>
</span><span id="MarkovReward-1394"><a href="#MarkovReward-1394"><span class="linenos">1394</span></a>    <span class="c1"># FUNCTIONS THAT MUST BE IMPLEMENTED IN SUBCLASSES WHICH UNIQUELY DEFINE THE PROBLEM</span>
</span><span id="MarkovReward-1395"><a href="#MarkovReward-1395"><span class="linenos">1395</span></a>
</span><span id="MarkovReward-1396"><a href="#MarkovReward-1396"><span class="linenos">1396</span></a>    <span class="k">def</span> <span class="nf">_initialize_parameters_and_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
</span><span id="MarkovReward-1397"><a href="#MarkovReward-1397"><span class="linenos">1397</span></a>                                               <span class="n">pi</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MarkovReward-1398"><a href="#MarkovReward-1398"><span class="linenos">1398</span></a>                                               <span class="n">P</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MarkovReward-1399"><a href="#MarkovReward-1399"><span class="linenos">1399</span></a>                                               <span class="n">r</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="MarkovReward-1400"><a href="#MarkovReward-1400"><span class="linenos">1400</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1401"><a href="#MarkovReward-1401"><span class="linenos">1401</span></a><span class="sd">        Initializes the parameters and constraints for a Markov reward process.</span>
</span><span id="MarkovReward-1402"><a href="#MarkovReward-1402"><span class="linenos">1402</span></a>
</span><span id="MarkovReward-1403"><a href="#MarkovReward-1403"><span class="linenos">1403</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReward-1404"><a href="#MarkovReward-1404"><span class="linenos">1404</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReward-1405"><a href="#MarkovReward-1405"><span class="linenos">1405</span></a><span class="sd">        pi : Optional[List | np.ndarray] (default=None)</span>
</span><span id="MarkovReward-1406"><a href="#MarkovReward-1406"><span class="linenos">1406</span></a><span class="sd">            The initial state probabilities</span>
</span><span id="MarkovReward-1407"><a href="#MarkovReward-1407"><span class="linenos">1407</span></a><span class="sd">        P : Optional[List[List] | np.ndarray] (default=None)</span>
</span><span id="MarkovReward-1408"><a href="#MarkovReward-1408"><span class="linenos">1408</span></a><span class="sd">            The transition probabilities</span>
</span><span id="MarkovReward-1409"><a href="#MarkovReward-1409"><span class="linenos">1409</span></a><span class="sd">        r : Optional[List | np.ndarray] (default=None)</span>
</span><span id="MarkovReward-1410"><a href="#MarkovReward-1410"><span class="linenos">1410</span></a><span class="sd">            The reward vector</span>
</span><span id="MarkovReward-1411"><a href="#MarkovReward-1411"><span class="linenos">1411</span></a>
</span><span id="MarkovReward-1412"><a href="#MarkovReward-1412"><span class="linenos">1412</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward-1413"><a href="#MarkovReward-1413"><span class="linenos">1413</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward-1414"><a href="#MarkovReward-1414"><span class="linenos">1414</span></a><span class="sd">        None</span>
</span><span id="MarkovReward-1415"><a href="#MarkovReward-1415"><span class="linenos">1415</span></a>
</span><span id="MarkovReward-1416"><a href="#MarkovReward-1416"><span class="linenos">1416</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReward-1417"><a href="#MarkovReward-1417"><span class="linenos">1417</span></a><span class="sd">        -----</span>
</span><span id="MarkovReward-1418"><a href="#MarkovReward-1418"><span class="linenos">1418</span></a><span class="sd">        Adds variables for: pi (bounds between 0 and 1), P (bounds between 0 and 1),</span>
</span><span id="MarkovReward-1419"><a href="#MarkovReward-1419"><span class="linenos">1419</span></a><span class="sd">        r (bounds between -inf and inf), and v (bounds between -inf and inf).</span>
</span><span id="MarkovReward-1420"><a href="#MarkovReward-1420"><span class="linenos">1420</span></a><span class="sd">        Creates boolean lists to store whether each variable has been set to an ML output</span>
</span><span id="MarkovReward-1421"><a href="#MarkovReward-1421"><span class="linenos">1421</span></a><span class="sd">        or a constant. Adds stochastic constraints on pi and rows of P. Lastly, adds</span>
</span><span id="MarkovReward-1422"><a href="#MarkovReward-1422"><span class="linenos">1422</span></a><span class="sd">        the Bellman equation constraint: v = r + discount_factor * P * v.</span>
</span><span id="MarkovReward-1423"><a href="#MarkovReward-1423"><span class="linenos">1423</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1424"><a href="#MarkovReward-1424"><span class="linenos">1424</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="MarkovReward-1425"><a href="#MarkovReward-1425"><span class="linenos">1425</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">,</span>
</span><span id="MarkovReward-1426"><a href="#MarkovReward-1426"><span class="linenos">1426</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pi&quot;</span><span class="p">,</span>
</span><span id="MarkovReward-1427"><a href="#MarkovReward-1427"><span class="linenos">1427</span></a>            <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MarkovReward-1428"><a href="#MarkovReward-1428"><span class="linenos">1428</span></a>            <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MarkovReward-1429"><a href="#MarkovReward-1429"><span class="linenos">1429</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="MarkovReward-1430"><a href="#MarkovReward-1430"><span class="linenos">1430</span></a>        <span class="p">)</span>
</span><span id="MarkovReward-1431"><a href="#MarkovReward-1431"><span class="linenos">1431</span></a>
</span><span id="MarkovReward-1432"><a href="#MarkovReward-1432"><span class="linenos">1432</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="MarkovReward-1433"><a href="#MarkovReward-1433"><span class="linenos">1433</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">,</span>
</span><span id="MarkovReward-1434"><a href="#MarkovReward-1434"><span class="linenos">1434</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">,</span>
</span><span id="MarkovReward-1435"><a href="#MarkovReward-1435"><span class="linenos">1435</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;P&quot;</span><span class="p">,</span>
</span><span id="MarkovReward-1436"><a href="#MarkovReward-1436"><span class="linenos">1436</span></a>            <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MarkovReward-1437"><a href="#MarkovReward-1437"><span class="linenos">1437</span></a>            <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MarkovReward-1438"><a href="#MarkovReward-1438"><span class="linenos">1438</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="MarkovReward-1439"><a href="#MarkovReward-1439"><span class="linenos">1439</span></a>        <span class="p">)</span>
</span><span id="MarkovReward-1440"><a href="#MarkovReward-1440"><span class="linenos">1440</span></a>
</span><span id="MarkovReward-1441"><a href="#MarkovReward-1441"><span class="linenos">1441</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="MarkovReward-1442"><a href="#MarkovReward-1442"><span class="linenos">1442</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">,</span>
</span><span id="MarkovReward-1443"><a href="#MarkovReward-1443"><span class="linenos">1443</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">,</span>
</span><span id="MarkovReward-1444"><a href="#MarkovReward-1444"><span class="linenos">1444</span></a>            <span class="n">lb</span><span class="o">=-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="MarkovReward-1445"><a href="#MarkovReward-1445"><span class="linenos">1445</span></a>            <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="MarkovReward-1446"><a href="#MarkovReward-1446"><span class="linenos">1446</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="MarkovReward-1447"><a href="#MarkovReward-1447"><span class="linenos">1447</span></a>        <span class="p">)</span>
</span><span id="MarkovReward-1448"><a href="#MarkovReward-1448"><span class="linenos">1448</span></a>
</span><span id="MarkovReward-1449"><a href="#MarkovReward-1449"><span class="linenos">1449</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="MarkovReward-1450"><a href="#MarkovReward-1450"><span class="linenos">1450</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">,</span>
</span><span id="MarkovReward-1451"><a href="#MarkovReward-1451"><span class="linenos">1451</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span>
</span><span id="MarkovReward-1452"><a href="#MarkovReward-1452"><span class="linenos">1452</span></a>            <span class="n">lb</span><span class="o">=-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="MarkovReward-1453"><a href="#MarkovReward-1453"><span class="linenos">1453</span></a>            <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="MarkovReward-1454"><a href="#MarkovReward-1454"><span class="linenos">1454</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="MarkovReward-1455"><a href="#MarkovReward-1455"><span class="linenos">1455</span></a>        <span class="p">)</span>
</span><span id="MarkovReward-1456"><a href="#MarkovReward-1456"><span class="linenos">1456</span></a>
</span><span id="MarkovReward-1457"><a href="#MarkovReward-1457"><span class="linenos">1457</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="MarkovReward-1458"><a href="#MarkovReward-1458"><span class="linenos">1458</span></a>
</span><span id="MarkovReward-1459"><a href="#MarkovReward-1459"><span class="linenos">1459</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span>
</span><span id="MarkovReward-1460"><a href="#MarkovReward-1460"><span class="linenos">1460</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span>
</span><span id="MarkovReward-1461"><a href="#MarkovReward-1461"><span class="linenos">1461</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span>
</span><span id="MarkovReward-1462"><a href="#MarkovReward-1462"><span class="linenos">1462</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span>
</span><span id="MarkovReward-1463"><a href="#MarkovReward-1463"><span class="linenos">1463</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span>
</span><span id="MarkovReward-1464"><a href="#MarkovReward-1464"><span class="linenos">1464</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span>
</span><span id="MarkovReward-1465"><a href="#MarkovReward-1465"><span class="linenos">1465</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span>
</span><span id="MarkovReward-1466"><a href="#MarkovReward-1466"><span class="linenos">1466</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span>
</span><span id="MarkovReward-1467"><a href="#MarkovReward-1467"><span class="linenos">1467</span></a>
</span><span id="MarkovReward-1468"><a href="#MarkovReward-1468"><span class="linenos">1468</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">,)</span>
</span><span id="MarkovReward-1469"><a href="#MarkovReward-1469"><span class="linenos">1469</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)</span>
</span><span id="MarkovReward-1470"><a href="#MarkovReward-1470"><span class="linenos">1470</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">,)</span>
</span><span id="MarkovReward-1471"><a href="#MarkovReward-1471"><span class="linenos">1471</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">,)</span>
</span><span id="MarkovReward-1472"><a href="#MarkovReward-1472"><span class="linenos">1472</span></a>
</span><span id="MarkovReward-1473"><a href="#MarkovReward-1473"><span class="linenos">1473</span></a>        <span class="k">if</span> <span class="n">pi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkovReward-1474"><a href="#MarkovReward-1474"><span class="linenos">1474</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_pi</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>
</span><span id="MarkovReward-1475"><a href="#MarkovReward-1475"><span class="linenos">1475</span></a>        <span class="k">if</span> <span class="n">P</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkovReward-1476"><a href="#MarkovReward-1476"><span class="linenos">1476</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_P</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>
</span><span id="MarkovReward-1477"><a href="#MarkovReward-1477"><span class="linenos">1477</span></a>        <span class="k">if</span> <span class="n">r</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkovReward-1478"><a href="#MarkovReward-1478"><span class="linenos">1478</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_r</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="MarkovReward-1479"><a href="#MarkovReward-1479"><span class="linenos">1479</span></a>
</span><span id="MarkovReward-1480"><a href="#MarkovReward-1480"><span class="linenos">1480</span></a>        <span class="c1"># add probability constraints</span>
</span><span id="MarkovReward-1481"><a href="#MarkovReward-1481"><span class="linenos">1481</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="MarkovReward-1482"><a href="#MarkovReward-1482"><span class="linenos">1482</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">):</span>
</span><span id="MarkovReward-1483"><a href="#MarkovReward-1483"><span class="linenos">1483</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="MarkovReward-1484"><a href="#MarkovReward-1484"><span class="linenos">1484</span></a>                                 <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;prob_constr_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MarkovReward-1485"><a href="#MarkovReward-1485"><span class="linenos">1485</span></a>
</span><span id="MarkovReward-1486"><a href="#MarkovReward-1486"><span class="linenos">1486</span></a>        <span class="c1"># add Bellman equation constraints</span>
</span><span id="MarkovReward-1487"><a href="#MarkovReward-1487"><span class="linenos">1487</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">):</span>
</span><span id="MarkovReward-1488"><a href="#MarkovReward-1488"><span class="linenos">1488</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">discount_factor</span> <span class="o">*</span> <span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)),</span>
</span><span id="MarkovReward-1489"><a href="#MarkovReward-1489"><span class="linenos">1489</span></a>                                 <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;bellman_constr_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MarkovReward-1490"><a href="#MarkovReward-1490"><span class="linenos">1490</span></a>
</span><span id="MarkovReward-1491"><a href="#MarkovReward-1491"><span class="linenos">1491</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="MarkovReward-1492"><a href="#MarkovReward-1492"><span class="linenos">1492</span></a>
</span><span id="MarkovReward-1493"><a href="#MarkovReward-1493"><span class="linenos">1493</span></a>    <span class="k">def</span> <span class="nf">_check_all_vars_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReward-1494"><a href="#MarkovReward-1494"><span class="linenos">1494</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1495"><a href="#MarkovReward-1495"><span class="linenos">1495</span></a><span class="sd">        Check if pi, P, and r have been set before optimization.</span>
</span><span id="MarkovReward-1496"><a href="#MarkovReward-1496"><span class="linenos">1496</span></a>
</span><span id="MarkovReward-1497"><a href="#MarkovReward-1497"><span class="linenos">1497</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward-1498"><a href="#MarkovReward-1498"><span class="linenos">1498</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward-1499"><a href="#MarkovReward-1499"><span class="linenos">1499</span></a><span class="sd">        None</span>
</span><span id="MarkovReward-1500"><a href="#MarkovReward-1500"><span class="linenos">1500</span></a>
</span><span id="MarkovReward-1501"><a href="#MarkovReward-1501"><span class="linenos">1501</span></a><span class="sd">        Raises</span>
</span><span id="MarkovReward-1502"><a href="#MarkovReward-1502"><span class="linenos">1502</span></a><span class="sd">        ------</span>
</span><span id="MarkovReward-1503"><a href="#MarkovReward-1503"><span class="linenos">1503</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovReward-1504"><a href="#MarkovReward-1504"><span class="linenos">1504</span></a><span class="sd">            If any required variables have not been set</span>
</span><span id="MarkovReward-1505"><a href="#MarkovReward-1505"><span class="linenos">1505</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1506"><a href="#MarkovReward-1506"><span class="linenos">1506</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReward-1507"><a href="#MarkovReward-1507"><span class="linenos">1507</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
</span><span id="MarkovReward-1508"><a href="#MarkovReward-1508"><span class="linenos">1508</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pi[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] needs to be set to a constant or linked to an ML output&quot;</span><span class="p">)</span>
</span><span id="MarkovReward-1509"><a href="#MarkovReward-1509"><span class="linenos">1509</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReward-1510"><a href="#MarkovReward-1510"><span class="linenos">1510</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
</span><span id="MarkovReward-1511"><a href="#MarkovReward-1511"><span class="linenos">1511</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;r[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] needs to be set to a constant or linked to an ML output&quot;</span><span class="p">)</span>
</span><span id="MarkovReward-1512"><a href="#MarkovReward-1512"><span class="linenos">1512</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReward-1513"><a href="#MarkovReward-1513"><span class="linenos">1513</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovReward-1514"><a href="#MarkovReward-1514"><span class="linenos">1514</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]):</span>
</span><span id="MarkovReward-1515"><a href="#MarkovReward-1515"><span class="linenos">1515</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] needs to be set to a constant or linked to an ML output&quot;</span><span class="p">)</span>
</span><span id="MarkovReward-1516"><a href="#MarkovReward-1516"><span class="linenos">1516</span></a>
</span><span id="MarkovReward-1517"><a href="#MarkovReward-1517"><span class="linenos">1517</span></a>    <span class="k">def</span> <span class="nf">_set_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReward-1518"><a href="#MarkovReward-1518"><span class="linenos">1518</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1519"><a href="#MarkovReward-1519"><span class="linenos">1519</span></a><span class="sd">        Sets the objective function to pi * v.</span>
</span><span id="MarkovReward-1520"><a href="#MarkovReward-1520"><span class="linenos">1520</span></a>
</span><span id="MarkovReward-1521"><a href="#MarkovReward-1521"><span class="linenos">1521</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward-1522"><a href="#MarkovReward-1522"><span class="linenos">1522</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward-1523"><a href="#MarkovReward-1523"><span class="linenos">1523</span></a><span class="sd">        None</span>
</span><span id="MarkovReward-1524"><a href="#MarkovReward-1524"><span class="linenos">1524</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1525"><a href="#MarkovReward-1525"><span class="linenos">1525</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)))</span>
</span><span id="MarkovReward-1526"><a href="#MarkovReward-1526"><span class="linenos">1526</span></a>
</span><span id="MarkovReward-1527"><a href="#MarkovReward-1527"><span class="linenos">1527</span></a>    <span class="k">def</span> <span class="nf">_set_feasible_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">,</span> <span class="n">ub</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="MarkovReward-1528"><a href="#MarkovReward-1528"><span class="linenos">1528</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1529"><a href="#MarkovReward-1529"><span class="linenos">1529</span></a><span class="sd">        Sets the feasible constraints on the objective. When looking for a feasible solution,</span>
</span><span id="MarkovReward-1530"><a href="#MarkovReward-1530"><span class="linenos">1530</span></a><span class="sd">        this simply adds the constraints: lb &lt;= pi * v &lt;= ub.</span>
</span><span id="MarkovReward-1531"><a href="#MarkovReward-1531"><span class="linenos">1531</span></a>
</span><span id="MarkovReward-1532"><a href="#MarkovReward-1532"><span class="linenos">1532</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReward-1533"><a href="#MarkovReward-1533"><span class="linenos">1533</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReward-1534"><a href="#MarkovReward-1534"><span class="linenos">1534</span></a><span class="sd">        lb : float | int</span>
</span><span id="MarkovReward-1535"><a href="#MarkovReward-1535"><span class="linenos">1535</span></a><span class="sd">            The lower bound</span>
</span><span id="MarkovReward-1536"><a href="#MarkovReward-1536"><span class="linenos">1536</span></a><span class="sd">        ub : float | int</span>
</span><span id="MarkovReward-1537"><a href="#MarkovReward-1537"><span class="linenos">1537</span></a><span class="sd">            The upper bound</span>
</span><span id="MarkovReward-1538"><a href="#MarkovReward-1538"><span class="linenos">1538</span></a>
</span><span id="MarkovReward-1539"><a href="#MarkovReward-1539"><span class="linenos">1539</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward-1540"><a href="#MarkovReward-1540"><span class="linenos">1540</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward-1541"><a href="#MarkovReward-1541"><span class="linenos">1541</span></a><span class="sd">        None</span>
</span><span id="MarkovReward-1542"><a href="#MarkovReward-1542"><span class="linenos">1542</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1543"><a href="#MarkovReward-1543"><span class="linenos">1543</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">lb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;temp_feasible_lb&quot;</span><span class="p">)</span>
</span><span id="MarkovReward-1544"><a href="#MarkovReward-1544"><span class="linenos">1544</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">ub</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;temp_feasible_ub&quot;</span><span class="p">)</span>
</span><span id="MarkovReward-1545"><a href="#MarkovReward-1545"><span class="linenos">1545</span></a>
</span><span id="MarkovReward-1546"><a href="#MarkovReward-1546"><span class="linenos">1546</span></a>    <span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReward-1547"><a href="#MarkovReward-1547"><span class="linenos">1547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1548"><a href="#MarkovReward-1548"><span class="linenos">1548</span></a><span class="sd">        Returns the values of pi, P, r, v, features, and ml_outputs as a dictionary.</span>
</span><span id="MarkovReward-1549"><a href="#MarkovReward-1549"><span class="linenos">1549</span></a>
</span><span id="MarkovReward-1550"><a href="#MarkovReward-1550"><span class="linenos">1550</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward-1551"><a href="#MarkovReward-1551"><span class="linenos">1551</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward-1552"><a href="#MarkovReward-1552"><span class="linenos">1552</span></a><span class="sd">        dict</span>
</span><span id="MarkovReward-1553"><a href="#MarkovReward-1553"><span class="linenos">1553</span></a><span class="sd">            A dictionary with keys:</span>
</span><span id="MarkovReward-1554"><a href="#MarkovReward-1554"><span class="linenos">1554</span></a><span class="sd">            - `pi`: the values of pi</span>
</span><span id="MarkovReward-1555"><a href="#MarkovReward-1555"><span class="linenos">1555</span></a><span class="sd">            - `P`: the values of P</span>
</span><span id="MarkovReward-1556"><a href="#MarkovReward-1556"><span class="linenos">1556</span></a><span class="sd">            - `r`: the values of r</span>
</span><span id="MarkovReward-1557"><a href="#MarkovReward-1557"><span class="linenos">1557</span></a><span class="sd">            - `v`: the values of v</span>
</span><span id="MarkovReward-1558"><a href="#MarkovReward-1558"><span class="linenos">1558</span></a><span class="sd">            - `features`: the values of the features</span>
</span><span id="MarkovReward-1559"><a href="#MarkovReward-1559"><span class="linenos">1559</span></a><span class="sd">            - `ml_outputs`: the values of the ml_outputs</span>
</span><span id="MarkovReward-1560"><a href="#MarkovReward-1560"><span class="linenos">1560</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1561"><a href="#MarkovReward-1561"><span class="linenos">1561</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="MarkovReward-1562"><a href="#MarkovReward-1562"><span class="linenos">1562</span></a>            <span class="s2">&quot;pi&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)],</span>
</span><span id="MarkovReward-1563"><a href="#MarkovReward-1563"><span class="linenos">1563</span></a>            <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)],</span>
</span><span id="MarkovReward-1564"><a href="#MarkovReward-1564"><span class="linenos">1564</span></a>            <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)],</span>
</span><span id="MarkovReward-1565"><a href="#MarkovReward-1565"><span class="linenos">1565</span></a>            <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)],</span>
</span><span id="MarkovReward-1566"><a href="#MarkovReward-1566"><span class="linenos">1566</span></a>            <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">)],</span>
</span><span id="MarkovReward-1567"><a href="#MarkovReward-1567"><span class="linenos">1567</span></a>            <span class="s2">&quot;ml_outputs&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]))]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">))]</span>
</span><span id="MarkovReward-1568"><a href="#MarkovReward-1568"><span class="linenos">1568</span></a>        <span class="p">}</span>
</span><span id="MarkovReward-1569"><a href="#MarkovReward-1569"><span class="linenos">1569</span></a>
</span><span id="MarkovReward-1570"><a href="#MarkovReward-1570"><span class="linenos">1570</span></a>    <span class="k">def</span> <span class="nf">_compute_affine_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ml_bounds</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]):</span>
</span><span id="MarkovReward-1571"><a href="#MarkovReward-1571"><span class="linenos">1571</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1572"><a href="#MarkovReward-1572"><span class="linenos">1572</span></a><span class="sd">        Computes the affine bounds for the parameters that are linked to ML outputs.</span>
</span><span id="MarkovReward-1573"><a href="#MarkovReward-1573"><span class="linenos">1573</span></a>
</span><span id="MarkovReward-1574"><a href="#MarkovReward-1574"><span class="linenos">1574</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReward-1575"><a href="#MarkovReward-1575"><span class="linenos">1575</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReward-1576"><a href="#MarkovReward-1576"><span class="linenos">1576</span></a><span class="sd">        ml_bounds : List[List[Tuple[float, float]]]</span>
</span><span id="MarkovReward-1577"><a href="#MarkovReward-1577"><span class="linenos">1577</span></a><span class="sd">            The bounds for the ML outputs</span>
</span><span id="MarkovReward-1578"><a href="#MarkovReward-1578"><span class="linenos">1578</span></a>
</span><span id="MarkovReward-1579"><a href="#MarkovReward-1579"><span class="linenos">1579</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward-1580"><a href="#MarkovReward-1580"><span class="linenos">1580</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward-1581"><a href="#MarkovReward-1581"><span class="linenos">1581</span></a><span class="sd">        dict</span>
</span><span id="MarkovReward-1582"><a href="#MarkovReward-1582"><span class="linenos">1582</span></a><span class="sd">            A dictionary with keys: &#39;pi&#39;, &#39;P&#39;, &#39;r&#39;</span>
</span><span id="MarkovReward-1583"><a href="#MarkovReward-1583"><span class="linenos">1583</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1584"><a href="#MarkovReward-1584"><span class="linenos">1584</span></a>        <span class="c1"># Convert ml_bounds to dictionary for easier lookup</span>
</span><span id="MarkovReward-1585"><a href="#MarkovReward-1585"><span class="linenos">1585</span></a>        <span class="n">bounds_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MarkovReward-1586"><a href="#MarkovReward-1586"><span class="linenos">1586</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model_bounds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ml_bounds</span><span class="p">):</span>
</span><span id="MarkovReward-1587"><a href="#MarkovReward-1587"><span class="linenos">1587</span></a>            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_bounds</span><span class="p">):</span>
</span><span id="MarkovReward-1588"><a href="#MarkovReward-1588"><span class="linenos">1588</span></a>                <span class="n">bounds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ml_outputs_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="MarkovReward-1589"><a href="#MarkovReward-1589"><span class="linenos">1589</span></a>
</span><span id="MarkovReward-1590"><a href="#MarkovReward-1590"><span class="linenos">1590</span></a>        <span class="c1"># Initialize bounds dictionary</span>
</span><span id="MarkovReward-1591"><a href="#MarkovReward-1591"><span class="linenos">1591</span></a>        <span class="n">affine_bounds</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MarkovReward-1592"><a href="#MarkovReward-1592"><span class="linenos">1592</span></a>            <span class="s1">&#39;pi&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="MarkovReward-1593"><a href="#MarkovReward-1593"><span class="linenos">1593</span></a>            <span class="s1">&#39;P&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="MarkovReward-1594"><a href="#MarkovReward-1594"><span class="linenos">1594</span></a>            <span class="s1">&#39;r&#39;</span><span class="p">:</span> <span class="p">[]</span>
</span><span id="MarkovReward-1595"><a href="#MarkovReward-1595"><span class="linenos">1595</span></a>        <span class="p">}</span>
</span><span id="MarkovReward-1596"><a href="#MarkovReward-1596"><span class="linenos">1596</span></a>
</span><span id="MarkovReward-1597"><a href="#MarkovReward-1597"><span class="linenos">1597</span></a>        <span class="c1"># Compute bounds for each parameter that is an ML output</span>
</span><span id="MarkovReward-1598"><a href="#MarkovReward-1598"><span class="linenos">1598</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReward-1599"><a href="#MarkovReward-1599"><span class="linenos">1599</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
</span><span id="MarkovReward-1600"><a href="#MarkovReward-1600"><span class="linenos">1600</span></a>                <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ml_expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovReward-1601"><a href="#MarkovReward-1601"><span class="linenos">1601</span></a>                <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_expr_bounds</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">bounds_dict</span><span class="p">)))</span>
</span><span id="MarkovReward-1602"><a href="#MarkovReward-1602"><span class="linenos">1602</span></a>
</span><span id="MarkovReward-1603"><a href="#MarkovReward-1603"><span class="linenos">1603</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReward-1604"><a href="#MarkovReward-1604"><span class="linenos">1604</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
</span><span id="MarkovReward-1605"><a href="#MarkovReward-1605"><span class="linenos">1605</span></a>                <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ml_expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovReward-1606"><a href="#MarkovReward-1606"><span class="linenos">1606</span></a>                <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_expr_bounds</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">bounds_dict</span><span class="p">)))</span>
</span><span id="MarkovReward-1607"><a href="#MarkovReward-1607"><span class="linenos">1607</span></a>
</span><span id="MarkovReward-1608"><a href="#MarkovReward-1608"><span class="linenos">1608</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReward-1609"><a href="#MarkovReward-1609"><span class="linenos">1609</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovReward-1610"><a href="#MarkovReward-1610"><span class="linenos">1610</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
</span><span id="MarkovReward-1611"><a href="#MarkovReward-1611"><span class="linenos">1611</span></a>                    <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ml_expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
</span><span id="MarkovReward-1612"><a href="#MarkovReward-1612"><span class="linenos">1612</span></a>                    <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_expr_bounds</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">bounds_dict</span><span class="p">)))</span>
</span><span id="MarkovReward-1613"><a href="#MarkovReward-1613"><span class="linenos">1613</span></a>
</span><span id="MarkovReward-1614"><a href="#MarkovReward-1614"><span class="linenos">1614</span></a>        <span class="k">return</span> <span class="n">affine_bounds</span>
</span><span id="MarkovReward-1615"><a href="#MarkovReward-1615"><span class="linenos">1615</span></a>
</span><span id="MarkovReward-1616"><a href="#MarkovReward-1616"><span class="linenos">1616</span></a>    <span class="k">def</span> <span class="nf">_set_affine_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">affine_bounds</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="MarkovReward-1617"><a href="#MarkovReward-1617"><span class="linenos">1617</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1618"><a href="#MarkovReward-1618"><span class="linenos">1618</span></a><span class="sd">        Sets the bounds for the parameters that are linked to ML outputs.</span>
</span><span id="MarkovReward-1619"><a href="#MarkovReward-1619"><span class="linenos">1619</span></a>
</span><span id="MarkovReward-1620"><a href="#MarkovReward-1620"><span class="linenos">1620</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReward-1621"><a href="#MarkovReward-1621"><span class="linenos">1621</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReward-1622"><a href="#MarkovReward-1622"><span class="linenos">1622</span></a><span class="sd">        affine_bounds : dict</span>
</span><span id="MarkovReward-1623"><a href="#MarkovReward-1623"><span class="linenos">1623</span></a><span class="sd">            The bounds for the ML outputs</span>
</span><span id="MarkovReward-1624"><a href="#MarkovReward-1624"><span class="linenos">1624</span></a>
</span><span id="MarkovReward-1625"><a href="#MarkovReward-1625"><span class="linenos">1625</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward-1626"><a href="#MarkovReward-1626"><span class="linenos">1626</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward-1627"><a href="#MarkovReward-1627"><span class="linenos">1627</span></a><span class="sd">        None</span>
</span><span id="MarkovReward-1628"><a href="#MarkovReward-1628"><span class="linenos">1628</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1629"><a href="#MarkovReward-1629"><span class="linenos">1629</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]:</span>
</span><span id="MarkovReward-1630"><a href="#MarkovReward-1630"><span class="linenos">1630</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="MarkovReward-1631"><a href="#MarkovReward-1631"><span class="linenos">1631</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="MarkovReward-1632"><a href="#MarkovReward-1632"><span class="linenos">1632</span></a>
</span><span id="MarkovReward-1633"><a href="#MarkovReward-1633"><span class="linenos">1633</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]:</span>
</span><span id="MarkovReward-1634"><a href="#MarkovReward-1634"><span class="linenos">1634</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="MarkovReward-1635"><a href="#MarkovReward-1635"><span class="linenos">1635</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="MarkovReward-1636"><a href="#MarkovReward-1636"><span class="linenos">1636</span></a>
</span><span id="MarkovReward-1637"><a href="#MarkovReward-1637"><span class="linenos">1637</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]:</span>
</span><span id="MarkovReward-1638"><a href="#MarkovReward-1638"><span class="linenos">1638</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="MarkovReward-1639"><a href="#MarkovReward-1639"><span class="linenos">1639</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="MarkovReward-1640"><a href="#MarkovReward-1640"><span class="linenos">1640</span></a>
</span><span id="MarkovReward-1641"><a href="#MarkovReward-1641"><span class="linenos">1641</span></a>    <span class="k">def</span> <span class="nf">_compute_initial_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReward-1642"><a href="#MarkovReward-1642"><span class="linenos">1642</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1643"><a href="#MarkovReward-1643"><span class="linenos">1643</span></a><span class="sd">        Computes the initial bounds for v using the reward bounds and discount factor.</span>
</span><span id="MarkovReward-1644"><a href="#MarkovReward-1644"><span class="linenos">1644</span></a><span class="sd">        Uses the lemma from the paper: for each $v_i$, $v_i \\in [v^min_i, v^max_i]$ where</span>
</span><span id="MarkovReward-1645"><a href="#MarkovReward-1645"><span class="linenos">1645</span></a><span class="sd">        $v^min_i = \\min_j r^min_j / (1 - \\lambda)$, and</span>
</span><span id="MarkovReward-1646"><a href="#MarkovReward-1646"><span class="linenos">1646</span></a><span class="sd">        $v^max_i = \\max_j r^max_j / (1 - \\lambda)$.</span>
</span><span id="MarkovReward-1647"><a href="#MarkovReward-1647"><span class="linenos">1647</span></a>
</span><span id="MarkovReward-1648"><a href="#MarkovReward-1648"><span class="linenos">1648</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward-1649"><a href="#MarkovReward-1649"><span class="linenos">1649</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward-1650"><a href="#MarkovReward-1650"><span class="linenos">1650</span></a><span class="sd">        List[Tuple[float, float]]</span>
</span><span id="MarkovReward-1651"><a href="#MarkovReward-1651"><span class="linenos">1651</span></a><span class="sd">            The initial bounds for v</span>
</span><span id="MarkovReward-1652"><a href="#MarkovReward-1652"><span class="linenos">1652</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1653"><a href="#MarkovReward-1653"><span class="linenos">1653</span></a>        <span class="c1"># Get min/max rewards across all states</span>
</span><span id="MarkovReward-1654"><a href="#MarkovReward-1654"><span class="linenos">1654</span></a>        <span class="n">r_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="MarkovReward-1655"><a href="#MarkovReward-1655"><span class="linenos">1655</span></a>        <span class="n">r_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="MarkovReward-1656"><a href="#MarkovReward-1656"><span class="linenos">1656</span></a>
</span><span id="MarkovReward-1657"><a href="#MarkovReward-1657"><span class="linenos">1657</span></a>        <span class="c1"># Compute v bounds using reward bounds and discount factor</span>
</span><span id="MarkovReward-1658"><a href="#MarkovReward-1658"><span class="linenos">1658</span></a>        <span class="n">v_min</span> <span class="o">=</span> <span class="n">r_min</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">discount_factor</span><span class="p">)</span>
</span><span id="MarkovReward-1659"><a href="#MarkovReward-1659"><span class="linenos">1659</span></a>        <span class="n">v_max</span> <span class="o">=</span> <span class="n">r_max</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">discount_factor</span><span class="p">)</span>
</span><span id="MarkovReward-1660"><a href="#MarkovReward-1660"><span class="linenos">1660</span></a>
</span><span id="MarkovReward-1661"><a href="#MarkovReward-1661"><span class="linenos">1661</span></a>        <span class="c1"># Return bounds for each state</span>
</span><span id="MarkovReward-1662"><a href="#MarkovReward-1662"><span class="linenos">1662</span></a>        <span class="k">return</span> <span class="p">[(</span><span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="MarkovReward-1663"><a href="#MarkovReward-1663"><span class="linenos">1663</span></a>
</span><span id="MarkovReward-1664"><a href="#MarkovReward-1664"><span class="linenos">1664</span></a>    <span class="k">def</span> <span class="nf">_set_initial_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_v_bounds</span><span class="p">):</span>
</span><span id="MarkovReward-1665"><a href="#MarkovReward-1665"><span class="linenos">1665</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1666"><a href="#MarkovReward-1666"><span class="linenos">1666</span></a><span class="sd">        Sets the initial bounds for v.</span>
</span><span id="MarkovReward-1667"><a href="#MarkovReward-1667"><span class="linenos">1667</span></a>
</span><span id="MarkovReward-1668"><a href="#MarkovReward-1668"><span class="linenos">1668</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReward-1669"><a href="#MarkovReward-1669"><span class="linenos">1669</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReward-1670"><a href="#MarkovReward-1670"><span class="linenos">1670</span></a><span class="sd">        initial_v_bounds : List[Tuple[float, float]]</span>
</span><span id="MarkovReward-1671"><a href="#MarkovReward-1671"><span class="linenos">1671</span></a><span class="sd">            The initial bounds for v</span>
</span><span id="MarkovReward-1672"><a href="#MarkovReward-1672"><span class="linenos">1672</span></a>
</span><span id="MarkovReward-1673"><a href="#MarkovReward-1673"><span class="linenos">1673</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward-1674"><a href="#MarkovReward-1674"><span class="linenos">1674</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward-1675"><a href="#MarkovReward-1675"><span class="linenos">1675</span></a><span class="sd">        None</span>
</span><span id="MarkovReward-1676"><a href="#MarkovReward-1676"><span class="linenos">1676</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1677"><a href="#MarkovReward-1677"><span class="linenos">1677</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReward-1678"><a href="#MarkovReward-1678"><span class="linenos">1678</span></a>            <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">initial_v_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="MarkovReward-1679"><a href="#MarkovReward-1679"><span class="linenos">1679</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="MarkovReward-1680"><a href="#MarkovReward-1680"><span class="linenos">1680</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="MarkovReward-1681"><a href="#MarkovReward-1681"><span class="linenos">1681</span></a>
</span><span id="MarkovReward-1682"><a href="#MarkovReward-1682"><span class="linenos">1682</span></a>    <span class="k">def</span> <span class="nf">_compute_tightened_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReward-1683"><a href="#MarkovReward-1683"><span class="linenos">1683</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1684"><a href="#MarkovReward-1684"><span class="linenos">1684</span></a><span class="sd">        Computes the tightened bounds for v using the bounds for P and r and initial bounds for v.</span>
</span><span id="MarkovReward-1685"><a href="#MarkovReward-1685"><span class="linenos">1685</span></a><span class="sd">        This uses Gauss-Seidel to solve the linear system: $vM = r$, where $M = I - \\lambda * P$.</span>
</span><span id="MarkovReward-1686"><a href="#MarkovReward-1686"><span class="linenos">1686</span></a>
</span><span id="MarkovReward-1687"><a href="#MarkovReward-1687"><span class="linenos">1687</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward-1688"><a href="#MarkovReward-1688"><span class="linenos">1688</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward-1689"><a href="#MarkovReward-1689"><span class="linenos">1689</span></a><span class="sd">        List[Tuple[float, float]]</span>
</span><span id="MarkovReward-1690"><a href="#MarkovReward-1690"><span class="linenos">1690</span></a><span class="sd">            The tightened bounds for v</span>
</span><span id="MarkovReward-1691"><a href="#MarkovReward-1691"><span class="linenos">1691</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1692"><a href="#MarkovReward-1692"><span class="linenos">1692</span></a>        <span class="c1"># Create interval matrices for P and r</span>
</span><span id="MarkovReward-1693"><a href="#MarkovReward-1693"><span class="linenos">1693</span></a>        <span class="n">P_intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="MarkovReward-1694"><a href="#MarkovReward-1694"><span class="linenos">1694</span></a>        <span class="n">r_intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="MarkovReward-1695"><a href="#MarkovReward-1695"><span class="linenos">1695</span></a>
</span><span id="MarkovReward-1696"><a href="#MarkovReward-1696"><span class="linenos">1696</span></a>        <span class="c1"># Fill intervals from current bounds</span>
</span><span id="MarkovReward-1697"><a href="#MarkovReward-1697"><span class="linenos">1697</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReward-1698"><a href="#MarkovReward-1698"><span class="linenos">1698</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovReward-1699"><a href="#MarkovReward-1699"><span class="linenos">1699</span></a>                <span class="n">P_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span><span class="p">]</span>
</span><span id="MarkovReward-1700"><a href="#MarkovReward-1700"><span class="linenos">1700</span></a>            <span class="n">r_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span><span class="p">]</span>
</span><span id="MarkovReward-1701"><a href="#MarkovReward-1701"><span class="linenos">1701</span></a>
</span><span id="MarkovReward-1702"><a href="#MarkovReward-1702"><span class="linenos">1702</span></a>        <span class="c1"># Create linear system: vM = r, where M = I - discount_factor * P</span>
</span><span id="MarkovReward-1703"><a href="#MarkovReward-1703"><span class="linenos">1703</span></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">ima</span><span class="o">.</span><span class="n">_identity_interval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="MarkovReward-1704"><a href="#MarkovReward-1704"><span class="linenos">1704</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">ima</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">discount_factor</span> <span class="o">*</span> <span class="n">P_intervals</span><span class="p">)</span>
</span><span id="MarkovReward-1705"><a href="#MarkovReward-1705"><span class="linenos">1705</span></a>
</span><span id="MarkovReward-1706"><a href="#MarkovReward-1706"><span class="linenos">1706</span></a>        <span class="c1"># Initial guess using current v bounds</span>
</span><span id="MarkovReward-1707"><a href="#MarkovReward-1707"><span class="linenos">1707</span></a>        <span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])])</span>
</span><span id="MarkovReward-1708"><a href="#MarkovReward-1708"><span class="linenos">1708</span></a>
</span><span id="MarkovReward-1709"><a href="#MarkovReward-1709"><span class="linenos">1709</span></a>        <span class="c1"># Solve using Gauss-Seidel</span>
</span><span id="MarkovReward-1710"><a href="#MarkovReward-1710"><span class="linenos">1710</span></a>        <span class="n">v_intervals</span> <span class="o">=</span> <span class="n">ima</span><span class="o">.</span><span class="n">interval_gauss_seidel</span><span class="p">(</span>
</span><span id="MarkovReward-1711"><a href="#MarkovReward-1711"><span class="linenos">1711</span></a>            <span class="n">M</span><span class="p">,</span> <span class="n">r_intervals</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span>
</span><span id="MarkovReward-1712"><a href="#MarkovReward-1712"><span class="linenos">1712</span></a>            <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span id="MarkovReward-1713"><a href="#MarkovReward-1713"><span class="linenos">1713</span></a>            <span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span>
</span><span id="MarkovReward-1714"><a href="#MarkovReward-1714"><span class="linenos">1714</span></a>        <span class="p">)</span>
</span><span id="MarkovReward-1715"><a href="#MarkovReward-1715"><span class="linenos">1715</span></a>
</span><span id="MarkovReward-1716"><a href="#MarkovReward-1716"><span class="linenos">1716</span></a>        <span class="c1"># Convert to list of tuples</span>
</span><span id="MarkovReward-1717"><a href="#MarkovReward-1717"><span class="linenos">1717</span></a>        <span class="k">return</span> <span class="p">[(</span><span class="n">v_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">v_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="MarkovReward-1718"><a href="#MarkovReward-1718"><span class="linenos">1718</span></a>
</span><span id="MarkovReward-1719"><a href="#MarkovReward-1719"><span class="linenos">1719</span></a>    <span class="k">def</span> <span class="nf">_set_tightened_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tightened_v_bounds</span><span class="p">):</span>
</span><span id="MarkovReward-1720"><a href="#MarkovReward-1720"><span class="linenos">1720</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1721"><a href="#MarkovReward-1721"><span class="linenos">1721</span></a><span class="sd">        Sets the tightened bounds for v.</span>
</span><span id="MarkovReward-1722"><a href="#MarkovReward-1722"><span class="linenos">1722</span></a>
</span><span id="MarkovReward-1723"><a href="#MarkovReward-1723"><span class="linenos">1723</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReward-1724"><a href="#MarkovReward-1724"><span class="linenos">1724</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReward-1725"><a href="#MarkovReward-1725"><span class="linenos">1725</span></a><span class="sd">        tightened_v_bounds : List[Tuple[float, float]]</span>
</span><span id="MarkovReward-1726"><a href="#MarkovReward-1726"><span class="linenos">1726</span></a><span class="sd">            The tightened bounds for v</span>
</span><span id="MarkovReward-1727"><a href="#MarkovReward-1727"><span class="linenos">1727</span></a>
</span><span id="MarkovReward-1728"><a href="#MarkovReward-1728"><span class="linenos">1728</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward-1729"><a href="#MarkovReward-1729"><span class="linenos">1729</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward-1730"><a href="#MarkovReward-1730"><span class="linenos">1730</span></a><span class="sd">        None</span>
</span><span id="MarkovReward-1731"><a href="#MarkovReward-1731"><span class="linenos">1731</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1732"><a href="#MarkovReward-1732"><span class="linenos">1732</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReward-1733"><a href="#MarkovReward-1733"><span class="linenos">1733</span></a>            <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">tightened_v_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="MarkovReward-1734"><a href="#MarkovReward-1734"><span class="linenos">1734</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="MarkovReward-1735"><a href="#MarkovReward-1735"><span class="linenos">1735</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="MarkovReward-1736"><a href="#MarkovReward-1736"><span class="linenos">1736</span></a>
</span><span id="MarkovReward-1737"><a href="#MarkovReward-1737"><span class="linenos">1737</span></a>    <span class="c1"># CLEAN PARAMETER ACCESSORS</span>
</span><span id="MarkovReward-1738"><a href="#MarkovReward-1738"><span class="linenos">1738</span></a>
</span><span id="MarkovReward-1739"><a href="#MarkovReward-1739"><span class="linenos">1739</span></a>    <span class="nd">@property</span>
</span><span id="MarkovReward-1740"><a href="#MarkovReward-1740"><span class="linenos">1740</span></a>    <span class="k">def</span> <span class="nf">pi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReward-1741"><a href="#MarkovReward-1741"><span class="linenos">1741</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1742"><a href="#MarkovReward-1742"><span class="linenos">1742</span></a><span class="sd">        Accessor for the pi parameter.</span>
</span><span id="MarkovReward-1743"><a href="#MarkovReward-1743"><span class="linenos">1743</span></a>
</span><span id="MarkovReward-1744"><a href="#MarkovReward-1744"><span class="linenos">1744</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward-1745"><a href="#MarkovReward-1745"><span class="linenos">1745</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward-1746"><a href="#MarkovReward-1746"><span class="linenos">1746</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovReward-1747"><a href="#MarkovReward-1747"><span class="linenos">1747</span></a><span class="sd">            The pi parameter</span>
</span><span id="MarkovReward-1748"><a href="#MarkovReward-1748"><span class="linenos">1748</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1749"><a href="#MarkovReward-1749"><span class="linenos">1749</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span>
</span><span id="MarkovReward-1750"><a href="#MarkovReward-1750"><span class="linenos">1750</span></a>
</span><span id="MarkovReward-1751"><a href="#MarkovReward-1751"><span class="linenos">1751</span></a>    <span class="nd">@property</span>
</span><span id="MarkovReward-1752"><a href="#MarkovReward-1752"><span class="linenos">1752</span></a>    <span class="k">def</span> <span class="nf">P</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReward-1753"><a href="#MarkovReward-1753"><span class="linenos">1753</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1754"><a href="#MarkovReward-1754"><span class="linenos">1754</span></a><span class="sd">        Accessor for the P parameter.</span>
</span><span id="MarkovReward-1755"><a href="#MarkovReward-1755"><span class="linenos">1755</span></a>
</span><span id="MarkovReward-1756"><a href="#MarkovReward-1756"><span class="linenos">1756</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward-1757"><a href="#MarkovReward-1757"><span class="linenos">1757</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward-1758"><a href="#MarkovReward-1758"><span class="linenos">1758</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovReward-1759"><a href="#MarkovReward-1759"><span class="linenos">1759</span></a><span class="sd">            The P parameter</span>
</span><span id="MarkovReward-1760"><a href="#MarkovReward-1760"><span class="linenos">1760</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1761"><a href="#MarkovReward-1761"><span class="linenos">1761</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
</span><span id="MarkovReward-1762"><a href="#MarkovReward-1762"><span class="linenos">1762</span></a>
</span><span id="MarkovReward-1763"><a href="#MarkovReward-1763"><span class="linenos">1763</span></a>    <span class="nd">@property</span>
</span><span id="MarkovReward-1764"><a href="#MarkovReward-1764"><span class="linenos">1764</span></a>    <span class="k">def</span> <span class="nf">r</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReward-1765"><a href="#MarkovReward-1765"><span class="linenos">1765</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1766"><a href="#MarkovReward-1766"><span class="linenos">1766</span></a><span class="sd">        Accessor for the r parameter.</span>
</span><span id="MarkovReward-1767"><a href="#MarkovReward-1767"><span class="linenos">1767</span></a>
</span><span id="MarkovReward-1768"><a href="#MarkovReward-1768"><span class="linenos">1768</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward-1769"><a href="#MarkovReward-1769"><span class="linenos">1769</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward-1770"><a href="#MarkovReward-1770"><span class="linenos">1770</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovReward-1771"><a href="#MarkovReward-1771"><span class="linenos">1771</span></a><span class="sd">            The r parameter</span>
</span><span id="MarkovReward-1772"><a href="#MarkovReward-1772"><span class="linenos">1772</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1773"><a href="#MarkovReward-1773"><span class="linenos">1773</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>
</span><span id="MarkovReward-1774"><a href="#MarkovReward-1774"><span class="linenos">1774</span></a>
</span><span id="MarkovReward-1775"><a href="#MarkovReward-1775"><span class="linenos">1775</span></a>    <span class="nd">@property</span>
</span><span id="MarkovReward-1776"><a href="#MarkovReward-1776"><span class="linenos">1776</span></a>    <span class="k">def</span> <span class="nf">v</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReward-1777"><a href="#MarkovReward-1777"><span class="linenos">1777</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1778"><a href="#MarkovReward-1778"><span class="linenos">1778</span></a><span class="sd">        Accessor for the v parameter.</span>
</span><span id="MarkovReward-1779"><a href="#MarkovReward-1779"><span class="linenos">1779</span></a>
</span><span id="MarkovReward-1780"><a href="#MarkovReward-1780"><span class="linenos">1780</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward-1781"><a href="#MarkovReward-1781"><span class="linenos">1781</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward-1782"><a href="#MarkovReward-1782"><span class="linenos">1782</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovReward-1783"><a href="#MarkovReward-1783"><span class="linenos">1783</span></a><span class="sd">            The v parameter</span>
</span><span id="MarkovReward-1784"><a href="#MarkovReward-1784"><span class="linenos">1784</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1785"><a href="#MarkovReward-1785"><span class="linenos">1785</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
</span><span id="MarkovReward-1786"><a href="#MarkovReward-1786"><span class="linenos">1786</span></a>
</span><span id="MarkovReward-1787"><a href="#MarkovReward-1787"><span class="linenos">1787</span></a>    <span class="c1"># HELPER FUNCTIONS TO SET PARAMETERS</span>
</span><span id="MarkovReward-1788"><a href="#MarkovReward-1788"><span class="linenos">1788</span></a>    <span class="c1"># Can set them all at once with set_pi, set_P, set_r</span>
</span><span id="MarkovReward-1789"><a href="#MarkovReward-1789"><span class="linenos">1789</span></a>    <span class="c1"># These check for validity of, e.g., probabilities</span>
</span><span id="MarkovReward-1790"><a href="#MarkovReward-1790"><span class="linenos">1790</span></a>
</span><span id="MarkovReward-1791"><a href="#MarkovReward-1791"><span class="linenos">1791</span></a>    <span class="k">def</span> <span class="nf">set_pi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]):</span>
</span><span id="MarkovReward-1792"><a href="#MarkovReward-1792"><span class="linenos">1792</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1793"><a href="#MarkovReward-1793"><span class="linenos">1793</span></a><span class="sd">        Helper function to set the entire pi vector.</span>
</span><span id="MarkovReward-1794"><a href="#MarkovReward-1794"><span class="linenos">1794</span></a>
</span><span id="MarkovReward-1795"><a href="#MarkovReward-1795"><span class="linenos">1795</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReward-1796"><a href="#MarkovReward-1796"><span class="linenos">1796</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReward-1797"><a href="#MarkovReward-1797"><span class="linenos">1797</span></a><span class="sd">        values : List[float | int | gp.Var | gp.LinExpr]</span>
</span><span id="MarkovReward-1798"><a href="#MarkovReward-1798"><span class="linenos">1798</span></a><span class="sd">            The values to set the pi parameter to</span>
</span><span id="MarkovReward-1799"><a href="#MarkovReward-1799"><span class="linenos">1799</span></a>
</span><span id="MarkovReward-1800"><a href="#MarkovReward-1800"><span class="linenos">1800</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward-1801"><a href="#MarkovReward-1801"><span class="linenos">1801</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward-1802"><a href="#MarkovReward-1802"><span class="linenos">1802</span></a><span class="sd">        None</span>
</span><span id="MarkovReward-1803"><a href="#MarkovReward-1803"><span class="linenos">1803</span></a>
</span><span id="MarkovReward-1804"><a href="#MarkovReward-1804"><span class="linenos">1804</span></a><span class="sd">        Raises</span>
</span><span id="MarkovReward-1805"><a href="#MarkovReward-1805"><span class="linenos">1805</span></a><span class="sd">        ------</span>
</span><span id="MarkovReward-1806"><a href="#MarkovReward-1806"><span class="linenos">1806</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovReward-1807"><a href="#MarkovReward-1807"><span class="linenos">1807</span></a><span class="sd">            If the values have incorrect length, are not in [0, 1], don&#39;t sum to 1,or pi is already set</span>
</span><span id="MarkovReward-1808"><a href="#MarkovReward-1808"><span class="linenos">1808</span></a>
</span><span id="MarkovReward-1809"><a href="#MarkovReward-1809"><span class="linenos">1809</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReward-1810"><a href="#MarkovReward-1810"><span class="linenos">1810</span></a><span class="sd">        -----</span>
</span><span id="MarkovReward-1811"><a href="#MarkovReward-1811"><span class="linenos">1811</span></a><span class="sd">        This checks for validity of the values, checks if pi is already set, and sets the values.</span>
</span><span id="MarkovReward-1812"><a href="#MarkovReward-1812"><span class="linenos">1812</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1813"><a href="#MarkovReward-1813"><span class="linenos">1813</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_length</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">)</span>
</span><span id="MarkovReward-1814"><a href="#MarkovReward-1814"><span class="linenos">1814</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="MarkovReward-1815"><a href="#MarkovReward-1815"><span class="linenos">1815</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="MarkovReward-1816"><a href="#MarkovReward-1816"><span class="linenos">1816</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">)</span>
</span><span id="MarkovReward-1817"><a href="#MarkovReward-1817"><span class="linenos">1817</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;pi&quot;</span><span class="p">),</span>\
</span><span id="MarkovReward-1818"><a href="#MarkovReward-1818"><span class="linenos">1818</span></a>              <span class="s2">&quot;pi is already set&quot;</span>
</span><span id="MarkovReward-1819"><a href="#MarkovReward-1819"><span class="linenos">1819</span></a>
</span><span id="MarkovReward-1820"><a href="#MarkovReward-1820"><span class="linenos">1820</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;pi&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReward-1821"><a href="#MarkovReward-1821"><span class="linenos">1821</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="MarkovReward-1822"><a href="#MarkovReward-1822"><span class="linenos">1822</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovReward-1823"><a href="#MarkovReward-1823"><span class="linenos">1823</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="MarkovReward-1824"><a href="#MarkovReward-1824"><span class="linenos">1824</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovReward-1825"><a href="#MarkovReward-1825"><span class="linenos">1825</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MarkovReward-1826"><a href="#MarkovReward-1826"><span class="linenos">1826</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pi[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span><span id="MarkovReward-1827"><a href="#MarkovReward-1827"><span class="linenos">1827</span></a>
</span><span id="MarkovReward-1828"><a href="#MarkovReward-1828"><span class="linenos">1828</span></a>    <span class="k">def</span> <span class="nf">set_r</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]):</span>
</span><span id="MarkovReward-1829"><a href="#MarkovReward-1829"><span class="linenos">1829</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1830"><a href="#MarkovReward-1830"><span class="linenos">1830</span></a><span class="sd">        Helper function to set the entire r vector.</span>
</span><span id="MarkovReward-1831"><a href="#MarkovReward-1831"><span class="linenos">1831</span></a>
</span><span id="MarkovReward-1832"><a href="#MarkovReward-1832"><span class="linenos">1832</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReward-1833"><a href="#MarkovReward-1833"><span class="linenos">1833</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReward-1834"><a href="#MarkovReward-1834"><span class="linenos">1834</span></a><span class="sd">        values : List[float | int | gp.Var | gp.LinExpr]</span>
</span><span id="MarkovReward-1835"><a href="#MarkovReward-1835"><span class="linenos">1835</span></a><span class="sd">            The values to set the r parameter to</span>
</span><span id="MarkovReward-1836"><a href="#MarkovReward-1836"><span class="linenos">1836</span></a>
</span><span id="MarkovReward-1837"><a href="#MarkovReward-1837"><span class="linenos">1837</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward-1838"><a href="#MarkovReward-1838"><span class="linenos">1838</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward-1839"><a href="#MarkovReward-1839"><span class="linenos">1839</span></a><span class="sd">        None</span>
</span><span id="MarkovReward-1840"><a href="#MarkovReward-1840"><span class="linenos">1840</span></a>
</span><span id="MarkovReward-1841"><a href="#MarkovReward-1841"><span class="linenos">1841</span></a><span class="sd">        Raises</span>
</span><span id="MarkovReward-1842"><a href="#MarkovReward-1842"><span class="linenos">1842</span></a><span class="sd">        ------</span>
</span><span id="MarkovReward-1843"><a href="#MarkovReward-1843"><span class="linenos">1843</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovReward-1844"><a href="#MarkovReward-1844"><span class="linenos">1844</span></a><span class="sd">            If the values have incorrect length, or r is already set</span>
</span><span id="MarkovReward-1845"><a href="#MarkovReward-1845"><span class="linenos">1845</span></a>
</span><span id="MarkovReward-1846"><a href="#MarkovReward-1846"><span class="linenos">1846</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReward-1847"><a href="#MarkovReward-1847"><span class="linenos">1847</span></a><span class="sd">        -----</span>
</span><span id="MarkovReward-1848"><a href="#MarkovReward-1848"><span class="linenos">1848</span></a><span class="sd">        This checks for validity of the values, checks if r is already set, and sets the values.</span>
</span><span id="MarkovReward-1849"><a href="#MarkovReward-1849"><span class="linenos">1849</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1850"><a href="#MarkovReward-1850"><span class="linenos">1850</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_length</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
</span><span id="MarkovReward-1851"><a href="#MarkovReward-1851"><span class="linenos">1851</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">),</span>\
</span><span id="MarkovReward-1852"><a href="#MarkovReward-1852"><span class="linenos">1852</span></a>              <span class="s2">&quot;r is already set&quot;</span>
</span><span id="MarkovReward-1853"><a href="#MarkovReward-1853"><span class="linenos">1853</span></a>
</span><span id="MarkovReward-1854"><a href="#MarkovReward-1854"><span class="linenos">1854</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReward-1855"><a href="#MarkovReward-1855"><span class="linenos">1855</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="MarkovReward-1856"><a href="#MarkovReward-1856"><span class="linenos">1856</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovReward-1857"><a href="#MarkovReward-1857"><span class="linenos">1857</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="MarkovReward-1858"><a href="#MarkovReward-1858"><span class="linenos">1858</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovReward-1859"><a href="#MarkovReward-1859"><span class="linenos">1859</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MarkovReward-1860"><a href="#MarkovReward-1860"><span class="linenos">1860</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;r[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span><span id="MarkovReward-1861"><a href="#MarkovReward-1861"><span class="linenos">1861</span></a>
</span><span id="MarkovReward-1862"><a href="#MarkovReward-1862"><span class="linenos">1862</span></a>    <span class="k">def</span> <span class="nf">set_P</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]]):</span>
</span><span id="MarkovReward-1863"><a href="#MarkovReward-1863"><span class="linenos">1863</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1864"><a href="#MarkovReward-1864"><span class="linenos">1864</span></a><span class="sd">        Helper function to set the entire P matrix.</span>
</span><span id="MarkovReward-1865"><a href="#MarkovReward-1865"><span class="linenos">1865</span></a>
</span><span id="MarkovReward-1866"><a href="#MarkovReward-1866"><span class="linenos">1866</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReward-1867"><a href="#MarkovReward-1867"><span class="linenos">1867</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReward-1868"><a href="#MarkovReward-1868"><span class="linenos">1868</span></a><span class="sd">        values : List[List[float | int | gp.Var | gp.LinExpr]]</span>
</span><span id="MarkovReward-1869"><a href="#MarkovReward-1869"><span class="linenos">1869</span></a><span class="sd">            The values to set the P parameter to</span>
</span><span id="MarkovReward-1870"><a href="#MarkovReward-1870"><span class="linenos">1870</span></a>
</span><span id="MarkovReward-1871"><a href="#MarkovReward-1871"><span class="linenos">1871</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward-1872"><a href="#MarkovReward-1872"><span class="linenos">1872</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward-1873"><a href="#MarkovReward-1873"><span class="linenos">1873</span></a><span class="sd">        None</span>
</span><span id="MarkovReward-1874"><a href="#MarkovReward-1874"><span class="linenos">1874</span></a>
</span><span id="MarkovReward-1875"><a href="#MarkovReward-1875"><span class="linenos">1875</span></a><span class="sd">        Raises</span>
</span><span id="MarkovReward-1876"><a href="#MarkovReward-1876"><span class="linenos">1876</span></a><span class="sd">        ------</span>
</span><span id="MarkovReward-1877"><a href="#MarkovReward-1877"><span class="linenos">1877</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovReward-1878"><a href="#MarkovReward-1878"><span class="linenos">1878</span></a><span class="sd">            If the values have incorrect shape, are not in [0, 1], rows don&#39;t sum to 1, or P is already set</span>
</span><span id="MarkovReward-1879"><a href="#MarkovReward-1879"><span class="linenos">1879</span></a>
</span><span id="MarkovReward-1880"><a href="#MarkovReward-1880"><span class="linenos">1880</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReward-1881"><a href="#MarkovReward-1881"><span class="linenos">1881</span></a><span class="sd">        -----</span>
</span><span id="MarkovReward-1882"><a href="#MarkovReward-1882"><span class="linenos">1882</span></a><span class="sd">        This checks for validity of the values, checks if P is already set, and sets the values.</span>
</span><span id="MarkovReward-1883"><a href="#MarkovReward-1883"><span class="linenos">1883</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1884"><a href="#MarkovReward-1884"><span class="linenos">1884</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_shape</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">)</span>
</span><span id="MarkovReward-1885"><a href="#MarkovReward-1885"><span class="linenos">1885</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="MarkovReward-1886"><a href="#MarkovReward-1886"><span class="linenos">1886</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="MarkovReward-1887"><a href="#MarkovReward-1887"><span class="linenos">1887</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_matrix</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">)</span>
</span><span id="MarkovReward-1888"><a href="#MarkovReward-1888"><span class="linenos">1888</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
</span><span id="MarkovReward-1889"><a href="#MarkovReward-1889"><span class="linenos">1889</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="MarkovReward-1890"><a href="#MarkovReward-1890"><span class="linenos">1890</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;P[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
</span><span id="MarkovReward-1891"><a href="#MarkovReward-1891"><span class="linenos">1891</span></a>
</span><span id="MarkovReward-1892"><a href="#MarkovReward-1892"><span class="linenos">1892</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">),</span>\
</span><span id="MarkovReward-1893"><a href="#MarkovReward-1893"><span class="linenos">1893</span></a>              <span class="s2">&quot;P is already set&quot;</span>
</span><span id="MarkovReward-1894"><a href="#MarkovReward-1894"><span class="linenos">1894</span></a>
</span><span id="MarkovReward-1895"><a href="#MarkovReward-1895"><span class="linenos">1895</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReward-1896"><a href="#MarkovReward-1896"><span class="linenos">1896</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovReward-1897"><a href="#MarkovReward-1897"><span class="linenos">1897</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="MarkovReward-1898"><a href="#MarkovReward-1898"><span class="linenos">1898</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="MarkovReward-1899"><a href="#MarkovReward-1899"><span class="linenos">1899</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="MarkovReward-1900"><a href="#MarkovReward-1900"><span class="linenos">1900</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="MarkovReward-1901"><a href="#MarkovReward-1901"><span class="linenos">1901</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MarkovReward-1902"><a href="#MarkovReward-1902"><span class="linenos">1902</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span><span id="MarkovReward-1903"><a href="#MarkovReward-1903"><span class="linenos">1903</span></a>
</span><span id="MarkovReward-1904"><a href="#MarkovReward-1904"><span class="linenos">1904</span></a>    <span class="c1"># FUNCTIONS TO ADD CONSTRAINTS TO THE MRP</span>
</span><span id="MarkovReward-1905"><a href="#MarkovReward-1905"><span class="linenos">1905</span></a>    <span class="c1"># In an MRP, IFT is important because we have a full prob matrix</span>
</span><span id="MarkovReward-1906"><a href="#MarkovReward-1906"><span class="linenos">1906</span></a>
</span><span id="MarkovReward-1907"><a href="#MarkovReward-1907"><span class="linenos">1907</span></a>    <span class="k">def</span> <span class="nf">add_ifr_inequalities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReward-1908"><a href="#MarkovReward-1908"><span class="linenos">1908</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward-1909"><a href="#MarkovReward-1909"><span class="linenos">1909</span></a><span class="sd">        Helper function to add IFR (increasing failure rate) inequalities on P.</span>
</span><span id="MarkovReward-1910"><a href="#MarkovReward-1910"><span class="linenos">1910</span></a>
</span><span id="MarkovReward-1911"><a href="#MarkovReward-1911"><span class="linenos">1911</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReward-1912"><a href="#MarkovReward-1912"><span class="linenos">1912</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReward-1913"><a href="#MarkovReward-1913"><span class="linenos">1913</span></a><span class="sd">        None</span>
</span><span id="MarkovReward-1914"><a href="#MarkovReward-1914"><span class="linenos">1914</span></a>
</span><span id="MarkovReward-1915"><a href="#MarkovReward-1915"><span class="linenos">1915</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward-1916"><a href="#MarkovReward-1916"><span class="linenos">1916</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward-1917"><a href="#MarkovReward-1917"><span class="linenos">1917</span></a><span class="sd">        None</span>
</span><span id="MarkovReward-1918"><a href="#MarkovReward-1918"><span class="linenos">1918</span></a>
</span><span id="MarkovReward-1919"><a href="#MarkovReward-1919"><span class="linenos">1919</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReward-1920"><a href="#MarkovReward-1920"><span class="linenos">1920</span></a><span class="sd">        -----</span>
</span><span id="MarkovReward-1921"><a href="#MarkovReward-1921"><span class="linenos">1921</span></a><span class="sd">        The definition of IFR is the following. Given an $n \\times n$ transition matrix $P$, and a fixed $i \\in [n]$,</span>
</span><span id="MarkovReward-1922"><a href="#MarkovReward-1922"><span class="linenos">1922</span></a><span class="sd">        define the function $b_h(i) = \\sum_{j=h}^n P_{ij}$. Then, $P$ is IFR if, for each $h \\in [n]$, we have</span>
</span><span id="MarkovReward-1923"><a href="#MarkovReward-1923"><span class="linenos">1923</span></a><span class="sd">        $b_h(i) \\leq b_h(i+1)$ for all $i \\in [n-1]$.</span>
</span><span id="MarkovReward-1924"><a href="#MarkovReward-1924"><span class="linenos">1924</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward-1925"><a href="#MarkovReward-1925"><span class="linenos">1925</span></a>        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">):</span>
</span><span id="MarkovReward-1926"><a href="#MarkovReward-1926"><span class="linenos">1926</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="MarkovReward-1927"><a href="#MarkovReward-1927"><span class="linenos">1927</span></a>                <span class="c1"># b_h(i) &lt;= b_h(i+1), i.e., sum_{j=h}^n P_{ij} &lt;= sum_{j=h}^n P_{i+1, j}</span>
</span><span id="MarkovReward-1928"><a href="#MarkovReward-1928"><span class="linenos">1928</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">))</span> <span class="o">&lt;=</span>
</span><span id="MarkovReward-1929"><a href="#MarkovReward-1929"><span class="linenos">1929</span></a>                                    <span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)),</span>
</span><span id="MarkovReward-1930"><a href="#MarkovReward-1930"><span class="linenos">1930</span></a>                                    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ifr_h_</span><span class="si">{</span><span class="n">h</span><span class="si">}</span><span class="s2">_row_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_row_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MarkovReward-1931"><a href="#MarkovReward-1931"><span class="linenos">1931</span></a>
</span><span id="MarkovReward-1932"><a href="#MarkovReward-1932"><span class="linenos">1932</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>For the total reward problem.</p>
</div>


                            <div id="MarkovReward.__init__" class="classattr">
                                        <input id="MarkovReward.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">MarkovReward</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">n_states</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">discount_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.97</span>,</span><span class="param">	<span class="n">pi</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">P</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">r</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="MarkovReward.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReward.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReward.__init__-1360"><a href="#MarkovReward.__init__-1360"><span class="linenos">1360</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_states</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovReward.__init__-1361"><a href="#MarkovReward.__init__-1361"><span class="linenos">1361</span></a>                 <span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovReward.__init__-1362"><a href="#MarkovReward.__init__-1362"><span class="linenos">1362</span></a>                 <span class="n">discount_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.97</span><span class="p">,</span> <span class="c1"># 3% discount</span>
</span><span id="MarkovReward.__init__-1363"><a href="#MarkovReward.__init__-1363"><span class="linenos">1363</span></a>                 <span class="n">pi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MarkovReward.__init__-1364"><a href="#MarkovReward.__init__-1364"><span class="linenos">1364</span></a>                 <span class="n">P</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MarkovReward.__init__-1365"><a href="#MarkovReward.__init__-1365"><span class="linenos">1365</span></a>                 <span class="n">r</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="MarkovReward.__init__-1366"><a href="#MarkovReward.__init__-1366"><span class="linenos">1366</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward.__init__-1367"><a href="#MarkovReward.__init__-1367"><span class="linenos">1367</span></a><span class="sd">        Initialize a Markov reward process for the total reward problem.</span>
</span><span id="MarkovReward.__init__-1368"><a href="#MarkovReward.__init__-1368"><span class="linenos">1368</span></a>
</span><span id="MarkovReward.__init__-1369"><a href="#MarkovReward.__init__-1369"><span class="linenos">1369</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReward.__init__-1370"><a href="#MarkovReward.__init__-1370"><span class="linenos">1370</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReward.__init__-1371"><a href="#MarkovReward.__init__-1371"><span class="linenos">1371</span></a><span class="sd">        n_states : int</span>
</span><span id="MarkovReward.__init__-1372"><a href="#MarkovReward.__init__-1372"><span class="linenos">1372</span></a><span class="sd">            The number of states</span>
</span><span id="MarkovReward.__init__-1373"><a href="#MarkovReward.__init__-1373"><span class="linenos">1373</span></a><span class="sd">        n_features : int</span>
</span><span id="MarkovReward.__init__-1374"><a href="#MarkovReward.__init__-1374"><span class="linenos">1374</span></a><span class="sd">            The number of features</span>
</span><span id="MarkovReward.__init__-1375"><a href="#MarkovReward.__init__-1375"><span class="linenos">1375</span></a><span class="sd">        discount_factor : float (default=0.97)</span>
</span><span id="MarkovReward.__init__-1376"><a href="#MarkovReward.__init__-1376"><span class="linenos">1376</span></a><span class="sd">            The discount factor for the Markov process</span>
</span><span id="MarkovReward.__init__-1377"><a href="#MarkovReward.__init__-1377"><span class="linenos">1377</span></a><span class="sd">        pi : Optional[List | np.ndarray] (default=None)</span>
</span><span id="MarkovReward.__init__-1378"><a href="#MarkovReward.__init__-1378"><span class="linenos">1378</span></a><span class="sd">            The initial state probabilities</span>
</span><span id="MarkovReward.__init__-1379"><a href="#MarkovReward.__init__-1379"><span class="linenos">1379</span></a><span class="sd">        P : Optional[List[List] | np.ndarray] (default=None)</span>
</span><span id="MarkovReward.__init__-1380"><a href="#MarkovReward.__init__-1380"><span class="linenos">1380</span></a><span class="sd">            The transition probabilities</span>
</span><span id="MarkovReward.__init__-1381"><a href="#MarkovReward.__init__-1381"><span class="linenos">1381</span></a><span class="sd">        r : Optional[List | np.ndarray] (default=None)</span>
</span><span id="MarkovReward.__init__-1382"><a href="#MarkovReward.__init__-1382"><span class="linenos">1382</span></a><span class="sd">            The reward vector</span>
</span><span id="MarkovReward.__init__-1383"><a href="#MarkovReward.__init__-1383"><span class="linenos">1383</span></a>
</span><span id="MarkovReward.__init__-1384"><a href="#MarkovReward.__init__-1384"><span class="linenos">1384</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReward.__init__-1385"><a href="#MarkovReward.__init__-1385"><span class="linenos">1385</span></a><span class="sd">        -----</span>
</span><span id="MarkovReward.__init__-1386"><a href="#MarkovReward.__init__-1386"><span class="linenos">1386</span></a><span class="sd">        Calls the constructor of the parent class AbstractMarkov, and additionally stores</span>
</span><span id="MarkovReward.__init__-1387"><a href="#MarkovReward.__init__-1387"><span class="linenos">1387</span></a><span class="sd">        the discount factor. Then, initializes the defining parameters and constraints.</span>
</span><span id="MarkovReward.__init__-1388"><a href="#MarkovReward.__init__-1388"><span class="linenos">1388</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward.__init__-1389"><a href="#MarkovReward.__init__-1389"><span class="linenos">1389</span></a>
</span><span id="MarkovReward.__init__-1390"><a href="#MarkovReward.__init__-1390"><span class="linenos">1390</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">n_states</span><span class="p">,</span> <span class="n">n_features</span><span class="p">)</span>
</span><span id="MarkovReward.__init__-1391"><a href="#MarkovReward.__init__-1391"><span class="linenos">1391</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">discount_factor</span> <span class="o">=</span> <span class="n">discount_factor</span>
</span><span id="MarkovReward.__init__-1392"><a href="#MarkovReward.__init__-1392"><span class="linenos">1392</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_parameters_and_constraints</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">P</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a Markov reward process for the total reward problem.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>n_states</strong> (int):
The number of states</li>
<li><strong>n_features</strong> (int):
The number of features</li>
<li><strong>discount_factor</strong> (float (default=0.97)):
The discount factor for the Markov process</li>
<li><strong>pi</strong> (Optional[List | np.ndarray] (default=None)):
The initial state probabilities</li>
<li><strong>P</strong> (Optional[List[List] | np.ndarray] (default=None)):
The transition probabilities</li>
<li><strong>r</strong> (Optional[List | np.ndarray] (default=None)):
The reward vector</li>
</ul>

<h6 id="notes">Notes</h6>

<p>Calls the constructor of the parent class AbstractMarkov, and additionally stores
the discount factor. Then, initializes the defining parameters and constraints.</p>
</div>


                            </div>
                            <div id="MarkovReward.discount_factor" class="classattr">
                                <div class="attr variable">
            <span class="name">discount_factor</span>

        
    </div>
    <a class="headerlink" href="#MarkovReward.discount_factor"></a>
    
    

                            </div>
                            <div id="MarkovReward.get_values" class="classattr">
                                        <input id="MarkovReward.get_values-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_values</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MarkovReward.get_values-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReward.get_values"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReward.get_values-1546"><a href="#MarkovReward.get_values-1546"><span class="linenos">1546</span></a>    <span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReward.get_values-1547"><a href="#MarkovReward.get_values-1547"><span class="linenos">1547</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward.get_values-1548"><a href="#MarkovReward.get_values-1548"><span class="linenos">1548</span></a><span class="sd">        Returns the values of pi, P, r, v, features, and ml_outputs as a dictionary.</span>
</span><span id="MarkovReward.get_values-1549"><a href="#MarkovReward.get_values-1549"><span class="linenos">1549</span></a>
</span><span id="MarkovReward.get_values-1550"><a href="#MarkovReward.get_values-1550"><span class="linenos">1550</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward.get_values-1551"><a href="#MarkovReward.get_values-1551"><span class="linenos">1551</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward.get_values-1552"><a href="#MarkovReward.get_values-1552"><span class="linenos">1552</span></a><span class="sd">        dict</span>
</span><span id="MarkovReward.get_values-1553"><a href="#MarkovReward.get_values-1553"><span class="linenos">1553</span></a><span class="sd">            A dictionary with keys:</span>
</span><span id="MarkovReward.get_values-1554"><a href="#MarkovReward.get_values-1554"><span class="linenos">1554</span></a><span class="sd">            - `pi`: the values of pi</span>
</span><span id="MarkovReward.get_values-1555"><a href="#MarkovReward.get_values-1555"><span class="linenos">1555</span></a><span class="sd">            - `P`: the values of P</span>
</span><span id="MarkovReward.get_values-1556"><a href="#MarkovReward.get_values-1556"><span class="linenos">1556</span></a><span class="sd">            - `r`: the values of r</span>
</span><span id="MarkovReward.get_values-1557"><a href="#MarkovReward.get_values-1557"><span class="linenos">1557</span></a><span class="sd">            - `v`: the values of v</span>
</span><span id="MarkovReward.get_values-1558"><a href="#MarkovReward.get_values-1558"><span class="linenos">1558</span></a><span class="sd">            - `features`: the values of the features</span>
</span><span id="MarkovReward.get_values-1559"><a href="#MarkovReward.get_values-1559"><span class="linenos">1559</span></a><span class="sd">            - `ml_outputs`: the values of the ml_outputs</span>
</span><span id="MarkovReward.get_values-1560"><a href="#MarkovReward.get_values-1560"><span class="linenos">1560</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward.get_values-1561"><a href="#MarkovReward.get_values-1561"><span class="linenos">1561</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="MarkovReward.get_values-1562"><a href="#MarkovReward.get_values-1562"><span class="linenos">1562</span></a>            <span class="s2">&quot;pi&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)],</span>
</span><span id="MarkovReward.get_values-1563"><a href="#MarkovReward.get_values-1563"><span class="linenos">1563</span></a>            <span class="s2">&quot;P&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)],</span>
</span><span id="MarkovReward.get_values-1564"><a href="#MarkovReward.get_values-1564"><span class="linenos">1564</span></a>            <span class="s2">&quot;r&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)],</span>
</span><span id="MarkovReward.get_values-1565"><a href="#MarkovReward.get_values-1565"><span class="linenos">1565</span></a>            <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)],</span>
</span><span id="MarkovReward.get_values-1566"><a href="#MarkovReward.get_values-1566"><span class="linenos">1566</span></a>            <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">)],</span>
</span><span id="MarkovReward.get_values-1567"><a href="#MarkovReward.get_values-1567"><span class="linenos">1567</span></a>            <span class="s2">&quot;ml_outputs&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]))]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">))]</span>
</span><span id="MarkovReward.get_values-1568"><a href="#MarkovReward.get_values-1568"><span class="linenos">1568</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Returns the values of pi, P, r, v, features, and ml_outputs as a dictionary.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>dict</strong>: A dictionary with keys:
<ul>
<li><code><a href="#MarkovReward.pi">pi</a></code>: the values of pi</li>
<li><code><a href="#MarkovReward.P">P</a></code>: the values of P</li>
<li><code><a href="#MarkovReward.r">r</a></code>: the values of r</li>
<li><code><a href="#MarkovReward.v">v</a></code>: the values of v</li>
<li><code><a href="#MarkovReward.features">features</a></code>: the values of the features</li>
<li><code><a href="#MarkovReward.ml_outputs">ml_outputs</a></code>: the values of the ml_outputs</li>
</ul></li>
</ul>
</div>


                            </div>
                            <div id="MarkovReward.pi" class="classattr">
                                        <input id="MarkovReward.pi-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">pi</span>

                <label class="view-source-button" for="MarkovReward.pi-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReward.pi"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReward.pi-1739"><a href="#MarkovReward.pi-1739"><span class="linenos">1739</span></a>    <span class="nd">@property</span>
</span><span id="MarkovReward.pi-1740"><a href="#MarkovReward.pi-1740"><span class="linenos">1740</span></a>    <span class="k">def</span> <span class="nf">pi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReward.pi-1741"><a href="#MarkovReward.pi-1741"><span class="linenos">1741</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward.pi-1742"><a href="#MarkovReward.pi-1742"><span class="linenos">1742</span></a><span class="sd">        Accessor for the pi parameter.</span>
</span><span id="MarkovReward.pi-1743"><a href="#MarkovReward.pi-1743"><span class="linenos">1743</span></a>
</span><span id="MarkovReward.pi-1744"><a href="#MarkovReward.pi-1744"><span class="linenos">1744</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward.pi-1745"><a href="#MarkovReward.pi-1745"><span class="linenos">1745</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward.pi-1746"><a href="#MarkovReward.pi-1746"><span class="linenos">1746</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovReward.pi-1747"><a href="#MarkovReward.pi-1747"><span class="linenos">1747</span></a><span class="sd">            The pi parameter</span>
</span><span id="MarkovReward.pi-1748"><a href="#MarkovReward.pi-1748"><span class="linenos">1748</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward.pi-1749"><a href="#MarkovReward.pi-1749"><span class="linenos">1749</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Accessor for the pi parameter.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>gurobipy.tupledict</strong>: The pi parameter</li>
</ul>
</div>


                            </div>
                            <div id="MarkovReward.P" class="classattr">
                                        <input id="MarkovReward.P-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">P</span>

                <label class="view-source-button" for="MarkovReward.P-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReward.P"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReward.P-1751"><a href="#MarkovReward.P-1751"><span class="linenos">1751</span></a>    <span class="nd">@property</span>
</span><span id="MarkovReward.P-1752"><a href="#MarkovReward.P-1752"><span class="linenos">1752</span></a>    <span class="k">def</span> <span class="nf">P</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReward.P-1753"><a href="#MarkovReward.P-1753"><span class="linenos">1753</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward.P-1754"><a href="#MarkovReward.P-1754"><span class="linenos">1754</span></a><span class="sd">        Accessor for the P parameter.</span>
</span><span id="MarkovReward.P-1755"><a href="#MarkovReward.P-1755"><span class="linenos">1755</span></a>
</span><span id="MarkovReward.P-1756"><a href="#MarkovReward.P-1756"><span class="linenos">1756</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward.P-1757"><a href="#MarkovReward.P-1757"><span class="linenos">1757</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward.P-1758"><a href="#MarkovReward.P-1758"><span class="linenos">1758</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovReward.P-1759"><a href="#MarkovReward.P-1759"><span class="linenos">1759</span></a><span class="sd">            The P parameter</span>
</span><span id="MarkovReward.P-1760"><a href="#MarkovReward.P-1760"><span class="linenos">1760</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward.P-1761"><a href="#MarkovReward.P-1761"><span class="linenos">1761</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Accessor for the P parameter.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>gurobipy.tupledict</strong>: The P parameter</li>
</ul>
</div>


                            </div>
                            <div id="MarkovReward.r" class="classattr">
                                        <input id="MarkovReward.r-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">r</span>

                <label class="view-source-button" for="MarkovReward.r-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReward.r"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReward.r-1763"><a href="#MarkovReward.r-1763"><span class="linenos">1763</span></a>    <span class="nd">@property</span>
</span><span id="MarkovReward.r-1764"><a href="#MarkovReward.r-1764"><span class="linenos">1764</span></a>    <span class="k">def</span> <span class="nf">r</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReward.r-1765"><a href="#MarkovReward.r-1765"><span class="linenos">1765</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward.r-1766"><a href="#MarkovReward.r-1766"><span class="linenos">1766</span></a><span class="sd">        Accessor for the r parameter.</span>
</span><span id="MarkovReward.r-1767"><a href="#MarkovReward.r-1767"><span class="linenos">1767</span></a>
</span><span id="MarkovReward.r-1768"><a href="#MarkovReward.r-1768"><span class="linenos">1768</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward.r-1769"><a href="#MarkovReward.r-1769"><span class="linenos">1769</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward.r-1770"><a href="#MarkovReward.r-1770"><span class="linenos">1770</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovReward.r-1771"><a href="#MarkovReward.r-1771"><span class="linenos">1771</span></a><span class="sd">            The r parameter</span>
</span><span id="MarkovReward.r-1772"><a href="#MarkovReward.r-1772"><span class="linenos">1772</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward.r-1773"><a href="#MarkovReward.r-1773"><span class="linenos">1773</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Accessor for the r parameter.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>gurobipy.tupledict</strong>: The r parameter</li>
</ul>
</div>


                            </div>
                            <div id="MarkovReward.v" class="classattr">
                                        <input id="MarkovReward.v-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">v</span>

                <label class="view-source-button" for="MarkovReward.v-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReward.v"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReward.v-1775"><a href="#MarkovReward.v-1775"><span class="linenos">1775</span></a>    <span class="nd">@property</span>
</span><span id="MarkovReward.v-1776"><a href="#MarkovReward.v-1776"><span class="linenos">1776</span></a>    <span class="k">def</span> <span class="nf">v</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReward.v-1777"><a href="#MarkovReward.v-1777"><span class="linenos">1777</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward.v-1778"><a href="#MarkovReward.v-1778"><span class="linenos">1778</span></a><span class="sd">        Accessor for the v parameter.</span>
</span><span id="MarkovReward.v-1779"><a href="#MarkovReward.v-1779"><span class="linenos">1779</span></a>
</span><span id="MarkovReward.v-1780"><a href="#MarkovReward.v-1780"><span class="linenos">1780</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward.v-1781"><a href="#MarkovReward.v-1781"><span class="linenos">1781</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward.v-1782"><a href="#MarkovReward.v-1782"><span class="linenos">1782</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovReward.v-1783"><a href="#MarkovReward.v-1783"><span class="linenos">1783</span></a><span class="sd">            The v parameter</span>
</span><span id="MarkovReward.v-1784"><a href="#MarkovReward.v-1784"><span class="linenos">1784</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward.v-1785"><a href="#MarkovReward.v-1785"><span class="linenos">1785</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Accessor for the v parameter.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>gurobipy.tupledict</strong>: The v parameter</li>
</ul>
</div>


                            </div>
                            <div id="MarkovReward.set_pi" class="classattr">
                                        <input id="MarkovReward.set_pi-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_pi</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MarkovReward.set_pi-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReward.set_pi"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReward.set_pi-1791"><a href="#MarkovReward.set_pi-1791"><span class="linenos">1791</span></a>    <span class="k">def</span> <span class="nf">set_pi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]):</span>
</span><span id="MarkovReward.set_pi-1792"><a href="#MarkovReward.set_pi-1792"><span class="linenos">1792</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward.set_pi-1793"><a href="#MarkovReward.set_pi-1793"><span class="linenos">1793</span></a><span class="sd">        Helper function to set the entire pi vector.</span>
</span><span id="MarkovReward.set_pi-1794"><a href="#MarkovReward.set_pi-1794"><span class="linenos">1794</span></a>
</span><span id="MarkovReward.set_pi-1795"><a href="#MarkovReward.set_pi-1795"><span class="linenos">1795</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReward.set_pi-1796"><a href="#MarkovReward.set_pi-1796"><span class="linenos">1796</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReward.set_pi-1797"><a href="#MarkovReward.set_pi-1797"><span class="linenos">1797</span></a><span class="sd">        values : List[float | int | gp.Var | gp.LinExpr]</span>
</span><span id="MarkovReward.set_pi-1798"><a href="#MarkovReward.set_pi-1798"><span class="linenos">1798</span></a><span class="sd">            The values to set the pi parameter to</span>
</span><span id="MarkovReward.set_pi-1799"><a href="#MarkovReward.set_pi-1799"><span class="linenos">1799</span></a>
</span><span id="MarkovReward.set_pi-1800"><a href="#MarkovReward.set_pi-1800"><span class="linenos">1800</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward.set_pi-1801"><a href="#MarkovReward.set_pi-1801"><span class="linenos">1801</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward.set_pi-1802"><a href="#MarkovReward.set_pi-1802"><span class="linenos">1802</span></a><span class="sd">        None</span>
</span><span id="MarkovReward.set_pi-1803"><a href="#MarkovReward.set_pi-1803"><span class="linenos">1803</span></a>
</span><span id="MarkovReward.set_pi-1804"><a href="#MarkovReward.set_pi-1804"><span class="linenos">1804</span></a><span class="sd">        Raises</span>
</span><span id="MarkovReward.set_pi-1805"><a href="#MarkovReward.set_pi-1805"><span class="linenos">1805</span></a><span class="sd">        ------</span>
</span><span id="MarkovReward.set_pi-1806"><a href="#MarkovReward.set_pi-1806"><span class="linenos">1806</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovReward.set_pi-1807"><a href="#MarkovReward.set_pi-1807"><span class="linenos">1807</span></a><span class="sd">            If the values have incorrect length, are not in [0, 1], don&#39;t sum to 1,or pi is already set</span>
</span><span id="MarkovReward.set_pi-1808"><a href="#MarkovReward.set_pi-1808"><span class="linenos">1808</span></a>
</span><span id="MarkovReward.set_pi-1809"><a href="#MarkovReward.set_pi-1809"><span class="linenos">1809</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReward.set_pi-1810"><a href="#MarkovReward.set_pi-1810"><span class="linenos">1810</span></a><span class="sd">        -----</span>
</span><span id="MarkovReward.set_pi-1811"><a href="#MarkovReward.set_pi-1811"><span class="linenos">1811</span></a><span class="sd">        This checks for validity of the values, checks if pi is already set, and sets the values.</span>
</span><span id="MarkovReward.set_pi-1812"><a href="#MarkovReward.set_pi-1812"><span class="linenos">1812</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward.set_pi-1813"><a href="#MarkovReward.set_pi-1813"><span class="linenos">1813</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_length</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">)</span>
</span><span id="MarkovReward.set_pi-1814"><a href="#MarkovReward.set_pi-1814"><span class="linenos">1814</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="MarkovReward.set_pi-1815"><a href="#MarkovReward.set_pi-1815"><span class="linenos">1815</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="MarkovReward.set_pi-1816"><a href="#MarkovReward.set_pi-1816"><span class="linenos">1816</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">)</span>
</span><span id="MarkovReward.set_pi-1817"><a href="#MarkovReward.set_pi-1817"><span class="linenos">1817</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;pi&quot;</span><span class="p">),</span>\
</span><span id="MarkovReward.set_pi-1818"><a href="#MarkovReward.set_pi-1818"><span class="linenos">1818</span></a>              <span class="s2">&quot;pi is already set&quot;</span>
</span><span id="MarkovReward.set_pi-1819"><a href="#MarkovReward.set_pi-1819"><span class="linenos">1819</span></a>
</span><span id="MarkovReward.set_pi-1820"><a href="#MarkovReward.set_pi-1820"><span class="linenos">1820</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;pi&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReward.set_pi-1821"><a href="#MarkovReward.set_pi-1821"><span class="linenos">1821</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="MarkovReward.set_pi-1822"><a href="#MarkovReward.set_pi-1822"><span class="linenos">1822</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovReward.set_pi-1823"><a href="#MarkovReward.set_pi-1823"><span class="linenos">1823</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="MarkovReward.set_pi-1824"><a href="#MarkovReward.set_pi-1824"><span class="linenos">1824</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovReward.set_pi-1825"><a href="#MarkovReward.set_pi-1825"><span class="linenos">1825</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MarkovReward.set_pi-1826"><a href="#MarkovReward.set_pi-1826"><span class="linenos">1826</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pi[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Helper function to set the entire pi vector.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>values</strong> (List[float | int | gp.Var | gp.LinExpr]):
The values to set the pi parameter to</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If the values have incorrect length, are not in [0, 1], don't sum to 1,or pi is already set</li>
</ul>

<h6 id="notes">Notes</h6>

<p>This checks for validity of the values, checks if pi is already set, and sets the values.</p>
</div>


                            </div>
                            <div id="MarkovReward.set_r" class="classattr">
                                        <input id="MarkovReward.set_r-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_r</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MarkovReward.set_r-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReward.set_r"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReward.set_r-1828"><a href="#MarkovReward.set_r-1828"><span class="linenos">1828</span></a>    <span class="k">def</span> <span class="nf">set_r</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]):</span>
</span><span id="MarkovReward.set_r-1829"><a href="#MarkovReward.set_r-1829"><span class="linenos">1829</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward.set_r-1830"><a href="#MarkovReward.set_r-1830"><span class="linenos">1830</span></a><span class="sd">        Helper function to set the entire r vector.</span>
</span><span id="MarkovReward.set_r-1831"><a href="#MarkovReward.set_r-1831"><span class="linenos">1831</span></a>
</span><span id="MarkovReward.set_r-1832"><a href="#MarkovReward.set_r-1832"><span class="linenos">1832</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReward.set_r-1833"><a href="#MarkovReward.set_r-1833"><span class="linenos">1833</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReward.set_r-1834"><a href="#MarkovReward.set_r-1834"><span class="linenos">1834</span></a><span class="sd">        values : List[float | int | gp.Var | gp.LinExpr]</span>
</span><span id="MarkovReward.set_r-1835"><a href="#MarkovReward.set_r-1835"><span class="linenos">1835</span></a><span class="sd">            The values to set the r parameter to</span>
</span><span id="MarkovReward.set_r-1836"><a href="#MarkovReward.set_r-1836"><span class="linenos">1836</span></a>
</span><span id="MarkovReward.set_r-1837"><a href="#MarkovReward.set_r-1837"><span class="linenos">1837</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward.set_r-1838"><a href="#MarkovReward.set_r-1838"><span class="linenos">1838</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward.set_r-1839"><a href="#MarkovReward.set_r-1839"><span class="linenos">1839</span></a><span class="sd">        None</span>
</span><span id="MarkovReward.set_r-1840"><a href="#MarkovReward.set_r-1840"><span class="linenos">1840</span></a>
</span><span id="MarkovReward.set_r-1841"><a href="#MarkovReward.set_r-1841"><span class="linenos">1841</span></a><span class="sd">        Raises</span>
</span><span id="MarkovReward.set_r-1842"><a href="#MarkovReward.set_r-1842"><span class="linenos">1842</span></a><span class="sd">        ------</span>
</span><span id="MarkovReward.set_r-1843"><a href="#MarkovReward.set_r-1843"><span class="linenos">1843</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovReward.set_r-1844"><a href="#MarkovReward.set_r-1844"><span class="linenos">1844</span></a><span class="sd">            If the values have incorrect length, or r is already set</span>
</span><span id="MarkovReward.set_r-1845"><a href="#MarkovReward.set_r-1845"><span class="linenos">1845</span></a>
</span><span id="MarkovReward.set_r-1846"><a href="#MarkovReward.set_r-1846"><span class="linenos">1846</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReward.set_r-1847"><a href="#MarkovReward.set_r-1847"><span class="linenos">1847</span></a><span class="sd">        -----</span>
</span><span id="MarkovReward.set_r-1848"><a href="#MarkovReward.set_r-1848"><span class="linenos">1848</span></a><span class="sd">        This checks for validity of the values, checks if r is already set, and sets the values.</span>
</span><span id="MarkovReward.set_r-1849"><a href="#MarkovReward.set_r-1849"><span class="linenos">1849</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward.set_r-1850"><a href="#MarkovReward.set_r-1850"><span class="linenos">1850</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_length</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
</span><span id="MarkovReward.set_r-1851"><a href="#MarkovReward.set_r-1851"><span class="linenos">1851</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">),</span>\
</span><span id="MarkovReward.set_r-1852"><a href="#MarkovReward.set_r-1852"><span class="linenos">1852</span></a>              <span class="s2">&quot;r is already set&quot;</span>
</span><span id="MarkovReward.set_r-1853"><a href="#MarkovReward.set_r-1853"><span class="linenos">1853</span></a>
</span><span id="MarkovReward.set_r-1854"><a href="#MarkovReward.set_r-1854"><span class="linenos">1854</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;r&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReward.set_r-1855"><a href="#MarkovReward.set_r-1855"><span class="linenos">1855</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="MarkovReward.set_r-1856"><a href="#MarkovReward.set_r-1856"><span class="linenos">1856</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovReward.set_r-1857"><a href="#MarkovReward.set_r-1857"><span class="linenos">1857</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="MarkovReward.set_r-1858"><a href="#MarkovReward.set_r-1858"><span class="linenos">1858</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">r</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovReward.set_r-1859"><a href="#MarkovReward.set_r-1859"><span class="linenos">1859</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MarkovReward.set_r-1860"><a href="#MarkovReward.set_r-1860"><span class="linenos">1860</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;r[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Helper function to set the entire r vector.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>values</strong> (List[float | int | gp.Var | gp.LinExpr]):
The values to set the r parameter to</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If the values have incorrect length, or r is already set</li>
</ul>

<h6 id="notes">Notes</h6>

<p>This checks for validity of the values, checks if r is already set, and sets the values.</p>
</div>


                            </div>
                            <div id="MarkovReward.set_P" class="classattr">
                                        <input id="MarkovReward.set_P-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_P</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MarkovReward.set_P-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReward.set_P"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReward.set_P-1862"><a href="#MarkovReward.set_P-1862"><span class="linenos">1862</span></a>    <span class="k">def</span> <span class="nf">set_P</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]]):</span>
</span><span id="MarkovReward.set_P-1863"><a href="#MarkovReward.set_P-1863"><span class="linenos">1863</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward.set_P-1864"><a href="#MarkovReward.set_P-1864"><span class="linenos">1864</span></a><span class="sd">        Helper function to set the entire P matrix.</span>
</span><span id="MarkovReward.set_P-1865"><a href="#MarkovReward.set_P-1865"><span class="linenos">1865</span></a>
</span><span id="MarkovReward.set_P-1866"><a href="#MarkovReward.set_P-1866"><span class="linenos">1866</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReward.set_P-1867"><a href="#MarkovReward.set_P-1867"><span class="linenos">1867</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReward.set_P-1868"><a href="#MarkovReward.set_P-1868"><span class="linenos">1868</span></a><span class="sd">        values : List[List[float | int | gp.Var | gp.LinExpr]]</span>
</span><span id="MarkovReward.set_P-1869"><a href="#MarkovReward.set_P-1869"><span class="linenos">1869</span></a><span class="sd">            The values to set the P parameter to</span>
</span><span id="MarkovReward.set_P-1870"><a href="#MarkovReward.set_P-1870"><span class="linenos">1870</span></a>
</span><span id="MarkovReward.set_P-1871"><a href="#MarkovReward.set_P-1871"><span class="linenos">1871</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward.set_P-1872"><a href="#MarkovReward.set_P-1872"><span class="linenos">1872</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward.set_P-1873"><a href="#MarkovReward.set_P-1873"><span class="linenos">1873</span></a><span class="sd">        None</span>
</span><span id="MarkovReward.set_P-1874"><a href="#MarkovReward.set_P-1874"><span class="linenos">1874</span></a>
</span><span id="MarkovReward.set_P-1875"><a href="#MarkovReward.set_P-1875"><span class="linenos">1875</span></a><span class="sd">        Raises</span>
</span><span id="MarkovReward.set_P-1876"><a href="#MarkovReward.set_P-1876"><span class="linenos">1876</span></a><span class="sd">        ------</span>
</span><span id="MarkovReward.set_P-1877"><a href="#MarkovReward.set_P-1877"><span class="linenos">1877</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovReward.set_P-1878"><a href="#MarkovReward.set_P-1878"><span class="linenos">1878</span></a><span class="sd">            If the values have incorrect shape, are not in [0, 1], rows don&#39;t sum to 1, or P is already set</span>
</span><span id="MarkovReward.set_P-1879"><a href="#MarkovReward.set_P-1879"><span class="linenos">1879</span></a>
</span><span id="MarkovReward.set_P-1880"><a href="#MarkovReward.set_P-1880"><span class="linenos">1880</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReward.set_P-1881"><a href="#MarkovReward.set_P-1881"><span class="linenos">1881</span></a><span class="sd">        -----</span>
</span><span id="MarkovReward.set_P-1882"><a href="#MarkovReward.set_P-1882"><span class="linenos">1882</span></a><span class="sd">        This checks for validity of the values, checks if P is already set, and sets the values.</span>
</span><span id="MarkovReward.set_P-1883"><a href="#MarkovReward.set_P-1883"><span class="linenos">1883</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward.set_P-1884"><a href="#MarkovReward.set_P-1884"><span class="linenos">1884</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_shape</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">)</span>
</span><span id="MarkovReward.set_P-1885"><a href="#MarkovReward.set_P-1885"><span class="linenos">1885</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="MarkovReward.set_P-1886"><a href="#MarkovReward.set_P-1886"><span class="linenos">1886</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="MarkovReward.set_P-1887"><a href="#MarkovReward.set_P-1887"><span class="linenos">1887</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_matrix</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;P&quot;</span><span class="p">)</span>
</span><span id="MarkovReward.set_P-1888"><a href="#MarkovReward.set_P-1888"><span class="linenos">1888</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
</span><span id="MarkovReward.set_P-1889"><a href="#MarkovReward.set_P-1889"><span class="linenos">1889</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="MarkovReward.set_P-1890"><a href="#MarkovReward.set_P-1890"><span class="linenos">1890</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;P[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">)</span>
</span><span id="MarkovReward.set_P-1891"><a href="#MarkovReward.set_P-1891"><span class="linenos">1891</span></a>
</span><span id="MarkovReward.set_P-1892"><a href="#MarkovReward.set_P-1892"><span class="linenos">1892</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;P&quot;</span><span class="p">),</span>\
</span><span id="MarkovReward.set_P-1893"><a href="#MarkovReward.set_P-1893"><span class="linenos">1893</span></a>              <span class="s2">&quot;P is already set&quot;</span>
</span><span id="MarkovReward.set_P-1894"><a href="#MarkovReward.set_P-1894"><span class="linenos">1894</span></a>
</span><span id="MarkovReward.set_P-1895"><a href="#MarkovReward.set_P-1895"><span class="linenos">1895</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReward.set_P-1896"><a href="#MarkovReward.set_P-1896"><span class="linenos">1896</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovReward.set_P-1897"><a href="#MarkovReward.set_P-1897"><span class="linenos">1897</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="MarkovReward.set_P-1898"><a href="#MarkovReward.set_P-1898"><span class="linenos">1898</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="MarkovReward.set_P-1899"><a href="#MarkovReward.set_P-1899"><span class="linenos">1899</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="MarkovReward.set_P-1900"><a href="#MarkovReward.set_P-1900"><span class="linenos">1900</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="MarkovReward.set_P-1901"><a href="#MarkovReward.set_P-1901"><span class="linenos">1901</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MarkovReward.set_P-1902"><a href="#MarkovReward.set_P-1902"><span class="linenos">1902</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;P[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Helper function to set the entire P matrix.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>values</strong> (List[List[float | int | gp.Var | gp.LinExpr]]):
The values to set the P parameter to</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If the values have incorrect shape, are not in [0, 1], rows don't sum to 1, or P is already set</li>
</ul>

<h6 id="notes">Notes</h6>

<p>This checks for validity of the values, checks if P is already set, and sets the values.</p>
</div>


                            </div>
                            <div id="MarkovReward.add_ifr_inequalities" class="classattr">
                                        <input id="MarkovReward.add_ifr_inequalities-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">add_ifr_inequalities</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MarkovReward.add_ifr_inequalities-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReward.add_ifr_inequalities"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReward.add_ifr_inequalities-1907"><a href="#MarkovReward.add_ifr_inequalities-1907"><span class="linenos">1907</span></a>    <span class="k">def</span> <span class="nf">add_ifr_inequalities</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReward.add_ifr_inequalities-1908"><a href="#MarkovReward.add_ifr_inequalities-1908"><span class="linenos">1908</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReward.add_ifr_inequalities-1909"><a href="#MarkovReward.add_ifr_inequalities-1909"><span class="linenos">1909</span></a><span class="sd">        Helper function to add IFR (increasing failure rate) inequalities on P.</span>
</span><span id="MarkovReward.add_ifr_inequalities-1910"><a href="#MarkovReward.add_ifr_inequalities-1910"><span class="linenos">1910</span></a>
</span><span id="MarkovReward.add_ifr_inequalities-1911"><a href="#MarkovReward.add_ifr_inequalities-1911"><span class="linenos">1911</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReward.add_ifr_inequalities-1912"><a href="#MarkovReward.add_ifr_inequalities-1912"><span class="linenos">1912</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReward.add_ifr_inequalities-1913"><a href="#MarkovReward.add_ifr_inequalities-1913"><span class="linenos">1913</span></a><span class="sd">        None</span>
</span><span id="MarkovReward.add_ifr_inequalities-1914"><a href="#MarkovReward.add_ifr_inequalities-1914"><span class="linenos">1914</span></a>
</span><span id="MarkovReward.add_ifr_inequalities-1915"><a href="#MarkovReward.add_ifr_inequalities-1915"><span class="linenos">1915</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReward.add_ifr_inequalities-1916"><a href="#MarkovReward.add_ifr_inequalities-1916"><span class="linenos">1916</span></a><span class="sd">        -------</span>
</span><span id="MarkovReward.add_ifr_inequalities-1917"><a href="#MarkovReward.add_ifr_inequalities-1917"><span class="linenos">1917</span></a><span class="sd">        None</span>
</span><span id="MarkovReward.add_ifr_inequalities-1918"><a href="#MarkovReward.add_ifr_inequalities-1918"><span class="linenos">1918</span></a>
</span><span id="MarkovReward.add_ifr_inequalities-1919"><a href="#MarkovReward.add_ifr_inequalities-1919"><span class="linenos">1919</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReward.add_ifr_inequalities-1920"><a href="#MarkovReward.add_ifr_inequalities-1920"><span class="linenos">1920</span></a><span class="sd">        -----</span>
</span><span id="MarkovReward.add_ifr_inequalities-1921"><a href="#MarkovReward.add_ifr_inequalities-1921"><span class="linenos">1921</span></a><span class="sd">        The definition of IFR is the following. Given an $n \\times n$ transition matrix $P$, and a fixed $i \\in [n]$,</span>
</span><span id="MarkovReward.add_ifr_inequalities-1922"><a href="#MarkovReward.add_ifr_inequalities-1922"><span class="linenos">1922</span></a><span class="sd">        define the function $b_h(i) = \\sum_{j=h}^n P_{ij}$. Then, $P$ is IFR if, for each $h \\in [n]$, we have</span>
</span><span id="MarkovReward.add_ifr_inequalities-1923"><a href="#MarkovReward.add_ifr_inequalities-1923"><span class="linenos">1923</span></a><span class="sd">        $b_h(i) \\leq b_h(i+1)$ for all $i \\in [n-1]$.</span>
</span><span id="MarkovReward.add_ifr_inequalities-1924"><a href="#MarkovReward.add_ifr_inequalities-1924"><span class="linenos">1924</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReward.add_ifr_inequalities-1925"><a href="#MarkovReward.add_ifr_inequalities-1925"><span class="linenos">1925</span></a>        <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">):</span>
</span><span id="MarkovReward.add_ifr_inequalities-1926"><a href="#MarkovReward.add_ifr_inequalities-1926"><span class="linenos">1926</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_states</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="MarkovReward.add_ifr_inequalities-1927"><a href="#MarkovReward.add_ifr_inequalities-1927"><span class="linenos">1927</span></a>                <span class="c1"># b_h(i) &lt;= b_h(i+1), i.e., sum_{j=h}^n P_{ij} &lt;= sum_{j=h}^n P_{i+1, j}</span>
</span><span id="MarkovReward.add_ifr_inequalities-1928"><a href="#MarkovReward.add_ifr_inequalities-1928"><span class="linenos">1928</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">))</span> <span class="o">&lt;=</span>
</span><span id="MarkovReward.add_ifr_inequalities-1929"><a href="#MarkovReward.add_ifr_inequalities-1929"><span class="linenos">1929</span></a>                                    <span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_states</span><span class="p">)),</span>
</span><span id="MarkovReward.add_ifr_inequalities-1930"><a href="#MarkovReward.add_ifr_inequalities-1930"><span class="linenos">1930</span></a>                                    <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;ifr_h_</span><span class="si">{</span><span class="n">h</span><span class="si">}</span><span class="s2">_row_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">_row_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MarkovReward.add_ifr_inequalities-1931"><a href="#MarkovReward.add_ifr_inequalities-1931"><span class="linenos">1931</span></a>
</span><span id="MarkovReward.add_ifr_inequalities-1932"><a href="#MarkovReward.add_ifr_inequalities-1932"><span class="linenos">1932</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Helper function to add IFR (increasing failure rate) inequalities on P.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="notes">Notes</h6>

<p>The definition of IFR is the following. Given an $n \times n$ transition matrix $P$, and a fixed $i \in [n]$,
define the function $b_h(i) = \sum_{j=h}^n P_{ij}$. Then, $P$ is IFR if, for each $h \in [n]$, we have
$b_h(i) \leq b_h(i+1)$ for all $i \in [n-1]$.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#AbstractMarkov">AbstractMarkov</a></dt>
                                <dd id="MarkovReward.n_states" class="variable"><a href="#AbstractMarkov.n_states">n_states</a></dd>
                <dd id="MarkovReward.n_features" class="variable"><a href="#AbstractMarkov.n_features">n_features</a></dd>
                <dd id="MarkovReward.model" class="variable"><a href="#AbstractMarkov.model">model</a></dd>
                <dd id="MarkovReward.variables" class="variable"><a href="#AbstractMarkov.variables">variables</a></dd>
                <dd id="MarkovReward.features" class="variable"><a href="#AbstractMarkov.features">features</a></dd>
                <dd id="MarkovReward.feature_aux" class="variable"><a href="#AbstractMarkov.feature_aux">feature_aux</a></dd>
                <dd id="MarkovReward.feature_constraints" class="variable"><a href="#AbstractMarkov.feature_constraints">feature_constraints</a></dd>
                <dd id="MarkovReward.ml_models" class="variable"><a href="#AbstractMarkov.ml_models">ml_models</a></dd>
                <dd id="MarkovReward.ml_outputs" class="variable"><a href="#AbstractMarkov.ml_outputs">ml_outputs</a></dd>
                <dd id="MarkovReward.set_to_ml_output" class="function"><a href="#AbstractMarkov.set_to_ml_output">set_to_ml_output</a></dd>
                <dd id="MarkovReward.set_to_const" class="function"><a href="#AbstractMarkov.set_to_const">set_to_const</a></dd>
                <dd id="MarkovReward.add_feature_constraint" class="function"><a href="#AbstractMarkov.add_feature_constraint">add_feature_constraint</a></dd>
                <dd id="MarkovReward.add_feature_aux_variable" class="function"><a href="#AbstractMarkov.add_feature_aux_variable">add_feature_aux_variable</a></dd>
                <dd id="MarkovReward.add_constraint" class="function"><a href="#AbstractMarkov.add_constraint">add_constraint</a></dd>
                <dd id="MarkovReward.add_ml_model" class="function"><a href="#AbstractMarkov.add_ml_model">add_ml_model</a></dd>
                <dd id="MarkovReward.optimize" class="function"><a href="#AbstractMarkov.optimize">optimize</a></dd>
                <dd id="MarkovReward.find_feasible" class="function"><a href="#AbstractMarkov.find_feasible">find_feasible</a></dd>
                <dd id="MarkovReward.get_value" class="function"><a href="#AbstractMarkov.get_value">get_value</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="MarkovReach">
                            <input id="MarkovReach-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MarkovReach</span><wbr>(<span class="base"><a href="#AbstractMarkov">AbstractMarkov</a></span>):

                <label class="view-source-button" for="MarkovReach-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReach"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReach-1934"><a href="#MarkovReach-1934"><span class="linenos">1934</span></a><span class="k">class</span> <span class="nc">MarkovReach</span><span class="p">(</span><span class="n">AbstractMarkov</span><span class="p">):</span>
</span><span id="MarkovReach-1935"><a href="#MarkovReach-1935"><span class="linenos">1935</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-1936"><a href="#MarkovReach-1936"><span class="linenos">1936</span></a><span class="sd">    For the reachability problem.</span>
</span><span id="MarkovReach-1937"><a href="#MarkovReach-1937"><span class="linenos">1937</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MarkovReach-1938"><a href="#MarkovReach-1938"><span class="linenos">1938</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_states</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovReach-1939"><a href="#MarkovReach-1939"><span class="linenos">1939</span></a>                 <span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovReach-1940"><a href="#MarkovReach-1940"><span class="linenos">1940</span></a>                 <span class="n">n_targets</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovReach-1941"><a href="#MarkovReach-1941"><span class="linenos">1941</span></a>                 <span class="n">n_transient</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovReach-1942"><a href="#MarkovReach-1942"><span class="linenos">1942</span></a>                 <span class="n">pi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MarkovReach-1943"><a href="#MarkovReach-1943"><span class="linenos">1943</span></a>                 <span class="n">Q</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MarkovReach-1944"><a href="#MarkovReach-1944"><span class="linenos">1944</span></a>                 <span class="n">R</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="MarkovReach-1945"><a href="#MarkovReach-1945"><span class="linenos">1945</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-1946"><a href="#MarkovReach-1946"><span class="linenos">1946</span></a><span class="sd">        Initialize a Markov chain for the reachability problem.</span>
</span><span id="MarkovReach-1947"><a href="#MarkovReach-1947"><span class="linenos">1947</span></a>
</span><span id="MarkovReach-1948"><a href="#MarkovReach-1948"><span class="linenos">1948</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReach-1949"><a href="#MarkovReach-1949"><span class="linenos">1949</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReach-1950"><a href="#MarkovReach-1950"><span class="linenos">1950</span></a><span class="sd">        n_states : int</span>
</span><span id="MarkovReach-1951"><a href="#MarkovReach-1951"><span class="linenos">1951</span></a><span class="sd">            The number of states</span>
</span><span id="MarkovReach-1952"><a href="#MarkovReach-1952"><span class="linenos">1952</span></a><span class="sd">        n_features : int</span>
</span><span id="MarkovReach-1953"><a href="#MarkovReach-1953"><span class="linenos">1953</span></a><span class="sd">            The number of features</span>
</span><span id="MarkovReach-1954"><a href="#MarkovReach-1954"><span class="linenos">1954</span></a><span class="sd">        n_targets : int</span>
</span><span id="MarkovReach-1955"><a href="#MarkovReach-1955"><span class="linenos">1955</span></a><span class="sd">            The number of target states ($|S|$ in the paper)</span>
</span><span id="MarkovReach-1956"><a href="#MarkovReach-1956"><span class="linenos">1956</span></a><span class="sd">        n_transient : int</span>
</span><span id="MarkovReach-1957"><a href="#MarkovReach-1957"><span class="linenos">1957</span></a><span class="sd">            The number of transient states ($|T|$ in the paper)</span>
</span><span id="MarkovReach-1958"><a href="#MarkovReach-1958"><span class="linenos">1958</span></a><span class="sd">        pi : Optional[List | np.ndarray]</span>
</span><span id="MarkovReach-1959"><a href="#MarkovReach-1959"><span class="linenos">1959</span></a><span class="sd">            The initial state distribution over transient states</span>
</span><span id="MarkovReach-1960"><a href="#MarkovReach-1960"><span class="linenos">1960</span></a><span class="sd">        Q : Optional[List[List] | np.ndarray]</span>
</span><span id="MarkovReach-1961"><a href="#MarkovReach-1961"><span class="linenos">1961</span></a><span class="sd">            The transition matrix between transient states</span>
</span><span id="MarkovReach-1962"><a href="#MarkovReach-1962"><span class="linenos">1962</span></a><span class="sd">        R : Optional[List[List] | np.ndarray]</span>
</span><span id="MarkovReach-1963"><a href="#MarkovReach-1963"><span class="linenos">1963</span></a><span class="sd">            The transition matrix from transient states to target states</span>
</span><span id="MarkovReach-1964"><a href="#MarkovReach-1964"><span class="linenos">1964</span></a>
</span><span id="MarkovReach-1965"><a href="#MarkovReach-1965"><span class="linenos">1965</span></a><span class="sd">        Raises</span>
</span><span id="MarkovReach-1966"><a href="#MarkovReach-1966"><span class="linenos">1966</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach-1967"><a href="#MarkovReach-1967"><span class="linenos">1967</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovReach-1968"><a href="#MarkovReach-1968"><span class="linenos">1968</span></a><span class="sd">            If the number of target states is greater than or equal to the number of states, or the number of transient</span>
</span><span id="MarkovReach-1969"><a href="#MarkovReach-1969"><span class="linenos">1969</span></a><span class="sd">            states is greater than or equal to the number of states</span>
</span><span id="MarkovReach-1970"><a href="#MarkovReach-1970"><span class="linenos">1970</span></a>
</span><span id="MarkovReach-1971"><a href="#MarkovReach-1971"><span class="linenos">1971</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReach-1972"><a href="#MarkovReach-1972"><span class="linenos">1972</span></a><span class="sd">        -----</span>
</span><span id="MarkovReach-1973"><a href="#MarkovReach-1973"><span class="linenos">1973</span></a><span class="sd">        Calls the constructor of the parent class AbstractMarkov, with additional attributes.</span>
</span><span id="MarkovReach-1974"><a href="#MarkovReach-1974"><span class="linenos">1974</span></a><span class="sd">        Then, initializes the defining parameters and constraints for the reachability problem.</span>
</span><span id="MarkovReach-1975"><a href="#MarkovReach-1975"><span class="linenos">1975</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach-1976"><a href="#MarkovReach-1976"><span class="linenos">1976</span></a>
</span><span id="MarkovReach-1977"><a href="#MarkovReach-1977"><span class="linenos">1977</span></a>        <span class="k">if</span> <span class="n">n_targets</span> <span class="o">&gt;=</span> <span class="n">n_states</span><span class="p">:</span>
</span><span id="MarkovReach-1978"><a href="#MarkovReach-1978"><span class="linenos">1978</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of target states must be less than number of states&quot;</span><span class="p">)</span>
</span><span id="MarkovReach-1979"><a href="#MarkovReach-1979"><span class="linenos">1979</span></a>        <span class="k">if</span> <span class="n">n_transient</span> <span class="o">&gt;=</span> <span class="n">n_states</span><span class="p">:</span>
</span><span id="MarkovReach-1980"><a href="#MarkovReach-1980"><span class="linenos">1980</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of transient states must be less than number of states&quot;</span><span class="p">)</span>
</span><span id="MarkovReach-1981"><a href="#MarkovReach-1981"><span class="linenos">1981</span></a>
</span><span id="MarkovReach-1982"><a href="#MarkovReach-1982"><span class="linenos">1982</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">n_states</span><span class="p">,</span> <span class="n">n_features</span><span class="p">)</span>
</span><span id="MarkovReach-1983"><a href="#MarkovReach-1983"><span class="linenos">1983</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span> <span class="o">=</span> <span class="n">n_targets</span>
</span><span id="MarkovReach-1984"><a href="#MarkovReach-1984"><span class="linenos">1984</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span> <span class="o">=</span> <span class="n">n_transient</span>
</span><span id="MarkovReach-1985"><a href="#MarkovReach-1985"><span class="linenos">1985</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_parameters_and_constraints</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
</span><span id="MarkovReach-1986"><a href="#MarkovReach-1986"><span class="linenos">1986</span></a>
</span><span id="MarkovReach-1987"><a href="#MarkovReach-1987"><span class="linenos">1987</span></a>    <span class="c1"># FUNCTIONS THAT MUST BE IMPLEMENTED IN SUBCLASSES WHICH UNIQUELY DEFINE THE PROBLEM</span>
</span><span id="MarkovReach-1988"><a href="#MarkovReach-1988"><span class="linenos">1988</span></a>
</span><span id="MarkovReach-1989"><a href="#MarkovReach-1989"><span class="linenos">1989</span></a>    <span class="k">def</span> <span class="nf">_initialize_parameters_and_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pi</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MarkovReach-1990"><a href="#MarkovReach-1990"><span class="linenos">1990</span></a>                                               <span class="n">Q</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MarkovReach-1991"><a href="#MarkovReach-1991"><span class="linenos">1991</span></a>                                               <span class="n">R</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="MarkovReach-1992"><a href="#MarkovReach-1992"><span class="linenos">1992</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-1993"><a href="#MarkovReach-1993"><span class="linenos">1993</span></a><span class="sd">        Initializes the parameters and constraints for the reachability problem.</span>
</span><span id="MarkovReach-1994"><a href="#MarkovReach-1994"><span class="linenos">1994</span></a>
</span><span id="MarkovReach-1995"><a href="#MarkovReach-1995"><span class="linenos">1995</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReach-1996"><a href="#MarkovReach-1996"><span class="linenos">1996</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReach-1997"><a href="#MarkovReach-1997"><span class="linenos">1997</span></a><span class="sd">        pi : Optional[List | np.ndarray]</span>
</span><span id="MarkovReach-1998"><a href="#MarkovReach-1998"><span class="linenos">1998</span></a><span class="sd">            The initial state distribution over transient states</span>
</span><span id="MarkovReach-1999"><a href="#MarkovReach-1999"><span class="linenos">1999</span></a><span class="sd">        Q : Optional[List[List] | np.ndarray]</span>
</span><span id="MarkovReach-2000"><a href="#MarkovReach-2000"><span class="linenos">2000</span></a><span class="sd">            The transition matrix between transient states</span>
</span><span id="MarkovReach-2001"><a href="#MarkovReach-2001"><span class="linenos">2001</span></a><span class="sd">        R : Optional[List[List] | np.ndarray]</span>
</span><span id="MarkovReach-2002"><a href="#MarkovReach-2002"><span class="linenos">2002</span></a><span class="sd">            The transition matrix from transient states to target states</span>
</span><span id="MarkovReach-2003"><a href="#MarkovReach-2003"><span class="linenos">2003</span></a>
</span><span id="MarkovReach-2004"><a href="#MarkovReach-2004"><span class="linenos">2004</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach-2005"><a href="#MarkovReach-2005"><span class="linenos">2005</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach-2006"><a href="#MarkovReach-2006"><span class="linenos">2006</span></a><span class="sd">        None</span>
</span><span id="MarkovReach-2007"><a href="#MarkovReach-2007"><span class="linenos">2007</span></a>
</span><span id="MarkovReach-2008"><a href="#MarkovReach-2008"><span class="linenos">2008</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReach-2009"><a href="#MarkovReach-2009"><span class="linenos">2009</span></a><span class="sd">        -----</span>
</span><span id="MarkovReach-2010"><a href="#MarkovReach-2010"><span class="linenos">2010</span></a><span class="sd">        Adds variables for: pi (bounds between 0 and 1), Q (bounds between 0 and 1, strictly less</span>
</span><span id="MarkovReach-2011"><a href="#MarkovReach-2011"><span class="linenos">2011</span></a><span class="sd">        than 1), R (bounds between 0 and 1, strictly less than 1), and v (bounds between -inf and inf).</span>
</span><span id="MarkovReach-2012"><a href="#MarkovReach-2012"><span class="linenos">2012</span></a><span class="sd">        Creates boolean lists to store whether each variable has been set to an ML output</span>
</span><span id="MarkovReach-2013"><a href="#MarkovReach-2013"><span class="linenos">2013</span></a><span class="sd">        or a constant. Adds substochastic constraints on pi, strictly substochastic constraints</span>
</span><span id="MarkovReach-2014"><a href="#MarkovReach-2014"><span class="linenos">2014</span></a><span class="sd">        on Q, and substochastic constraints on R. In pratice, strict substochastic constraints</span>
</span><span id="MarkovReach-2015"><a href="#MarkovReach-2015"><span class="linenos">2015</span></a><span class="sd">        are implemented with a small numerical offset epsilon=1e-6. Lastly, adds the definition of v as</span>
</span><span id="MarkovReach-2016"><a href="#MarkovReach-2016"><span class="linenos">2016</span></a><span class="sd">        v = Qv + R1.</span>
</span><span id="MarkovReach-2017"><a href="#MarkovReach-2017"><span class="linenos">2017</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach-2018"><a href="#MarkovReach-2018"><span class="linenos">2018</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="MarkovReach-2019"><a href="#MarkovReach-2019"><span class="linenos">2019</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span>
</span><span id="MarkovReach-2020"><a href="#MarkovReach-2020"><span class="linenos">2020</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pi&quot;</span><span class="p">,</span>
</span><span id="MarkovReach-2021"><a href="#MarkovReach-2021"><span class="linenos">2021</span></a>            <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MarkovReach-2022"><a href="#MarkovReach-2022"><span class="linenos">2022</span></a>            <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MarkovReach-2023"><a href="#MarkovReach-2023"><span class="linenos">2023</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="MarkovReach-2024"><a href="#MarkovReach-2024"><span class="linenos">2024</span></a>        <span class="p">)</span>
</span><span id="MarkovReach-2025"><a href="#MarkovReach-2025"><span class="linenos">2025</span></a>
</span><span id="MarkovReach-2026"><a href="#MarkovReach-2026"><span class="linenos">2026</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="MarkovReach-2027"><a href="#MarkovReach-2027"><span class="linenos">2027</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span>
</span><span id="MarkovReach-2028"><a href="#MarkovReach-2028"><span class="linenos">2028</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span>
</span><span id="MarkovReach-2029"><a href="#MarkovReach-2029"><span class="linenos">2029</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span>
</span><span id="MarkovReach-2030"><a href="#MarkovReach-2030"><span class="linenos">2030</span></a>            <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MarkovReach-2031"><a href="#MarkovReach-2031"><span class="linenos">2031</span></a>            <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span><span class="p">,</span>
</span><span id="MarkovReach-2032"><a href="#MarkovReach-2032"><span class="linenos">2032</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="MarkovReach-2033"><a href="#MarkovReach-2033"><span class="linenos">2033</span></a>        <span class="p">)</span>
</span><span id="MarkovReach-2034"><a href="#MarkovReach-2034"><span class="linenos">2034</span></a>
</span><span id="MarkovReach-2035"><a href="#MarkovReach-2035"><span class="linenos">2035</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="MarkovReach-2036"><a href="#MarkovReach-2036"><span class="linenos">2036</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span>
</span><span id="MarkovReach-2037"><a href="#MarkovReach-2037"><span class="linenos">2037</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span><span class="p">,</span>
</span><span id="MarkovReach-2038"><a href="#MarkovReach-2038"><span class="linenos">2038</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;R&quot;</span><span class="p">,</span>
</span><span id="MarkovReach-2039"><a href="#MarkovReach-2039"><span class="linenos">2039</span></a>            <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MarkovReach-2040"><a href="#MarkovReach-2040"><span class="linenos">2040</span></a>            <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MarkovReach-2041"><a href="#MarkovReach-2041"><span class="linenos">2041</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="MarkovReach-2042"><a href="#MarkovReach-2042"><span class="linenos">2042</span></a>        <span class="p">)</span>
</span><span id="MarkovReach-2043"><a href="#MarkovReach-2043"><span class="linenos">2043</span></a>
</span><span id="MarkovReach-2044"><a href="#MarkovReach-2044"><span class="linenos">2044</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="MarkovReach-2045"><a href="#MarkovReach-2045"><span class="linenos">2045</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span>
</span><span id="MarkovReach-2046"><a href="#MarkovReach-2046"><span class="linenos">2046</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span>
</span><span id="MarkovReach-2047"><a href="#MarkovReach-2047"><span class="linenos">2047</span></a>            <span class="n">lb</span><span class="o">=-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="MarkovReach-2048"><a href="#MarkovReach-2048"><span class="linenos">2048</span></a>            <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="MarkovReach-2049"><a href="#MarkovReach-2049"><span class="linenos">2049</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="MarkovReach-2050"><a href="#MarkovReach-2050"><span class="linenos">2050</span></a>        <span class="p">)</span>
</span><span id="MarkovReach-2051"><a href="#MarkovReach-2051"><span class="linenos">2051</span></a>
</span><span id="MarkovReach-2052"><a href="#MarkovReach-2052"><span class="linenos">2052</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="MarkovReach-2053"><a href="#MarkovReach-2053"><span class="linenos">2053</span></a>
</span><span id="MarkovReach-2054"><a href="#MarkovReach-2054"><span class="linenos">2054</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="MarkovReach-2055"><a href="#MarkovReach-2055"><span class="linenos">2055</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="MarkovReach-2056"><a href="#MarkovReach-2056"><span class="linenos">2056</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="MarkovReach-2057"><a href="#MarkovReach-2057"><span class="linenos">2057</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="MarkovReach-2058"><a href="#MarkovReach-2058"><span class="linenos">2058</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="MarkovReach-2059"><a href="#MarkovReach-2059"><span class="linenos">2059</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="MarkovReach-2060"><a href="#MarkovReach-2060"><span class="linenos">2060</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="MarkovReach-2061"><a href="#MarkovReach-2061"><span class="linenos">2061</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="MarkovReach-2062"><a href="#MarkovReach-2062"><span class="linenos">2062</span></a>
</span><span id="MarkovReach-2063"><a href="#MarkovReach-2063"><span class="linenos">2063</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,)</span>
</span><span id="MarkovReach-2064"><a href="#MarkovReach-2064"><span class="linenos">2064</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)</span>
</span><span id="MarkovReach-2065"><a href="#MarkovReach-2065"><span class="linenos">2065</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span><span class="p">)</span>
</span><span id="MarkovReach-2066"><a href="#MarkovReach-2066"><span class="linenos">2066</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,)</span>
</span><span id="MarkovReach-2067"><a href="#MarkovReach-2067"><span class="linenos">2067</span></a>
</span><span id="MarkovReach-2068"><a href="#MarkovReach-2068"><span class="linenos">2068</span></a>        <span class="k">if</span> <span class="n">pi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkovReach-2069"><a href="#MarkovReach-2069"><span class="linenos">2069</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_pi</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>
</span><span id="MarkovReach-2070"><a href="#MarkovReach-2070"><span class="linenos">2070</span></a>        <span class="k">if</span> <span class="n">Q</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkovReach-2071"><a href="#MarkovReach-2071"><span class="linenos">2071</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_Q</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
</span><span id="MarkovReach-2072"><a href="#MarkovReach-2072"><span class="linenos">2072</span></a>        <span class="k">if</span> <span class="n">R</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkovReach-2073"><a href="#MarkovReach-2073"><span class="linenos">2073</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_R</span><span class="p">(</span><span class="n">R</span><span class="p">)</span>
</span><span id="MarkovReach-2074"><a href="#MarkovReach-2074"><span class="linenos">2074</span></a>
</span><span id="MarkovReach-2075"><a href="#MarkovReach-2075"><span class="linenos">2075</span></a>        <span class="c1"># pi is substochastic</span>
</span><span id="MarkovReach-2076"><a href="#MarkovReach-2076"><span class="linenos">2076</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span>
</span><span id="MarkovReach-2077"><a href="#MarkovReach-2077"><span class="linenos">2077</span></a>                             <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="MarkovReach-2078"><a href="#MarkovReach-2078"><span class="linenos">2078</span></a>                             <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pi_prob_constr&quot;</span><span class="p">)</span>
</span><span id="MarkovReach-2079"><a href="#MarkovReach-2079"><span class="linenos">2079</span></a>        <span class="c1"># Q is strictly substochastic</span>
</span><span id="MarkovReach-2080"><a href="#MarkovReach-2080"><span class="linenos">2080</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">):</span>
</span><span id="MarkovReach-2081"><a href="#MarkovReach-2081"><span class="linenos">2081</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span>
</span><span id="MarkovReach-2082"><a href="#MarkovReach-2082"><span class="linenos">2082</span></a>                                 <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span><span class="p">,</span>
</span><span id="MarkovReach-2083"><a href="#MarkovReach-2083"><span class="linenos">2083</span></a>                                 <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;q_prob_constr_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MarkovReach-2084"><a href="#MarkovReach-2084"><span class="linenos">2084</span></a>        <span class="c1"># R is substochastic</span>
</span><span id="MarkovReach-2085"><a href="#MarkovReach-2085"><span class="linenos">2085</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">):</span>
</span><span id="MarkovReach-2086"><a href="#MarkovReach-2086"><span class="linenos">2086</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span><span class="p">))</span>
</span><span id="MarkovReach-2087"><a href="#MarkovReach-2087"><span class="linenos">2087</span></a>                                 <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="MarkovReach-2088"><a href="#MarkovReach-2088"><span class="linenos">2088</span></a>                                 <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;r_prob_constr_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MarkovReach-2089"><a href="#MarkovReach-2089"><span class="linenos">2089</span></a>
</span><span id="MarkovReach-2090"><a href="#MarkovReach-2090"><span class="linenos">2090</span></a>        <span class="c1"># v = Qv + R1</span>
</span><span id="MarkovReach-2091"><a href="#MarkovReach-2091"><span class="linenos">2091</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">):</span>
</span><span id="MarkovReach-2092"><a href="#MarkovReach-2092"><span class="linenos">2092</span></a>            <span class="n">R1</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span><span class="p">))</span>
</span><span id="MarkovReach-2093"><a href="#MarkovReach-2093"><span class="linenos">2093</span></a>            <span class="n">Qv</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span>
</span><span id="MarkovReach-2094"><a href="#MarkovReach-2094"><span class="linenos">2094</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">Qv</span> <span class="o">+</span> <span class="n">R1</span><span class="p">,</span>
</span><span id="MarkovReach-2095"><a href="#MarkovReach-2095"><span class="linenos">2095</span></a>                                 <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;v_constr_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MarkovReach-2096"><a href="#MarkovReach-2096"><span class="linenos">2096</span></a>
</span><span id="MarkovReach-2097"><a href="#MarkovReach-2097"><span class="linenos">2097</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="MarkovReach-2098"><a href="#MarkovReach-2098"><span class="linenos">2098</span></a>
</span><span id="MarkovReach-2099"><a href="#MarkovReach-2099"><span class="linenos">2099</span></a>    <span class="k">def</span> <span class="nf">_check_all_vars_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReach-2100"><a href="#MarkovReach-2100"><span class="linenos">2100</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-2101"><a href="#MarkovReach-2101"><span class="linenos">2101</span></a><span class="sd">        Check if pi, Q, and R have been set before optimization.</span>
</span><span id="MarkovReach-2102"><a href="#MarkovReach-2102"><span class="linenos">2102</span></a>
</span><span id="MarkovReach-2103"><a href="#MarkovReach-2103"><span class="linenos">2103</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach-2104"><a href="#MarkovReach-2104"><span class="linenos">2104</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach-2105"><a href="#MarkovReach-2105"><span class="linenos">2105</span></a><span class="sd">        None</span>
</span><span id="MarkovReach-2106"><a href="#MarkovReach-2106"><span class="linenos">2106</span></a>
</span><span id="MarkovReach-2107"><a href="#MarkovReach-2107"><span class="linenos">2107</span></a><span class="sd">        Raises</span>
</span><span id="MarkovReach-2108"><a href="#MarkovReach-2108"><span class="linenos">2108</span></a><span class="sd">        ------</span>
</span><span id="MarkovReach-2109"><a href="#MarkovReach-2109"><span class="linenos">2109</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovReach-2110"><a href="#MarkovReach-2110"><span class="linenos">2110</span></a><span class="sd">            If any required variables have not been set</span>
</span><span id="MarkovReach-2111"><a href="#MarkovReach-2111"><span class="linenos">2111</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach-2112"><a href="#MarkovReach-2112"><span class="linenos">2112</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReach-2113"><a href="#MarkovReach-2113"><span class="linenos">2113</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
</span><span id="MarkovReach-2114"><a href="#MarkovReach-2114"><span class="linenos">2114</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pi[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] needs to be set to a constant or linked to an ML output&quot;</span><span class="p">)</span>
</span><span id="MarkovReach-2115"><a href="#MarkovReach-2115"><span class="linenos">2115</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReach-2116"><a href="#MarkovReach-2116"><span class="linenos">2116</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovReach-2117"><a href="#MarkovReach-2117"><span class="linenos">2117</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]):</span>
</span><span id="MarkovReach-2118"><a href="#MarkovReach-2118"><span class="linenos">2118</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] needs to be set to a constant or linked to an ML output&quot;</span><span class="p">)</span>
</span><span id="MarkovReach-2119"><a href="#MarkovReach-2119"><span class="linenos">2119</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReach-2120"><a href="#MarkovReach-2120"><span class="linenos">2120</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovReach-2121"><a href="#MarkovReach-2121"><span class="linenos">2121</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]):</span>
</span><span id="MarkovReach-2122"><a href="#MarkovReach-2122"><span class="linenos">2122</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] needs to be set to a constant or linked to an ML output&quot;</span><span class="p">)</span>
</span><span id="MarkovReach-2123"><a href="#MarkovReach-2123"><span class="linenos">2123</span></a>
</span><span id="MarkovReach-2124"><a href="#MarkovReach-2124"><span class="linenos">2124</span></a>    <span class="k">def</span> <span class="nf">_set_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReach-2125"><a href="#MarkovReach-2125"><span class="linenos">2125</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-2126"><a href="#MarkovReach-2126"><span class="linenos">2126</span></a><span class="sd">        Sets the objective function to pi * v.</span>
</span><span id="MarkovReach-2127"><a href="#MarkovReach-2127"><span class="linenos">2127</span></a>
</span><span id="MarkovReach-2128"><a href="#MarkovReach-2128"><span class="linenos">2128</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach-2129"><a href="#MarkovReach-2129"><span class="linenos">2129</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach-2130"><a href="#MarkovReach-2130"><span class="linenos">2130</span></a><span class="sd">        None</span>
</span><span id="MarkovReach-2131"><a href="#MarkovReach-2131"><span class="linenos">2131</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach-2132"><a href="#MarkovReach-2132"><span class="linenos">2132</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)))</span>
</span><span id="MarkovReach-2133"><a href="#MarkovReach-2133"><span class="linenos">2133</span></a>
</span><span id="MarkovReach-2134"><a href="#MarkovReach-2134"><span class="linenos">2134</span></a>    <span class="k">def</span> <span class="nf">_set_feasible_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovReach-2135"><a href="#MarkovReach-2135"><span class="linenos">2135</span></a>                                 <span class="n">ub</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="MarkovReach-2136"><a href="#MarkovReach-2136"><span class="linenos">2136</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-2137"><a href="#MarkovReach-2137"><span class="linenos">2137</span></a><span class="sd">        Sets the feasible constraints on the objective. When looking for a feasible solution,</span>
</span><span id="MarkovReach-2138"><a href="#MarkovReach-2138"><span class="linenos">2138</span></a><span class="sd">        this simply adds the constraints: lb &lt;= pi * v &lt;= ub.</span>
</span><span id="MarkovReach-2139"><a href="#MarkovReach-2139"><span class="linenos">2139</span></a>
</span><span id="MarkovReach-2140"><a href="#MarkovReach-2140"><span class="linenos">2140</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReach-2141"><a href="#MarkovReach-2141"><span class="linenos">2141</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReach-2142"><a href="#MarkovReach-2142"><span class="linenos">2142</span></a><span class="sd">        lb : float | int</span>
</span><span id="MarkovReach-2143"><a href="#MarkovReach-2143"><span class="linenos">2143</span></a><span class="sd">            The lower bound</span>
</span><span id="MarkovReach-2144"><a href="#MarkovReach-2144"><span class="linenos">2144</span></a><span class="sd">        ub : float | int</span>
</span><span id="MarkovReach-2145"><a href="#MarkovReach-2145"><span class="linenos">2145</span></a><span class="sd">            The upper bound</span>
</span><span id="MarkovReach-2146"><a href="#MarkovReach-2146"><span class="linenos">2146</span></a>
</span><span id="MarkovReach-2147"><a href="#MarkovReach-2147"><span class="linenos">2147</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach-2148"><a href="#MarkovReach-2148"><span class="linenos">2148</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach-2149"><a href="#MarkovReach-2149"><span class="linenos">2149</span></a><span class="sd">        None</span>
</span><span id="MarkovReach-2150"><a href="#MarkovReach-2150"><span class="linenos">2150</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach-2151"><a href="#MarkovReach-2151"><span class="linenos">2151</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">lb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;temp_feasible_lb&quot;</span><span class="p">)</span>
</span><span id="MarkovReach-2152"><a href="#MarkovReach-2152"><span class="linenos">2152</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">ub</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;temp_feasible_ub&quot;</span><span class="p">)</span>
</span><span id="MarkovReach-2153"><a href="#MarkovReach-2153"><span class="linenos">2153</span></a>
</span><span id="MarkovReach-2154"><a href="#MarkovReach-2154"><span class="linenos">2154</span></a>    <span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReach-2155"><a href="#MarkovReach-2155"><span class="linenos">2155</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-2156"><a href="#MarkovReach-2156"><span class="linenos">2156</span></a><span class="sd">        Returns the values of pi, Q, R, v, features, and ml_outputs as a dictionary.</span>
</span><span id="MarkovReach-2157"><a href="#MarkovReach-2157"><span class="linenos">2157</span></a>
</span><span id="MarkovReach-2158"><a href="#MarkovReach-2158"><span class="linenos">2158</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach-2159"><a href="#MarkovReach-2159"><span class="linenos">2159</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach-2160"><a href="#MarkovReach-2160"><span class="linenos">2160</span></a><span class="sd">        dict</span>
</span><span id="MarkovReach-2161"><a href="#MarkovReach-2161"><span class="linenos">2161</span></a><span class="sd">            A dictionary with keys:</span>
</span><span id="MarkovReach-2162"><a href="#MarkovReach-2162"><span class="linenos">2162</span></a><span class="sd">            - `pi`: the values of pi</span>
</span><span id="MarkovReach-2163"><a href="#MarkovReach-2163"><span class="linenos">2163</span></a><span class="sd">            - `Q`: the values of Q</span>
</span><span id="MarkovReach-2164"><a href="#MarkovReach-2164"><span class="linenos">2164</span></a><span class="sd">            - `R`: the values of R</span>
</span><span id="MarkovReach-2165"><a href="#MarkovReach-2165"><span class="linenos">2165</span></a><span class="sd">            - `v`: the values of v</span>
</span><span id="MarkovReach-2166"><a href="#MarkovReach-2166"><span class="linenos">2166</span></a><span class="sd">            - `features`: the values of the features</span>
</span><span id="MarkovReach-2167"><a href="#MarkovReach-2167"><span class="linenos">2167</span></a><span class="sd">            - `ml_outputs`: the values of the ml_outputs</span>
</span><span id="MarkovReach-2168"><a href="#MarkovReach-2168"><span class="linenos">2168</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach-2169"><a href="#MarkovReach-2169"><span class="linenos">2169</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="MarkovReach-2170"><a href="#MarkovReach-2170"><span class="linenos">2170</span></a>            <span class="s2">&quot;pi&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="MarkovReach-2171"><a href="#MarkovReach-2171"><span class="linenos">2171</span></a>            <span class="s2">&quot;Q&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="MarkovReach-2172"><a href="#MarkovReach-2172"><span class="linenos">2172</span></a>            <span class="s2">&quot;R&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="MarkovReach-2173"><a href="#MarkovReach-2173"><span class="linenos">2173</span></a>            <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="MarkovReach-2174"><a href="#MarkovReach-2174"><span class="linenos">2174</span></a>            <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">)],</span>
</span><span id="MarkovReach-2175"><a href="#MarkovReach-2175"><span class="linenos">2175</span></a>            <span class="s2">&quot;ml_outputs&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]))]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">))]</span>
</span><span id="MarkovReach-2176"><a href="#MarkovReach-2176"><span class="linenos">2176</span></a>        <span class="p">}</span>
</span><span id="MarkovReach-2177"><a href="#MarkovReach-2177"><span class="linenos">2177</span></a>
</span><span id="MarkovReach-2178"><a href="#MarkovReach-2178"><span class="linenos">2178</span></a>    <span class="k">def</span> <span class="nf">_compute_affine_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ml_bounds</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]):</span>
</span><span id="MarkovReach-2179"><a href="#MarkovReach-2179"><span class="linenos">2179</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-2180"><a href="#MarkovReach-2180"><span class="linenos">2180</span></a><span class="sd">        Computes the affine bounds for the parameters that are linked to ML outputs.</span>
</span><span id="MarkovReach-2181"><a href="#MarkovReach-2181"><span class="linenos">2181</span></a>
</span><span id="MarkovReach-2182"><a href="#MarkovReach-2182"><span class="linenos">2182</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReach-2183"><a href="#MarkovReach-2183"><span class="linenos">2183</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReach-2184"><a href="#MarkovReach-2184"><span class="linenos">2184</span></a><span class="sd">        ml_bounds : List[List[Tuple[float, float]]]</span>
</span><span id="MarkovReach-2185"><a href="#MarkovReach-2185"><span class="linenos">2185</span></a><span class="sd">            The bounds for the ML outputs</span>
</span><span id="MarkovReach-2186"><a href="#MarkovReach-2186"><span class="linenos">2186</span></a>
</span><span id="MarkovReach-2187"><a href="#MarkovReach-2187"><span class="linenos">2187</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach-2188"><a href="#MarkovReach-2188"><span class="linenos">2188</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach-2189"><a href="#MarkovReach-2189"><span class="linenos">2189</span></a><span class="sd">        dict</span>
</span><span id="MarkovReach-2190"><a href="#MarkovReach-2190"><span class="linenos">2190</span></a><span class="sd">            A dictionary with keys: &#39;pi&#39;, &#39;Q&#39;, &#39;R&#39;</span>
</span><span id="MarkovReach-2191"><a href="#MarkovReach-2191"><span class="linenos">2191</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach-2192"><a href="#MarkovReach-2192"><span class="linenos">2192</span></a>        <span class="c1"># Convert ml_bounds to dictionary for easier lookup</span>
</span><span id="MarkovReach-2193"><a href="#MarkovReach-2193"><span class="linenos">2193</span></a>        <span class="n">bounds_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MarkovReach-2194"><a href="#MarkovReach-2194"><span class="linenos">2194</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model_bounds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ml_bounds</span><span class="p">):</span>
</span><span id="MarkovReach-2195"><a href="#MarkovReach-2195"><span class="linenos">2195</span></a>            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_bounds</span><span class="p">):</span>
</span><span id="MarkovReach-2196"><a href="#MarkovReach-2196"><span class="linenos">2196</span></a>                <span class="n">bounds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ml_outputs_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="MarkovReach-2197"><a href="#MarkovReach-2197"><span class="linenos">2197</span></a>
</span><span id="MarkovReach-2198"><a href="#MarkovReach-2198"><span class="linenos">2198</span></a>        <span class="c1"># Initialize bounds dictionary</span>
</span><span id="MarkovReach-2199"><a href="#MarkovReach-2199"><span class="linenos">2199</span></a>        <span class="n">affine_bounds</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MarkovReach-2200"><a href="#MarkovReach-2200"><span class="linenos">2200</span></a>            <span class="s1">&#39;pi&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="MarkovReach-2201"><a href="#MarkovReach-2201"><span class="linenos">2201</span></a>            <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="MarkovReach-2202"><a href="#MarkovReach-2202"><span class="linenos">2202</span></a>            <span class="s1">&#39;R&#39;</span><span class="p">:</span> <span class="p">[]</span>
</span><span id="MarkovReach-2203"><a href="#MarkovReach-2203"><span class="linenos">2203</span></a>        <span class="p">}</span>
</span><span id="MarkovReach-2204"><a href="#MarkovReach-2204"><span class="linenos">2204</span></a>
</span><span id="MarkovReach-2205"><a href="#MarkovReach-2205"><span class="linenos">2205</span></a>        <span class="c1"># Compute bounds for each parameter that is an ML output</span>
</span><span id="MarkovReach-2206"><a href="#MarkovReach-2206"><span class="linenos">2206</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReach-2207"><a href="#MarkovReach-2207"><span class="linenos">2207</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
</span><span id="MarkovReach-2208"><a href="#MarkovReach-2208"><span class="linenos">2208</span></a>                <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ml_expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovReach-2209"><a href="#MarkovReach-2209"><span class="linenos">2209</span></a>                <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_expr_bounds</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">bounds_dict</span><span class="p">)))</span>
</span><span id="MarkovReach-2210"><a href="#MarkovReach-2210"><span class="linenos">2210</span></a>
</span><span id="MarkovReach-2211"><a href="#MarkovReach-2211"><span class="linenos">2211</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReach-2212"><a href="#MarkovReach-2212"><span class="linenos">2212</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovReach-2213"><a href="#MarkovReach-2213"><span class="linenos">2213</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
</span><span id="MarkovReach-2214"><a href="#MarkovReach-2214"><span class="linenos">2214</span></a>                    <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ml_expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
</span><span id="MarkovReach-2215"><a href="#MarkovReach-2215"><span class="linenos">2215</span></a>                    <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_expr_bounds</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">bounds_dict</span><span class="p">)))</span>
</span><span id="MarkovReach-2216"><a href="#MarkovReach-2216"><span class="linenos">2216</span></a>
</span><span id="MarkovReach-2217"><a href="#MarkovReach-2217"><span class="linenos">2217</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReach-2218"><a href="#MarkovReach-2218"><span class="linenos">2218</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovReach-2219"><a href="#MarkovReach-2219"><span class="linenos">2219</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
</span><span id="MarkovReach-2220"><a href="#MarkovReach-2220"><span class="linenos">2220</span></a>                    <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ml_expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
</span><span id="MarkovReach-2221"><a href="#MarkovReach-2221"><span class="linenos">2221</span></a>                    <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_expr_bounds</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">bounds_dict</span><span class="p">)))</span>
</span><span id="MarkovReach-2222"><a href="#MarkovReach-2222"><span class="linenos">2222</span></a>
</span><span id="MarkovReach-2223"><a href="#MarkovReach-2223"><span class="linenos">2223</span></a>        <span class="k">return</span> <span class="n">affine_bounds</span>
</span><span id="MarkovReach-2224"><a href="#MarkovReach-2224"><span class="linenos">2224</span></a>
</span><span id="MarkovReach-2225"><a href="#MarkovReach-2225"><span class="linenos">2225</span></a>    <span class="k">def</span> <span class="nf">_set_affine_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">affine_bounds</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="MarkovReach-2226"><a href="#MarkovReach-2226"><span class="linenos">2226</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-2227"><a href="#MarkovReach-2227"><span class="linenos">2227</span></a><span class="sd">        Sets the bounds for the parameters that are linked to ML outputs.</span>
</span><span id="MarkovReach-2228"><a href="#MarkovReach-2228"><span class="linenos">2228</span></a>
</span><span id="MarkovReach-2229"><a href="#MarkovReach-2229"><span class="linenos">2229</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReach-2230"><a href="#MarkovReach-2230"><span class="linenos">2230</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReach-2231"><a href="#MarkovReach-2231"><span class="linenos">2231</span></a><span class="sd">        affine_bounds : dict</span>
</span><span id="MarkovReach-2232"><a href="#MarkovReach-2232"><span class="linenos">2232</span></a><span class="sd">            The bounds for the ML outputs</span>
</span><span id="MarkovReach-2233"><a href="#MarkovReach-2233"><span class="linenos">2233</span></a>
</span><span id="MarkovReach-2234"><a href="#MarkovReach-2234"><span class="linenos">2234</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach-2235"><a href="#MarkovReach-2235"><span class="linenos">2235</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach-2236"><a href="#MarkovReach-2236"><span class="linenos">2236</span></a><span class="sd">        None</span>
</span><span id="MarkovReach-2237"><a href="#MarkovReach-2237"><span class="linenos">2237</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach-2238"><a href="#MarkovReach-2238"><span class="linenos">2238</span></a>        <span class="c1"># Set bounds only for parameters that are ML outputs</span>
</span><span id="MarkovReach-2239"><a href="#MarkovReach-2239"><span class="linenos">2239</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]:</span>
</span><span id="MarkovReach-2240"><a href="#MarkovReach-2240"><span class="linenos">2240</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="MarkovReach-2241"><a href="#MarkovReach-2241"><span class="linenos">2241</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="MarkovReach-2242"><a href="#MarkovReach-2242"><span class="linenos">2242</span></a>
</span><span id="MarkovReach-2243"><a href="#MarkovReach-2243"><span class="linenos">2243</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]:</span>
</span><span id="MarkovReach-2244"><a href="#MarkovReach-2244"><span class="linenos">2244</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="MarkovReach-2245"><a href="#MarkovReach-2245"><span class="linenos">2245</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="MarkovReach-2246"><a href="#MarkovReach-2246"><span class="linenos">2246</span></a>
</span><span id="MarkovReach-2247"><a href="#MarkovReach-2247"><span class="linenos">2247</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]:</span>
</span><span id="MarkovReach-2248"><a href="#MarkovReach-2248"><span class="linenos">2248</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="MarkovReach-2249"><a href="#MarkovReach-2249"><span class="linenos">2249</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="MarkovReach-2250"><a href="#MarkovReach-2250"><span class="linenos">2250</span></a>
</span><span id="MarkovReach-2251"><a href="#MarkovReach-2251"><span class="linenos">2251</span></a>    <span class="k">def</span> <span class="nf">_compute_initial_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReach-2252"><a href="#MarkovReach-2252"><span class="linenos">2252</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-2253"><a href="#MarkovReach-2253"><span class="linenos">2253</span></a><span class="sd">        Computes the initial bounds for v using the bounds on R.</span>
</span><span id="MarkovReach-2254"><a href="#MarkovReach-2254"><span class="linenos">2254</span></a><span class="sd">        Uses the lemma from the paper: for each $v_i$, $v_i \\in [v^min_i, v^max_i]$ where</span>
</span><span id="MarkovReach-2255"><a href="#MarkovReach-2255"><span class="linenos">2255</span></a><span class="sd">        $v^min_i = 0$, and</span>
</span><span id="MarkovReach-2256"><a href="#MarkovReach-2256"><span class="linenos">2256</span></a><span class="sd">        $v^max_i = 1/\\epsilon * \\max_j \\sum_{k=1}^{|S|} R_{jk}^max$,</span>
</span><span id="MarkovReach-2257"><a href="#MarkovReach-2257"><span class="linenos">2257</span></a><span class="sd">        where $\\epsilon$ is the small numerical offset for the strict substochasticity</span>
</span><span id="MarkovReach-2258"><a href="#MarkovReach-2258"><span class="linenos">2258</span></a>
</span><span id="MarkovReach-2259"><a href="#MarkovReach-2259"><span class="linenos">2259</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach-2260"><a href="#MarkovReach-2260"><span class="linenos">2260</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach-2261"><a href="#MarkovReach-2261"><span class="linenos">2261</span></a><span class="sd">        List[Tuple[float, float]]</span>
</span><span id="MarkovReach-2262"><a href="#MarkovReach-2262"><span class="linenos">2262</span></a><span class="sd">            The initial bounds for v</span>
</span><span id="MarkovReach-2263"><a href="#MarkovReach-2263"><span class="linenos">2263</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach-2264"><a href="#MarkovReach-2264"><span class="linenos">2264</span></a>        <span class="c1"># Find maximum row sum of R&#39;s upper bounds</span>
</span><span id="MarkovReach-2265"><a href="#MarkovReach-2265"><span class="linenos">2265</span></a>        <span class="n">max_row_sum</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MarkovReach-2266"><a href="#MarkovReach-2266"><span class="linenos">2266</span></a>        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">):</span>
</span><span id="MarkovReach-2267"><a href="#MarkovReach-2267"><span class="linenos">2267</span></a>            <span class="n">row_sum</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span><span class="p">))</span>
</span><span id="MarkovReach-2268"><a href="#MarkovReach-2268"><span class="linenos">2268</span></a>            <span class="n">max_row_sum</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">max_row_sum</span><span class="p">,</span> <span class="n">row_sum</span><span class="p">)</span>
</span><span id="MarkovReach-2269"><a href="#MarkovReach-2269"><span class="linenos">2269</span></a>
</span><span id="MarkovReach-2270"><a href="#MarkovReach-2270"><span class="linenos">2270</span></a>        <span class="c1"># Compute upper bound using epsilon</span>
</span><span id="MarkovReach-2271"><a href="#MarkovReach-2271"><span class="linenos">2271</span></a>        <span class="n">v_max</span> <span class="o">=</span> <span class="n">max_row_sum</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span>
</span><span id="MarkovReach-2272"><a href="#MarkovReach-2272"><span class="linenos">2272</span></a>
</span><span id="MarkovReach-2273"><a href="#MarkovReach-2273"><span class="linenos">2273</span></a>        <span class="c1"># Return bounds for each transient state: [0, v_max]</span>
</span><span id="MarkovReach-2274"><a href="#MarkovReach-2274"><span class="linenos">2274</span></a>        <span class="k">return</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="n">v_max</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="MarkovReach-2275"><a href="#MarkovReach-2275"><span class="linenos">2275</span></a>
</span><span id="MarkovReach-2276"><a href="#MarkovReach-2276"><span class="linenos">2276</span></a>    <span class="k">def</span> <span class="nf">_set_initial_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_v_bounds</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]):</span>
</span><span id="MarkovReach-2277"><a href="#MarkovReach-2277"><span class="linenos">2277</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-2278"><a href="#MarkovReach-2278"><span class="linenos">2278</span></a><span class="sd">        Sets the initial bounds for v.</span>
</span><span id="MarkovReach-2279"><a href="#MarkovReach-2279"><span class="linenos">2279</span></a>
</span><span id="MarkovReach-2280"><a href="#MarkovReach-2280"><span class="linenos">2280</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReach-2281"><a href="#MarkovReach-2281"><span class="linenos">2281</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReach-2282"><a href="#MarkovReach-2282"><span class="linenos">2282</span></a><span class="sd">        initial_v_bounds : List[Tuple[float, float]]</span>
</span><span id="MarkovReach-2283"><a href="#MarkovReach-2283"><span class="linenos">2283</span></a><span class="sd">            The initial bounds for v</span>
</span><span id="MarkovReach-2284"><a href="#MarkovReach-2284"><span class="linenos">2284</span></a>
</span><span id="MarkovReach-2285"><a href="#MarkovReach-2285"><span class="linenos">2285</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach-2286"><a href="#MarkovReach-2286"><span class="linenos">2286</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach-2287"><a href="#MarkovReach-2287"><span class="linenos">2287</span></a><span class="sd">        None</span>
</span><span id="MarkovReach-2288"><a href="#MarkovReach-2288"><span class="linenos">2288</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach-2289"><a href="#MarkovReach-2289"><span class="linenos">2289</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReach-2290"><a href="#MarkovReach-2290"><span class="linenos">2290</span></a>            <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">initial_v_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="MarkovReach-2291"><a href="#MarkovReach-2291"><span class="linenos">2291</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="MarkovReach-2292"><a href="#MarkovReach-2292"><span class="linenos">2292</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="MarkovReach-2293"><a href="#MarkovReach-2293"><span class="linenos">2293</span></a>
</span><span id="MarkovReach-2294"><a href="#MarkovReach-2294"><span class="linenos">2294</span></a>    <span class="k">def</span> <span class="nf">_compute_tightened_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReach-2295"><a href="#MarkovReach-2295"><span class="linenos">2295</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-2296"><a href="#MarkovReach-2296"><span class="linenos">2296</span></a><span class="sd">        Computes the tightened bounds for v using the bounds for Q and R and initial bounds for v.</span>
</span><span id="MarkovReach-2297"><a href="#MarkovReach-2297"><span class="linenos">2297</span></a><span class="sd">        This uses Gauss-Seidel to solve the linear system: $vM = R1$, where $M = I - Q$.</span>
</span><span id="MarkovReach-2298"><a href="#MarkovReach-2298"><span class="linenos">2298</span></a>
</span><span id="MarkovReach-2299"><a href="#MarkovReach-2299"><span class="linenos">2299</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach-2300"><a href="#MarkovReach-2300"><span class="linenos">2300</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach-2301"><a href="#MarkovReach-2301"><span class="linenos">2301</span></a><span class="sd">        List[Tuple[float, float]]</span>
</span><span id="MarkovReach-2302"><a href="#MarkovReach-2302"><span class="linenos">2302</span></a><span class="sd">            The tightened bounds for v</span>
</span><span id="MarkovReach-2303"><a href="#MarkovReach-2303"><span class="linenos">2303</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach-2304"><a href="#MarkovReach-2304"><span class="linenos">2304</span></a>        <span class="c1"># Create interval matrices for Q and R</span>
</span><span id="MarkovReach-2305"><a href="#MarkovReach-2305"><span class="linenos">2305</span></a>        <span class="n">Q_intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="MarkovReach-2306"><a href="#MarkovReach-2306"><span class="linenos">2306</span></a>        <span class="n">R_intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="MarkovReach-2307"><a href="#MarkovReach-2307"><span class="linenos">2307</span></a>
</span><span id="MarkovReach-2308"><a href="#MarkovReach-2308"><span class="linenos">2308</span></a>        <span class="c1"># Fill intervals from current bounds</span>
</span><span id="MarkovReach-2309"><a href="#MarkovReach-2309"><span class="linenos">2309</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReach-2310"><a href="#MarkovReach-2310"><span class="linenos">2310</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovReach-2311"><a href="#MarkovReach-2311"><span class="linenos">2311</span></a>                <span class="n">Q_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span><span class="p">]</span>
</span><span id="MarkovReach-2312"><a href="#MarkovReach-2312"><span class="linenos">2312</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReach-2313"><a href="#MarkovReach-2313"><span class="linenos">2313</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovReach-2314"><a href="#MarkovReach-2314"><span class="linenos">2314</span></a>                <span class="n">R_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span><span class="p">]</span>
</span><span id="MarkovReach-2315"><a href="#MarkovReach-2315"><span class="linenos">2315</span></a>
</span><span id="MarkovReach-2316"><a href="#MarkovReach-2316"><span class="linenos">2316</span></a>        <span class="n">R1_intervals</span> <span class="o">=</span> <span class="n">R_intervals</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># R1 is basically row sums</span>
</span><span id="MarkovReach-2317"><a href="#MarkovReach-2317"><span class="linenos">2317</span></a>
</span><span id="MarkovReach-2318"><a href="#MarkovReach-2318"><span class="linenos">2318</span></a>        <span class="c1"># Create linear system: Mv = R1, where M = I - Q</span>
</span><span id="MarkovReach-2319"><a href="#MarkovReach-2319"><span class="linenos">2319</span></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">ima</span><span class="o">.</span><span class="n">_identity_interval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="MarkovReach-2320"><a href="#MarkovReach-2320"><span class="linenos">2320</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">ima</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">Q_intervals</span><span class="p">)</span>
</span><span id="MarkovReach-2321"><a href="#MarkovReach-2321"><span class="linenos">2321</span></a>
</span><span id="MarkovReach-2322"><a href="#MarkovReach-2322"><span class="linenos">2322</span></a>        <span class="c1"># Initial guess using current v bounds</span>
</span><span id="MarkovReach-2323"><a href="#MarkovReach-2323"><span class="linenos">2323</span></a>        <span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])])</span>
</span><span id="MarkovReach-2324"><a href="#MarkovReach-2324"><span class="linenos">2324</span></a>
</span><span id="MarkovReach-2325"><a href="#MarkovReach-2325"><span class="linenos">2325</span></a>        <span class="c1"># Solve using Gauss-Seidel</span>
</span><span id="MarkovReach-2326"><a href="#MarkovReach-2326"><span class="linenos">2326</span></a>        <span class="n">v_intervals</span> <span class="o">=</span> <span class="n">ima</span><span class="o">.</span><span class="n">interval_gauss_seidel</span><span class="p">(</span>
</span><span id="MarkovReach-2327"><a href="#MarkovReach-2327"><span class="linenos">2327</span></a>            <span class="n">M</span><span class="p">,</span> <span class="n">R1_intervals</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span>
</span><span id="MarkovReach-2328"><a href="#MarkovReach-2328"><span class="linenos">2328</span></a>            <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span id="MarkovReach-2329"><a href="#MarkovReach-2329"><span class="linenos">2329</span></a>            <span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span>
</span><span id="MarkovReach-2330"><a href="#MarkovReach-2330"><span class="linenos">2330</span></a>        <span class="p">)</span>
</span><span id="MarkovReach-2331"><a href="#MarkovReach-2331"><span class="linenos">2331</span></a>
</span><span id="MarkovReach-2332"><a href="#MarkovReach-2332"><span class="linenos">2332</span></a>        <span class="c1"># Convert to list of tuples</span>
</span><span id="MarkovReach-2333"><a href="#MarkovReach-2333"><span class="linenos">2333</span></a>        <span class="k">return</span> <span class="p">[(</span><span class="n">v_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">v_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="MarkovReach-2334"><a href="#MarkovReach-2334"><span class="linenos">2334</span></a>
</span><span id="MarkovReach-2335"><a href="#MarkovReach-2335"><span class="linenos">2335</span></a>    <span class="k">def</span> <span class="nf">_set_tightened_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tightened_v_bounds</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]):</span>
</span><span id="MarkovReach-2336"><a href="#MarkovReach-2336"><span class="linenos">2336</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-2337"><a href="#MarkovReach-2337"><span class="linenos">2337</span></a><span class="sd">        Sets the tightened bounds for v.</span>
</span><span id="MarkovReach-2338"><a href="#MarkovReach-2338"><span class="linenos">2338</span></a>
</span><span id="MarkovReach-2339"><a href="#MarkovReach-2339"><span class="linenos">2339</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReach-2340"><a href="#MarkovReach-2340"><span class="linenos">2340</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReach-2341"><a href="#MarkovReach-2341"><span class="linenos">2341</span></a><span class="sd">        tightened_v_bounds : List[Tuple[float, float]]</span>
</span><span id="MarkovReach-2342"><a href="#MarkovReach-2342"><span class="linenos">2342</span></a><span class="sd">            The tightened bounds for v</span>
</span><span id="MarkovReach-2343"><a href="#MarkovReach-2343"><span class="linenos">2343</span></a>
</span><span id="MarkovReach-2344"><a href="#MarkovReach-2344"><span class="linenos">2344</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach-2345"><a href="#MarkovReach-2345"><span class="linenos">2345</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach-2346"><a href="#MarkovReach-2346"><span class="linenos">2346</span></a><span class="sd">        None</span>
</span><span id="MarkovReach-2347"><a href="#MarkovReach-2347"><span class="linenos">2347</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach-2348"><a href="#MarkovReach-2348"><span class="linenos">2348</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReach-2349"><a href="#MarkovReach-2349"><span class="linenos">2349</span></a>            <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">tightened_v_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="MarkovReach-2350"><a href="#MarkovReach-2350"><span class="linenos">2350</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="MarkovReach-2351"><a href="#MarkovReach-2351"><span class="linenos">2351</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="MarkovReach-2352"><a href="#MarkovReach-2352"><span class="linenos">2352</span></a>
</span><span id="MarkovReach-2353"><a href="#MarkovReach-2353"><span class="linenos">2353</span></a>    <span class="c1"># CLEAN PARAMETER ACCESSORS</span>
</span><span id="MarkovReach-2354"><a href="#MarkovReach-2354"><span class="linenos">2354</span></a>
</span><span id="MarkovReach-2355"><a href="#MarkovReach-2355"><span class="linenos">2355</span></a>    <span class="nd">@property</span>
</span><span id="MarkovReach-2356"><a href="#MarkovReach-2356"><span class="linenos">2356</span></a>    <span class="k">def</span> <span class="nf">pi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReach-2357"><a href="#MarkovReach-2357"><span class="linenos">2357</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-2358"><a href="#MarkovReach-2358"><span class="linenos">2358</span></a><span class="sd">        Accessor for the pi parameter.</span>
</span><span id="MarkovReach-2359"><a href="#MarkovReach-2359"><span class="linenos">2359</span></a>
</span><span id="MarkovReach-2360"><a href="#MarkovReach-2360"><span class="linenos">2360</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach-2361"><a href="#MarkovReach-2361"><span class="linenos">2361</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach-2362"><a href="#MarkovReach-2362"><span class="linenos">2362</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovReach-2363"><a href="#MarkovReach-2363"><span class="linenos">2363</span></a><span class="sd">            The pi parameter</span>
</span><span id="MarkovReach-2364"><a href="#MarkovReach-2364"><span class="linenos">2364</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach-2365"><a href="#MarkovReach-2365"><span class="linenos">2365</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span>
</span><span id="MarkovReach-2366"><a href="#MarkovReach-2366"><span class="linenos">2366</span></a>
</span><span id="MarkovReach-2367"><a href="#MarkovReach-2367"><span class="linenos">2367</span></a>    <span class="nd">@property</span>
</span><span id="MarkovReach-2368"><a href="#MarkovReach-2368"><span class="linenos">2368</span></a>    <span class="k">def</span> <span class="nf">Q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReach-2369"><a href="#MarkovReach-2369"><span class="linenos">2369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-2370"><a href="#MarkovReach-2370"><span class="linenos">2370</span></a><span class="sd">        Accessor for the Q parameter.</span>
</span><span id="MarkovReach-2371"><a href="#MarkovReach-2371"><span class="linenos">2371</span></a>
</span><span id="MarkovReach-2372"><a href="#MarkovReach-2372"><span class="linenos">2372</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach-2373"><a href="#MarkovReach-2373"><span class="linenos">2373</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach-2374"><a href="#MarkovReach-2374"><span class="linenos">2374</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovReach-2375"><a href="#MarkovReach-2375"><span class="linenos">2375</span></a><span class="sd">            The Q parameter</span>
</span><span id="MarkovReach-2376"><a href="#MarkovReach-2376"><span class="linenos">2376</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach-2377"><a href="#MarkovReach-2377"><span class="linenos">2377</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span>
</span><span id="MarkovReach-2378"><a href="#MarkovReach-2378"><span class="linenos">2378</span></a>
</span><span id="MarkovReach-2379"><a href="#MarkovReach-2379"><span class="linenos">2379</span></a>    <span class="nd">@property</span>
</span><span id="MarkovReach-2380"><a href="#MarkovReach-2380"><span class="linenos">2380</span></a>    <span class="k">def</span> <span class="nf">R</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReach-2381"><a href="#MarkovReach-2381"><span class="linenos">2381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-2382"><a href="#MarkovReach-2382"><span class="linenos">2382</span></a><span class="sd">        Accessor for the R parameter.</span>
</span><span id="MarkovReach-2383"><a href="#MarkovReach-2383"><span class="linenos">2383</span></a>
</span><span id="MarkovReach-2384"><a href="#MarkovReach-2384"><span class="linenos">2384</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach-2385"><a href="#MarkovReach-2385"><span class="linenos">2385</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach-2386"><a href="#MarkovReach-2386"><span class="linenos">2386</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovReach-2387"><a href="#MarkovReach-2387"><span class="linenos">2387</span></a><span class="sd">            The R parameter</span>
</span><span id="MarkovReach-2388"><a href="#MarkovReach-2388"><span class="linenos">2388</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach-2389"><a href="#MarkovReach-2389"><span class="linenos">2389</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>
</span><span id="MarkovReach-2390"><a href="#MarkovReach-2390"><span class="linenos">2390</span></a>
</span><span id="MarkovReach-2391"><a href="#MarkovReach-2391"><span class="linenos">2391</span></a>    <span class="nd">@property</span>
</span><span id="MarkovReach-2392"><a href="#MarkovReach-2392"><span class="linenos">2392</span></a>    <span class="k">def</span> <span class="nf">v</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReach-2393"><a href="#MarkovReach-2393"><span class="linenos">2393</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-2394"><a href="#MarkovReach-2394"><span class="linenos">2394</span></a><span class="sd">        Accessor for the v parameter.</span>
</span><span id="MarkovReach-2395"><a href="#MarkovReach-2395"><span class="linenos">2395</span></a>
</span><span id="MarkovReach-2396"><a href="#MarkovReach-2396"><span class="linenos">2396</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach-2397"><a href="#MarkovReach-2397"><span class="linenos">2397</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach-2398"><a href="#MarkovReach-2398"><span class="linenos">2398</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovReach-2399"><a href="#MarkovReach-2399"><span class="linenos">2399</span></a><span class="sd">            The v parameter</span>
</span><span id="MarkovReach-2400"><a href="#MarkovReach-2400"><span class="linenos">2400</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach-2401"><a href="#MarkovReach-2401"><span class="linenos">2401</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
</span><span id="MarkovReach-2402"><a href="#MarkovReach-2402"><span class="linenos">2402</span></a>
</span><span id="MarkovReach-2403"><a href="#MarkovReach-2403"><span class="linenos">2403</span></a>    <span class="c1"># HELPER FUNCTIONS TO SET PARAMETERS</span>
</span><span id="MarkovReach-2404"><a href="#MarkovReach-2404"><span class="linenos">2404</span></a>
</span><span id="MarkovReach-2405"><a href="#MarkovReach-2405"><span class="linenos">2405</span></a>    <span class="k">def</span> <span class="nf">set_pi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]):</span>
</span><span id="MarkovReach-2406"><a href="#MarkovReach-2406"><span class="linenos">2406</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-2407"><a href="#MarkovReach-2407"><span class="linenos">2407</span></a><span class="sd">        Helper function to set the entire pi vector.</span>
</span><span id="MarkovReach-2408"><a href="#MarkovReach-2408"><span class="linenos">2408</span></a>
</span><span id="MarkovReach-2409"><a href="#MarkovReach-2409"><span class="linenos">2409</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReach-2410"><a href="#MarkovReach-2410"><span class="linenos">2410</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReach-2411"><a href="#MarkovReach-2411"><span class="linenos">2411</span></a><span class="sd">        values : List[float | int | gp.Var | gp.LinExpr]</span>
</span><span id="MarkovReach-2412"><a href="#MarkovReach-2412"><span class="linenos">2412</span></a><span class="sd">            The values to set the pi parameter to</span>
</span><span id="MarkovReach-2413"><a href="#MarkovReach-2413"><span class="linenos">2413</span></a>
</span><span id="MarkovReach-2414"><a href="#MarkovReach-2414"><span class="linenos">2414</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach-2415"><a href="#MarkovReach-2415"><span class="linenos">2415</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach-2416"><a href="#MarkovReach-2416"><span class="linenos">2416</span></a><span class="sd">        None</span>
</span><span id="MarkovReach-2417"><a href="#MarkovReach-2417"><span class="linenos">2417</span></a>
</span><span id="MarkovReach-2418"><a href="#MarkovReach-2418"><span class="linenos">2418</span></a><span class="sd">        Raises</span>
</span><span id="MarkovReach-2419"><a href="#MarkovReach-2419"><span class="linenos">2419</span></a><span class="sd">        ------</span>
</span><span id="MarkovReach-2420"><a href="#MarkovReach-2420"><span class="linenos">2420</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovReach-2421"><a href="#MarkovReach-2421"><span class="linenos">2421</span></a><span class="sd">            If the values have incorrect length, are not in [0, 1], don&#39;t sum to &lt;=1, or pi is already set</span>
</span><span id="MarkovReach-2422"><a href="#MarkovReach-2422"><span class="linenos">2422</span></a>
</span><span id="MarkovReach-2423"><a href="#MarkovReach-2423"><span class="linenos">2423</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReach-2424"><a href="#MarkovReach-2424"><span class="linenos">2424</span></a><span class="sd">        -----</span>
</span><span id="MarkovReach-2425"><a href="#MarkovReach-2425"><span class="linenos">2425</span></a><span class="sd">        This checks for validity of the values, checks if pi is already set, and sets the values.</span>
</span><span id="MarkovReach-2426"><a href="#MarkovReach-2426"><span class="linenos">2426</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach-2427"><a href="#MarkovReach-2427"><span class="linenos">2427</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_length</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">)</span>
</span><span id="MarkovReach-2428"><a href="#MarkovReach-2428"><span class="linenos">2428</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="MarkovReach-2429"><a href="#MarkovReach-2429"><span class="linenos">2429</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="MarkovReach-2430"><a href="#MarkovReach-2430"><span class="linenos">2430</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MarkovReach-2431"><a href="#MarkovReach-2431"><span class="linenos">2431</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;pi&quot;</span><span class="p">),</span>\
</span><span id="MarkovReach-2432"><a href="#MarkovReach-2432"><span class="linenos">2432</span></a>              <span class="s2">&quot;pi is already set&quot;</span>
</span><span id="MarkovReach-2433"><a href="#MarkovReach-2433"><span class="linenos">2433</span></a>
</span><span id="MarkovReach-2434"><a href="#MarkovReach-2434"><span class="linenos">2434</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;pi&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReach-2435"><a href="#MarkovReach-2435"><span class="linenos">2435</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="MarkovReach-2436"><a href="#MarkovReach-2436"><span class="linenos">2436</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovReach-2437"><a href="#MarkovReach-2437"><span class="linenos">2437</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="MarkovReach-2438"><a href="#MarkovReach-2438"><span class="linenos">2438</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovReach-2439"><a href="#MarkovReach-2439"><span class="linenos">2439</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MarkovReach-2440"><a href="#MarkovReach-2440"><span class="linenos">2440</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pi[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span><span id="MarkovReach-2441"><a href="#MarkovReach-2441"><span class="linenos">2441</span></a>
</span><span id="MarkovReach-2442"><a href="#MarkovReach-2442"><span class="linenos">2442</span></a>    <span class="k">def</span> <span class="nf">set_Q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]]):</span>
</span><span id="MarkovReach-2443"><a href="#MarkovReach-2443"><span class="linenos">2443</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-2444"><a href="#MarkovReach-2444"><span class="linenos">2444</span></a><span class="sd">        Helper function to set the Q matrix.</span>
</span><span id="MarkovReach-2445"><a href="#MarkovReach-2445"><span class="linenos">2445</span></a>
</span><span id="MarkovReach-2446"><a href="#MarkovReach-2446"><span class="linenos">2446</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReach-2447"><a href="#MarkovReach-2447"><span class="linenos">2447</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReach-2448"><a href="#MarkovReach-2448"><span class="linenos">2448</span></a><span class="sd">        values : List[List[float | int | gp.Var | gp.LinExpr]]</span>
</span><span id="MarkovReach-2449"><a href="#MarkovReach-2449"><span class="linenos">2449</span></a><span class="sd">            The values to set the Q matrix to</span>
</span><span id="MarkovReach-2450"><a href="#MarkovReach-2450"><span class="linenos">2450</span></a>
</span><span id="MarkovReach-2451"><a href="#MarkovReach-2451"><span class="linenos">2451</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach-2452"><a href="#MarkovReach-2452"><span class="linenos">2452</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach-2453"><a href="#MarkovReach-2453"><span class="linenos">2453</span></a><span class="sd">        None</span>
</span><span id="MarkovReach-2454"><a href="#MarkovReach-2454"><span class="linenos">2454</span></a>
</span><span id="MarkovReach-2455"><a href="#MarkovReach-2455"><span class="linenos">2455</span></a><span class="sd">        Raises</span>
</span><span id="MarkovReach-2456"><a href="#MarkovReach-2456"><span class="linenos">2456</span></a><span class="sd">        ------</span>
</span><span id="MarkovReach-2457"><a href="#MarkovReach-2457"><span class="linenos">2457</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovReach-2458"><a href="#MarkovReach-2458"><span class="linenos">2458</span></a><span class="sd">            If the values have incorrect length, are not in [0, 1), rows don&#39;t sum to strictly less than 1, or Q is already set</span>
</span><span id="MarkovReach-2459"><a href="#MarkovReach-2459"><span class="linenos">2459</span></a>
</span><span id="MarkovReach-2460"><a href="#MarkovReach-2460"><span class="linenos">2460</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReach-2461"><a href="#MarkovReach-2461"><span class="linenos">2461</span></a><span class="sd">        -----</span>
</span><span id="MarkovReach-2462"><a href="#MarkovReach-2462"><span class="linenos">2462</span></a><span class="sd">        This checks for validity of the values, checks if Q is already set, and sets the values.</span>
</span><span id="MarkovReach-2463"><a href="#MarkovReach-2463"><span class="linenos">2463</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach-2464"><a href="#MarkovReach-2464"><span class="linenos">2464</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_shape</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">)</span>
</span><span id="MarkovReach-2465"><a href="#MarkovReach-2465"><span class="linenos">2465</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="MarkovReach-2466"><a href="#MarkovReach-2466"><span class="linenos">2466</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="MarkovReach-2467"><a href="#MarkovReach-2467"><span class="linenos">2467</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_matrix</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">strictsub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Q is strictly substochastic</span>
</span><span id="MarkovReach-2468"><a href="#MarkovReach-2468"><span class="linenos">2468</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
</span><span id="MarkovReach-2469"><a href="#MarkovReach-2469"><span class="linenos">2469</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="MarkovReach-2470"><a href="#MarkovReach-2470"><span class="linenos">2470</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;Q[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">strictsub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Q is strictly substochastic</span>
</span><span id="MarkovReach-2471"><a href="#MarkovReach-2471"><span class="linenos">2471</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">),</span>\
</span><span id="MarkovReach-2472"><a href="#MarkovReach-2472"><span class="linenos">2472</span></a>              <span class="s2">&quot;Q is already set&quot;</span>
</span><span id="MarkovReach-2473"><a href="#MarkovReach-2473"><span class="linenos">2473</span></a>
</span><span id="MarkovReach-2474"><a href="#MarkovReach-2474"><span class="linenos">2474</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReach-2475"><a href="#MarkovReach-2475"><span class="linenos">2475</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovReach-2476"><a href="#MarkovReach-2476"><span class="linenos">2476</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="MarkovReach-2477"><a href="#MarkovReach-2477"><span class="linenos">2477</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="MarkovReach-2478"><a href="#MarkovReach-2478"><span class="linenos">2478</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="MarkovReach-2479"><a href="#MarkovReach-2479"><span class="linenos">2479</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="MarkovReach-2480"><a href="#MarkovReach-2480"><span class="linenos">2480</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MarkovReach-2481"><a href="#MarkovReach-2481"><span class="linenos">2481</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span><span id="MarkovReach-2482"><a href="#MarkovReach-2482"><span class="linenos">2482</span></a>
</span><span id="MarkovReach-2483"><a href="#MarkovReach-2483"><span class="linenos">2483</span></a>    <span class="k">def</span> <span class="nf">set_R</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]]):</span>
</span><span id="MarkovReach-2484"><a href="#MarkovReach-2484"><span class="linenos">2484</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach-2485"><a href="#MarkovReach-2485"><span class="linenos">2485</span></a><span class="sd">        Helper function to set the R matrix.</span>
</span><span id="MarkovReach-2486"><a href="#MarkovReach-2486"><span class="linenos">2486</span></a>
</span><span id="MarkovReach-2487"><a href="#MarkovReach-2487"><span class="linenos">2487</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReach-2488"><a href="#MarkovReach-2488"><span class="linenos">2488</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReach-2489"><a href="#MarkovReach-2489"><span class="linenos">2489</span></a><span class="sd">        values : List[List[float | int | gp.Var | gp.LinExpr]]</span>
</span><span id="MarkovReach-2490"><a href="#MarkovReach-2490"><span class="linenos">2490</span></a><span class="sd">            The values to set the R matrix to</span>
</span><span id="MarkovReach-2491"><a href="#MarkovReach-2491"><span class="linenos">2491</span></a>
</span><span id="MarkovReach-2492"><a href="#MarkovReach-2492"><span class="linenos">2492</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach-2493"><a href="#MarkovReach-2493"><span class="linenos">2493</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach-2494"><a href="#MarkovReach-2494"><span class="linenos">2494</span></a><span class="sd">        None</span>
</span><span id="MarkovReach-2495"><a href="#MarkovReach-2495"><span class="linenos">2495</span></a>
</span><span id="MarkovReach-2496"><a href="#MarkovReach-2496"><span class="linenos">2496</span></a><span class="sd">        Raises</span>
</span><span id="MarkovReach-2497"><a href="#MarkovReach-2497"><span class="linenos">2497</span></a><span class="sd">        ------</span>
</span><span id="MarkovReach-2498"><a href="#MarkovReach-2498"><span class="linenos">2498</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovReach-2499"><a href="#MarkovReach-2499"><span class="linenos">2499</span></a><span class="sd">            If the values have incorrect length, are not in [0, 1], rows don&#39;t sum to &lt;=1, or R is already set</span>
</span><span id="MarkovReach-2500"><a href="#MarkovReach-2500"><span class="linenos">2500</span></a>
</span><span id="MarkovReach-2501"><a href="#MarkovReach-2501"><span class="linenos">2501</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReach-2502"><a href="#MarkovReach-2502"><span class="linenos">2502</span></a><span class="sd">        -----</span>
</span><span id="MarkovReach-2503"><a href="#MarkovReach-2503"><span class="linenos">2503</span></a><span class="sd">        This checks for validity of the values, checks if R is already set, and sets the values.</span>
</span><span id="MarkovReach-2504"><a href="#MarkovReach-2504"><span class="linenos">2504</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach-2505"><a href="#MarkovReach-2505"><span class="linenos">2505</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_shape</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">)</span>
</span><span id="MarkovReach-2506"><a href="#MarkovReach-2506"><span class="linenos">2506</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="MarkovReach-2507"><a href="#MarkovReach-2507"><span class="linenos">2507</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="MarkovReach-2508"><a href="#MarkovReach-2508"><span class="linenos">2508</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_matrix</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MarkovReach-2509"><a href="#MarkovReach-2509"><span class="linenos">2509</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
</span><span id="MarkovReach-2510"><a href="#MarkovReach-2510"><span class="linenos">2510</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="MarkovReach-2511"><a href="#MarkovReach-2511"><span class="linenos">2511</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;R[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MarkovReach-2512"><a href="#MarkovReach-2512"><span class="linenos">2512</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">),</span>\
</span><span id="MarkovReach-2513"><a href="#MarkovReach-2513"><span class="linenos">2513</span></a>              <span class="s2">&quot;R is already set&quot;</span>
</span><span id="MarkovReach-2514"><a href="#MarkovReach-2514"><span class="linenos">2514</span></a>
</span><span id="MarkovReach-2515"><a href="#MarkovReach-2515"><span class="linenos">2515</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReach-2516"><a href="#MarkovReach-2516"><span class="linenos">2516</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovReach-2517"><a href="#MarkovReach-2517"><span class="linenos">2517</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="MarkovReach-2518"><a href="#MarkovReach-2518"><span class="linenos">2518</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="MarkovReach-2519"><a href="#MarkovReach-2519"><span class="linenos">2519</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="MarkovReach-2520"><a href="#MarkovReach-2520"><span class="linenos">2520</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="MarkovReach-2521"><a href="#MarkovReach-2521"><span class="linenos">2521</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MarkovReach-2522"><a href="#MarkovReach-2522"><span class="linenos">2522</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>For the reachability problem.</p>
</div>


                            <div id="MarkovReach.__init__" class="classattr">
                                        <input id="MarkovReach.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">MarkovReach</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">n_states</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">n_targets</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">n_transient</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">pi</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">Q</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">R</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="MarkovReach.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReach.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReach.__init__-1938"><a href="#MarkovReach.__init__-1938"><span class="linenos">1938</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_states</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovReach.__init__-1939"><a href="#MarkovReach.__init__-1939"><span class="linenos">1939</span></a>                 <span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovReach.__init__-1940"><a href="#MarkovReach.__init__-1940"><span class="linenos">1940</span></a>                 <span class="n">n_targets</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovReach.__init__-1941"><a href="#MarkovReach.__init__-1941"><span class="linenos">1941</span></a>                 <span class="n">n_transient</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovReach.__init__-1942"><a href="#MarkovReach.__init__-1942"><span class="linenos">1942</span></a>                 <span class="n">pi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MarkovReach.__init__-1943"><a href="#MarkovReach.__init__-1943"><span class="linenos">1943</span></a>                 <span class="n">Q</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MarkovReach.__init__-1944"><a href="#MarkovReach.__init__-1944"><span class="linenos">1944</span></a>                 <span class="n">R</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="MarkovReach.__init__-1945"><a href="#MarkovReach.__init__-1945"><span class="linenos">1945</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach.__init__-1946"><a href="#MarkovReach.__init__-1946"><span class="linenos">1946</span></a><span class="sd">        Initialize a Markov chain for the reachability problem.</span>
</span><span id="MarkovReach.__init__-1947"><a href="#MarkovReach.__init__-1947"><span class="linenos">1947</span></a>
</span><span id="MarkovReach.__init__-1948"><a href="#MarkovReach.__init__-1948"><span class="linenos">1948</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReach.__init__-1949"><a href="#MarkovReach.__init__-1949"><span class="linenos">1949</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReach.__init__-1950"><a href="#MarkovReach.__init__-1950"><span class="linenos">1950</span></a><span class="sd">        n_states : int</span>
</span><span id="MarkovReach.__init__-1951"><a href="#MarkovReach.__init__-1951"><span class="linenos">1951</span></a><span class="sd">            The number of states</span>
</span><span id="MarkovReach.__init__-1952"><a href="#MarkovReach.__init__-1952"><span class="linenos">1952</span></a><span class="sd">        n_features : int</span>
</span><span id="MarkovReach.__init__-1953"><a href="#MarkovReach.__init__-1953"><span class="linenos">1953</span></a><span class="sd">            The number of features</span>
</span><span id="MarkovReach.__init__-1954"><a href="#MarkovReach.__init__-1954"><span class="linenos">1954</span></a><span class="sd">        n_targets : int</span>
</span><span id="MarkovReach.__init__-1955"><a href="#MarkovReach.__init__-1955"><span class="linenos">1955</span></a><span class="sd">            The number of target states ($|S|$ in the paper)</span>
</span><span id="MarkovReach.__init__-1956"><a href="#MarkovReach.__init__-1956"><span class="linenos">1956</span></a><span class="sd">        n_transient : int</span>
</span><span id="MarkovReach.__init__-1957"><a href="#MarkovReach.__init__-1957"><span class="linenos">1957</span></a><span class="sd">            The number of transient states ($|T|$ in the paper)</span>
</span><span id="MarkovReach.__init__-1958"><a href="#MarkovReach.__init__-1958"><span class="linenos">1958</span></a><span class="sd">        pi : Optional[List | np.ndarray]</span>
</span><span id="MarkovReach.__init__-1959"><a href="#MarkovReach.__init__-1959"><span class="linenos">1959</span></a><span class="sd">            The initial state distribution over transient states</span>
</span><span id="MarkovReach.__init__-1960"><a href="#MarkovReach.__init__-1960"><span class="linenos">1960</span></a><span class="sd">        Q : Optional[List[List] | np.ndarray]</span>
</span><span id="MarkovReach.__init__-1961"><a href="#MarkovReach.__init__-1961"><span class="linenos">1961</span></a><span class="sd">            The transition matrix between transient states</span>
</span><span id="MarkovReach.__init__-1962"><a href="#MarkovReach.__init__-1962"><span class="linenos">1962</span></a><span class="sd">        R : Optional[List[List] | np.ndarray]</span>
</span><span id="MarkovReach.__init__-1963"><a href="#MarkovReach.__init__-1963"><span class="linenos">1963</span></a><span class="sd">            The transition matrix from transient states to target states</span>
</span><span id="MarkovReach.__init__-1964"><a href="#MarkovReach.__init__-1964"><span class="linenos">1964</span></a>
</span><span id="MarkovReach.__init__-1965"><a href="#MarkovReach.__init__-1965"><span class="linenos">1965</span></a><span class="sd">        Raises</span>
</span><span id="MarkovReach.__init__-1966"><a href="#MarkovReach.__init__-1966"><span class="linenos">1966</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach.__init__-1967"><a href="#MarkovReach.__init__-1967"><span class="linenos">1967</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovReach.__init__-1968"><a href="#MarkovReach.__init__-1968"><span class="linenos">1968</span></a><span class="sd">            If the number of target states is greater than or equal to the number of states, or the number of transient</span>
</span><span id="MarkovReach.__init__-1969"><a href="#MarkovReach.__init__-1969"><span class="linenos">1969</span></a><span class="sd">            states is greater than or equal to the number of states</span>
</span><span id="MarkovReach.__init__-1970"><a href="#MarkovReach.__init__-1970"><span class="linenos">1970</span></a>
</span><span id="MarkovReach.__init__-1971"><a href="#MarkovReach.__init__-1971"><span class="linenos">1971</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReach.__init__-1972"><a href="#MarkovReach.__init__-1972"><span class="linenos">1972</span></a><span class="sd">        -----</span>
</span><span id="MarkovReach.__init__-1973"><a href="#MarkovReach.__init__-1973"><span class="linenos">1973</span></a><span class="sd">        Calls the constructor of the parent class AbstractMarkov, with additional attributes.</span>
</span><span id="MarkovReach.__init__-1974"><a href="#MarkovReach.__init__-1974"><span class="linenos">1974</span></a><span class="sd">        Then, initializes the defining parameters and constraints for the reachability problem.</span>
</span><span id="MarkovReach.__init__-1975"><a href="#MarkovReach.__init__-1975"><span class="linenos">1975</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach.__init__-1976"><a href="#MarkovReach.__init__-1976"><span class="linenos">1976</span></a>
</span><span id="MarkovReach.__init__-1977"><a href="#MarkovReach.__init__-1977"><span class="linenos">1977</span></a>        <span class="k">if</span> <span class="n">n_targets</span> <span class="o">&gt;=</span> <span class="n">n_states</span><span class="p">:</span>
</span><span id="MarkovReach.__init__-1978"><a href="#MarkovReach.__init__-1978"><span class="linenos">1978</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of target states must be less than number of states&quot;</span><span class="p">)</span>
</span><span id="MarkovReach.__init__-1979"><a href="#MarkovReach.__init__-1979"><span class="linenos">1979</span></a>        <span class="k">if</span> <span class="n">n_transient</span> <span class="o">&gt;=</span> <span class="n">n_states</span><span class="p">:</span>
</span><span id="MarkovReach.__init__-1980"><a href="#MarkovReach.__init__-1980"><span class="linenos">1980</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of transient states must be less than number of states&quot;</span><span class="p">)</span>
</span><span id="MarkovReach.__init__-1981"><a href="#MarkovReach.__init__-1981"><span class="linenos">1981</span></a>
</span><span id="MarkovReach.__init__-1982"><a href="#MarkovReach.__init__-1982"><span class="linenos">1982</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">n_states</span><span class="p">,</span> <span class="n">n_features</span><span class="p">)</span>
</span><span id="MarkovReach.__init__-1983"><a href="#MarkovReach.__init__-1983"><span class="linenos">1983</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span> <span class="o">=</span> <span class="n">n_targets</span>
</span><span id="MarkovReach.__init__-1984"><a href="#MarkovReach.__init__-1984"><span class="linenos">1984</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span> <span class="o">=</span> <span class="n">n_transient</span>
</span><span id="MarkovReach.__init__-1985"><a href="#MarkovReach.__init__-1985"><span class="linenos">1985</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_parameters_and_constraints</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a Markov chain for the reachability problem.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>n_states</strong> (int):
The number of states</li>
<li><strong>n_features</strong> (int):
The number of features</li>
<li><strong>n_targets</strong> (int):
The number of target states ($|S|$ in the paper)</li>
<li><strong>n_transient</strong> (int):
The number of transient states ($|T|$ in the paper)</li>
<li><strong>pi</strong> (Optional[List | np.ndarray]):
The initial state distribution over transient states</li>
<li><strong>Q</strong> (Optional[List[List] | np.ndarray]):
The transition matrix between transient states</li>
<li><strong>R</strong> (Optional[List[List] | np.ndarray]):
The transition matrix from transient states to target states</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If the number of target states is greater than or equal to the number of states, or the number of transient
states is greater than or equal to the number of states</li>
</ul>

<h6 id="notes">Notes</h6>

<p>Calls the constructor of the parent class AbstractMarkov, with additional attributes.
Then, initializes the defining parameters and constraints for the reachability problem.</p>
</div>


                            </div>
                            <div id="MarkovReach.n_targets" class="classattr">
                                <div class="attr variable">
            <span class="name">n_targets</span>

        
    </div>
    <a class="headerlink" href="#MarkovReach.n_targets"></a>
    
    

                            </div>
                            <div id="MarkovReach.n_transient" class="classattr">
                                <div class="attr variable">
            <span class="name">n_transient</span>

        
    </div>
    <a class="headerlink" href="#MarkovReach.n_transient"></a>
    
    

                            </div>
                            <div id="MarkovReach.get_values" class="classattr">
                                        <input id="MarkovReach.get_values-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_values</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MarkovReach.get_values-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReach.get_values"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReach.get_values-2154"><a href="#MarkovReach.get_values-2154"><span class="linenos">2154</span></a>    <span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReach.get_values-2155"><a href="#MarkovReach.get_values-2155"><span class="linenos">2155</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach.get_values-2156"><a href="#MarkovReach.get_values-2156"><span class="linenos">2156</span></a><span class="sd">        Returns the values of pi, Q, R, v, features, and ml_outputs as a dictionary.</span>
</span><span id="MarkovReach.get_values-2157"><a href="#MarkovReach.get_values-2157"><span class="linenos">2157</span></a>
</span><span id="MarkovReach.get_values-2158"><a href="#MarkovReach.get_values-2158"><span class="linenos">2158</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach.get_values-2159"><a href="#MarkovReach.get_values-2159"><span class="linenos">2159</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach.get_values-2160"><a href="#MarkovReach.get_values-2160"><span class="linenos">2160</span></a><span class="sd">        dict</span>
</span><span id="MarkovReach.get_values-2161"><a href="#MarkovReach.get_values-2161"><span class="linenos">2161</span></a><span class="sd">            A dictionary with keys:</span>
</span><span id="MarkovReach.get_values-2162"><a href="#MarkovReach.get_values-2162"><span class="linenos">2162</span></a><span class="sd">            - `pi`: the values of pi</span>
</span><span id="MarkovReach.get_values-2163"><a href="#MarkovReach.get_values-2163"><span class="linenos">2163</span></a><span class="sd">            - `Q`: the values of Q</span>
</span><span id="MarkovReach.get_values-2164"><a href="#MarkovReach.get_values-2164"><span class="linenos">2164</span></a><span class="sd">            - `R`: the values of R</span>
</span><span id="MarkovReach.get_values-2165"><a href="#MarkovReach.get_values-2165"><span class="linenos">2165</span></a><span class="sd">            - `v`: the values of v</span>
</span><span id="MarkovReach.get_values-2166"><a href="#MarkovReach.get_values-2166"><span class="linenos">2166</span></a><span class="sd">            - `features`: the values of the features</span>
</span><span id="MarkovReach.get_values-2167"><a href="#MarkovReach.get_values-2167"><span class="linenos">2167</span></a><span class="sd">            - `ml_outputs`: the values of the ml_outputs</span>
</span><span id="MarkovReach.get_values-2168"><a href="#MarkovReach.get_values-2168"><span class="linenos">2168</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach.get_values-2169"><a href="#MarkovReach.get_values-2169"><span class="linenos">2169</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="MarkovReach.get_values-2170"><a href="#MarkovReach.get_values-2170"><span class="linenos">2170</span></a>            <span class="s2">&quot;pi&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="MarkovReach.get_values-2171"><a href="#MarkovReach.get_values-2171"><span class="linenos">2171</span></a>            <span class="s2">&quot;Q&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="MarkovReach.get_values-2172"><a href="#MarkovReach.get_values-2172"><span class="linenos">2172</span></a>            <span class="s2">&quot;R&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_targets</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="MarkovReach.get_values-2173"><a href="#MarkovReach.get_values-2173"><span class="linenos">2173</span></a>            <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="MarkovReach.get_values-2174"><a href="#MarkovReach.get_values-2174"><span class="linenos">2174</span></a>            <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">)],</span>
</span><span id="MarkovReach.get_values-2175"><a href="#MarkovReach.get_values-2175"><span class="linenos">2175</span></a>            <span class="s2">&quot;ml_outputs&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]))]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">))]</span>
</span><span id="MarkovReach.get_values-2176"><a href="#MarkovReach.get_values-2176"><span class="linenos">2176</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Returns the values of pi, Q, R, v, features, and ml_outputs as a dictionary.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>dict</strong>: A dictionary with keys:
<ul>
<li><code><a href="#MarkovReach.pi">pi</a></code>: the values of pi</li>
<li><code><a href="#MarkovReach.Q">Q</a></code>: the values of Q</li>
<li><code><a href="#MarkovReach.R">R</a></code>: the values of R</li>
<li><code><a href="#MarkovReach.v">v</a></code>: the values of v</li>
<li><code><a href="#MarkovReach.features">features</a></code>: the values of the features</li>
<li><code><a href="#MarkovReach.ml_outputs">ml_outputs</a></code>: the values of the ml_outputs</li>
</ul></li>
</ul>
</div>


                            </div>
                            <div id="MarkovReach.pi" class="classattr">
                                        <input id="MarkovReach.pi-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">pi</span>

                <label class="view-source-button" for="MarkovReach.pi-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReach.pi"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReach.pi-2355"><a href="#MarkovReach.pi-2355"><span class="linenos">2355</span></a>    <span class="nd">@property</span>
</span><span id="MarkovReach.pi-2356"><a href="#MarkovReach.pi-2356"><span class="linenos">2356</span></a>    <span class="k">def</span> <span class="nf">pi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReach.pi-2357"><a href="#MarkovReach.pi-2357"><span class="linenos">2357</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach.pi-2358"><a href="#MarkovReach.pi-2358"><span class="linenos">2358</span></a><span class="sd">        Accessor for the pi parameter.</span>
</span><span id="MarkovReach.pi-2359"><a href="#MarkovReach.pi-2359"><span class="linenos">2359</span></a>
</span><span id="MarkovReach.pi-2360"><a href="#MarkovReach.pi-2360"><span class="linenos">2360</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach.pi-2361"><a href="#MarkovReach.pi-2361"><span class="linenos">2361</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach.pi-2362"><a href="#MarkovReach.pi-2362"><span class="linenos">2362</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovReach.pi-2363"><a href="#MarkovReach.pi-2363"><span class="linenos">2363</span></a><span class="sd">            The pi parameter</span>
</span><span id="MarkovReach.pi-2364"><a href="#MarkovReach.pi-2364"><span class="linenos">2364</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach.pi-2365"><a href="#MarkovReach.pi-2365"><span class="linenos">2365</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Accessor for the pi parameter.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>gurobipy.tupledict</strong>: The pi parameter</li>
</ul>
</div>


                            </div>
                            <div id="MarkovReach.Q" class="classattr">
                                        <input id="MarkovReach.Q-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">Q</span>

                <label class="view-source-button" for="MarkovReach.Q-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReach.Q"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReach.Q-2367"><a href="#MarkovReach.Q-2367"><span class="linenos">2367</span></a>    <span class="nd">@property</span>
</span><span id="MarkovReach.Q-2368"><a href="#MarkovReach.Q-2368"><span class="linenos">2368</span></a>    <span class="k">def</span> <span class="nf">Q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReach.Q-2369"><a href="#MarkovReach.Q-2369"><span class="linenos">2369</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach.Q-2370"><a href="#MarkovReach.Q-2370"><span class="linenos">2370</span></a><span class="sd">        Accessor for the Q parameter.</span>
</span><span id="MarkovReach.Q-2371"><a href="#MarkovReach.Q-2371"><span class="linenos">2371</span></a>
</span><span id="MarkovReach.Q-2372"><a href="#MarkovReach.Q-2372"><span class="linenos">2372</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach.Q-2373"><a href="#MarkovReach.Q-2373"><span class="linenos">2373</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach.Q-2374"><a href="#MarkovReach.Q-2374"><span class="linenos">2374</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovReach.Q-2375"><a href="#MarkovReach.Q-2375"><span class="linenos">2375</span></a><span class="sd">            The Q parameter</span>
</span><span id="MarkovReach.Q-2376"><a href="#MarkovReach.Q-2376"><span class="linenos">2376</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach.Q-2377"><a href="#MarkovReach.Q-2377"><span class="linenos">2377</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Accessor for the Q parameter.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>gurobipy.tupledict</strong>: The Q parameter</li>
</ul>
</div>


                            </div>
                            <div id="MarkovReach.R" class="classattr">
                                        <input id="MarkovReach.R-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">R</span>

                <label class="view-source-button" for="MarkovReach.R-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReach.R"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReach.R-2379"><a href="#MarkovReach.R-2379"><span class="linenos">2379</span></a>    <span class="nd">@property</span>
</span><span id="MarkovReach.R-2380"><a href="#MarkovReach.R-2380"><span class="linenos">2380</span></a>    <span class="k">def</span> <span class="nf">R</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReach.R-2381"><a href="#MarkovReach.R-2381"><span class="linenos">2381</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach.R-2382"><a href="#MarkovReach.R-2382"><span class="linenos">2382</span></a><span class="sd">        Accessor for the R parameter.</span>
</span><span id="MarkovReach.R-2383"><a href="#MarkovReach.R-2383"><span class="linenos">2383</span></a>
</span><span id="MarkovReach.R-2384"><a href="#MarkovReach.R-2384"><span class="linenos">2384</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach.R-2385"><a href="#MarkovReach.R-2385"><span class="linenos">2385</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach.R-2386"><a href="#MarkovReach.R-2386"><span class="linenos">2386</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovReach.R-2387"><a href="#MarkovReach.R-2387"><span class="linenos">2387</span></a><span class="sd">            The R parameter</span>
</span><span id="MarkovReach.R-2388"><a href="#MarkovReach.R-2388"><span class="linenos">2388</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach.R-2389"><a href="#MarkovReach.R-2389"><span class="linenos">2389</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Accessor for the R parameter.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>gurobipy.tupledict</strong>: The R parameter</li>
</ul>
</div>


                            </div>
                            <div id="MarkovReach.v" class="classattr">
                                        <input id="MarkovReach.v-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">v</span>

                <label class="view-source-button" for="MarkovReach.v-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReach.v"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReach.v-2391"><a href="#MarkovReach.v-2391"><span class="linenos">2391</span></a>    <span class="nd">@property</span>
</span><span id="MarkovReach.v-2392"><a href="#MarkovReach.v-2392"><span class="linenos">2392</span></a>    <span class="k">def</span> <span class="nf">v</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovReach.v-2393"><a href="#MarkovReach.v-2393"><span class="linenos">2393</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach.v-2394"><a href="#MarkovReach.v-2394"><span class="linenos">2394</span></a><span class="sd">        Accessor for the v parameter.</span>
</span><span id="MarkovReach.v-2395"><a href="#MarkovReach.v-2395"><span class="linenos">2395</span></a>
</span><span id="MarkovReach.v-2396"><a href="#MarkovReach.v-2396"><span class="linenos">2396</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach.v-2397"><a href="#MarkovReach.v-2397"><span class="linenos">2397</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach.v-2398"><a href="#MarkovReach.v-2398"><span class="linenos">2398</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovReach.v-2399"><a href="#MarkovReach.v-2399"><span class="linenos">2399</span></a><span class="sd">            The v parameter</span>
</span><span id="MarkovReach.v-2400"><a href="#MarkovReach.v-2400"><span class="linenos">2400</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach.v-2401"><a href="#MarkovReach.v-2401"><span class="linenos">2401</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Accessor for the v parameter.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>gurobipy.tupledict</strong>: The v parameter</li>
</ul>
</div>


                            </div>
                            <div id="MarkovReach.set_pi" class="classattr">
                                        <input id="MarkovReach.set_pi-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_pi</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MarkovReach.set_pi-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReach.set_pi"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReach.set_pi-2405"><a href="#MarkovReach.set_pi-2405"><span class="linenos">2405</span></a>    <span class="k">def</span> <span class="nf">set_pi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]):</span>
</span><span id="MarkovReach.set_pi-2406"><a href="#MarkovReach.set_pi-2406"><span class="linenos">2406</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach.set_pi-2407"><a href="#MarkovReach.set_pi-2407"><span class="linenos">2407</span></a><span class="sd">        Helper function to set the entire pi vector.</span>
</span><span id="MarkovReach.set_pi-2408"><a href="#MarkovReach.set_pi-2408"><span class="linenos">2408</span></a>
</span><span id="MarkovReach.set_pi-2409"><a href="#MarkovReach.set_pi-2409"><span class="linenos">2409</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReach.set_pi-2410"><a href="#MarkovReach.set_pi-2410"><span class="linenos">2410</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReach.set_pi-2411"><a href="#MarkovReach.set_pi-2411"><span class="linenos">2411</span></a><span class="sd">        values : List[float | int | gp.Var | gp.LinExpr]</span>
</span><span id="MarkovReach.set_pi-2412"><a href="#MarkovReach.set_pi-2412"><span class="linenos">2412</span></a><span class="sd">            The values to set the pi parameter to</span>
</span><span id="MarkovReach.set_pi-2413"><a href="#MarkovReach.set_pi-2413"><span class="linenos">2413</span></a>
</span><span id="MarkovReach.set_pi-2414"><a href="#MarkovReach.set_pi-2414"><span class="linenos">2414</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach.set_pi-2415"><a href="#MarkovReach.set_pi-2415"><span class="linenos">2415</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach.set_pi-2416"><a href="#MarkovReach.set_pi-2416"><span class="linenos">2416</span></a><span class="sd">        None</span>
</span><span id="MarkovReach.set_pi-2417"><a href="#MarkovReach.set_pi-2417"><span class="linenos">2417</span></a>
</span><span id="MarkovReach.set_pi-2418"><a href="#MarkovReach.set_pi-2418"><span class="linenos">2418</span></a><span class="sd">        Raises</span>
</span><span id="MarkovReach.set_pi-2419"><a href="#MarkovReach.set_pi-2419"><span class="linenos">2419</span></a><span class="sd">        ------</span>
</span><span id="MarkovReach.set_pi-2420"><a href="#MarkovReach.set_pi-2420"><span class="linenos">2420</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovReach.set_pi-2421"><a href="#MarkovReach.set_pi-2421"><span class="linenos">2421</span></a><span class="sd">            If the values have incorrect length, are not in [0, 1], don&#39;t sum to &lt;=1, or pi is already set</span>
</span><span id="MarkovReach.set_pi-2422"><a href="#MarkovReach.set_pi-2422"><span class="linenos">2422</span></a>
</span><span id="MarkovReach.set_pi-2423"><a href="#MarkovReach.set_pi-2423"><span class="linenos">2423</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReach.set_pi-2424"><a href="#MarkovReach.set_pi-2424"><span class="linenos">2424</span></a><span class="sd">        -----</span>
</span><span id="MarkovReach.set_pi-2425"><a href="#MarkovReach.set_pi-2425"><span class="linenos">2425</span></a><span class="sd">        This checks for validity of the values, checks if pi is already set, and sets the values.</span>
</span><span id="MarkovReach.set_pi-2426"><a href="#MarkovReach.set_pi-2426"><span class="linenos">2426</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach.set_pi-2427"><a href="#MarkovReach.set_pi-2427"><span class="linenos">2427</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_length</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">)</span>
</span><span id="MarkovReach.set_pi-2428"><a href="#MarkovReach.set_pi-2428"><span class="linenos">2428</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="MarkovReach.set_pi-2429"><a href="#MarkovReach.set_pi-2429"><span class="linenos">2429</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="MarkovReach.set_pi-2430"><a href="#MarkovReach.set_pi-2430"><span class="linenos">2430</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MarkovReach.set_pi-2431"><a href="#MarkovReach.set_pi-2431"><span class="linenos">2431</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;pi&quot;</span><span class="p">),</span>\
</span><span id="MarkovReach.set_pi-2432"><a href="#MarkovReach.set_pi-2432"><span class="linenos">2432</span></a>              <span class="s2">&quot;pi is already set&quot;</span>
</span><span id="MarkovReach.set_pi-2433"><a href="#MarkovReach.set_pi-2433"><span class="linenos">2433</span></a>
</span><span id="MarkovReach.set_pi-2434"><a href="#MarkovReach.set_pi-2434"><span class="linenos">2434</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;pi&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReach.set_pi-2435"><a href="#MarkovReach.set_pi-2435"><span class="linenos">2435</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="MarkovReach.set_pi-2436"><a href="#MarkovReach.set_pi-2436"><span class="linenos">2436</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovReach.set_pi-2437"><a href="#MarkovReach.set_pi-2437"><span class="linenos">2437</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="MarkovReach.set_pi-2438"><a href="#MarkovReach.set_pi-2438"><span class="linenos">2438</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovReach.set_pi-2439"><a href="#MarkovReach.set_pi-2439"><span class="linenos">2439</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MarkovReach.set_pi-2440"><a href="#MarkovReach.set_pi-2440"><span class="linenos">2440</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pi[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Helper function to set the entire pi vector.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>values</strong> (List[float | int | gp.Var | gp.LinExpr]):
The values to set the pi parameter to</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If the values have incorrect length, are not in [0, 1], don't sum to &lt;=1, or pi is already set</li>
</ul>

<h6 id="notes">Notes</h6>

<p>This checks for validity of the values, checks if pi is already set, and sets the values.</p>
</div>


                            </div>
                            <div id="MarkovReach.set_Q" class="classattr">
                                        <input id="MarkovReach.set_Q-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_Q</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MarkovReach.set_Q-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReach.set_Q"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReach.set_Q-2442"><a href="#MarkovReach.set_Q-2442"><span class="linenos">2442</span></a>    <span class="k">def</span> <span class="nf">set_Q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]]):</span>
</span><span id="MarkovReach.set_Q-2443"><a href="#MarkovReach.set_Q-2443"><span class="linenos">2443</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach.set_Q-2444"><a href="#MarkovReach.set_Q-2444"><span class="linenos">2444</span></a><span class="sd">        Helper function to set the Q matrix.</span>
</span><span id="MarkovReach.set_Q-2445"><a href="#MarkovReach.set_Q-2445"><span class="linenos">2445</span></a>
</span><span id="MarkovReach.set_Q-2446"><a href="#MarkovReach.set_Q-2446"><span class="linenos">2446</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReach.set_Q-2447"><a href="#MarkovReach.set_Q-2447"><span class="linenos">2447</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReach.set_Q-2448"><a href="#MarkovReach.set_Q-2448"><span class="linenos">2448</span></a><span class="sd">        values : List[List[float | int | gp.Var | gp.LinExpr]]</span>
</span><span id="MarkovReach.set_Q-2449"><a href="#MarkovReach.set_Q-2449"><span class="linenos">2449</span></a><span class="sd">            The values to set the Q matrix to</span>
</span><span id="MarkovReach.set_Q-2450"><a href="#MarkovReach.set_Q-2450"><span class="linenos">2450</span></a>
</span><span id="MarkovReach.set_Q-2451"><a href="#MarkovReach.set_Q-2451"><span class="linenos">2451</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach.set_Q-2452"><a href="#MarkovReach.set_Q-2452"><span class="linenos">2452</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach.set_Q-2453"><a href="#MarkovReach.set_Q-2453"><span class="linenos">2453</span></a><span class="sd">        None</span>
</span><span id="MarkovReach.set_Q-2454"><a href="#MarkovReach.set_Q-2454"><span class="linenos">2454</span></a>
</span><span id="MarkovReach.set_Q-2455"><a href="#MarkovReach.set_Q-2455"><span class="linenos">2455</span></a><span class="sd">        Raises</span>
</span><span id="MarkovReach.set_Q-2456"><a href="#MarkovReach.set_Q-2456"><span class="linenos">2456</span></a><span class="sd">        ------</span>
</span><span id="MarkovReach.set_Q-2457"><a href="#MarkovReach.set_Q-2457"><span class="linenos">2457</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovReach.set_Q-2458"><a href="#MarkovReach.set_Q-2458"><span class="linenos">2458</span></a><span class="sd">            If the values have incorrect length, are not in [0, 1), rows don&#39;t sum to strictly less than 1, or Q is already set</span>
</span><span id="MarkovReach.set_Q-2459"><a href="#MarkovReach.set_Q-2459"><span class="linenos">2459</span></a>
</span><span id="MarkovReach.set_Q-2460"><a href="#MarkovReach.set_Q-2460"><span class="linenos">2460</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReach.set_Q-2461"><a href="#MarkovReach.set_Q-2461"><span class="linenos">2461</span></a><span class="sd">        -----</span>
</span><span id="MarkovReach.set_Q-2462"><a href="#MarkovReach.set_Q-2462"><span class="linenos">2462</span></a><span class="sd">        This checks for validity of the values, checks if Q is already set, and sets the values.</span>
</span><span id="MarkovReach.set_Q-2463"><a href="#MarkovReach.set_Q-2463"><span class="linenos">2463</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach.set_Q-2464"><a href="#MarkovReach.set_Q-2464"><span class="linenos">2464</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_shape</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">)</span>
</span><span id="MarkovReach.set_Q-2465"><a href="#MarkovReach.set_Q-2465"><span class="linenos">2465</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="MarkovReach.set_Q-2466"><a href="#MarkovReach.set_Q-2466"><span class="linenos">2466</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="MarkovReach.set_Q-2467"><a href="#MarkovReach.set_Q-2467"><span class="linenos">2467</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_matrix</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">strictsub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Q is strictly substochastic</span>
</span><span id="MarkovReach.set_Q-2468"><a href="#MarkovReach.set_Q-2468"><span class="linenos">2468</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
</span><span id="MarkovReach.set_Q-2469"><a href="#MarkovReach.set_Q-2469"><span class="linenos">2469</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="MarkovReach.set_Q-2470"><a href="#MarkovReach.set_Q-2470"><span class="linenos">2470</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;Q[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">strictsub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Q is strictly substochastic</span>
</span><span id="MarkovReach.set_Q-2471"><a href="#MarkovReach.set_Q-2471"><span class="linenos">2471</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">),</span>\
</span><span id="MarkovReach.set_Q-2472"><a href="#MarkovReach.set_Q-2472"><span class="linenos">2472</span></a>              <span class="s2">&quot;Q is already set&quot;</span>
</span><span id="MarkovReach.set_Q-2473"><a href="#MarkovReach.set_Q-2473"><span class="linenos">2473</span></a>
</span><span id="MarkovReach.set_Q-2474"><a href="#MarkovReach.set_Q-2474"><span class="linenos">2474</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReach.set_Q-2475"><a href="#MarkovReach.set_Q-2475"><span class="linenos">2475</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovReach.set_Q-2476"><a href="#MarkovReach.set_Q-2476"><span class="linenos">2476</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="MarkovReach.set_Q-2477"><a href="#MarkovReach.set_Q-2477"><span class="linenos">2477</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="MarkovReach.set_Q-2478"><a href="#MarkovReach.set_Q-2478"><span class="linenos">2478</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="MarkovReach.set_Q-2479"><a href="#MarkovReach.set_Q-2479"><span class="linenos">2479</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="MarkovReach.set_Q-2480"><a href="#MarkovReach.set_Q-2480"><span class="linenos">2480</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MarkovReach.set_Q-2481"><a href="#MarkovReach.set_Q-2481"><span class="linenos">2481</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Helper function to set the Q matrix.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>values</strong> (List[List[float | int | gp.Var | gp.LinExpr]]):
The values to set the Q matrix to</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If the values have incorrect length, are not in [0, 1), rows don't sum to strictly less than 1, or Q is already set</li>
</ul>

<h6 id="notes">Notes</h6>

<p>This checks for validity of the values, checks if Q is already set, and sets the values.</p>
</div>


                            </div>
                            <div id="MarkovReach.set_R" class="classattr">
                                        <input id="MarkovReach.set_R-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_R</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MarkovReach.set_R-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovReach.set_R"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovReach.set_R-2483"><a href="#MarkovReach.set_R-2483"><span class="linenos">2483</span></a>    <span class="k">def</span> <span class="nf">set_R</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]]):</span>
</span><span id="MarkovReach.set_R-2484"><a href="#MarkovReach.set_R-2484"><span class="linenos">2484</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovReach.set_R-2485"><a href="#MarkovReach.set_R-2485"><span class="linenos">2485</span></a><span class="sd">        Helper function to set the R matrix.</span>
</span><span id="MarkovReach.set_R-2486"><a href="#MarkovReach.set_R-2486"><span class="linenos">2486</span></a>
</span><span id="MarkovReach.set_R-2487"><a href="#MarkovReach.set_R-2487"><span class="linenos">2487</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovReach.set_R-2488"><a href="#MarkovReach.set_R-2488"><span class="linenos">2488</span></a><span class="sd">        ----------</span>
</span><span id="MarkovReach.set_R-2489"><a href="#MarkovReach.set_R-2489"><span class="linenos">2489</span></a><span class="sd">        values : List[List[float | int | gp.Var | gp.LinExpr]]</span>
</span><span id="MarkovReach.set_R-2490"><a href="#MarkovReach.set_R-2490"><span class="linenos">2490</span></a><span class="sd">            The values to set the R matrix to</span>
</span><span id="MarkovReach.set_R-2491"><a href="#MarkovReach.set_R-2491"><span class="linenos">2491</span></a>
</span><span id="MarkovReach.set_R-2492"><a href="#MarkovReach.set_R-2492"><span class="linenos">2492</span></a><span class="sd">        Returns</span>
</span><span id="MarkovReach.set_R-2493"><a href="#MarkovReach.set_R-2493"><span class="linenos">2493</span></a><span class="sd">        -------</span>
</span><span id="MarkovReach.set_R-2494"><a href="#MarkovReach.set_R-2494"><span class="linenos">2494</span></a><span class="sd">        None</span>
</span><span id="MarkovReach.set_R-2495"><a href="#MarkovReach.set_R-2495"><span class="linenos">2495</span></a>
</span><span id="MarkovReach.set_R-2496"><a href="#MarkovReach.set_R-2496"><span class="linenos">2496</span></a><span class="sd">        Raises</span>
</span><span id="MarkovReach.set_R-2497"><a href="#MarkovReach.set_R-2497"><span class="linenos">2497</span></a><span class="sd">        ------</span>
</span><span id="MarkovReach.set_R-2498"><a href="#MarkovReach.set_R-2498"><span class="linenos">2498</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovReach.set_R-2499"><a href="#MarkovReach.set_R-2499"><span class="linenos">2499</span></a><span class="sd">            If the values have incorrect length, are not in [0, 1], rows don&#39;t sum to &lt;=1, or R is already set</span>
</span><span id="MarkovReach.set_R-2500"><a href="#MarkovReach.set_R-2500"><span class="linenos">2500</span></a>
</span><span id="MarkovReach.set_R-2501"><a href="#MarkovReach.set_R-2501"><span class="linenos">2501</span></a><span class="sd">        Notes</span>
</span><span id="MarkovReach.set_R-2502"><a href="#MarkovReach.set_R-2502"><span class="linenos">2502</span></a><span class="sd">        -----</span>
</span><span id="MarkovReach.set_R-2503"><a href="#MarkovReach.set_R-2503"><span class="linenos">2503</span></a><span class="sd">        This checks for validity of the values, checks if R is already set, and sets the values.</span>
</span><span id="MarkovReach.set_R-2504"><a href="#MarkovReach.set_R-2504"><span class="linenos">2504</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovReach.set_R-2505"><a href="#MarkovReach.set_R-2505"><span class="linenos">2505</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_shape</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">)</span>
</span><span id="MarkovReach.set_R-2506"><a href="#MarkovReach.set_R-2506"><span class="linenos">2506</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="MarkovReach.set_R-2507"><a href="#MarkovReach.set_R-2507"><span class="linenos">2507</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="MarkovReach.set_R-2508"><a href="#MarkovReach.set_R-2508"><span class="linenos">2508</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_matrix</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MarkovReach.set_R-2509"><a href="#MarkovReach.set_R-2509"><span class="linenos">2509</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
</span><span id="MarkovReach.set_R-2510"><a href="#MarkovReach.set_R-2510"><span class="linenos">2510</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="MarkovReach.set_R-2511"><a href="#MarkovReach.set_R-2511"><span class="linenos">2511</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;R[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MarkovReach.set_R-2512"><a href="#MarkovReach.set_R-2512"><span class="linenos">2512</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;R&quot;</span><span class="p">),</span>\
</span><span id="MarkovReach.set_R-2513"><a href="#MarkovReach.set_R-2513"><span class="linenos">2513</span></a>              <span class="s2">&quot;R is already set&quot;</span>
</span><span id="MarkovReach.set_R-2514"><a href="#MarkovReach.set_R-2514"><span class="linenos">2514</span></a>
</span><span id="MarkovReach.set_R-2515"><a href="#MarkovReach.set_R-2515"><span class="linenos">2515</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovReach.set_R-2516"><a href="#MarkovReach.set_R-2516"><span class="linenos">2516</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;R&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovReach.set_R-2517"><a href="#MarkovReach.set_R-2517"><span class="linenos">2517</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="MarkovReach.set_R-2518"><a href="#MarkovReach.set_R-2518"><span class="linenos">2518</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="MarkovReach.set_R-2519"><a href="#MarkovReach.set_R-2519"><span class="linenos">2519</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="MarkovReach.set_R-2520"><a href="#MarkovReach.set_R-2520"><span class="linenos">2520</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="MarkovReach.set_R-2521"><a href="#MarkovReach.set_R-2521"><span class="linenos">2521</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MarkovReach.set_R-2522"><a href="#MarkovReach.set_R-2522"><span class="linenos">2522</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;R[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Helper function to set the R matrix.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>values</strong> (List[List[float | int | gp.Var | gp.LinExpr]]):
The values to set the R matrix to</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If the values have incorrect length, are not in [0, 1], rows don't sum to &lt;=1, or R is already set</li>
</ul>

<h6 id="notes">Notes</h6>

<p>This checks for validity of the values, checks if R is already set, and sets the values.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#AbstractMarkov">AbstractMarkov</a></dt>
                                <dd id="MarkovReach.n_states" class="variable"><a href="#AbstractMarkov.n_states">n_states</a></dd>
                <dd id="MarkovReach.n_features" class="variable"><a href="#AbstractMarkov.n_features">n_features</a></dd>
                <dd id="MarkovReach.model" class="variable"><a href="#AbstractMarkov.model">model</a></dd>
                <dd id="MarkovReach.variables" class="variable"><a href="#AbstractMarkov.variables">variables</a></dd>
                <dd id="MarkovReach.features" class="variable"><a href="#AbstractMarkov.features">features</a></dd>
                <dd id="MarkovReach.feature_aux" class="variable"><a href="#AbstractMarkov.feature_aux">feature_aux</a></dd>
                <dd id="MarkovReach.feature_constraints" class="variable"><a href="#AbstractMarkov.feature_constraints">feature_constraints</a></dd>
                <dd id="MarkovReach.ml_models" class="variable"><a href="#AbstractMarkov.ml_models">ml_models</a></dd>
                <dd id="MarkovReach.ml_outputs" class="variable"><a href="#AbstractMarkov.ml_outputs">ml_outputs</a></dd>
                <dd id="MarkovReach.set_to_ml_output" class="function"><a href="#AbstractMarkov.set_to_ml_output">set_to_ml_output</a></dd>
                <dd id="MarkovReach.set_to_const" class="function"><a href="#AbstractMarkov.set_to_const">set_to_const</a></dd>
                <dd id="MarkovReach.add_feature_constraint" class="function"><a href="#AbstractMarkov.add_feature_constraint">add_feature_constraint</a></dd>
                <dd id="MarkovReach.add_feature_aux_variable" class="function"><a href="#AbstractMarkov.add_feature_aux_variable">add_feature_aux_variable</a></dd>
                <dd id="MarkovReach.add_constraint" class="function"><a href="#AbstractMarkov.add_constraint">add_constraint</a></dd>
                <dd id="MarkovReach.add_ml_model" class="function"><a href="#AbstractMarkov.add_ml_model">add_ml_model</a></dd>
                <dd id="MarkovReach.optimize" class="function"><a href="#AbstractMarkov.optimize">optimize</a></dd>
                <dd id="MarkovReach.find_feasible" class="function"><a href="#AbstractMarkov.find_feasible">find_feasible</a></dd>
                <dd id="MarkovReach.get_value" class="function"><a href="#AbstractMarkov.get_value">get_value</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="MarkovHitting">
                            <input id="MarkovHitting-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MarkovHitting</span><wbr>(<span class="base"><a href="#AbstractMarkov">AbstractMarkov</a></span>):

                <label class="view-source-button" for="MarkovHitting-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovHitting"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovHitting-2524"><a href="#MarkovHitting-2524"><span class="linenos">2524</span></a><span class="k">class</span> <span class="nc">MarkovHitting</span><span class="p">(</span><span class="n">AbstractMarkov</span><span class="p">):</span>
</span><span id="MarkovHitting-2525"><a href="#MarkovHitting-2525"><span class="linenos">2525</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2526"><a href="#MarkovHitting-2526"><span class="linenos">2526</span></a><span class="sd">    For the hitting time problem.</span>
</span><span id="MarkovHitting-2527"><a href="#MarkovHitting-2527"><span class="linenos">2527</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2528"><a href="#MarkovHitting-2528"><span class="linenos">2528</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_states</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovHitting-2529"><a href="#MarkovHitting-2529"><span class="linenos">2529</span></a>                 <span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovHitting-2530"><a href="#MarkovHitting-2530"><span class="linenos">2530</span></a>                 <span class="n">n_transient</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovHitting-2531"><a href="#MarkovHitting-2531"><span class="linenos">2531</span></a>                 <span class="n">pi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MarkovHitting-2532"><a href="#MarkovHitting-2532"><span class="linenos">2532</span></a>                 <span class="n">Q</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="MarkovHitting-2533"><a href="#MarkovHitting-2533"><span class="linenos">2533</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2534"><a href="#MarkovHitting-2534"><span class="linenos">2534</span></a><span class="sd">        Initialize a Markov chain for the hitting time problem.</span>
</span><span id="MarkovHitting-2535"><a href="#MarkovHitting-2535"><span class="linenos">2535</span></a>
</span><span id="MarkovHitting-2536"><a href="#MarkovHitting-2536"><span class="linenos">2536</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovHitting-2537"><a href="#MarkovHitting-2537"><span class="linenos">2537</span></a><span class="sd">        ----------</span>
</span><span id="MarkovHitting-2538"><a href="#MarkovHitting-2538"><span class="linenos">2538</span></a><span class="sd">        n_states : int</span>
</span><span id="MarkovHitting-2539"><a href="#MarkovHitting-2539"><span class="linenos">2539</span></a><span class="sd">            The number of states</span>
</span><span id="MarkovHitting-2540"><a href="#MarkovHitting-2540"><span class="linenos">2540</span></a><span class="sd">        n_features : int</span>
</span><span id="MarkovHitting-2541"><a href="#MarkovHitting-2541"><span class="linenos">2541</span></a><span class="sd">            The number of features</span>
</span><span id="MarkovHitting-2542"><a href="#MarkovHitting-2542"><span class="linenos">2542</span></a><span class="sd">        n_transient : int</span>
</span><span id="MarkovHitting-2543"><a href="#MarkovHitting-2543"><span class="linenos">2543</span></a><span class="sd">            The number of transient states ($|T|$ in the paper)</span>
</span><span id="MarkovHitting-2544"><a href="#MarkovHitting-2544"><span class="linenos">2544</span></a><span class="sd">        pi : Optional[List | np.ndarray]</span>
</span><span id="MarkovHitting-2545"><a href="#MarkovHitting-2545"><span class="linenos">2545</span></a><span class="sd">            The initial state distribution over transient states</span>
</span><span id="MarkovHitting-2546"><a href="#MarkovHitting-2546"><span class="linenos">2546</span></a><span class="sd">        Q : Optional[List[List] | np.ndarray]</span>
</span><span id="MarkovHitting-2547"><a href="#MarkovHitting-2547"><span class="linenos">2547</span></a><span class="sd">            The transition matrix between transient states</span>
</span><span id="MarkovHitting-2548"><a href="#MarkovHitting-2548"><span class="linenos">2548</span></a>
</span><span id="MarkovHitting-2549"><a href="#MarkovHitting-2549"><span class="linenos">2549</span></a><span class="sd">        Raises</span>
</span><span id="MarkovHitting-2550"><a href="#MarkovHitting-2550"><span class="linenos">2550</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting-2551"><a href="#MarkovHitting-2551"><span class="linenos">2551</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovHitting-2552"><a href="#MarkovHitting-2552"><span class="linenos">2552</span></a><span class="sd">            If the number of transient states is greater than or equal to the number of states</span>
</span><span id="MarkovHitting-2553"><a href="#MarkovHitting-2553"><span class="linenos">2553</span></a>
</span><span id="MarkovHitting-2554"><a href="#MarkovHitting-2554"><span class="linenos">2554</span></a><span class="sd">        Notes</span>
</span><span id="MarkovHitting-2555"><a href="#MarkovHitting-2555"><span class="linenos">2555</span></a><span class="sd">        -----</span>
</span><span id="MarkovHitting-2556"><a href="#MarkovHitting-2556"><span class="linenos">2556</span></a><span class="sd">        Calls the constructor of the parent class AbstractMarkov, with additional attributes.</span>
</span><span id="MarkovHitting-2557"><a href="#MarkovHitting-2557"><span class="linenos">2557</span></a><span class="sd">        Then, initializes the defining parameters and constraints for the hitting time problem.</span>
</span><span id="MarkovHitting-2558"><a href="#MarkovHitting-2558"><span class="linenos">2558</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2559"><a href="#MarkovHitting-2559"><span class="linenos">2559</span></a>
</span><span id="MarkovHitting-2560"><a href="#MarkovHitting-2560"><span class="linenos">2560</span></a>        <span class="k">if</span> <span class="n">n_transient</span> <span class="o">&gt;=</span> <span class="n">n_states</span><span class="p">:</span>
</span><span id="MarkovHitting-2561"><a href="#MarkovHitting-2561"><span class="linenos">2561</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of transient states must be less than number of states&quot;</span><span class="p">)</span>
</span><span id="MarkovHitting-2562"><a href="#MarkovHitting-2562"><span class="linenos">2562</span></a>
</span><span id="MarkovHitting-2563"><a href="#MarkovHitting-2563"><span class="linenos">2563</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">n_states</span><span class="p">,</span> <span class="n">n_features</span><span class="p">)</span>
</span><span id="MarkovHitting-2564"><a href="#MarkovHitting-2564"><span class="linenos">2564</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span> <span class="o">=</span> <span class="n">n_transient</span>
</span><span id="MarkovHitting-2565"><a href="#MarkovHitting-2565"><span class="linenos">2565</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_parameters_and_constraints</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span>
</span><span id="MarkovHitting-2566"><a href="#MarkovHitting-2566"><span class="linenos">2566</span></a>
</span><span id="MarkovHitting-2567"><a href="#MarkovHitting-2567"><span class="linenos">2567</span></a>    <span class="c1"># FUNCTIONS THAT MUST BE IMPLEMENTED IN SUBCLASSES WHICH UNIQUELY DEFINE THE PROBLEM</span>
</span><span id="MarkovHitting-2568"><a href="#MarkovHitting-2568"><span class="linenos">2568</span></a>
</span><span id="MarkovHitting-2569"><a href="#MarkovHitting-2569"><span class="linenos">2569</span></a>    <span class="k">def</span> <span class="nf">_initialize_parameters_and_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pi</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MarkovHitting-2570"><a href="#MarkovHitting-2570"><span class="linenos">2570</span></a>                                               <span class="n">Q</span> <span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="MarkovHitting-2571"><a href="#MarkovHitting-2571"><span class="linenos">2571</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2572"><a href="#MarkovHitting-2572"><span class="linenos">2572</span></a><span class="sd">        Initializes the parameters and constraints for the reachability problem.</span>
</span><span id="MarkovHitting-2573"><a href="#MarkovHitting-2573"><span class="linenos">2573</span></a>
</span><span id="MarkovHitting-2574"><a href="#MarkovHitting-2574"><span class="linenos">2574</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovHitting-2575"><a href="#MarkovHitting-2575"><span class="linenos">2575</span></a><span class="sd">        ----------</span>
</span><span id="MarkovHitting-2576"><a href="#MarkovHitting-2576"><span class="linenos">2576</span></a><span class="sd">        pi : Optional[List | np.ndarray]</span>
</span><span id="MarkovHitting-2577"><a href="#MarkovHitting-2577"><span class="linenos">2577</span></a><span class="sd">            The initial state distribution over transient states</span>
</span><span id="MarkovHitting-2578"><a href="#MarkovHitting-2578"><span class="linenos">2578</span></a><span class="sd">        Q : Optional[List[List] | np.ndarray]</span>
</span><span id="MarkovHitting-2579"><a href="#MarkovHitting-2579"><span class="linenos">2579</span></a><span class="sd">            The transition matrix between transient states</span>
</span><span id="MarkovHitting-2580"><a href="#MarkovHitting-2580"><span class="linenos">2580</span></a>
</span><span id="MarkovHitting-2581"><a href="#MarkovHitting-2581"><span class="linenos">2581</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting-2582"><a href="#MarkovHitting-2582"><span class="linenos">2582</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting-2583"><a href="#MarkovHitting-2583"><span class="linenos">2583</span></a><span class="sd">        None</span>
</span><span id="MarkovHitting-2584"><a href="#MarkovHitting-2584"><span class="linenos">2584</span></a>
</span><span id="MarkovHitting-2585"><a href="#MarkovHitting-2585"><span class="linenos">2585</span></a><span class="sd">        Notes</span>
</span><span id="MarkovHitting-2586"><a href="#MarkovHitting-2586"><span class="linenos">2586</span></a><span class="sd">        -----</span>
</span><span id="MarkovHitting-2587"><a href="#MarkovHitting-2587"><span class="linenos">2587</span></a><span class="sd">        Adds variables for: pi (bounds between 0 and 1), Q (bounds between 0 and 1, strictly less</span>
</span><span id="MarkovHitting-2588"><a href="#MarkovHitting-2588"><span class="linenos">2588</span></a><span class="sd">        than 1), and v (bounds between -inf and inf). Creates boolean lists to store whether each</span>
</span><span id="MarkovHitting-2589"><a href="#MarkovHitting-2589"><span class="linenos">2589</span></a><span class="sd">        variable has been set to an ML output or a constant. Adds substochastic constraints on pi,</span>
</span><span id="MarkovHitting-2590"><a href="#MarkovHitting-2590"><span class="linenos">2590</span></a><span class="sd">        and strictly substochastic constraints on Q. In pratice, strict substochastic constraints</span>
</span><span id="MarkovHitting-2591"><a href="#MarkovHitting-2591"><span class="linenos">2591</span></a><span class="sd">        are implemented with a small numerical offset epsilon=1e-6. Lastly, adds the definition</span>
</span><span id="MarkovHitting-2592"><a href="#MarkovHitting-2592"><span class="linenos">2592</span></a><span class="sd">        of v as v = Qv + 1.</span>
</span><span id="MarkovHitting-2593"><a href="#MarkovHitting-2593"><span class="linenos">2593</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2594"><a href="#MarkovHitting-2594"><span class="linenos">2594</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="MarkovHitting-2595"><a href="#MarkovHitting-2595"><span class="linenos">2595</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span>
</span><span id="MarkovHitting-2596"><a href="#MarkovHitting-2596"><span class="linenos">2596</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pi&quot;</span><span class="p">,</span>
</span><span id="MarkovHitting-2597"><a href="#MarkovHitting-2597"><span class="linenos">2597</span></a>            <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MarkovHitting-2598"><a href="#MarkovHitting-2598"><span class="linenos">2598</span></a>            <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
</span><span id="MarkovHitting-2599"><a href="#MarkovHitting-2599"><span class="linenos">2599</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="MarkovHitting-2600"><a href="#MarkovHitting-2600"><span class="linenos">2600</span></a>        <span class="p">)</span>
</span><span id="MarkovHitting-2601"><a href="#MarkovHitting-2601"><span class="linenos">2601</span></a>
</span><span id="MarkovHitting-2602"><a href="#MarkovHitting-2602"><span class="linenos">2602</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="MarkovHitting-2603"><a href="#MarkovHitting-2603"><span class="linenos">2603</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span>
</span><span id="MarkovHitting-2604"><a href="#MarkovHitting-2604"><span class="linenos">2604</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span>
</span><span id="MarkovHitting-2605"><a href="#MarkovHitting-2605"><span class="linenos">2605</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span>
</span><span id="MarkovHitting-2606"><a href="#MarkovHitting-2606"><span class="linenos">2606</span></a>            <span class="n">lb</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
</span><span id="MarkovHitting-2607"><a href="#MarkovHitting-2607"><span class="linenos">2607</span></a>            <span class="n">ub</span><span class="o">=</span><span class="mi">1</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span><span class="p">,</span>
</span><span id="MarkovHitting-2608"><a href="#MarkovHitting-2608"><span class="linenos">2608</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="MarkovHitting-2609"><a href="#MarkovHitting-2609"><span class="linenos">2609</span></a>        <span class="p">)</span>
</span><span id="MarkovHitting-2610"><a href="#MarkovHitting-2610"><span class="linenos">2610</span></a>
</span><span id="MarkovHitting-2611"><a href="#MarkovHitting-2611"><span class="linenos">2611</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addVars</span><span class="p">(</span>
</span><span id="MarkovHitting-2612"><a href="#MarkovHitting-2612"><span class="linenos">2612</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span>
</span><span id="MarkovHitting-2613"><a href="#MarkovHitting-2613"><span class="linenos">2613</span></a>            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;v&quot;</span><span class="p">,</span>
</span><span id="MarkovHitting-2614"><a href="#MarkovHitting-2614"><span class="linenos">2614</span></a>            <span class="n">lb</span><span class="o">=-</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="MarkovHitting-2615"><a href="#MarkovHitting-2615"><span class="linenos">2615</span></a>            <span class="n">ub</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">INFINITY</span><span class="p">,</span>
</span><span id="MarkovHitting-2616"><a href="#MarkovHitting-2616"><span class="linenos">2616</span></a>            <span class="n">vtype</span><span class="o">=</span><span class="n">GRB</span><span class="o">.</span><span class="n">CONTINUOUS</span>
</span><span id="MarkovHitting-2617"><a href="#MarkovHitting-2617"><span class="linenos">2617</span></a>        <span class="p">)</span>
</span><span id="MarkovHitting-2618"><a href="#MarkovHitting-2618"><span class="linenos">2618</span></a>
</span><span id="MarkovHitting-2619"><a href="#MarkovHitting-2619"><span class="linenos">2619</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="MarkovHitting-2620"><a href="#MarkovHitting-2620"><span class="linenos">2620</span></a>
</span><span id="MarkovHitting-2621"><a href="#MarkovHitting-2621"><span class="linenos">2621</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="MarkovHitting-2622"><a href="#MarkovHitting-2622"><span class="linenos">2622</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="MarkovHitting-2623"><a href="#MarkovHitting-2623"><span class="linenos">2623</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="MarkovHitting-2624"><a href="#MarkovHitting-2624"><span class="linenos">2624</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="MarkovHitting-2625"><a href="#MarkovHitting-2625"><span class="linenos">2625</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="MarkovHitting-2626"><a href="#MarkovHitting-2626"><span class="linenos">2626</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="kc">False</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span>
</span><span id="MarkovHitting-2627"><a href="#MarkovHitting-2627"><span class="linenos">2627</span></a>
</span><span id="MarkovHitting-2628"><a href="#MarkovHitting-2628"><span class="linenos">2628</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,)</span>
</span><span id="MarkovHitting-2629"><a href="#MarkovHitting-2629"><span class="linenos">2629</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)</span>
</span><span id="MarkovHitting-2630"><a href="#MarkovHitting-2630"><span class="linenos">2630</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">,)</span>
</span><span id="MarkovHitting-2631"><a href="#MarkovHitting-2631"><span class="linenos">2631</span></a>
</span><span id="MarkovHitting-2632"><a href="#MarkovHitting-2632"><span class="linenos">2632</span></a>        <span class="k">if</span> <span class="n">pi</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkovHitting-2633"><a href="#MarkovHitting-2633"><span class="linenos">2633</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_pi</span><span class="p">(</span><span class="n">pi</span><span class="p">)</span>
</span><span id="MarkovHitting-2634"><a href="#MarkovHitting-2634"><span class="linenos">2634</span></a>        <span class="k">if</span> <span class="n">Q</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="MarkovHitting-2635"><a href="#MarkovHitting-2635"><span class="linenos">2635</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set_Q</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span>
</span><span id="MarkovHitting-2636"><a href="#MarkovHitting-2636"><span class="linenos">2636</span></a>
</span><span id="MarkovHitting-2637"><a href="#MarkovHitting-2637"><span class="linenos">2637</span></a>        <span class="c1"># pi is substochastic</span>
</span><span id="MarkovHitting-2638"><a href="#MarkovHitting-2638"><span class="linenos">2638</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span>
</span><span id="MarkovHitting-2639"><a href="#MarkovHitting-2639"><span class="linenos">2639</span></a>                             <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="MarkovHitting-2640"><a href="#MarkovHitting-2640"><span class="linenos">2640</span></a>                             <span class="n">name</span><span class="o">=</span><span class="s2">&quot;pi_prob_constr&quot;</span><span class="p">)</span>
</span><span id="MarkovHitting-2641"><a href="#MarkovHitting-2641"><span class="linenos">2641</span></a>        <span class="c1"># Q is strictly substochastic</span>
</span><span id="MarkovHitting-2642"><a href="#MarkovHitting-2642"><span class="linenos">2642</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">):</span>
</span><span id="MarkovHitting-2643"><a href="#MarkovHitting-2643"><span class="linenos">2643</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span>
</span><span id="MarkovHitting-2644"><a href="#MarkovHitting-2644"><span class="linenos">2644</span></a>                                 <span class="o">&lt;=</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span><span class="p">,</span>
</span><span id="MarkovHitting-2645"><a href="#MarkovHitting-2645"><span class="linenos">2645</span></a>                                 <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;q_prob_constr_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MarkovHitting-2646"><a href="#MarkovHitting-2646"><span class="linenos">2646</span></a>
</span><span id="MarkovHitting-2647"><a href="#MarkovHitting-2647"><span class="linenos">2647</span></a>        <span class="c1"># v = Qv + 1</span>
</span><span id="MarkovHitting-2648"><a href="#MarkovHitting-2648"><span class="linenos">2648</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">):</span>
</span><span id="MarkovHitting-2649"><a href="#MarkovHitting-2649"><span class="linenos">2649</span></a>            <span class="n">Qv</span> <span class="o">=</span> <span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span>
</span><span id="MarkovHitting-2650"><a href="#MarkovHitting-2650"><span class="linenos">2650</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">==</span> <span class="n">Qv</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="MarkovHitting-2651"><a href="#MarkovHitting-2651"><span class="linenos">2651</span></a>                                 <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;v_constr_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MarkovHitting-2652"><a href="#MarkovHitting-2652"><span class="linenos">2652</span></a>
</span><span id="MarkovHitting-2653"><a href="#MarkovHitting-2653"><span class="linenos">2653</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
</span><span id="MarkovHitting-2654"><a href="#MarkovHitting-2654"><span class="linenos">2654</span></a>
</span><span id="MarkovHitting-2655"><a href="#MarkovHitting-2655"><span class="linenos">2655</span></a>    <span class="k">def</span> <span class="nf">_check_all_vars_set</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovHitting-2656"><a href="#MarkovHitting-2656"><span class="linenos">2656</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2657"><a href="#MarkovHitting-2657"><span class="linenos">2657</span></a><span class="sd">        Check if pi and Q have been set before optimization.</span>
</span><span id="MarkovHitting-2658"><a href="#MarkovHitting-2658"><span class="linenos">2658</span></a>
</span><span id="MarkovHitting-2659"><a href="#MarkovHitting-2659"><span class="linenos">2659</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting-2660"><a href="#MarkovHitting-2660"><span class="linenos">2660</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting-2661"><a href="#MarkovHitting-2661"><span class="linenos">2661</span></a><span class="sd">        None</span>
</span><span id="MarkovHitting-2662"><a href="#MarkovHitting-2662"><span class="linenos">2662</span></a>
</span><span id="MarkovHitting-2663"><a href="#MarkovHitting-2663"><span class="linenos">2663</span></a><span class="sd">        Raises</span>
</span><span id="MarkovHitting-2664"><a href="#MarkovHitting-2664"><span class="linenos">2664</span></a><span class="sd">        ------</span>
</span><span id="MarkovHitting-2665"><a href="#MarkovHitting-2665"><span class="linenos">2665</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovHitting-2666"><a href="#MarkovHitting-2666"><span class="linenos">2666</span></a><span class="sd">            If any required variables have not been set</span>
</span><span id="MarkovHitting-2667"><a href="#MarkovHitting-2667"><span class="linenos">2667</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2668"><a href="#MarkovHitting-2668"><span class="linenos">2668</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovHitting-2669"><a href="#MarkovHitting-2669"><span class="linenos">2669</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]):</span>
</span><span id="MarkovHitting-2670"><a href="#MarkovHitting-2670"><span class="linenos">2670</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pi[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] needs to be set to a constant or linked to an ML output&quot;</span><span class="p">)</span>
</span><span id="MarkovHitting-2671"><a href="#MarkovHitting-2671"><span class="linenos">2671</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovHitting-2672"><a href="#MarkovHitting-2672"><span class="linenos">2672</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovHitting-2673"><a href="#MarkovHitting-2673"><span class="linenos">2673</span></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_const</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]):</span>
</span><span id="MarkovHitting-2674"><a href="#MarkovHitting-2674"><span class="linenos">2674</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] needs to be set to a constant or linked to an ML output&quot;</span><span class="p">)</span>
</span><span id="MarkovHitting-2675"><a href="#MarkovHitting-2675"><span class="linenos">2675</span></a>
</span><span id="MarkovHitting-2676"><a href="#MarkovHitting-2676"><span class="linenos">2676</span></a>    <span class="k">def</span> <span class="nf">_set_objective</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovHitting-2677"><a href="#MarkovHitting-2677"><span class="linenos">2677</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2678"><a href="#MarkovHitting-2678"><span class="linenos">2678</span></a><span class="sd">        Sets the objective function to pi * v.</span>
</span><span id="MarkovHitting-2679"><a href="#MarkovHitting-2679"><span class="linenos">2679</span></a>
</span><span id="MarkovHitting-2680"><a href="#MarkovHitting-2680"><span class="linenos">2680</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting-2681"><a href="#MarkovHitting-2681"><span class="linenos">2681</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting-2682"><a href="#MarkovHitting-2682"><span class="linenos">2682</span></a><span class="sd">        None</span>
</span><span id="MarkovHitting-2683"><a href="#MarkovHitting-2683"><span class="linenos">2683</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2684"><a href="#MarkovHitting-2684"><span class="linenos">2684</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">setObjective</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)))</span>
</span><span id="MarkovHitting-2685"><a href="#MarkovHitting-2685"><span class="linenos">2685</span></a>
</span><span id="MarkovHitting-2686"><a href="#MarkovHitting-2686"><span class="linenos">2686</span></a>    <span class="k">def</span> <span class="nf">_set_feasible_constraints</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lb</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovHitting-2687"><a href="#MarkovHitting-2687"><span class="linenos">2687</span></a>                                 <span class="n">ub</span> <span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="MarkovHitting-2688"><a href="#MarkovHitting-2688"><span class="linenos">2688</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2689"><a href="#MarkovHitting-2689"><span class="linenos">2689</span></a><span class="sd">        Sets the feasible constraints on the objective. When looking for a feasible solution,</span>
</span><span id="MarkovHitting-2690"><a href="#MarkovHitting-2690"><span class="linenos">2690</span></a><span class="sd">        this simply adds the constraints: lb &lt;= pi * v &lt;= ub.</span>
</span><span id="MarkovHitting-2691"><a href="#MarkovHitting-2691"><span class="linenos">2691</span></a>
</span><span id="MarkovHitting-2692"><a href="#MarkovHitting-2692"><span class="linenos">2692</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovHitting-2693"><a href="#MarkovHitting-2693"><span class="linenos">2693</span></a><span class="sd">        ----------</span>
</span><span id="MarkovHitting-2694"><a href="#MarkovHitting-2694"><span class="linenos">2694</span></a><span class="sd">        lb : float | int</span>
</span><span id="MarkovHitting-2695"><a href="#MarkovHitting-2695"><span class="linenos">2695</span></a><span class="sd">            The lower bound</span>
</span><span id="MarkovHitting-2696"><a href="#MarkovHitting-2696"><span class="linenos">2696</span></a><span class="sd">        ub : float | int</span>
</span><span id="MarkovHitting-2697"><a href="#MarkovHitting-2697"><span class="linenos">2697</span></a><span class="sd">            The upper bound</span>
</span><span id="MarkovHitting-2698"><a href="#MarkovHitting-2698"><span class="linenos">2698</span></a>
</span><span id="MarkovHitting-2699"><a href="#MarkovHitting-2699"><span class="linenos">2699</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting-2700"><a href="#MarkovHitting-2700"><span class="linenos">2700</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting-2701"><a href="#MarkovHitting-2701"><span class="linenos">2701</span></a><span class="sd">        None</span>
</span><span id="MarkovHitting-2702"><a href="#MarkovHitting-2702"><span class="linenos">2702</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2703"><a href="#MarkovHitting-2703"><span class="linenos">2703</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span> <span class="o">&gt;=</span> <span class="n">lb</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;temp_feasible_lb&quot;</span><span class="p">)</span>
</span><span id="MarkovHitting-2704"><a href="#MarkovHitting-2704"><span class="linenos">2704</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addConstr</span><span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">quicksum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">))</span> <span class="o">&lt;=</span> <span class="n">ub</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;temp_feasible_ub&quot;</span><span class="p">)</span>
</span><span id="MarkovHitting-2705"><a href="#MarkovHitting-2705"><span class="linenos">2705</span></a>
</span><span id="MarkovHitting-2706"><a href="#MarkovHitting-2706"><span class="linenos">2706</span></a>    <span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovHitting-2707"><a href="#MarkovHitting-2707"><span class="linenos">2707</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2708"><a href="#MarkovHitting-2708"><span class="linenos">2708</span></a><span class="sd">        Returns the values of pi, Q, v, features, and ml_outputs as a dictionary.</span>
</span><span id="MarkovHitting-2709"><a href="#MarkovHitting-2709"><span class="linenos">2709</span></a>
</span><span id="MarkovHitting-2710"><a href="#MarkovHitting-2710"><span class="linenos">2710</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting-2711"><a href="#MarkovHitting-2711"><span class="linenos">2711</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting-2712"><a href="#MarkovHitting-2712"><span class="linenos">2712</span></a><span class="sd">        dict</span>
</span><span id="MarkovHitting-2713"><a href="#MarkovHitting-2713"><span class="linenos">2713</span></a><span class="sd">            A dictionary with keys:</span>
</span><span id="MarkovHitting-2714"><a href="#MarkovHitting-2714"><span class="linenos">2714</span></a><span class="sd">            - `pi`: the values of pi</span>
</span><span id="MarkovHitting-2715"><a href="#MarkovHitting-2715"><span class="linenos">2715</span></a><span class="sd">            - `Q`: the values of Q</span>
</span><span id="MarkovHitting-2716"><a href="#MarkovHitting-2716"><span class="linenos">2716</span></a><span class="sd">            - `v`: the values of v</span>
</span><span id="MarkovHitting-2717"><a href="#MarkovHitting-2717"><span class="linenos">2717</span></a><span class="sd">            - `features`: the values of the features</span>
</span><span id="MarkovHitting-2718"><a href="#MarkovHitting-2718"><span class="linenos">2718</span></a><span class="sd">            - `ml_outputs`: the values of the ml_outputs</span>
</span><span id="MarkovHitting-2719"><a href="#MarkovHitting-2719"><span class="linenos">2719</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2720"><a href="#MarkovHitting-2720"><span class="linenos">2720</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="MarkovHitting-2721"><a href="#MarkovHitting-2721"><span class="linenos">2721</span></a>            <span class="s2">&quot;pi&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="MarkovHitting-2722"><a href="#MarkovHitting-2722"><span class="linenos">2722</span></a>            <span class="s2">&quot;Q&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="MarkovHitting-2723"><a href="#MarkovHitting-2723"><span class="linenos">2723</span></a>            <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="MarkovHitting-2724"><a href="#MarkovHitting-2724"><span class="linenos">2724</span></a>            <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">)],</span>
</span><span id="MarkovHitting-2725"><a href="#MarkovHitting-2725"><span class="linenos">2725</span></a>            <span class="s2">&quot;ml_outputs&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]))]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">))]</span>
</span><span id="MarkovHitting-2726"><a href="#MarkovHitting-2726"><span class="linenos">2726</span></a>        <span class="p">}</span>
</span><span id="MarkovHitting-2727"><a href="#MarkovHitting-2727"><span class="linenos">2727</span></a>
</span><span id="MarkovHitting-2728"><a href="#MarkovHitting-2728"><span class="linenos">2728</span></a>    <span class="k">def</span> <span class="nf">_compute_affine_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ml_bounds</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]):</span>
</span><span id="MarkovHitting-2729"><a href="#MarkovHitting-2729"><span class="linenos">2729</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2730"><a href="#MarkovHitting-2730"><span class="linenos">2730</span></a><span class="sd">        Computes the affine bounds for the parameters that are linked to ML outputs.</span>
</span><span id="MarkovHitting-2731"><a href="#MarkovHitting-2731"><span class="linenos">2731</span></a>
</span><span id="MarkovHitting-2732"><a href="#MarkovHitting-2732"><span class="linenos">2732</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovHitting-2733"><a href="#MarkovHitting-2733"><span class="linenos">2733</span></a><span class="sd">        ----------</span>
</span><span id="MarkovHitting-2734"><a href="#MarkovHitting-2734"><span class="linenos">2734</span></a><span class="sd">        ml_bounds : List[List[Tuple[float, float]]]</span>
</span><span id="MarkovHitting-2735"><a href="#MarkovHitting-2735"><span class="linenos">2735</span></a><span class="sd">            The bounds for the ML outputs</span>
</span><span id="MarkovHitting-2736"><a href="#MarkovHitting-2736"><span class="linenos">2736</span></a>
</span><span id="MarkovHitting-2737"><a href="#MarkovHitting-2737"><span class="linenos">2737</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting-2738"><a href="#MarkovHitting-2738"><span class="linenos">2738</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting-2739"><a href="#MarkovHitting-2739"><span class="linenos">2739</span></a><span class="sd">        dict</span>
</span><span id="MarkovHitting-2740"><a href="#MarkovHitting-2740"><span class="linenos">2740</span></a><span class="sd">            A dictionary with keys: &#39;pi&#39;, and &#39;Q&#39;</span>
</span><span id="MarkovHitting-2741"><a href="#MarkovHitting-2741"><span class="linenos">2741</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2742"><a href="#MarkovHitting-2742"><span class="linenos">2742</span></a>        <span class="c1"># Convert ml_bounds to dictionary for easier lookup</span>
</span><span id="MarkovHitting-2743"><a href="#MarkovHitting-2743"><span class="linenos">2743</span></a>        <span class="n">bounds_dict</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MarkovHitting-2744"><a href="#MarkovHitting-2744"><span class="linenos">2744</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">model_bounds</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ml_bounds</span><span class="p">):</span>
</span><span id="MarkovHitting-2745"><a href="#MarkovHitting-2745"><span class="linenos">2745</span></a>            <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">model_bounds</span><span class="p">):</span>
</span><span id="MarkovHitting-2746"><a href="#MarkovHitting-2746"><span class="linenos">2746</span></a>                <span class="n">bounds_dict</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;ml_outputs_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">[</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="MarkovHitting-2747"><a href="#MarkovHitting-2747"><span class="linenos">2747</span></a>
</span><span id="MarkovHitting-2748"><a href="#MarkovHitting-2748"><span class="linenos">2748</span></a>        <span class="c1"># Initialize bounds dictionary</span>
</span><span id="MarkovHitting-2749"><a href="#MarkovHitting-2749"><span class="linenos">2749</span></a>        <span class="n">affine_bounds</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="MarkovHitting-2750"><a href="#MarkovHitting-2750"><span class="linenos">2750</span></a>            <span class="s1">&#39;pi&#39;</span><span class="p">:</span> <span class="p">[],</span>
</span><span id="MarkovHitting-2751"><a href="#MarkovHitting-2751"><span class="linenos">2751</span></a>            <span class="s1">&#39;Q&#39;</span><span class="p">:</span> <span class="p">[]</span>
</span><span id="MarkovHitting-2752"><a href="#MarkovHitting-2752"><span class="linenos">2752</span></a>        <span class="p">}</span>
</span><span id="MarkovHitting-2753"><a href="#MarkovHitting-2753"><span class="linenos">2753</span></a>
</span><span id="MarkovHitting-2754"><a href="#MarkovHitting-2754"><span class="linenos">2754</span></a>        <span class="c1"># Compute bounds for each parameter that is an ML output</span>
</span><span id="MarkovHitting-2755"><a href="#MarkovHitting-2755"><span class="linenos">2755</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovHitting-2756"><a href="#MarkovHitting-2756"><span class="linenos">2756</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]:</span>
</span><span id="MarkovHitting-2757"><a href="#MarkovHitting-2757"><span class="linenos">2757</span></a>                <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ml_expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovHitting-2758"><a href="#MarkovHitting-2758"><span class="linenos">2758</span></a>                <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_expr_bounds</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">bounds_dict</span><span class="p">)))</span>
</span><span id="MarkovHitting-2759"><a href="#MarkovHitting-2759"><span class="linenos">2759</span></a>
</span><span id="MarkovHitting-2760"><a href="#MarkovHitting-2760"><span class="linenos">2760</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovHitting-2761"><a href="#MarkovHitting-2761"><span class="linenos">2761</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovHitting-2762"><a href="#MarkovHitting-2762"><span class="linenos">2762</span></a>                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_is_ml_output</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]:</span>
</span><span id="MarkovHitting-2763"><a href="#MarkovHitting-2763"><span class="linenos">2763</span></a>                    <span class="n">expr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_ml_expr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">])</span>
</span><span id="MarkovHitting-2764"><a href="#MarkovHitting-2764"><span class="linenos">2764</span></a>                    <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_compute_expr_bounds</span><span class="p">(</span><span class="n">expr</span><span class="p">,</span> <span class="n">bounds_dict</span><span class="p">)))</span>
</span><span id="MarkovHitting-2765"><a href="#MarkovHitting-2765"><span class="linenos">2765</span></a>
</span><span id="MarkovHitting-2766"><a href="#MarkovHitting-2766"><span class="linenos">2766</span></a>        <span class="k">return</span> <span class="n">affine_bounds</span>
</span><span id="MarkovHitting-2767"><a href="#MarkovHitting-2767"><span class="linenos">2767</span></a>
</span><span id="MarkovHitting-2768"><a href="#MarkovHitting-2768"><span class="linenos">2768</span></a>    <span class="k">def</span> <span class="nf">_set_affine_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">affine_bounds</span> <span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="MarkovHitting-2769"><a href="#MarkovHitting-2769"><span class="linenos">2769</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2770"><a href="#MarkovHitting-2770"><span class="linenos">2770</span></a><span class="sd">        Sets the bounds for the parameters that are linked to ML outputs.</span>
</span><span id="MarkovHitting-2771"><a href="#MarkovHitting-2771"><span class="linenos">2771</span></a>
</span><span id="MarkovHitting-2772"><a href="#MarkovHitting-2772"><span class="linenos">2772</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovHitting-2773"><a href="#MarkovHitting-2773"><span class="linenos">2773</span></a><span class="sd">        ----------</span>
</span><span id="MarkovHitting-2774"><a href="#MarkovHitting-2774"><span class="linenos">2774</span></a><span class="sd">        affine_bounds : dict</span>
</span><span id="MarkovHitting-2775"><a href="#MarkovHitting-2775"><span class="linenos">2775</span></a><span class="sd">            The bounds for the ML outputs</span>
</span><span id="MarkovHitting-2776"><a href="#MarkovHitting-2776"><span class="linenos">2776</span></a>
</span><span id="MarkovHitting-2777"><a href="#MarkovHitting-2777"><span class="linenos">2777</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting-2778"><a href="#MarkovHitting-2778"><span class="linenos">2778</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting-2779"><a href="#MarkovHitting-2779"><span class="linenos">2779</span></a><span class="sd">        None</span>
</span><span id="MarkovHitting-2780"><a href="#MarkovHitting-2780"><span class="linenos">2780</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2781"><a href="#MarkovHitting-2781"><span class="linenos">2781</span></a>        <span class="c1"># Set bounds only for parameters that are ML outputs</span>
</span><span id="MarkovHitting-2782"><a href="#MarkovHitting-2782"><span class="linenos">2782</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]:</span>
</span><span id="MarkovHitting-2783"><a href="#MarkovHitting-2783"><span class="linenos">2783</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="MarkovHitting-2784"><a href="#MarkovHitting-2784"><span class="linenos">2784</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="MarkovHitting-2785"><a href="#MarkovHitting-2785"><span class="linenos">2785</span></a>
</span><span id="MarkovHitting-2786"><a href="#MarkovHitting-2786"><span class="linenos">2786</span></a>        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">ub</span><span class="p">)</span> <span class="ow">in</span> <span class="n">affine_bounds</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]:</span>
</span><span id="MarkovHitting-2787"><a href="#MarkovHitting-2787"><span class="linenos">2787</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="MarkovHitting-2788"><a href="#MarkovHitting-2788"><span class="linenos">2788</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="MarkovHitting-2789"><a href="#MarkovHitting-2789"><span class="linenos">2789</span></a>
</span><span id="MarkovHitting-2790"><a href="#MarkovHitting-2790"><span class="linenos">2790</span></a>    <span class="k">def</span> <span class="nf">_compute_initial_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovHitting-2791"><a href="#MarkovHitting-2791"><span class="linenos">2791</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2792"><a href="#MarkovHitting-2792"><span class="linenos">2792</span></a><span class="sd">        Computes the initial bounds for v. Simply, for each $v_i$, $ 0 \leq v_i \leq 1 / \\epsilon$ where</span>
</span><span id="MarkovHitting-2793"><a href="#MarkovHitting-2793"><span class="linenos">2793</span></a><span class="sd">        $\\epsilon$ is the small numerical offset for the strict substochasticity.</span>
</span><span id="MarkovHitting-2794"><a href="#MarkovHitting-2794"><span class="linenos">2794</span></a>
</span><span id="MarkovHitting-2795"><a href="#MarkovHitting-2795"><span class="linenos">2795</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting-2796"><a href="#MarkovHitting-2796"><span class="linenos">2796</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting-2797"><a href="#MarkovHitting-2797"><span class="linenos">2797</span></a><span class="sd">        List[Tuple[float, float]]</span>
</span><span id="MarkovHitting-2798"><a href="#MarkovHitting-2798"><span class="linenos">2798</span></a><span class="sd">            The initial bounds for v</span>
</span><span id="MarkovHitting-2799"><a href="#MarkovHitting-2799"><span class="linenos">2799</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2800"><a href="#MarkovHitting-2800"><span class="linenos">2800</span></a>        <span class="c1"># Compute v bounds using epsilon</span>
</span><span id="MarkovHitting-2801"><a href="#MarkovHitting-2801"><span class="linenos">2801</span></a>        <span class="n">v_min</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MarkovHitting-2802"><a href="#MarkovHitting-2802"><span class="linenos">2802</span></a>        <span class="n">v_max</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">_epsilon</span>
</span><span id="MarkovHitting-2803"><a href="#MarkovHitting-2803"><span class="linenos">2803</span></a>
</span><span id="MarkovHitting-2804"><a href="#MarkovHitting-2804"><span class="linenos">2804</span></a>        <span class="c1"># Return bounds for each state</span>
</span><span id="MarkovHitting-2805"><a href="#MarkovHitting-2805"><span class="linenos">2805</span></a>        <span class="k">return</span> <span class="p">[(</span><span class="n">v_min</span><span class="p">,</span> <span class="n">v_max</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="MarkovHitting-2806"><a href="#MarkovHitting-2806"><span class="linenos">2806</span></a>
</span><span id="MarkovHitting-2807"><a href="#MarkovHitting-2807"><span class="linenos">2807</span></a>    <span class="k">def</span> <span class="nf">_set_initial_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">initial_v_bounds</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]):</span>
</span><span id="MarkovHitting-2808"><a href="#MarkovHitting-2808"><span class="linenos">2808</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2809"><a href="#MarkovHitting-2809"><span class="linenos">2809</span></a><span class="sd">        Sets the initial bounds for v.</span>
</span><span id="MarkovHitting-2810"><a href="#MarkovHitting-2810"><span class="linenos">2810</span></a>
</span><span id="MarkovHitting-2811"><a href="#MarkovHitting-2811"><span class="linenos">2811</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovHitting-2812"><a href="#MarkovHitting-2812"><span class="linenos">2812</span></a><span class="sd">        ----------</span>
</span><span id="MarkovHitting-2813"><a href="#MarkovHitting-2813"><span class="linenos">2813</span></a><span class="sd">        initial_v_bounds : List[Tuple[float, float]]</span>
</span><span id="MarkovHitting-2814"><a href="#MarkovHitting-2814"><span class="linenos">2814</span></a><span class="sd">            The initial bounds for v</span>
</span><span id="MarkovHitting-2815"><a href="#MarkovHitting-2815"><span class="linenos">2815</span></a>
</span><span id="MarkovHitting-2816"><a href="#MarkovHitting-2816"><span class="linenos">2816</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting-2817"><a href="#MarkovHitting-2817"><span class="linenos">2817</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting-2818"><a href="#MarkovHitting-2818"><span class="linenos">2818</span></a><span class="sd">        None</span>
</span><span id="MarkovHitting-2819"><a href="#MarkovHitting-2819"><span class="linenos">2819</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2820"><a href="#MarkovHitting-2820"><span class="linenos">2820</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovHitting-2821"><a href="#MarkovHitting-2821"><span class="linenos">2821</span></a>            <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">initial_v_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="MarkovHitting-2822"><a href="#MarkovHitting-2822"><span class="linenos">2822</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="MarkovHitting-2823"><a href="#MarkovHitting-2823"><span class="linenos">2823</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="MarkovHitting-2824"><a href="#MarkovHitting-2824"><span class="linenos">2824</span></a>
</span><span id="MarkovHitting-2825"><a href="#MarkovHitting-2825"><span class="linenos">2825</span></a>    <span class="k">def</span> <span class="nf">_compute_tightened_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovHitting-2826"><a href="#MarkovHitting-2826"><span class="linenos">2826</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2827"><a href="#MarkovHitting-2827"><span class="linenos">2827</span></a><span class="sd">        Computes the tightened bounds for v using the bounds for Q and initial bounds for v.</span>
</span><span id="MarkovHitting-2828"><a href="#MarkovHitting-2828"><span class="linenos">2828</span></a><span class="sd">        This uses Gauss-Seidel to solve the linear system: $vM = 1$, where $M = I - Q$.</span>
</span><span id="MarkovHitting-2829"><a href="#MarkovHitting-2829"><span class="linenos">2829</span></a>
</span><span id="MarkovHitting-2830"><a href="#MarkovHitting-2830"><span class="linenos">2830</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting-2831"><a href="#MarkovHitting-2831"><span class="linenos">2831</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting-2832"><a href="#MarkovHitting-2832"><span class="linenos">2832</span></a><span class="sd">        List[Tuple[float, float]]</span>
</span><span id="MarkovHitting-2833"><a href="#MarkovHitting-2833"><span class="linenos">2833</span></a><span class="sd">            The tightened bounds for v</span>
</span><span id="MarkovHitting-2834"><a href="#MarkovHitting-2834"><span class="linenos">2834</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2835"><a href="#MarkovHitting-2835"><span class="linenos">2835</span></a>        <span class="c1"># Create interval matrices for Q</span>
</span><span id="MarkovHitting-2836"><a href="#MarkovHitting-2836"><span class="linenos">2836</span></a>        <span class="n">Q_intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="MarkovHitting-2837"><a href="#MarkovHitting-2837"><span class="linenos">2837</span></a>
</span><span id="MarkovHitting-2838"><a href="#MarkovHitting-2838"><span class="linenos">2838</span></a>        <span class="c1"># Fill intervals from current bounds</span>
</span><span id="MarkovHitting-2839"><a href="#MarkovHitting-2839"><span class="linenos">2839</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovHitting-2840"><a href="#MarkovHitting-2840"><span class="linenos">2840</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovHitting-2841"><a href="#MarkovHitting-2841"><span class="linenos">2841</span></a>                <span class="n">Q_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span><span class="p">]</span>
</span><span id="MarkovHitting-2842"><a href="#MarkovHitting-2842"><span class="linenos">2842</span></a>
</span><span id="MarkovHitting-2843"><a href="#MarkovHitting-2843"><span class="linenos">2843</span></a>        <span class="c1"># Create linear system: Mv = 1, where M = I - Q</span>
</span><span id="MarkovHitting-2844"><a href="#MarkovHitting-2844"><span class="linenos">2844</span></a>        <span class="n">I</span> <span class="o">=</span> <span class="n">ima</span><span class="o">.</span><span class="n">_identity_interval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
</span><span id="MarkovHitting-2845"><a href="#MarkovHitting-2845"><span class="linenos">2845</span></a>        <span class="n">M</span> <span class="o">=</span> <span class="n">ima</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">I</span><span class="p">,</span> <span class="n">Q_intervals</span><span class="p">)</span>
</span><span id="MarkovHitting-2846"><a href="#MarkovHitting-2846"><span class="linenos">2846</span></a>        <span class="n">ones_intervals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="mi">2</span><span class="p">))</span>
</span><span id="MarkovHitting-2847"><a href="#MarkovHitting-2847"><span class="linenos">2847</span></a>
</span><span id="MarkovHitting-2848"><a href="#MarkovHitting-2848"><span class="linenos">2848</span></a>        <span class="c1"># Initial guess using current v bounds</span>
</span><span id="MarkovHitting-2849"><a href="#MarkovHitting-2849"><span class="linenos">2849</span></a>        <span class="n">v0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">LB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">UB</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])])</span>
</span><span id="MarkovHitting-2850"><a href="#MarkovHitting-2850"><span class="linenos">2850</span></a>
</span><span id="MarkovHitting-2851"><a href="#MarkovHitting-2851"><span class="linenos">2851</span></a>        <span class="c1"># Solve using Gauss-Seidel</span>
</span><span id="MarkovHitting-2852"><a href="#MarkovHitting-2852"><span class="linenos">2852</span></a>        <span class="n">v_intervals</span> <span class="o">=</span> <span class="n">ima</span><span class="o">.</span><span class="n">interval_gauss_seidel</span><span class="p">(</span>
</span><span id="MarkovHitting-2853"><a href="#MarkovHitting-2853"><span class="linenos">2853</span></a>            <span class="n">M</span><span class="p">,</span> <span class="n">ones_intervals</span><span class="p">,</span> <span class="n">v0</span><span class="p">,</span>
</span><span id="MarkovHitting-2854"><a href="#MarkovHitting-2854"><span class="linenos">2854</span></a>            <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
</span><span id="MarkovHitting-2855"><a href="#MarkovHitting-2855"><span class="linenos">2855</span></a>            <span class="n">tol</span><span class="o">=</span><span class="mf">1e-6</span>
</span><span id="MarkovHitting-2856"><a href="#MarkovHitting-2856"><span class="linenos">2856</span></a>        <span class="p">)</span>
</span><span id="MarkovHitting-2857"><a href="#MarkovHitting-2857"><span class="linenos">2857</span></a>
</span><span id="MarkovHitting-2858"><a href="#MarkovHitting-2858"><span class="linenos">2858</span></a>        <span class="c1"># Convert to list of tuples</span>
</span><span id="MarkovHitting-2859"><a href="#MarkovHitting-2859"><span class="linenos">2859</span></a>        <span class="k">return</span> <span class="p">[(</span><span class="n">v_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">v_intervals</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])]</span>
</span><span id="MarkovHitting-2860"><a href="#MarkovHitting-2860"><span class="linenos">2860</span></a>
</span><span id="MarkovHitting-2861"><a href="#MarkovHitting-2861"><span class="linenos">2861</span></a>    <span class="k">def</span> <span class="nf">_set_tightened_v_bounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tightened_v_bounds</span> <span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]):</span>
</span><span id="MarkovHitting-2862"><a href="#MarkovHitting-2862"><span class="linenos">2862</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2863"><a href="#MarkovHitting-2863"><span class="linenos">2863</span></a><span class="sd">        Sets the tightened bounds for v.</span>
</span><span id="MarkovHitting-2864"><a href="#MarkovHitting-2864"><span class="linenos">2864</span></a>
</span><span id="MarkovHitting-2865"><a href="#MarkovHitting-2865"><span class="linenos">2865</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovHitting-2866"><a href="#MarkovHitting-2866"><span class="linenos">2866</span></a><span class="sd">        ----------</span>
</span><span id="MarkovHitting-2867"><a href="#MarkovHitting-2867"><span class="linenos">2867</span></a><span class="sd">        tightened_v_bounds : List[Tuple[float, float]]</span>
</span><span id="MarkovHitting-2868"><a href="#MarkovHitting-2868"><span class="linenos">2868</span></a><span class="sd">            The tightened bounds for v</span>
</span><span id="MarkovHitting-2869"><a href="#MarkovHitting-2869"><span class="linenos">2869</span></a>
</span><span id="MarkovHitting-2870"><a href="#MarkovHitting-2870"><span class="linenos">2870</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting-2871"><a href="#MarkovHitting-2871"><span class="linenos">2871</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting-2872"><a href="#MarkovHitting-2872"><span class="linenos">2872</span></a><span class="sd">        None</span>
</span><span id="MarkovHitting-2873"><a href="#MarkovHitting-2873"><span class="linenos">2873</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2874"><a href="#MarkovHitting-2874"><span class="linenos">2874</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovHitting-2875"><a href="#MarkovHitting-2875"><span class="linenos">2875</span></a>            <span class="n">lb</span><span class="p">,</span> <span class="n">ub</span> <span class="o">=</span> <span class="n">tightened_v_bounds</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
</span><span id="MarkovHitting-2876"><a href="#MarkovHitting-2876"><span class="linenos">2876</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_lb</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lb</span><span class="p">)</span>
</span><span id="MarkovHitting-2877"><a href="#MarkovHitting-2877"><span class="linenos">2877</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_update_ub</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">ub</span><span class="p">)</span>
</span><span id="MarkovHitting-2878"><a href="#MarkovHitting-2878"><span class="linenos">2878</span></a>
</span><span id="MarkovHitting-2879"><a href="#MarkovHitting-2879"><span class="linenos">2879</span></a>    <span class="c1"># CLEAN PARAMETER ACCESSORS</span>
</span><span id="MarkovHitting-2880"><a href="#MarkovHitting-2880"><span class="linenos">2880</span></a>
</span><span id="MarkovHitting-2881"><a href="#MarkovHitting-2881"><span class="linenos">2881</span></a>    <span class="nd">@property</span>
</span><span id="MarkovHitting-2882"><a href="#MarkovHitting-2882"><span class="linenos">2882</span></a>    <span class="k">def</span> <span class="nf">pi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovHitting-2883"><a href="#MarkovHitting-2883"><span class="linenos">2883</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2884"><a href="#MarkovHitting-2884"><span class="linenos">2884</span></a><span class="sd">        Accessor for the pi parameter.</span>
</span><span id="MarkovHitting-2885"><a href="#MarkovHitting-2885"><span class="linenos">2885</span></a>
</span><span id="MarkovHitting-2886"><a href="#MarkovHitting-2886"><span class="linenos">2886</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting-2887"><a href="#MarkovHitting-2887"><span class="linenos">2887</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting-2888"><a href="#MarkovHitting-2888"><span class="linenos">2888</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovHitting-2889"><a href="#MarkovHitting-2889"><span class="linenos">2889</span></a><span class="sd">            The pi parameter</span>
</span><span id="MarkovHitting-2890"><a href="#MarkovHitting-2890"><span class="linenos">2890</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2891"><a href="#MarkovHitting-2891"><span class="linenos">2891</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span>
</span><span id="MarkovHitting-2892"><a href="#MarkovHitting-2892"><span class="linenos">2892</span></a>
</span><span id="MarkovHitting-2893"><a href="#MarkovHitting-2893"><span class="linenos">2893</span></a>    <span class="nd">@property</span>
</span><span id="MarkovHitting-2894"><a href="#MarkovHitting-2894"><span class="linenos">2894</span></a>    <span class="k">def</span> <span class="nf">Q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovHitting-2895"><a href="#MarkovHitting-2895"><span class="linenos">2895</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2896"><a href="#MarkovHitting-2896"><span class="linenos">2896</span></a><span class="sd">        Accessor for the Q parameter.</span>
</span><span id="MarkovHitting-2897"><a href="#MarkovHitting-2897"><span class="linenos">2897</span></a>
</span><span id="MarkovHitting-2898"><a href="#MarkovHitting-2898"><span class="linenos">2898</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting-2899"><a href="#MarkovHitting-2899"><span class="linenos">2899</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting-2900"><a href="#MarkovHitting-2900"><span class="linenos">2900</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovHitting-2901"><a href="#MarkovHitting-2901"><span class="linenos">2901</span></a><span class="sd">            The Q parameter</span>
</span><span id="MarkovHitting-2902"><a href="#MarkovHitting-2902"><span class="linenos">2902</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2903"><a href="#MarkovHitting-2903"><span class="linenos">2903</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span>
</span><span id="MarkovHitting-2904"><a href="#MarkovHitting-2904"><span class="linenos">2904</span></a>
</span><span id="MarkovHitting-2905"><a href="#MarkovHitting-2905"><span class="linenos">2905</span></a>    <span class="nd">@property</span>
</span><span id="MarkovHitting-2906"><a href="#MarkovHitting-2906"><span class="linenos">2906</span></a>    <span class="k">def</span> <span class="nf">v</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovHitting-2907"><a href="#MarkovHitting-2907"><span class="linenos">2907</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2908"><a href="#MarkovHitting-2908"><span class="linenos">2908</span></a><span class="sd">        Accessor for the v parameter.</span>
</span><span id="MarkovHitting-2909"><a href="#MarkovHitting-2909"><span class="linenos">2909</span></a>
</span><span id="MarkovHitting-2910"><a href="#MarkovHitting-2910"><span class="linenos">2910</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting-2911"><a href="#MarkovHitting-2911"><span class="linenos">2911</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting-2912"><a href="#MarkovHitting-2912"><span class="linenos">2912</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovHitting-2913"><a href="#MarkovHitting-2913"><span class="linenos">2913</span></a><span class="sd">            The v parameter</span>
</span><span id="MarkovHitting-2914"><a href="#MarkovHitting-2914"><span class="linenos">2914</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2915"><a href="#MarkovHitting-2915"><span class="linenos">2915</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
</span><span id="MarkovHitting-2916"><a href="#MarkovHitting-2916"><span class="linenos">2916</span></a>
</span><span id="MarkovHitting-2917"><a href="#MarkovHitting-2917"><span class="linenos">2917</span></a>    <span class="c1"># HELPER FUNCTIONS TO SET PARAMETERS</span>
</span><span id="MarkovHitting-2918"><a href="#MarkovHitting-2918"><span class="linenos">2918</span></a>
</span><span id="MarkovHitting-2919"><a href="#MarkovHitting-2919"><span class="linenos">2919</span></a>    <span class="k">def</span> <span class="nf">set_pi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]):</span>
</span><span id="MarkovHitting-2920"><a href="#MarkovHitting-2920"><span class="linenos">2920</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2921"><a href="#MarkovHitting-2921"><span class="linenos">2921</span></a><span class="sd">        Helper function to set the entire pi vector.</span>
</span><span id="MarkovHitting-2922"><a href="#MarkovHitting-2922"><span class="linenos">2922</span></a>
</span><span id="MarkovHitting-2923"><a href="#MarkovHitting-2923"><span class="linenos">2923</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovHitting-2924"><a href="#MarkovHitting-2924"><span class="linenos">2924</span></a><span class="sd">        ----------</span>
</span><span id="MarkovHitting-2925"><a href="#MarkovHitting-2925"><span class="linenos">2925</span></a><span class="sd">        values : List[float | int | gp.Var | gp.LinExpr]</span>
</span><span id="MarkovHitting-2926"><a href="#MarkovHitting-2926"><span class="linenos">2926</span></a><span class="sd">            The values to set the pi parameter to</span>
</span><span id="MarkovHitting-2927"><a href="#MarkovHitting-2927"><span class="linenos">2927</span></a>
</span><span id="MarkovHitting-2928"><a href="#MarkovHitting-2928"><span class="linenos">2928</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting-2929"><a href="#MarkovHitting-2929"><span class="linenos">2929</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting-2930"><a href="#MarkovHitting-2930"><span class="linenos">2930</span></a><span class="sd">        None</span>
</span><span id="MarkovHitting-2931"><a href="#MarkovHitting-2931"><span class="linenos">2931</span></a>
</span><span id="MarkovHitting-2932"><a href="#MarkovHitting-2932"><span class="linenos">2932</span></a><span class="sd">        Raises</span>
</span><span id="MarkovHitting-2933"><a href="#MarkovHitting-2933"><span class="linenos">2933</span></a><span class="sd">        ------</span>
</span><span id="MarkovHitting-2934"><a href="#MarkovHitting-2934"><span class="linenos">2934</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovHitting-2935"><a href="#MarkovHitting-2935"><span class="linenos">2935</span></a><span class="sd">            If the values have incorrect length, are not in [0, 1], don&#39;t sum to &lt;=1, or pi is already set</span>
</span><span id="MarkovHitting-2936"><a href="#MarkovHitting-2936"><span class="linenos">2936</span></a>
</span><span id="MarkovHitting-2937"><a href="#MarkovHitting-2937"><span class="linenos">2937</span></a><span class="sd">        Notes</span>
</span><span id="MarkovHitting-2938"><a href="#MarkovHitting-2938"><span class="linenos">2938</span></a><span class="sd">        -----</span>
</span><span id="MarkovHitting-2939"><a href="#MarkovHitting-2939"><span class="linenos">2939</span></a><span class="sd">        This checks for validity of the values, checks if pi is already set, and sets the values.</span>
</span><span id="MarkovHitting-2940"><a href="#MarkovHitting-2940"><span class="linenos">2940</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2941"><a href="#MarkovHitting-2941"><span class="linenos">2941</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_length</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">)</span>
</span><span id="MarkovHitting-2942"><a href="#MarkovHitting-2942"><span class="linenos">2942</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="MarkovHitting-2943"><a href="#MarkovHitting-2943"><span class="linenos">2943</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="MarkovHitting-2944"><a href="#MarkovHitting-2944"><span class="linenos">2944</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MarkovHitting-2945"><a href="#MarkovHitting-2945"><span class="linenos">2945</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;pi&quot;</span><span class="p">),</span>\
</span><span id="MarkovHitting-2946"><a href="#MarkovHitting-2946"><span class="linenos">2946</span></a>              <span class="s2">&quot;pi is already set&quot;</span>
</span><span id="MarkovHitting-2947"><a href="#MarkovHitting-2947"><span class="linenos">2947</span></a>
</span><span id="MarkovHitting-2948"><a href="#MarkovHitting-2948"><span class="linenos">2948</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;pi&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovHitting-2949"><a href="#MarkovHitting-2949"><span class="linenos">2949</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="MarkovHitting-2950"><a href="#MarkovHitting-2950"><span class="linenos">2950</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovHitting-2951"><a href="#MarkovHitting-2951"><span class="linenos">2951</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="MarkovHitting-2952"><a href="#MarkovHitting-2952"><span class="linenos">2952</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovHitting-2953"><a href="#MarkovHitting-2953"><span class="linenos">2953</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MarkovHitting-2954"><a href="#MarkovHitting-2954"><span class="linenos">2954</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pi[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span><span id="MarkovHitting-2955"><a href="#MarkovHitting-2955"><span class="linenos">2955</span></a>
</span><span id="MarkovHitting-2956"><a href="#MarkovHitting-2956"><span class="linenos">2956</span></a>    <span class="k">def</span> <span class="nf">set_Q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]]):</span>
</span><span id="MarkovHitting-2957"><a href="#MarkovHitting-2957"><span class="linenos">2957</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2958"><a href="#MarkovHitting-2958"><span class="linenos">2958</span></a><span class="sd">        Helper function to set the Q matrix.</span>
</span><span id="MarkovHitting-2959"><a href="#MarkovHitting-2959"><span class="linenos">2959</span></a>
</span><span id="MarkovHitting-2960"><a href="#MarkovHitting-2960"><span class="linenos">2960</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovHitting-2961"><a href="#MarkovHitting-2961"><span class="linenos">2961</span></a><span class="sd">        ----------</span>
</span><span id="MarkovHitting-2962"><a href="#MarkovHitting-2962"><span class="linenos">2962</span></a><span class="sd">        values : List[List[float | int | gp.Var | gp.LinExpr]]</span>
</span><span id="MarkovHitting-2963"><a href="#MarkovHitting-2963"><span class="linenos">2963</span></a><span class="sd">            The values to set the Q matrix to</span>
</span><span id="MarkovHitting-2964"><a href="#MarkovHitting-2964"><span class="linenos">2964</span></a>
</span><span id="MarkovHitting-2965"><a href="#MarkovHitting-2965"><span class="linenos">2965</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting-2966"><a href="#MarkovHitting-2966"><span class="linenos">2966</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting-2967"><a href="#MarkovHitting-2967"><span class="linenos">2967</span></a><span class="sd">        None</span>
</span><span id="MarkovHitting-2968"><a href="#MarkovHitting-2968"><span class="linenos">2968</span></a>
</span><span id="MarkovHitting-2969"><a href="#MarkovHitting-2969"><span class="linenos">2969</span></a><span class="sd">        Raises</span>
</span><span id="MarkovHitting-2970"><a href="#MarkovHitting-2970"><span class="linenos">2970</span></a><span class="sd">        ------</span>
</span><span id="MarkovHitting-2971"><a href="#MarkovHitting-2971"><span class="linenos">2971</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovHitting-2972"><a href="#MarkovHitting-2972"><span class="linenos">2972</span></a><span class="sd">            If the values have incorrect length, are not in [0, 1), rows don&#39;t sum to strictly less than 1, or Q is already set</span>
</span><span id="MarkovHitting-2973"><a href="#MarkovHitting-2973"><span class="linenos">2973</span></a>
</span><span id="MarkovHitting-2974"><a href="#MarkovHitting-2974"><span class="linenos">2974</span></a><span class="sd">        Notes</span>
</span><span id="MarkovHitting-2975"><a href="#MarkovHitting-2975"><span class="linenos">2975</span></a><span class="sd">        -----</span>
</span><span id="MarkovHitting-2976"><a href="#MarkovHitting-2976"><span class="linenos">2976</span></a><span class="sd">        This checks for validity of the values, checks if Q is already set, and sets the values.</span>
</span><span id="MarkovHitting-2977"><a href="#MarkovHitting-2977"><span class="linenos">2977</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting-2978"><a href="#MarkovHitting-2978"><span class="linenos">2978</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_shape</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">)</span>
</span><span id="MarkovHitting-2979"><a href="#MarkovHitting-2979"><span class="linenos">2979</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="MarkovHitting-2980"><a href="#MarkovHitting-2980"><span class="linenos">2980</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="MarkovHitting-2981"><a href="#MarkovHitting-2981"><span class="linenos">2981</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_matrix</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">strictsub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Q is strictly substochastic</span>
</span><span id="MarkovHitting-2982"><a href="#MarkovHitting-2982"><span class="linenos">2982</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
</span><span id="MarkovHitting-2983"><a href="#MarkovHitting-2983"><span class="linenos">2983</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="MarkovHitting-2984"><a href="#MarkovHitting-2984"><span class="linenos">2984</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;Q[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">strictsub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Q is strictly substochastic</span>
</span><span id="MarkovHitting-2985"><a href="#MarkovHitting-2985"><span class="linenos">2985</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">),</span>\
</span><span id="MarkovHitting-2986"><a href="#MarkovHitting-2986"><span class="linenos">2986</span></a>              <span class="s2">&quot;Q is already set&quot;</span>
</span><span id="MarkovHitting-2987"><a href="#MarkovHitting-2987"><span class="linenos">2987</span></a>
</span><span id="MarkovHitting-2988"><a href="#MarkovHitting-2988"><span class="linenos">2988</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovHitting-2989"><a href="#MarkovHitting-2989"><span class="linenos">2989</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovHitting-2990"><a href="#MarkovHitting-2990"><span class="linenos">2990</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="MarkovHitting-2991"><a href="#MarkovHitting-2991"><span class="linenos">2991</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="MarkovHitting-2992"><a href="#MarkovHitting-2992"><span class="linenos">2992</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="MarkovHitting-2993"><a href="#MarkovHitting-2993"><span class="linenos">2993</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="MarkovHitting-2994"><a href="#MarkovHitting-2994"><span class="linenos">2994</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MarkovHitting-2995"><a href="#MarkovHitting-2995"><span class="linenos">2995</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>For the hitting time problem.</p>
</div>


                            <div id="MarkovHitting.__init__" class="classattr">
                                        <input id="MarkovHitting.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">MarkovHitting</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">n_states</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">n_transient</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">pi</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">Q</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span>)</span>

                <label class="view-source-button" for="MarkovHitting.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovHitting.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovHitting.__init__-2528"><a href="#MarkovHitting.__init__-2528"><span class="linenos">2528</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_states</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovHitting.__init__-2529"><a href="#MarkovHitting.__init__-2529"><span class="linenos">2529</span></a>                 <span class="n">n_features</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovHitting.__init__-2530"><a href="#MarkovHitting.__init__-2530"><span class="linenos">2530</span></a>                 <span class="n">n_transient</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="MarkovHitting.__init__-2531"><a href="#MarkovHitting.__init__-2531"><span class="linenos">2531</span></a>                 <span class="n">pi</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="MarkovHitting.__init__-2532"><a href="#MarkovHitting.__init__-2532"><span class="linenos">2532</span></a>                 <span class="n">Q</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="MarkovHitting.__init__-2533"><a href="#MarkovHitting.__init__-2533"><span class="linenos">2533</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting.__init__-2534"><a href="#MarkovHitting.__init__-2534"><span class="linenos">2534</span></a><span class="sd">        Initialize a Markov chain for the hitting time problem.</span>
</span><span id="MarkovHitting.__init__-2535"><a href="#MarkovHitting.__init__-2535"><span class="linenos">2535</span></a>
</span><span id="MarkovHitting.__init__-2536"><a href="#MarkovHitting.__init__-2536"><span class="linenos">2536</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovHitting.__init__-2537"><a href="#MarkovHitting.__init__-2537"><span class="linenos">2537</span></a><span class="sd">        ----------</span>
</span><span id="MarkovHitting.__init__-2538"><a href="#MarkovHitting.__init__-2538"><span class="linenos">2538</span></a><span class="sd">        n_states : int</span>
</span><span id="MarkovHitting.__init__-2539"><a href="#MarkovHitting.__init__-2539"><span class="linenos">2539</span></a><span class="sd">            The number of states</span>
</span><span id="MarkovHitting.__init__-2540"><a href="#MarkovHitting.__init__-2540"><span class="linenos">2540</span></a><span class="sd">        n_features : int</span>
</span><span id="MarkovHitting.__init__-2541"><a href="#MarkovHitting.__init__-2541"><span class="linenos">2541</span></a><span class="sd">            The number of features</span>
</span><span id="MarkovHitting.__init__-2542"><a href="#MarkovHitting.__init__-2542"><span class="linenos">2542</span></a><span class="sd">        n_transient : int</span>
</span><span id="MarkovHitting.__init__-2543"><a href="#MarkovHitting.__init__-2543"><span class="linenos">2543</span></a><span class="sd">            The number of transient states ($|T|$ in the paper)</span>
</span><span id="MarkovHitting.__init__-2544"><a href="#MarkovHitting.__init__-2544"><span class="linenos">2544</span></a><span class="sd">        pi : Optional[List | np.ndarray]</span>
</span><span id="MarkovHitting.__init__-2545"><a href="#MarkovHitting.__init__-2545"><span class="linenos">2545</span></a><span class="sd">            The initial state distribution over transient states</span>
</span><span id="MarkovHitting.__init__-2546"><a href="#MarkovHitting.__init__-2546"><span class="linenos">2546</span></a><span class="sd">        Q : Optional[List[List] | np.ndarray]</span>
</span><span id="MarkovHitting.__init__-2547"><a href="#MarkovHitting.__init__-2547"><span class="linenos">2547</span></a><span class="sd">            The transition matrix between transient states</span>
</span><span id="MarkovHitting.__init__-2548"><a href="#MarkovHitting.__init__-2548"><span class="linenos">2548</span></a>
</span><span id="MarkovHitting.__init__-2549"><a href="#MarkovHitting.__init__-2549"><span class="linenos">2549</span></a><span class="sd">        Raises</span>
</span><span id="MarkovHitting.__init__-2550"><a href="#MarkovHitting.__init__-2550"><span class="linenos">2550</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting.__init__-2551"><a href="#MarkovHitting.__init__-2551"><span class="linenos">2551</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovHitting.__init__-2552"><a href="#MarkovHitting.__init__-2552"><span class="linenos">2552</span></a><span class="sd">            If the number of transient states is greater than or equal to the number of states</span>
</span><span id="MarkovHitting.__init__-2553"><a href="#MarkovHitting.__init__-2553"><span class="linenos">2553</span></a>
</span><span id="MarkovHitting.__init__-2554"><a href="#MarkovHitting.__init__-2554"><span class="linenos">2554</span></a><span class="sd">        Notes</span>
</span><span id="MarkovHitting.__init__-2555"><a href="#MarkovHitting.__init__-2555"><span class="linenos">2555</span></a><span class="sd">        -----</span>
</span><span id="MarkovHitting.__init__-2556"><a href="#MarkovHitting.__init__-2556"><span class="linenos">2556</span></a><span class="sd">        Calls the constructor of the parent class AbstractMarkov, with additional attributes.</span>
</span><span id="MarkovHitting.__init__-2557"><a href="#MarkovHitting.__init__-2557"><span class="linenos">2557</span></a><span class="sd">        Then, initializes the defining parameters and constraints for the hitting time problem.</span>
</span><span id="MarkovHitting.__init__-2558"><a href="#MarkovHitting.__init__-2558"><span class="linenos">2558</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting.__init__-2559"><a href="#MarkovHitting.__init__-2559"><span class="linenos">2559</span></a>
</span><span id="MarkovHitting.__init__-2560"><a href="#MarkovHitting.__init__-2560"><span class="linenos">2560</span></a>        <span class="k">if</span> <span class="n">n_transient</span> <span class="o">&gt;=</span> <span class="n">n_states</span><span class="p">:</span>
</span><span id="MarkovHitting.__init__-2561"><a href="#MarkovHitting.__init__-2561"><span class="linenos">2561</span></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Number of transient states must be less than number of states&quot;</span><span class="p">)</span>
</span><span id="MarkovHitting.__init__-2562"><a href="#MarkovHitting.__init__-2562"><span class="linenos">2562</span></a>
</span><span id="MarkovHitting.__init__-2563"><a href="#MarkovHitting.__init__-2563"><span class="linenos">2563</span></a>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">n_states</span><span class="p">,</span> <span class="n">n_features</span><span class="p">)</span>
</span><span id="MarkovHitting.__init__-2564"><a href="#MarkovHitting.__init__-2564"><span class="linenos">2564</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span> <span class="o">=</span> <span class="n">n_transient</span>
</span><span id="MarkovHitting.__init__-2565"><a href="#MarkovHitting.__init__-2565"><span class="linenos">2565</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_parameters_and_constraints</span><span class="p">(</span><span class="n">pi</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Initialize a Markov chain for the hitting time problem.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>n_states</strong> (int):
The number of states</li>
<li><strong>n_features</strong> (int):
The number of features</li>
<li><strong>n_transient</strong> (int):
The number of transient states ($|T|$ in the paper)</li>
<li><strong>pi</strong> (Optional[List | np.ndarray]):
The initial state distribution over transient states</li>
<li><strong>Q</strong> (Optional[List[List] | np.ndarray]):
The transition matrix between transient states</li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If the number of transient states is greater than or equal to the number of states</li>
</ul>

<h6 id="notes">Notes</h6>

<p>Calls the constructor of the parent class AbstractMarkov, with additional attributes.
Then, initializes the defining parameters and constraints for the hitting time problem.</p>
</div>


                            </div>
                            <div id="MarkovHitting.n_transient" class="classattr">
                                <div class="attr variable">
            <span class="name">n_transient</span>

        
    </div>
    <a class="headerlink" href="#MarkovHitting.n_transient"></a>
    
    

                            </div>
                            <div id="MarkovHitting.get_values" class="classattr">
                                        <input id="MarkovHitting.get_values-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_values</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MarkovHitting.get_values-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovHitting.get_values"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovHitting.get_values-2706"><a href="#MarkovHitting.get_values-2706"><span class="linenos">2706</span></a>    <span class="k">def</span> <span class="nf">get_values</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovHitting.get_values-2707"><a href="#MarkovHitting.get_values-2707"><span class="linenos">2707</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting.get_values-2708"><a href="#MarkovHitting.get_values-2708"><span class="linenos">2708</span></a><span class="sd">        Returns the values of pi, Q, v, features, and ml_outputs as a dictionary.</span>
</span><span id="MarkovHitting.get_values-2709"><a href="#MarkovHitting.get_values-2709"><span class="linenos">2709</span></a>
</span><span id="MarkovHitting.get_values-2710"><a href="#MarkovHitting.get_values-2710"><span class="linenos">2710</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting.get_values-2711"><a href="#MarkovHitting.get_values-2711"><span class="linenos">2711</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting.get_values-2712"><a href="#MarkovHitting.get_values-2712"><span class="linenos">2712</span></a><span class="sd">        dict</span>
</span><span id="MarkovHitting.get_values-2713"><a href="#MarkovHitting.get_values-2713"><span class="linenos">2713</span></a><span class="sd">            A dictionary with keys:</span>
</span><span id="MarkovHitting.get_values-2714"><a href="#MarkovHitting.get_values-2714"><span class="linenos">2714</span></a><span class="sd">            - `pi`: the values of pi</span>
</span><span id="MarkovHitting.get_values-2715"><a href="#MarkovHitting.get_values-2715"><span class="linenos">2715</span></a><span class="sd">            - `Q`: the values of Q</span>
</span><span id="MarkovHitting.get_values-2716"><a href="#MarkovHitting.get_values-2716"><span class="linenos">2716</span></a><span class="sd">            - `v`: the values of v</span>
</span><span id="MarkovHitting.get_values-2717"><a href="#MarkovHitting.get_values-2717"><span class="linenos">2717</span></a><span class="sd">            - `features`: the values of the features</span>
</span><span id="MarkovHitting.get_values-2718"><a href="#MarkovHitting.get_values-2718"><span class="linenos">2718</span></a><span class="sd">            - `ml_outputs`: the values of the ml_outputs</span>
</span><span id="MarkovHitting.get_values-2719"><a href="#MarkovHitting.get_values-2719"><span class="linenos">2719</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting.get_values-2720"><a href="#MarkovHitting.get_values-2720"><span class="linenos">2720</span></a>        <span class="k">return</span> <span class="p">{</span>
</span><span id="MarkovHitting.get_values-2721"><a href="#MarkovHitting.get_values-2721"><span class="linenos">2721</span></a>            <span class="s2">&quot;pi&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="MarkovHitting.get_values-2722"><a href="#MarkovHitting.get_values-2722"><span class="linenos">2722</span></a>            <span class="s2">&quot;Q&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="MarkovHitting.get_values-2723"><a href="#MarkovHitting.get_values-2723"><span class="linenos">2723</span></a>            <span class="s2">&quot;v&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">v</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_transient</span><span class="p">)],</span>
</span><span id="MarkovHitting.get_values-2724"><a href="#MarkovHitting.get_values-2724"><span class="linenos">2724</span></a>            <span class="s2">&quot;features&quot;</span><span class="p">:</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">features</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">n_features</span><span class="p">)],</span>
</span><span id="MarkovHitting.get_values-2725"><a href="#MarkovHitting.get_values-2725"><span class="linenos">2725</span></a>            <span class="s2">&quot;ml_outputs&quot;</span><span class="p">:</span> <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">x</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">[</span><span class="n">i</span><span class="p">]))]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ml_outputs</span><span class="p">))]</span>
</span><span id="MarkovHitting.get_values-2726"><a href="#MarkovHitting.get_values-2726"><span class="linenos">2726</span></a>        <span class="p">}</span>
</span></pre></div>


            <div class="docstring"><p>Returns the values of pi, Q, v, features, and ml_outputs as a dictionary.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>dict</strong>: A dictionary with keys:
<ul>
<li><code><a href="#MarkovHitting.pi">pi</a></code>: the values of pi</li>
<li><code><a href="#MarkovHitting.Q">Q</a></code>: the values of Q</li>
<li><code><a href="#MarkovHitting.v">v</a></code>: the values of v</li>
<li><code><a href="#MarkovHitting.features">features</a></code>: the values of the features</li>
<li><code><a href="#MarkovHitting.ml_outputs">ml_outputs</a></code>: the values of the ml_outputs</li>
</ul></li>
</ul>
</div>


                            </div>
                            <div id="MarkovHitting.pi" class="classattr">
                                        <input id="MarkovHitting.pi-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">pi</span>

                <label class="view-source-button" for="MarkovHitting.pi-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovHitting.pi"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovHitting.pi-2881"><a href="#MarkovHitting.pi-2881"><span class="linenos">2881</span></a>    <span class="nd">@property</span>
</span><span id="MarkovHitting.pi-2882"><a href="#MarkovHitting.pi-2882"><span class="linenos">2882</span></a>    <span class="k">def</span> <span class="nf">pi</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovHitting.pi-2883"><a href="#MarkovHitting.pi-2883"><span class="linenos">2883</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting.pi-2884"><a href="#MarkovHitting.pi-2884"><span class="linenos">2884</span></a><span class="sd">        Accessor for the pi parameter.</span>
</span><span id="MarkovHitting.pi-2885"><a href="#MarkovHitting.pi-2885"><span class="linenos">2885</span></a>
</span><span id="MarkovHitting.pi-2886"><a href="#MarkovHitting.pi-2886"><span class="linenos">2886</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting.pi-2887"><a href="#MarkovHitting.pi-2887"><span class="linenos">2887</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting.pi-2888"><a href="#MarkovHitting.pi-2888"><span class="linenos">2888</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovHitting.pi-2889"><a href="#MarkovHitting.pi-2889"><span class="linenos">2889</span></a><span class="sd">            The pi parameter</span>
</span><span id="MarkovHitting.pi-2890"><a href="#MarkovHitting.pi-2890"><span class="linenos">2890</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting.pi-2891"><a href="#MarkovHitting.pi-2891"><span class="linenos">2891</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;pi&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Accessor for the pi parameter.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>gurobipy.tupledict</strong>: The pi parameter</li>
</ul>
</div>


                            </div>
                            <div id="MarkovHitting.Q" class="classattr">
                                        <input id="MarkovHitting.Q-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">Q</span>

                <label class="view-source-button" for="MarkovHitting.Q-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovHitting.Q"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovHitting.Q-2893"><a href="#MarkovHitting.Q-2893"><span class="linenos">2893</span></a>    <span class="nd">@property</span>
</span><span id="MarkovHitting.Q-2894"><a href="#MarkovHitting.Q-2894"><span class="linenos">2894</span></a>    <span class="k">def</span> <span class="nf">Q</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovHitting.Q-2895"><a href="#MarkovHitting.Q-2895"><span class="linenos">2895</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting.Q-2896"><a href="#MarkovHitting.Q-2896"><span class="linenos">2896</span></a><span class="sd">        Accessor for the Q parameter.</span>
</span><span id="MarkovHitting.Q-2897"><a href="#MarkovHitting.Q-2897"><span class="linenos">2897</span></a>
</span><span id="MarkovHitting.Q-2898"><a href="#MarkovHitting.Q-2898"><span class="linenos">2898</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting.Q-2899"><a href="#MarkovHitting.Q-2899"><span class="linenos">2899</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting.Q-2900"><a href="#MarkovHitting.Q-2900"><span class="linenos">2900</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovHitting.Q-2901"><a href="#MarkovHitting.Q-2901"><span class="linenos">2901</span></a><span class="sd">            The Q parameter</span>
</span><span id="MarkovHitting.Q-2902"><a href="#MarkovHitting.Q-2902"><span class="linenos">2902</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting.Q-2903"><a href="#MarkovHitting.Q-2903"><span class="linenos">2903</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Accessor for the Q parameter.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>gurobipy.tupledict</strong>: The Q parameter</li>
</ul>
</div>


                            </div>
                            <div id="MarkovHitting.v" class="classattr">
                                        <input id="MarkovHitting.v-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr variable">
            <span class="name">v</span>

                <label class="view-source-button" for="MarkovHitting.v-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovHitting.v"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovHitting.v-2905"><a href="#MarkovHitting.v-2905"><span class="linenos">2905</span></a>    <span class="nd">@property</span>
</span><span id="MarkovHitting.v-2906"><a href="#MarkovHitting.v-2906"><span class="linenos">2906</span></a>    <span class="k">def</span> <span class="nf">v</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MarkovHitting.v-2907"><a href="#MarkovHitting.v-2907"><span class="linenos">2907</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting.v-2908"><a href="#MarkovHitting.v-2908"><span class="linenos">2908</span></a><span class="sd">        Accessor for the v parameter.</span>
</span><span id="MarkovHitting.v-2909"><a href="#MarkovHitting.v-2909"><span class="linenos">2909</span></a>
</span><span id="MarkovHitting.v-2910"><a href="#MarkovHitting.v-2910"><span class="linenos">2910</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting.v-2911"><a href="#MarkovHitting.v-2911"><span class="linenos">2911</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting.v-2912"><a href="#MarkovHitting.v-2912"><span class="linenos">2912</span></a><span class="sd">        gurobipy.tupledict</span>
</span><span id="MarkovHitting.v-2913"><a href="#MarkovHitting.v-2913"><span class="linenos">2913</span></a><span class="sd">            The v parameter</span>
</span><span id="MarkovHitting.v-2914"><a href="#MarkovHitting.v-2914"><span class="linenos">2914</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting.v-2915"><a href="#MarkovHitting.v-2915"><span class="linenos">2915</span></a>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Accessor for the v parameter.</p>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>gurobipy.tupledict</strong>: The v parameter</li>
</ul>
</div>


                            </div>
                            <div id="MarkovHitting.set_pi" class="classattr">
                                        <input id="MarkovHitting.set_pi-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_pi</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MarkovHitting.set_pi-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovHitting.set_pi"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovHitting.set_pi-2919"><a href="#MarkovHitting.set_pi-2919"><span class="linenos">2919</span></a>    <span class="k">def</span> <span class="nf">set_pi</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]):</span>
</span><span id="MarkovHitting.set_pi-2920"><a href="#MarkovHitting.set_pi-2920"><span class="linenos">2920</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting.set_pi-2921"><a href="#MarkovHitting.set_pi-2921"><span class="linenos">2921</span></a><span class="sd">        Helper function to set the entire pi vector.</span>
</span><span id="MarkovHitting.set_pi-2922"><a href="#MarkovHitting.set_pi-2922"><span class="linenos">2922</span></a>
</span><span id="MarkovHitting.set_pi-2923"><a href="#MarkovHitting.set_pi-2923"><span class="linenos">2923</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovHitting.set_pi-2924"><a href="#MarkovHitting.set_pi-2924"><span class="linenos">2924</span></a><span class="sd">        ----------</span>
</span><span id="MarkovHitting.set_pi-2925"><a href="#MarkovHitting.set_pi-2925"><span class="linenos">2925</span></a><span class="sd">        values : List[float | int | gp.Var | gp.LinExpr]</span>
</span><span id="MarkovHitting.set_pi-2926"><a href="#MarkovHitting.set_pi-2926"><span class="linenos">2926</span></a><span class="sd">            The values to set the pi parameter to</span>
</span><span id="MarkovHitting.set_pi-2927"><a href="#MarkovHitting.set_pi-2927"><span class="linenos">2927</span></a>
</span><span id="MarkovHitting.set_pi-2928"><a href="#MarkovHitting.set_pi-2928"><span class="linenos">2928</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting.set_pi-2929"><a href="#MarkovHitting.set_pi-2929"><span class="linenos">2929</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting.set_pi-2930"><a href="#MarkovHitting.set_pi-2930"><span class="linenos">2930</span></a><span class="sd">        None</span>
</span><span id="MarkovHitting.set_pi-2931"><a href="#MarkovHitting.set_pi-2931"><span class="linenos">2931</span></a>
</span><span id="MarkovHitting.set_pi-2932"><a href="#MarkovHitting.set_pi-2932"><span class="linenos">2932</span></a><span class="sd">        Raises</span>
</span><span id="MarkovHitting.set_pi-2933"><a href="#MarkovHitting.set_pi-2933"><span class="linenos">2933</span></a><span class="sd">        ------</span>
</span><span id="MarkovHitting.set_pi-2934"><a href="#MarkovHitting.set_pi-2934"><span class="linenos">2934</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovHitting.set_pi-2935"><a href="#MarkovHitting.set_pi-2935"><span class="linenos">2935</span></a><span class="sd">            If the values have incorrect length, are not in [0, 1], don&#39;t sum to &lt;=1, or pi is already set</span>
</span><span id="MarkovHitting.set_pi-2936"><a href="#MarkovHitting.set_pi-2936"><span class="linenos">2936</span></a>
</span><span id="MarkovHitting.set_pi-2937"><a href="#MarkovHitting.set_pi-2937"><span class="linenos">2937</span></a><span class="sd">        Notes</span>
</span><span id="MarkovHitting.set_pi-2938"><a href="#MarkovHitting.set_pi-2938"><span class="linenos">2938</span></a><span class="sd">        -----</span>
</span><span id="MarkovHitting.set_pi-2939"><a href="#MarkovHitting.set_pi-2939"><span class="linenos">2939</span></a><span class="sd">        This checks for validity of the values, checks if pi is already set, and sets the values.</span>
</span><span id="MarkovHitting.set_pi-2940"><a href="#MarkovHitting.set_pi-2940"><span class="linenos">2940</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting.set_pi-2941"><a href="#MarkovHitting.set_pi-2941"><span class="linenos">2941</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_length</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">)</span>
</span><span id="MarkovHitting.set_pi-2942"><a href="#MarkovHitting.set_pi-2942"><span class="linenos">2942</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="MarkovHitting.set_pi-2943"><a href="#MarkovHitting.set_pi-2943"><span class="linenos">2943</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_vector_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="MarkovHitting.set_pi-2944"><a href="#MarkovHitting.set_pi-2944"><span class="linenos">2944</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;pi&quot;</span><span class="p">,</span> <span class="n">sub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="MarkovHitting.set_pi-2945"><a href="#MarkovHitting.set_pi-2945"><span class="linenos">2945</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;pi&quot;</span><span class="p">),</span>\
</span><span id="MarkovHitting.set_pi-2946"><a href="#MarkovHitting.set_pi-2946"><span class="linenos">2946</span></a>              <span class="s2">&quot;pi is already set&quot;</span>
</span><span id="MarkovHitting.set_pi-2947"><a href="#MarkovHitting.set_pi-2947"><span class="linenos">2947</span></a>
</span><span id="MarkovHitting.set_pi-2948"><a href="#MarkovHitting.set_pi-2948"><span class="linenos">2948</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;pi&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovHitting.set_pi-2949"><a href="#MarkovHitting.set_pi-2949"><span class="linenos">2949</span></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="MarkovHitting.set_pi-2950"><a href="#MarkovHitting.set_pi-2950"><span class="linenos">2950</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovHitting.set_pi-2951"><a href="#MarkovHitting.set_pi-2951"><span class="linenos">2951</span></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="MarkovHitting.set_pi-2952"><a href="#MarkovHitting.set_pi-2952"><span class="linenos">2952</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pi</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
</span><span id="MarkovHitting.set_pi-2953"><a href="#MarkovHitting.set_pi-2953"><span class="linenos">2953</span></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="MarkovHitting.set_pi-2954"><a href="#MarkovHitting.set_pi-2954"><span class="linenos">2954</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;pi[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Helper function to set the entire pi vector.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>values</strong> (List[float | int | gp.Var | gp.LinExpr]):
The values to set the pi parameter to</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If the values have incorrect length, are not in [0, 1], don't sum to &lt;=1, or pi is already set</li>
</ul>

<h6 id="notes">Notes</h6>

<p>This checks for validity of the values, checks if pi is already set, and sets the values.</p>
</div>


                            </div>
                            <div id="MarkovHitting.set_Q" class="classattr">
                                        <input id="MarkovHitting.set_Q-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set_Q</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="bp">self</span>,</span><span class="param">	<span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gurobipy</span><span class="o">.</span><span class="n">_core</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MarkovHitting.set_Q-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MarkovHitting.set_Q"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MarkovHitting.set_Q-2956"><a href="#MarkovHitting.set_Q-2956"><span class="linenos">2956</span></a>    <span class="k">def</span> <span class="nf">set_Q</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">List</span><span class="p">[</span><span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">Var</span> <span class="o">|</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">]]):</span>
</span><span id="MarkovHitting.set_Q-2957"><a href="#MarkovHitting.set_Q-2957"><span class="linenos">2957</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span id="MarkovHitting.set_Q-2958"><a href="#MarkovHitting.set_Q-2958"><span class="linenos">2958</span></a><span class="sd">        Helper function to set the Q matrix.</span>
</span><span id="MarkovHitting.set_Q-2959"><a href="#MarkovHitting.set_Q-2959"><span class="linenos">2959</span></a>
</span><span id="MarkovHitting.set_Q-2960"><a href="#MarkovHitting.set_Q-2960"><span class="linenos">2960</span></a><span class="sd">        Parameters</span>
</span><span id="MarkovHitting.set_Q-2961"><a href="#MarkovHitting.set_Q-2961"><span class="linenos">2961</span></a><span class="sd">        ----------</span>
</span><span id="MarkovHitting.set_Q-2962"><a href="#MarkovHitting.set_Q-2962"><span class="linenos">2962</span></a><span class="sd">        values : List[List[float | int | gp.Var | gp.LinExpr]]</span>
</span><span id="MarkovHitting.set_Q-2963"><a href="#MarkovHitting.set_Q-2963"><span class="linenos">2963</span></a><span class="sd">            The values to set the Q matrix to</span>
</span><span id="MarkovHitting.set_Q-2964"><a href="#MarkovHitting.set_Q-2964"><span class="linenos">2964</span></a>
</span><span id="MarkovHitting.set_Q-2965"><a href="#MarkovHitting.set_Q-2965"><span class="linenos">2965</span></a><span class="sd">        Returns</span>
</span><span id="MarkovHitting.set_Q-2966"><a href="#MarkovHitting.set_Q-2966"><span class="linenos">2966</span></a><span class="sd">        -------</span>
</span><span id="MarkovHitting.set_Q-2967"><a href="#MarkovHitting.set_Q-2967"><span class="linenos">2967</span></a><span class="sd">        None</span>
</span><span id="MarkovHitting.set_Q-2968"><a href="#MarkovHitting.set_Q-2968"><span class="linenos">2968</span></a>
</span><span id="MarkovHitting.set_Q-2969"><a href="#MarkovHitting.set_Q-2969"><span class="linenos">2969</span></a><span class="sd">        Raises</span>
</span><span id="MarkovHitting.set_Q-2970"><a href="#MarkovHitting.set_Q-2970"><span class="linenos">2970</span></a><span class="sd">        ------</span>
</span><span id="MarkovHitting.set_Q-2971"><a href="#MarkovHitting.set_Q-2971"><span class="linenos">2971</span></a><span class="sd">        ValueError</span>
</span><span id="MarkovHitting.set_Q-2972"><a href="#MarkovHitting.set_Q-2972"><span class="linenos">2972</span></a><span class="sd">            If the values have incorrect length, are not in [0, 1), rows don&#39;t sum to strictly less than 1, or Q is already set</span>
</span><span id="MarkovHitting.set_Q-2973"><a href="#MarkovHitting.set_Q-2973"><span class="linenos">2973</span></a>
</span><span id="MarkovHitting.set_Q-2974"><a href="#MarkovHitting.set_Q-2974"><span class="linenos">2974</span></a><span class="sd">        Notes</span>
</span><span id="MarkovHitting.set_Q-2975"><a href="#MarkovHitting.set_Q-2975"><span class="linenos">2975</span></a><span class="sd">        -----</span>
</span><span id="MarkovHitting.set_Q-2976"><a href="#MarkovHitting.set_Q-2976"><span class="linenos">2976</span></a><span class="sd">        This checks for validity of the values, checks if Q is already set, and sets the values.</span>
</span><span id="MarkovHitting.set_Q-2977"><a href="#MarkovHitting.set_Q-2977"><span class="linenos">2977</span></a><span class="sd">        &quot;&quot;&quot;</span>
</span><span id="MarkovHitting.set_Q-2978"><a href="#MarkovHitting.set_Q-2978"><span class="linenos">2978</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_shape</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">)</span>
</span><span id="MarkovHitting.set_Q-2979"><a href="#MarkovHitting.set_Q-2979"><span class="linenos">2979</span></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">):</span>
</span><span id="MarkovHitting.set_Q-2980"><a href="#MarkovHitting.set_Q-2980"><span class="linenos">2980</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_matrix_bounds</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="MarkovHitting.set_Q-2981"><a href="#MarkovHitting.set_Q-2981"><span class="linenos">2981</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_matrix</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="s2">&quot;Q&quot;</span><span class="p">,</span> <span class="n">strictsub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Q is strictly substochastic</span>
</span><span id="MarkovHitting.set_Q-2982"><a href="#MarkovHitting.set_Q-2982"><span class="linenos">2982</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)):</span>
</span><span id="MarkovHitting.set_Q-2983"><a href="#MarkovHitting.set_Q-2983"><span class="linenos">2983</span></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_seq_is_all_const</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]):</span>
</span><span id="MarkovHitting.set_Q-2984"><a href="#MarkovHitting.set_Q-2984"><span class="linenos">2984</span></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_validate_stochastic_vector</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="sa">f</span><span class="s2">&quot;Q[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">]&quot;</span><span class="p">,</span> <span class="n">strictsub</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Q is strictly substochastic</span>
</span><span id="MarkovHitting.set_Q-2985"><a href="#MarkovHitting.set_Q-2985"><span class="linenos">2985</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_any_var_set</span><span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">),</span>\
</span><span id="MarkovHitting.set_Q-2986"><a href="#MarkovHitting.set_Q-2986"><span class="linenos">2986</span></a>              <span class="s2">&quot;Q is already set&quot;</span>
</span><span id="MarkovHitting.set_Q-2987"><a href="#MarkovHitting.set_Q-2987"><span class="linenos">2987</span></a>
</span><span id="MarkovHitting.set_Q-2988"><a href="#MarkovHitting.set_Q-2988"><span class="linenos">2988</span></a>        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]):</span>
</span><span id="MarkovHitting.set_Q-2989"><a href="#MarkovHitting.set_Q-2989"><span class="linenos">2989</span></a>            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_var_dim</span><span class="p">[</span><span class="s2">&quot;Q&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]):</span>
</span><span id="MarkovHitting.set_Q-2990"><a href="#MarkovHitting.set_Q-2990"><span class="linenos">2990</span></a>                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
</span><span id="MarkovHitting.set_Q-2991"><a href="#MarkovHitting.set_Q-2991"><span class="linenos">2991</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_const</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="MarkovHitting.set_Q-2992"><a href="#MarkovHitting.set_Q-2992"><span class="linenos">2992</span></a>                <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">],</span> <span class="p">(</span><span class="n">gp</span><span class="o">.</span><span class="n">Var</span><span class="p">,</span> <span class="n">gp</span><span class="o">.</span><span class="n">LinExpr</span><span class="p">)):</span>
</span><span id="MarkovHitting.set_Q-2993"><a href="#MarkovHitting.set_Q-2993"><span class="linenos">2993</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">set_to_ml_output</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span> <span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">])</span>
</span><span id="MarkovHitting.set_Q-2994"><a href="#MarkovHitting.set_Q-2994"><span class="linenos">2994</span></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="MarkovHitting.set_Q-2995"><a href="#MarkovHitting.set_Q-2995"><span class="linenos">2995</span></a>                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Q[</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s2">] must be a float, int, or a Gurobi expression&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Helper function to set the Q matrix.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>values</strong> (List[List[float | int | gp.Var | gp.LinExpr]]):
The values to set the Q matrix to</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>None</strong></li>
</ul>

<h6 id="raises">Raises</h6>

<ul>
<li><strong>ValueError</strong>: If the values have incorrect length, are not in [0, 1), rows don't sum to strictly less than 1, or Q is already set</li>
</ul>

<h6 id="notes">Notes</h6>

<p>This checks for validity of the values, checks if Q is already set, and sets the values.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#AbstractMarkov">AbstractMarkov</a></dt>
                                <dd id="MarkovHitting.n_states" class="variable"><a href="#AbstractMarkov.n_states">n_states</a></dd>
                <dd id="MarkovHitting.n_features" class="variable"><a href="#AbstractMarkov.n_features">n_features</a></dd>
                <dd id="MarkovHitting.model" class="variable"><a href="#AbstractMarkov.model">model</a></dd>
                <dd id="MarkovHitting.variables" class="variable"><a href="#AbstractMarkov.variables">variables</a></dd>
                <dd id="MarkovHitting.features" class="variable"><a href="#AbstractMarkov.features">features</a></dd>
                <dd id="MarkovHitting.feature_aux" class="variable"><a href="#AbstractMarkov.feature_aux">feature_aux</a></dd>
                <dd id="MarkovHitting.feature_constraints" class="variable"><a href="#AbstractMarkov.feature_constraints">feature_constraints</a></dd>
                <dd id="MarkovHitting.ml_models" class="variable"><a href="#AbstractMarkov.ml_models">ml_models</a></dd>
                <dd id="MarkovHitting.ml_outputs" class="variable"><a href="#AbstractMarkov.ml_outputs">ml_outputs</a></dd>
                <dd id="MarkovHitting.set_to_ml_output" class="function"><a href="#AbstractMarkov.set_to_ml_output">set_to_ml_output</a></dd>
                <dd id="MarkovHitting.set_to_const" class="function"><a href="#AbstractMarkov.set_to_const">set_to_const</a></dd>
                <dd id="MarkovHitting.add_feature_constraint" class="function"><a href="#AbstractMarkov.add_feature_constraint">add_feature_constraint</a></dd>
                <dd id="MarkovHitting.add_feature_aux_variable" class="function"><a href="#AbstractMarkov.add_feature_aux_variable">add_feature_aux_variable</a></dd>
                <dd id="MarkovHitting.add_constraint" class="function"><a href="#AbstractMarkov.add_constraint">add_constraint</a></dd>
                <dd id="MarkovHitting.add_ml_model" class="function"><a href="#AbstractMarkov.add_ml_model">add_ml_model</a></dd>
                <dd id="MarkovHitting.optimize" class="function"><a href="#AbstractMarkov.optimize">optimize</a></dd>
                <dd id="MarkovHitting.find_feasible" class="function"><a href="#AbstractMarkov.find_feasible">find_feasible</a></dd>
                <dd id="MarkovHitting.get_value" class="function"><a href="#AbstractMarkov.get_value">get_value</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>